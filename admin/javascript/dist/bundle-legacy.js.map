{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","admin/javascript/src/LeftAndMain.ActionTabSet.js","admin/javascript/src/LeftAndMain.BatchActions.js","admin/javascript/src/LeftAndMain.Content.js","admin/javascript/src/LeftAndMain.EditForm.js","admin/javascript/src/LeftAndMain.FieldDescriptionToggle.js","admin/javascript/src/LeftAndMain.FieldHelp.js","admin/javascript/src/LeftAndMain.Layout.js","admin/javascript/src/LeftAndMain.Menu.js","admin/javascript/src/LeftAndMain.Panel.js","admin/javascript/src/LeftAndMain.Preview.js","admin/javascript/src/LeftAndMain.Tree.js","admin/javascript/src/LeftAndMain.TreeDropdownField.js","admin/javascript/src/LeftAndMain.js","admin/javascript/src/bundles/legacy.js"],"names":[],"mappings":"AAAA;;;ACQA;;;;;;AAEA,iBAAE,OAAF,CAAU,IAAV,EAAgB,UAAS,CAAT,EAAY;AAM3B,GAAE,gCAAF,EAAoC,OAApC,CAA4C;AAE3C,kBAAgB,IAAhB;;AAEA,SAAO,iBAAW;AAEjB,QAAK,MAAL,GAFiB;;AAIjB,QAAK,IAAL,CAAU,EAAC,eAAe,IAAf,EAAqB,UAAU,KAAV,EAAhC,EAJiB;GAAX;;AAOP,YAAU,oBAAW;AAIpB,OAAI,QAAQ,EAAE,gBAAF,EAAoB,IAApB,CAAyB,QAAzB,CAAR,CAJgB;AAKpB,SAAM,IAAN,CAAW,UAAS,KAAT,EAAgB,MAAhB,EAAuB;AACjC,QAAI;AACH,OAAE,MAAF,EAAU,QAAV,GAAqB,GAArB,CAAyB,2BAAzB,EADG;KAAJ,CAEE,OAAO,CAAP,EAAU;AACX,aAAQ,IAAR,CAAa,mDAAb,EADW;KAAV;IAHQ,CAAX,CALoB;AAYpB,KAAE,QAAF,EAAY,GAAZ,CAAgB,2BAAhB,EAZoB;;AAcpB,QAAK,MAAL,GAdoB;GAAX;;AAoBV,0BAAwB,8BAAS,KAAT,EAAgB,EAAhB,EAAoB;AAC3C,QAAK,MAAL,CAAY,KAAZ,EAAmB,EAAnB,EAD2C;GAApB;;AAOxB,WAAS,iBAAS,KAAT,EAAgB,EAAhB,EAAoB;AAC5B,QAAK,kBAAL,CAAwB,KAAxB,EAA+B,EAA/B,EAD4B;GAApB;;AAUT,sBAAoB,4BAAS,KAAT,EAAgB,EAAhB,EAAoB;AACvC,OAAI,OAAO,IAAP;OAAa,QAAQ,EAAE,gBAAF,EAAoB,IAApB,CAAyB,QAAzB,CAAR;OAA4C,aAA7D,CADuC;;AAKvC,mBAAe,sBAAS,KAAT,EAAgB;AAC9B,QAAI,KAAJ,EAAW,KAAX,CAD8B;AAE9B,YAAQ,EAAE,MAAM,MAAN,CAAF,CAAgB,OAAhB,CAAwB,qCAAxB,CAAR,CAF8B;;AAQ9B,QAAI,CAAC,EAAE,MAAM,MAAN,CAAF,CAAgB,OAAhB,CAAwB,IAAxB,EAA8B,MAA9B,IAAwC,CAAC,MAAM,MAAN,EAAc;AAC3D,UAAK,IAAL,CAAU,QAAV,EAAoB,QAApB,EAA8B,KAA9B,EAD2D;AAI3D,aAAQ,EAAE,gBAAF,EAAoB,IAApB,CAAyB,QAAzB,CAAR,CAJ2D;AAK3D,WAAM,IAAN,CAAW,UAAS,KAAT,EAAgB,MAAhB,EAAuB;AACjC,QAAE,MAAF,EAAU,QAAV,GAAqB,GAArB,CAAyB,2BAAzB,EAAsD,aAAtD,EADiC;MAAvB,CAAX,CAL2D;AAQ3D,OAAE,QAAF,EAAY,GAAZ,CAAgB,2BAAhB,EAA6C,aAA7C,EAR2D;KAA5D;IARc,CALwB;;AA0BvC,KAAE,QAAF,EAAY,EAAZ,CAAe,2BAAf,EAA4C,aAA5C,EA1BuC;;AA6BvC,OAAG,MAAM,MAAN,GAAe,CAAf,EAAiB;AACnB,UAAM,IAAN,CAAW,UAAS,KAAT,EAAgB,MAAhB,EAAwB;AAClC,OAAE,MAAF,EAAU,QAAV,GAAqB,EAArB,CAAwB,2BAAxB,EAAqD,aAArD,EADkC;KAAxB,CAAX,CADmB;IAApB;GA7BmB;;AA0CpB,UAAQ,gBAAS,KAAT,EAAgB,EAAhB,EAAoB;AAC3B,OAAI,QAAJ,EAAc,OAAd,EAAuB,WAAvB,EAAoC,KAApC,EAA2C,WAA3C,EAAwD,SAAxD,EAAmE,WAAnE,EAAgF,cAAhF,EAAgG,OAAhG,CAD2B;;AAI3B,cAAW,EAAE,IAAF,EAAQ,IAAR,CAAa,gBAAb,EAA+B,WAA/B,EAAX,CAJ2B;AAK3B,aAAU,EAAE,IAAF,EAAQ,IAAR,CAAa,cAAb,EAA6B,WAA7B,EAAV,CAL2B;AAM3B,iBAAc,CAAC,CAAE,MAAF,EAAU,MAAV,KAAqB,EAAE,QAAF,EAAY,SAAZ,EAArB,GAAgD,OAAjD,CANa;AAO3B,WAAQ,EAAE,IAAF,EAAQ,IAAR,CAAa,cAAb,EAA6B,MAA7B,GAAsC,GAAtC,CAPmB;;AAS3B,iBAAc,GAAG,QAAH,CATa;AAU3B,eAAY,GAAG,MAAH,CAVe;;AAY3B,OAAI,QAAQ,QAAR,IAAoB,WAApB,IAAmC,QAAQ,QAAR,GAAmB,CAAnB,EAAqB;AAC3D,SAAK,QAAL,CAAc,SAAd,EAD2D;;AAG3D,QAAI,UAAU,QAAV,OAAyB,IAAzB,EAA8B;AACjC,mBAAc,CAAC,YAAY,WAAZ,EAAD,CADmB;AAEjC,sBAAiB,YAAY,OAAZ,CAAoB,QAApB,CAAjB,CAFiC;AAGjC,SAAI,cAAJ,EAAmB;AAElB,gBAAU,UAAU,MAAV,GAAmB,GAAnB,GAAyB,eAAe,MAAf,GAAwB,GAAxB,CAFjB;AAGlB,oBAAc,cAAY,OAAZ,CAHI;MAAnB;AAKA,OAAE,WAAF,EAAe,GAAf,CAAmB,KAAnB,EAAyB,cAAY,IAAZ,CAAzB,CARiC;KAAlC;IAHD,MAaO;AAEN,SAAK,WAAL,CAAiB,SAAjB,EAFM;AAGN,QAAI,UAAU,QAAV,OAAyB,IAAzB,EAA8B;AACjC,OAAE,WAAF,EAAe,GAAf,CAAmB,KAAnB,EAAyB,KAAzB,EADiC;KAAlC;IAhBD;AAoBA,UAAO,KAAP,CAhC2B;GAApB;EA1FT,EAN2B;;AAyI3B,GAAE,qDAAF,EAAyD,OAAzD,CAAiE;AAIhE,0BAAwB,8BAAS,KAAT,EAAgB,EAAhB,EAAoB;AAC3C,QAAK,MAAL,CAAY,KAAZ,EAAmB,EAAnB,EAD2C;;AAG3C,OAAG,EAAE,GAAG,QAAH,CAAF,CAAe,MAAf,GAAwB,CAAxB,EAA0B;AAC5B,MAAE,GAAG,QAAH,CAAF,CAAe,GAAf,CAAmB,MAAnB,EAA2B,GAAG,MAAH,CAAU,QAAV,GAAqB,IAArB,GAA0B,IAA1B,CAA3B,CAD4B;IAA7B;GAHuB;EAJzB,EAzI2B;;AA2J3B,GAAE,gDAAF,EAAoD,OAApD,CAA4D;AAI3D,0BAAwB,8BAAS,KAAT,EAAgB,EAAhB,EAAoB;AAC3C,QAAK,MAAL,CAAY,KAAZ,EAAmB,EAAnB,EAD2C;;AAI3C,KAAE,IAAF,EAAQ,OAAR,CAAgB,sBAAhB,EACG,WADH,CACe,8BADf,EAJ2C;GAApB;EAJzB,EA3J2B;;AA4K3B,GAAE,oDAAF,EAAwD,OAAxD,CAAgE;AAI/D,0BAAwB,8BAAS,KAAT,EAAgB,EAAhB,EAAoB;AAC3C,QAAK,MAAL,CAAY,KAAZ,EAAmB,EAAnB,EAD2C;AAE3C,OAAG,EAAG,GAAG,QAAH,CAAH,CAAgB,MAAhB,GAAyB,CAAzB,EAA2B;AAC7B,QAAG,EAAE,GAAG,MAAH,CAAF,CAAa,QAAb,CAAsB,MAAtB,CAAH,EAAiC;AAEhC,OAAE,GAAG,QAAH,CAAF,CAAe,GAAf,CAAmB,EAAC,QAAQ,MAAR,EAAgB,SAAS,KAAT,EAApC,EAFgC;;AAKhC,OAAE,GAAG,QAAH,CAAF,CAAe,MAAf,GAAwB,QAAxB,CAAiC,kBAAjC,EALgC;KAAjC,MAMK;AAEJ,OAAE,GAAG,QAAH,CAAF,CAAe,GAAf,CAAmB,MAAnB,EAA2B,GAAG,MAAH,CAAU,QAAV,GAAqB,IAArB,GAA0B,IAA1B,CAA3B,CAFI;;AAMJ,SAAG,EAAE,GAAG,MAAH,CAAF,CAAa,QAAb,CAAsB,OAAtB,CAAH,EAAkC;AACjC,QAAE,GAAG,QAAH,CAAF,CAAe,GAAf,CAAmB,MAAnB,EAA0B,KAA1B,EADiC;AAEjC,QAAE,GAAG,QAAH,CAAF,CAAe,MAAf,GAAwB,QAAxB,CAAiC,aAAjC,EAFiC;MAAlC;KAZD;IADD;GAFuB;EAJzB,EA5K2B;;AA6M3B,GAAE,uEAAF,EAA2E,OAA3E,CAAmF;AAIlF,0BAAwB;AACvB,YAAS,iBAAS,CAAT,EAAY;AACpB,MAAE,EAAE,MAAF,CAAF,CAAY,MAAZ,GAAqB,IAArB,CAA0B,YAA1B,EAAwC,WAAxC,CAAoD,QAApD,EADoB;AAEpB,MAAE,EAAE,MAAF,CAAF,CAAY,IAAZ,CAAiB,GAAjB,EAAsB,QAAtB,CAA+B,QAA/B,EAFoB;IAAZ;GADV;;AAUA,0BAAwB,8BAAS,KAAT,EAAgB,EAAhB,EAAoB;AAC3C,QAAK,MAAL,CAAY,KAAZ,EAAmB,EAAnB,EAD2C;;AAK3C,KAAE,GAAG,QAAH,CAAF,CAAe,GAAf,CAAmB,EAAC,QAAQ,MAAR,EAAgB,SAAS,MAAT,EAApC,EAL2C;;AAO3C,OAAG,EAAE,GAAG,QAAH,CAAF,CAAe,MAAf,GAAwB,CAAxB,EAA0B;AAC5B,MAAE,GAAG,QAAH,CAAF,CAAe,MAAf,GAAwB,QAAxB,CAAiC,aAAjC,EAD4B;IAA7B;GAPuB;EAdzB,EA7M2B;CAAZ,CAAhB;;;;;ACPA;;;;AACA;;;;;;AAEA,iBAAE,OAAF,CAAU,SAAV,EAAqB,UAAS,CAAT,EAAW;AAc/B,GAAE,wBAAF,EAA4B,OAA5B,CAAoC;AAQnC,WAAS,EAAT;;AAEA,WAAS,mBAAW;AACnB,UAAO,EAAE,WAAF,CAAP,CADmB;GAAX;;AAIT,YAAU;AACT,iBAAc,sBAAS,CAAT,EAAY,IAAZ,EAAiB;AAC9B,SAAK,iBAAL,GAD8B;IAAjB;AAGd,mBAAgB,wBAAS,CAAT,EAAY,IAAZ,EAAiB;AAChC,SAAK,iBAAL,GADgC;IAAjB;GAJjB;;AAaA,mBAAiB,2BAAW;AAE3B,QAAK,QAAL,CAAc,kCAAd,EAAkD,UAAS,GAAT,EAAc;AAC/D,QAAI,YAAY,QACf,eAAK,MAAL,CACC,eAAK,EAAL,CACC,8BADD,EAEC,oEAFD,CADD,EAKC,EAAC,OAAO,IAAI,MAAJ,EALT,CADe,CAAZ,CAD2D;AAU/D,WAAO,YAAc,GAAd,GAAoB,KAApB,CAVwD;IAAd,CAAlD,CAF2B;;AAgB3B,QAAK,QAAL,CAAc,oCAAd,EAAoD,UAAS,GAAT,EAAc;AACjE,QAAI,YAAY,QACf,eAAK,MAAL,CACC,eAAK,EAAL,CACC,gCADD,EAEC,qEAFD,CADD,EAKC,EAAC,OAAO,IAAI,MAAJ,EALT,CADe,CAAZ,CAD6D;AAUjE,WAAO,YAAc,GAAd,GAAoB,KAApB,CAV0D;IAAd,CAApD,CAhB2B;;AA+B3B,QAAK,QAAL,CAAc,iCAAd,EAAiD,UAAS,GAAT,EAAc;AAC9D,QAAI,YAAY,QACf,eAAK,MAAL,CACC,eAAK,EAAL,CACC,6BADD,EAEC,mEAFD,CADD,EAKC,EAAC,OAAO,IAAI,MAAJ,EALT,CADe,CAAZ,CAD0D;AAU9D,WAAO,YAAc,GAAd,GAAoB,KAApB,CAVuD;IAAd,CAAjD,CA/B2B;;AA6C3B,QAAK,QAAL,CAAc,kCAAd,EAAkD,UAAS,GAAT,EAAc;AAC/D,QAAI,YAAY,QACf,eAAK,MAAL,CACC,eAAK,EAAL,CACC,8BADD,EAEC,+KAFD,CADD,EAKC,EAAC,OAAO,IAAI,MAAJ,EALT,CADe,CAAZ,CAD2D;AAU/D,WAAO,YAAc,GAAd,GAAoB,KAApB,CAVwD;IAAd,CAAlD,CA7C2B;;AA2D3B,QAAK,QAAL,CAAc,kCAAd,EAAkD,UAAS,GAAT,EAAc;AAC/D,QAAI,YAAY,QACf,eAAK,MAAL,CACC,eAAK,EAAL,CACC,8BADD,EAEC,2LAFD,CADD,EAKC,EAAC,OAAO,IAAI,MAAJ,EALT,CADe,CAAZ,CAD2D;AAU/D,WAAO,YAAc,GAAd,GAAoB,KAApB,CAVwD;IAAd,CAAlD,CA3D2B;;AAyE3B,QAAK,QAAL,CAAc,yCAAd,EAAyD,UAAS,GAAT,EAAc;AACtE,QAAI,YAAY,QACf,eAAK,MAAL,CACC,eAAK,EAAL,CACC,iCADD,EAEC,yFAFD,CADD,EAKC,EAAC,OAAO,IAAI,MAAJ,EALT,CADe,CAAZ,CADkE;AAUtE,WAAO,YAAc,GAAd,GAAoB,KAApB,CAV+D;IAAd,CAAzD,CAzE2B;GAAX;;AAuFjB,SAAO,iBAAW;AACjB,QAAK,eAAL,GADiB;AAEjB,QAAK,MAAL,GAFiB;GAAX;;AAUP,YAAU,kBAAS,IAAT,EAAe,QAAf,EAAyB;AAClC,QAAK,OAAL,CAAa,UAAb,EAAyB,EAAC,MAAM,IAAN,EAAY,UAAU,QAAV,EAAtC,EADkC;AAElC,OAAI,UAAU,KAAK,UAAL,EAAV,CAF8B;AAGlC,WAAQ,IAAR,IAAgB,QAAhB,CAHkC;AAIlC,QAAK,UAAL,CAAgB,OAAhB,EAJkC;GAAzB;;AAYV,cAAY,oBAAS,IAAT,EAAe;AAC1B,QAAK,OAAL,CAAa,YAAb,EAA2B,EAAC,MAAM,IAAN,EAA5B,EAD0B;;AAG1B,OAAI,UAAU,KAAK,UAAL,EAAV,CAHsB;AAI1B,OAAG,QAAQ,IAAR,CAAH,EAAkB,OAAO,QAAQ,IAAR,CAAP,CAAlB;AACA,QAAK,UAAL,CAAgB,OAAhB,EAL0B;GAAf;;AAaZ,mBAAkB,yBAAS,QAAT,EAAmB;AACpC,OAAI,OAAO,IAAP;OACH,KAAK,KAAK,OAAL,EAAL;OACA,MAAM,KAAK,MAAL,EAAN;OACA,SAAS,EAAT;OACA,WAAW,EAAE,kCAAF,CAAX;OACA,YAAY,KAAK,IAAL,CAAU,qBAAV,EAAiC,GAAjC,EAAZ,CANmC;;AASpC,OAAG,YAAY,IAAZ,EAAkB,WAAW,EAAX,CAArB;;AAEA,QAAI,IAAI,GAAJ,IAAW,GAAf,EAAoB;AACnB,MAAE,EAAE,EAAF,EAAM,WAAN,CAAkB,GAAlB,CAAF,EAA0B,QAA1B,CAAmC,UAAnC,EAA+C,IAA/C,CAAoD,UAApD,EAAgE,UAAhE,EADmB;IAApB;;AAKA,OAAG,CAAC,SAAD,IAAc,aAAa,CAAC,CAAD,IAAM,CAAC,SAAS,QAAT,CAAkB,QAAlB,CAAD,EAA8B;AACjE,MAAE,QAAF,EAAY,IAAZ,CAAiB,IAAjB,EAAuB,IAAvB,CAA4B,YAAW;AACtC,OAAE,IAAF,EAAQ,UAAR,CAAmB,IAAnB,EADsC;KAAX,CAA5B,CADiE;AAIjE,WAJiE;IAAlE;;AAQA,KAAE,QAAF,EAAY,IAAZ,CAAiB,IAAjB,EAAuB,IAAvB,CAA4B,YAAW;AACtC,WAAO,IAAP,CAAY,EAAE,IAAF,EAAQ,IAAR,CAAa,IAAb,CAAZ,EADsC;AAEtC,MAAE,IAAF,EAAQ,QAAR,CAAiB,aAAjB,EAAgC,UAAhC,CAA2C,KAA3C,EAFsC;IAAX,CAA5B,CAxBoC;;AA+BpC,OAAI,iBAAiB,EAAE,IAAF,CAAO,QAAP,CAAgB,SAAhB,CAAjB,CA/BgC;AAgCpC,OAAI,qBAAqB,eAAe,YAAf,GAA8B,mBAA9B,CAhCW;AAiCpC,wBAAqB,EAAE,IAAF,CAAO,eAAP,CAAuB,kBAAvB,EAA2C,eAAe,MAAf,CAAhE,CAjCoC;AAkCpC,wBAAqB,EAAE,IAAF,CAAO,eAAP,CAAuB,kBAAvB,EAA2C,EAAC,QAAQ,OAAO,IAAP,CAAY,GAAZ,CAAR,EAA5C,CAArB,CAlCoC;AAmCpC,UAAO,OAAP,CAAe,kBAAf,EAAmC,UAAS,aAAT,EAAwB;AAE1D,WAAO,QAAP,EAAiB,IAAjB,CAAsB,IAAtB,EAA4B,IAA5B,CAAiC,YAAW;AAC3C,OAAE,IAAF,EAAQ,WAAR,CAAoB,aAApB,EAD2C;;AAG3C,SAAI,KAAK,EAAE,IAAF,EAAQ,IAAR,CAAa,IAAb,CAAL,CAHuC;AAI3C,SAAG,MAAM,CAAN,IAAW,EAAE,OAAF,CAAU,EAAV,EAAc,aAAd,KAAgC,CAAhC,EAAmC;AAChD,QAAE,IAAF,EAAQ,UAAR,CAAmB,IAAnB,EADgD;MAAjD,MAEO;AAEN,QAAE,IAAF,EAAQ,WAAR,CAAoB,UAApB,EAAgC,UAAhC,CAA2C,KAA3C,EAFM;AAGN,QAAE,IAAF,EAAQ,IAAR,CAAa,UAAb,EAAyB,KAAzB,EAHM;MAFP;KAJgC,CAAjC,CAF0D;;AAe1D,SAAK,iBAAL,GAf0D;IAAxB,CAAnC,CAnCoC;GAAnB;;AA0DlB,qBAAmB,6BAAW;AAC7B,OAAI,OAAO,KAAK,OAAL,EAAP;OAAuB,MAAM,KAAK,cAAL,EAAN,CADE;;AAI7B,QAAK,MAAL,CAAY,GAAZ,EAJ6B;;AAM7B,UAAO,IAAP,CAN6B;GAAX;;AAanB,UAAQ,gBAAS,GAAT,EAAc;AACrB,QAAK,IAAL,CAAU,qBAAV,EAAiC,GAAjC,CAAqC,MAAM,IAAI,IAAJ,CAAS,GAAT,CAAN,GAAsB,IAAtB,CAArC,CADqB;GAAd;;AAQR,UAAQ,kBAAW;AAElB,OAAI,QAAQ,KAAK,IAAL,CAAU,qBAAV,EAAiC,GAAjC,EAAR,CAFc;AAGlB,UAAO,QACJ,MAAM,KAAN,CAAY,GAAZ,CADI,GAEJ,EAFI,CAHW;GAAX;;AAQR,YAAU,kBAAS,CAAT,EAAY;AACrB,OAAI,OAAO,IAAP;OAAa,MAAM,KAAK,MAAL,EAAN;OAAqB,OAAO,KAAK,OAAL,EAAP;OAAuB,UAAU,KAAK,UAAL,EAAV,CADxC;;AAIrB,OAAG,CAAC,GAAD,IAAQ,CAAC,IAAI,MAAJ,EAAY;AACvB,UAAM,eAAK,EAAL,CAAQ,uBAAR,EAAiC,iCAAjC,CAAN,EADuB;AAEvB,MAAE,cAAF,GAFuB;AAGvB,WAAO,KAAP,CAHuB;IAAxB;;AAOA,OAAI,OAAO,KAAK,IAAL,CAAU,qBAAV,EAAiC,GAAjC,EAAP,CAXiB;AAYrB,OAAG,QAAQ,IAAR,CAAH,EAAkB;AACjB,UAAM,KAAK,UAAL,GAAkB,IAAlB,EAAwB,KAAxB,CAA8B,IAA9B,EAAoC,CAAC,GAAD,CAApC,CAAN,CADiB;IAAlB;;AAKA,OAAG,CAAC,GAAD,IAAQ,CAAC,IAAI,MAAJ,EAAY;AACvB,MAAE,cAAF,GADuB;AAEvB,WAAO,KAAP,CAFuB;IAAxB;;AAMA,QAAK,MAAL,CAAY,GAAZ,EAvBqB;;AA0BrB,QAAK,IAAL,CAAU,IAAV,EAAgB,WAAhB,CAA4B,QAA5B,EA1BqB;;AA4BrB,OAAI,SAAS,KAAK,IAAL,CAAU,eAAV,CAAT,CA5BiB;AA6BrB,UAAO,QAAP,CAAgB,SAAhB,EA7BqB;;AA+BrB,UAAO,IAAP,CAAY;AAEX,SAAK,IAAL;AACA,UAAM,MAAN;AACA,UAAM,KAAK,cAAL,EAAN;AACA,cAAU,kBAAS,OAAT,EAAkB,MAAlB,EAA0B;AACnC,YAAO,WAAP,CAAmB,SAAnB,EADmC;;AAKnC,UAAK,MAAL,CAAY,SAAZ,EAAuB,CAAC,CAAD,CAAvB,CALmC;AAMnC,UAAK,MAAL,CAAY,EAAZ,EANmC;;AASnC,UAAK,IAAL,CAAU,qBAAV,EAAiC,GAAjC,CAAqC,EAArC,EAAyC,MAAzC,GATmC;;AAYnC,SAAI,MAAM,QAAQ,iBAAR,CAA0B,UAA1B,CAAN,CAZ+B;AAanC,SAAG,GAAH,EAAQ,cAAc,mBAAmB,GAAnB,CAAd,EAAuC,MAAC,IAAU,SAAV,GAAuB,MAAxB,GAAiC,KAAjC,CAAvC,CAAR;KAbS;AAeV,aAAS,iBAAS,IAAT,EAAe,MAAf,EAAuB;AAC/B,SAAI,EAAJ,EAAQ,IAAR,CAD+B;;AAG/B,SAAG,KAAK,QAAL,EAAe;AACjB,UAAI,gBAAgB,EAAhB,CADa;AAEjB,WAAI,EAAJ,IAAU,KAAK,QAAL,EAAe;AACxB,cAAO,KAAK,WAAL,CAAiB,EAAjB,CAAP,CADwB;AAExB,YAAK,MAAL,CAAY,UAAZ,EAAwB,IAAxB,EAA8B,KAAK,QAAL,CAAc,EAAd,EAAkB,WAAlB,CAA9B,EAFwB;AAGxB,qBAAc,IAAd,CAAmB,IAAnB,EAHwB;OAAzB;AAKA,QAAE,aAAF,EAAiB,MAAjB,CAAwB,WAAxB,EAPiB;MAAlB;AASA,SAAG,KAAK,OAAL,EAAc;AAChB,WAAI,EAAJ,IAAU,KAAK,OAAL,EAAc;AACvB,cAAO,KAAK,WAAL,CAAiB,EAAjB,CAAP,CADuB;AAEvB,WAAG,KAAK,MAAL,EAAa,KAAK,MAAL,CAAY,aAAZ,EAA2B,IAA3B,EAAhB;OAFD;MADD;AAMA,SAAG,KAAK,KAAL,EAAY;AACd,WAAI,EAAJ,IAAU,KAAK,KAAL,EAAY;AACrB,cAAO,KAAK,WAAL,CAAiB,EAAjB,CAAP,CADqB;AAErB,SAAE,IAAF,EAAQ,QAAR,CAAiB,QAAjB,EAFqB;OAAtB;MADD;KAlBQ;AAyBT,cAAU,MAAV;IA7CD,EA/BqB;;AAgFrB,KAAE,cAAF,GAhFqB;AAiFrB,UAAO,KAAP,CAjFqB;GAAZ;;EA5OX,EAd+B;;AAgV/B,GAAE,kCAAF,EAAsC,OAAtC,CAA8C;AAC7C,WAAS,mBAAY;AACpB,QAAK,MAAL,GADoB;AAEpB,QAAK,UAAL,GAFoB;GAAZ;AAIT,aAAW,qBAAY;AACtB,QAAK,MAAL,GADsB;GAAZ;AAGX,WAAS,iBAAU,CAAV,EAAa;AACrB,QAAK,UAAL,GADqB;GAAb;AAGT,cAAY,sBAAY;AACvB,OAAI,OAAO,EAAE,WAAF,CAAP;OACH,OAAO,EAAE,wBAAF,CAAP,CAFsB;;AAIvB,QAAK,MAAL,GAJuB;;AAMvB,OAAG,KAAK,IAAL,CAAU,QAAV,CAAH,EAAwB;AACvB,SAAK,QAAL,CAAc,UAAd,EADuB;AAEvB,SAAK,WAAL,CAAiB,WAAjB,EAFuB;AAGvB,SAAK,iBAAL,GAHuB;IAAxB,MAIO;AACN,SAAK,WAAL,CAAiB,UAAjB,EADM;AAEN,SAAK,QAAL,CAAc,WAAd,EAFM;IAJP;;AASA,KAAE,wBAAF,EAA4B,eAA5B,GAfuB;GAAZ;EAXb,EAhV+B;;AAiX/B,GAAE,4CAAF,EAAgD,OAAhD,CAAwD;AACvD,YAAU,kBAAS,CAAT,EAAY;AACrB,OAAI,OAAO,EAAE,EAAE,MAAF,CAAS,IAAT,CAAT;OACH,MAAM,KAAK,IAAL,CAAU,SAAV,CAAN;OACA,WAAW,EAAE,EAAE,MAAF,CAAF,CAAY,GAAZ,EAAX,CAHoB;AAIrB,OAAG,CAAC,QAAD,IAAa,YAAY,CAAC,CAAD,EAAI;AAC/B,QAAI,IAAJ,CAAS,UAAT,EAAqB,UAArB,EAAiC,MAAjC,CAAwC,SAAxC,EAD+B;IAAhC,MAEO;AACN,QAAI,UAAJ,CAAe,UAAf,EAA2B,MAA3B,CAAkC,SAAlC,EADM;IAFP;;AAOA,KAAE,wBAAF,EAA4B,eAA5B,GAXqB;;AAcrB,QAAK,OAAL,CAAa,eAAb,EAdqB;;AAgBrB,QAAK,MAAL,CAAY,CAAZ,EAhBqB;GAAZ;EADX,EAjX+B;CAAX,CAArB;;;;;ACNA;;;;;;AAEA,iBAAE,OAAF,CAAU,IAAV,EAAgB,UAAS,CAAT,EAAW;AAQ1B,GAAE,cAAF,EAAkB,OAAlB,CAA0B;;AAEzB,SAAO,iBAAW;AACjB,OAAI,OAAO,IAAP,CADa;;AAIjB,QAAK,IAAL,CAAU,aAAV,EAAyB,UAAzB,GAJiB;AAKjB,QAAK,MAAL,GALiB;GAAX;;AASP,UAAQ,kBAAW;AAClB,OAAG,OAAO,KAAP,EAAc,QAAQ,GAAR,CAAY,QAAZ,EAAsB,KAAK,IAAL,CAAU,OAAV,CAAtB,EAA0C,KAAK,GAAL,CAAS,CAAT,CAA1C,EAAjB;;AAGA,QAAK,GAAL,CAAS,KAAK,IAAL,CAAU,aAAV,CAAT,EAAmC,UAAnC,GAJkB;AAKlB,QAAK,IAAL,CAAU,qBAAV,EAAiC,MAAjC,GALkB;AAMlB,QAAK,IAAL,CAAU,sBAAV,EAAkC,MAAlC,GANkB;GAAX;EAXT,EAR0B;;AAgC1B,GAAE,wBAAF,EAA4B,OAA5B,CAAoC;AACnC,SAAO,iBAAW;AACjB,OAAI,OAAO,IAAP,CADa;;AAGjB,QAAK,MAAL,GAHiB;;AAKjB,QAAK,IAAL,CAAU,oBAAV,EAAgC,UAAS,CAAT,EAAY,IAAZ,EAAkB;AACjD,QAAI,OAAO,KAAK,IAAL,CAAU,GAAV;QAAe,eAAe,KAAK,IAAL,CAAU,iBAAV,EAA6B,GAA7B,EAAf;QAAmD,YAAY,KAAK,IAAL,CAAU,CAAV,CAAZ;QAA0B,YAAY,EAAE,gBAAF,CAAZ,CADtD;;AAMjD,QAAG,CAAC,SAAD,EAAY;AACd,YAAO,KAAP,CADc;KAAf;;AAKA,QAAG,EAAE,IAAF,EAAQ,QAAR,CAAiB,UAAjB,CAAH,EAAiC,OAAO,KAAP,CAAjC;;AAIA,QAAG,EAAE,IAAF,EAAQ,IAAR,CAAa,IAAb,KAAsB,YAAtB,EAAoC,OAAvC;;AAEA,QAAI,MAAM,EAAE,IAAF,EAAQ,IAAR,CAAa,SAAb,EAAwB,IAAxB,CAA6B,MAA7B,CAAN,CAjB6C;AAkBjD,QAAG,OAAO,OAAO,GAAP,EAAY;AAErB,WAAM,IAAI,KAAJ,CAAU,GAAV,EAAe,CAAf,CAAN,CAFqB;;AAKrB,UAAK,MAAL,CAAY,cAAZ,EALqB;AAMrB,UAAK,MAAL,CAAY,aAAZ,EANqB;;AASrB,SAAG,EAAE,IAAF,CAAO,UAAP,CAAkB,EAAE,IAAF,EAAQ,IAAR,CAAa,SAAb,CAAlB,CAAH,EAA+C,MAAM,MAAM,EAAE,IAAF,CAAO,eAAP,CAAuB,GAAvB,EAA4B,EAAE,MAAF,EAAU,IAAV,CAAe,MAAf,CAA5B,CAAN,CAArD;;AAEA,SAAG,SAAS,QAAT,CAAkB,MAAlB,EAA0B,MAAM,EAAE,IAAF,CAAO,eAAP,CAAuB,GAAvB,EAA4B,SAAS,QAAT,CAAkB,MAAlB,CAAyB,OAAzB,CAAiC,KAAjC,EAAwC,EAAxC,CAA5B,CAAN,CAA7B;;AAEA,eAAU,SAAV,CAAoB,GAApB,EAbqB;KAAtB,MAcO;AACN,UAAK,UAAL,GADM;KAdP;IAlB+B,CAAhC,CALiB;GAAX;EADR,EAhC0B;;AA6E1B,GAAE,kCAAF,EAAsC,OAAtC,CAA8C;AAC7C,UAAQ,kBAAW;AAClB,OAAG,OAAO,KAAP,EAAc,QAAQ,GAAR,CAAY,QAAZ,EAAsB,KAAK,IAAL,CAAU,OAAV,CAAtB,EAA0C,KAAK,GAAL,CAAS,CAAT,CAA1C,EAAjB;GADO;EADT,EA7E0B;;AAmF1B,GAAE,qEAAF,EAAyE,OAAzE,CAAiF;AAChF,UAAQ,kBAAW;AAClB,OAAG,OAAO,KAAP,EAAc,QAAQ,GAAR,CAAY,QAAZ,EAAsB,KAAK,IAAL,CAAU,OAAV,CAAtB,EAA0C,KAAK,GAAL,CAAS,CAAT,CAA1C,EAAjB;;AAGA,QAAK,MAAL,CAAY,MAAZ,EAJkB;AAKlB,QAAK,MAAL,CAAY,KAAK,WAAL,KAAmB,KAAK,GAAL,CAAS,aAAT,CAAnB,GAA2C,KAAK,GAAL,CAAS,gBAAT,CAA3C,CAAZ,CALkB;GAAX;EADT,EAnF0B;CAAX,CAAhB;;;;;ACCA;;;;AACA;;;;;;AAGA,OAAO,cAAP,GAAwB,UAAS,CAAT,EAAY;AACnC,KAAI,OAAO,sBAAE,gBAAF,CAAP,CAD+B;AAEnC,MAAK,OAAL,CAAa,kBAAb,EAFmC;AAGnC,KAAG,KAAK,EAAL,CAAQ,UAAR,KAAuB,CAAE,KAAK,EAAL,CAAQ,iBAAR,CAAF,EAA8B;AACvD,SAAO,eAAK,EAAL,CAAQ,iCAAR,CAAP,CADuD;EAAxD;CAHuB;;AAQxB,iBAAE,OAAF,CAAU,IAAV,EAAgB,UAAS,CAAT,EAAW;AAqB1B,GAAE,gBAAF,EAAoB,OAApB,CAA0D;AAMzD,mBAAiB,EAAjB;;AAMA,wBAAsB;AACrB,wBAAqB,4DAArB;GADD;;AAOA,SAAO,iBAAW;AACjB,OAAI,OAAO,IAAP,CADa;;AAUjB,QAAK,IAAL,CAAU,cAAV,EAA0B,KAA1B,EAViB;;AAYjB,QAAK,mBAAL,GAZiB;;AAmBjB,QAAI,IAAI,YAAJ,IAAoB,EAAC,UAAS,IAAT,EAAc,UAAS,IAAT,EAAc,WAAU,IAAV,EAAe,QAAO,IAAP,EAApE,EAAkF;AACjF,QAAI,KAAK,KAAK,IAAL,CAAU,iBAAgB,QAAhB,GAA2B,YAA3B,GAA0C,GAA1C,CAAf,CAD6E;AAEjF,QAAG,EAAH,EAAO;AACN,UAAK,IAAL,CAAU,YAAV,EAAwB,GAAG,GAAH,EAAxB,EADM;AAEN,QAAG,MAAH,GAFM;KAAP;IAFD;;AAgBA,OAAG,KAAK,QAAL,CAAc,iBAAd,CAAH,EAAqC;AAEpC,QAAI,WAAW,KAAK,IAAL,CAAU,wCAAV,EAAoD,KAApD,GAA4D,OAA5D,CAAoE,MAApE,CAAX,CAFgC;AAGpC,MAAE,gBAAF,EAAoB,oBAApB,GAHoC;AAIpC,aAAS,OAAT,CAAiB,YAAjB,EAA+B,IAA/B,CAAoC,QAApC,EAA8C,QAA9C,EAAwD,SAAS,KAAT,CAAe,MAAf,CAAxD,EAJoC;IAArC;;AAOA,QAAK,MAAL,GA1CiB;GAAX;AA4CP,YAAU,oBAAW;AACpB,QAAK,aAAL,CAAmB,SAAnB,EADoB;AAEpB,QAAK,MAAL,GAFoB;GAAX;AAIV,WAAS,mBAAW;AACnB,QAAK,MAAL,GADmB;GAAX;AAGT,aAAW,qBAAW;AACrB,QAAK,MAAL,GADqB;GAAX;AAGX,UAAQ,kBAAW;AAClB,OAAG,OAAO,KAAP,EAAc,QAAQ,GAAR,CAAY,QAAZ,EAAsB,KAAK,IAAL,CAAU,OAAV,CAAtB,EAA0C,KAAK,GAAL,CAAS,CAAT,CAA1C,EAAjB;;AAGA,QAAK,GAAL,CAAS,KAAK,IAAL,CAAU,aAAV,CAAT,EAAmC,UAAnC,GAJkB;AAKlB,QAAK,IAAL,CAAU,qBAAV,EAAiC,MAAjC,GALkB;GAAX;;AAWR,uBAAqB,+BAAW;AAG/B,QAAK,aAAL,CAAmB,KAAK,uBAAL,EAAnB,EAH+B;GAAX;;AAoBrB,yBAAuB,iCAAW;AACjC,QAAK,OAAL,CAAa,kBAAb,EADiC;AAEjC,OAAG,CAAC,KAAK,EAAL,CAAQ,UAAR,CAAD,IAAwB,KAAK,EAAL,CAAQ,iBAAR,CAAxB,EAAoD;AACtD,WAAO,IAAP,CADsD;IAAvD;AAGA,OAAI,YAAY,QAAQ,eAAK,EAAL,CAAQ,4BAAR,CAAR,CAAZ,CAL6B;AAMjC,OAAG,SAAH,EAAc;AAIb,SAAK,QAAL,CAAc,gBAAd,EAJa;IAAd;AAMA,UAAO,SAAP,CAZiC;GAAX;;AAoBvB,YAAU,kBAAS,CAAT,EAAY,MAAZ,EAAoB;AAM7B,OAAG,KAAK,IAAL,CAAU,QAAV,KAAuB,QAAvB,EAAiC;AACnC,QAAG,MAAH,EAAW,KAAK,OAAL,CAAa,gBAAb,EAA+B,UAA/B,CAA0C,IAA1C,EAAgD,MAAhD,EAAX;AACA,WAAO,KAAP,CAFmC;IAApC;GANS;;AAwBV,YAAU,oBAAW;AACpB,OAAI,UAAU,IAAV,CADgB;AAEpB,QAAK,OAAL,CAAa,UAAb,EAAyB,EAAC,SAAS,OAAT,EAA1B,EAFoB;;AAIpB,UAAO,OAAP,CAJoB;GAAX;;AASV,sBAAoB;AACnB,iBAAc,sBAAS,CAAT,EAAW;AACxB,QAAI,OAAO,IAAP;QACH,QAAQ,EAAE,EAAE,MAAF,CAAF,CAAY,OAAZ,CAAoB,mBAApB,CAAR;QACA,SAAS,MAAM,IAAN,CAAW,qBAAX,EAAkC,SAAlC,GAA8C,WAA9C,EAAT,CAHuB;;AAMxB,WAAO,OAAP,CAAe,GAAf,CAAmB,UAAS,CAAT,EAAW;AAC7B,UAAK,cAAL,CAAoB,MAAM,IAAN,CAAW,IAAX,CAApB,EAD6B;KAAX,CAAnB,CANwB;IAAX;GADf;;AAeA,6CAA2C;AAC1C,YAAS,iBAAS,CAAT,EAAW;AACnB,SAAK,cAAL,CAAoB,EAAE,EAAE,MAAF,CAAF,CAAY,IAAZ,CAAiB,IAAjB,CAApB,EADmB;IAAX;AAGT,YAAS,iBAAS,CAAT,EAAW;AACnB,SAAK,cAAL,CAAoB,EAAE,EAAE,MAAF,CAAF,CAAY,IAAZ,CAAiB,IAAjB,CAApB,EADmB;IAAX;GAJV;;AAWA,yCAAuC;AACtC,cAAW,mBAAS,CAAT,EAAW;AACrB,QAAI,QAAQ,EAAE,EAAE,MAAF,CAAF,CAAY,OAAZ,CAAoB,qBAApB,CAAR,CADiB;AAErB,SAAK,cAAL,CAAoB,MAAM,IAAN,CAAW,IAAX,CAApB,EAFqB;IAAX;GADZ;;AASA,qDAAmD;AAClD,cAAW,mBAAS,CAAT,EAAW;AACrB,QAAI,QAAQ,EAAE,EAAE,MAAF,CAAF,CAAY,OAAZ,CAAoB,iBAApB,CAAR,CADiB;AAErB,SAAK,cAAL,CAAoB,MAAM,IAAN,CAAW,IAAX,CAApB,EAFqB;IAAX;GADZ;;AASA,yBAAuB;AACtB,uBAAoB,4BAAS,CAAT,EAAW;AAC9B,SAAK,iBAAL,GAD8B;IAAX;GADrB;;AAQA,kBAAgB,wBAAS,QAAT,EAAkB;AACjC,OAAG,OAAO,OAAO,cAAP,IAAwB,WAA/B,IAA8C,OAAO,cAAP,KAA0B,IAA1B,EAAgC,OAAjF;;AAEA,OAAI,KAAK,EAAE,IAAF,EAAQ,IAAR,CAAa,IAAb,CAAL;OACH,gBAAgB,EAAhB,CAJgC;;AAMjC,iBAAc,IAAd,CAAmB;AAClB,QAAG,EAAH;AACA,cAAS,QAAT;IAFD,EANiC;;AAWjC,OAAG,aAAH,EAAkB;AACjB,QAAI;AACH,YAAO,cAAP,CAAsB,OAAtB,CAA8B,EAA9B,EAAkC,KAAK,SAAL,CAAe,aAAf,CAAlC,EADG;KAAJ,CAEE,OAAM,GAAN,EAAW;AACZ,SAAI,IAAI,IAAJ,KAAa,aAAa,kBAAb,IAAmC,OAAO,cAAP,CAAsB,MAAtB,KAAiC,CAAjC,EAAoC;AAIvF,aAJuF;MAAxF,MAKO;AACN,YAAM,GAAN,CADM;MALP;KADC;IAHH;GAXe;;AAgChB,qBAAmB,6BAAU;AAC5B,OAAG,OAAO,OAAO,cAAP,IAAwB,WAA/B,IAA8C,OAAO,cAAP,KAA0B,IAA1B,EAAgC,OAAjF;;AAEA,OAAI,OAAO,IAAP;OACH,oBAAqB,OAAO,OAAO,cAAP,KAAyB,WAAhC,IAA+C,OAAO,cAAP;OACpE,cAAc,oBAAoB,OAAO,cAAP,CAAsB,OAAtB,CAA8B,KAAK,IAAL,CAAU,IAAV,CAA9B,CAApB,GAAqE,IAArE;OACd,gBAAgB,cAAc,KAAK,KAAL,CAAW,WAAX,CAAd,GAAwC,KAAxC;OAChB,SAJD;OAKC,SAAU,KAAK,IAAL,CAAU,YAAV,EAAwB,MAAxB,KAAmC,CAAnC;OACV,SAND;OAOC,UAPD;OAQC,eARD;OASC,OATD,CAH4B;;AAc5B,OAAG,qBAAqB,cAAc,MAAd,GAAuB,CAAvB,EAAyB;AAChD,MAAE,IAAF,CAAO,aAAP,EAAsB,UAAS,CAAT,EAAY,YAAZ,EAA0B;AAC/C,SAAG,KAAK,EAAL,CAAQ,MAAM,aAAa,EAAb,CAAjB,EAAkC;AACjC,kBAAY,EAAE,MAAM,aAAa,QAAb,CAApB,CADiC;MAAlC;KADqB,CAAtB,CADgD;;AAShD,QAAG,EAAE,SAAF,EAAa,MAAb,GAAsB,CAAtB,EAAwB;AAC1B,UAAK,eAAL,GAD0B;AAE1B,YAF0B;KAA3B;;AAKA,gBAAY,EAAE,SAAF,EAAa,OAAb,CAAqB,YAArB,EAAmC,IAAnC,CAAwC,8CAAxC,EAAwF,IAAxF,CAA6F,IAA7F,CAAZ,CAdgD;AAehD,iBAAc,SAAS,EAAE,SAAF,EAAa,OAAb,CAAqB,2BAArB,EAAkD,IAAlD,CAAuD,IAAvD,CAAT,CAfkC;;AAkBhD,QAAG,UAAU,eAAe,SAAf,EAAyB;AACrC,YADqC;KAAtC;;AAIA,sBAAkB,EAAE,SAAF,EAAa,OAAb,CAAqB,kBAArB,CAAlB,CAtBgD;;AAyBhD,QAAG,gBAAgB,MAAhB,GAAyB,CAAzB,EAA2B;AAC7B,qBAAgB,SAAhB,CAA0B,UAA1B,EAAsC,gBAAgB,IAAhB,CAAqB,sBAArB,CAAtC,EAD6B;KAA9B;;AAKA,cAAU,EAAE,SAAF,EAAa,QAAb,GAAwB,GAAxB,CA9BsC;;AAiChD,QAAG,CAAC,EAAE,SAAF,EAAa,EAAb,CAAgB,UAAhB,CAAD,EAA6B;AAC/B,iBAAY,MAAM,EAAE,SAAF,EAAa,OAAb,CAAqB,QAArB,EAA+B,IAA/B,CAAoC,IAApC,CAAN,CADmB;AAE/B,eAAU,EAAE,SAAF,EAAa,QAAb,GAAwB,GAAxB,CAFqB;KAAhC;;AAMA,MAAE,SAAF,EAAa,KAAb,GAvCgD;;AA2ChD,QAAG,UAAU,EAAE,MAAF,EAAU,MAAV,KAAqB,CAArB,EAAuB;AACnC,UAAK,IAAL,CAAU,qBAAV,EAAiC,SAAjC,CAA2C,OAA3C,EADmC;KAApC;IA3CD,MA+CO;AAEN,SAAK,eAAL,GAFM;IA/CP;GAdkB;;AAwEnB,mBAAiB,2BAAW;AAC3B,QAAK,IAAL,CAAU,kDAAV,EAA8D,MAA9D,CAAqE,gBAArE,EAAuF,KAAvF,GAD2B;GAAX;EAzTlB,EArB0B;;AA0V1B,GAAE,0FAAF,EAA8F,OAA9F,CAAsG;AAIrG,WAAS,iBAAS,CAAT,EAAY;AAEpB,OACC,KAAK,QAAL,CAAc,yBAAd,KACG,CAAC,QAAQ,eAAK,EAAL,CAAQ,iCAAR,CAAR,CAAD,EACF;AACD,MAAE,cAAF,GADC;AAED,WAAO,KAAP,CAFC;IAHF;;AAQA,OAAG,CAAC,KAAK,EAAL,CAAQ,WAAR,CAAD,EAAuB;AACzB,SAAK,OAAL,CAAa,MAAb,EAAqB,OAArB,CAA6B,QAA7B,EAAuC,CAAC,IAAD,CAAvC,EADyB;IAA1B;AAGA,KAAE,cAAF,GAboB;AAcpB,UAAO,KAAP,CAdoB;GAAZ;EAJV,EA1V0B;;AAoX1B,GAAE,kIAAF,EAAsI,OAAtI,CAA8I;AAC7I,WAAS,iBAAS,CAAT,EAAY;AACpB,OAAI,OAAO,OAAP,CAAe,MAAf,GAAwB,CAAxB,EAA2B;AAC9B,WAAO,OAAP,CAAe,IAAf,GAD8B;IAA/B,MAEO;AACN,SAAK,OAAL,CAAa,MAAb,EAAqB,OAArB,CAA6B,QAA7B,EAAuC,CAAC,IAAD,CAAvC,EADM;IAFP;AAKA,KAAE,cAAF,GANoB;GAAZ;EADV,EApX0B;;AAoY1B,GAAE,2BAAF,EAA+B,OAA/B,CAAuC;AACtC,WAAS,mBAAW;AACnB,OAAI,CAAC,KAAK,QAAL,CAAc,qBAAd,CAAD,EAAuC;AAC1C,QAAI,OAAO,KAAK,IAAL,CAAU,YAAV,CAAP,CADsC;;AAG1C,QAAG,KAAK,QAAL,CAAc,IAAd,EAAoB,MAApB,IAA8B,CAA9B,EAAiC;AACnC,UAAK,IAAL,GAAY,MAAZ,GAAqB,QAArB,CAA8B,sBAA9B,EADmC;KAApC;IAHD;;AAQA,QAAK,MAAL,GATmB;GAAX;AAWT,aAAW,qBAAW;AACrB,QAAK,MAAL,GADqB;GAAX;EAZZ,EApY0B;CAAX,CAAhB;;;;;ACXA;;;;;;AAEA,iBAAE,OAAF,CAAU,IAAV,EAAgB,UAAU,CAAV,EAAa;;AAE3B,IAAE,yBAAF,EAA6B,OAA7B,CAAqC;AACnC,WAAO,iBAAY;AACjB,UAAI,QAAQ,KAAR;UACF,UAAU,KAAK,IAAL,CAAU,IAAV,EAAgB,MAAhB,CAAuB,CAAvB,EAA0B,KAAK,IAAL,CAAU,IAAV,EAAgB,OAAhB,CAAwB,SAAxB,CAA1B,CAAV;UACA,WAAW,KAAK,IAAL,CAAU,0BAAV,CAAX;UACA,eAAe,KAAK,IAAL,CAAU,cAAV,CAAf,CAJe;;AAOjB,UAAI,KAAK,QAAL,CAAc,4BAAd,CAAJ,EAAiD;AAC/C,eAD+C;OAAjD;;AAKA,UAAI,SAAS,MAAT,KAAoB,CAApB,EAAuB;AACzB,mBAAW,KACR,IADQ,CACH,eADG,EAER,KAFQ,GAGR,KAHQ,CAGF,+BAA+B,OAA/B,GAAyC,uHAAzC,CAHE,CAIR,IAJQ,EAAX,CADyB;OAA3B;;AAQA,WAAK,QAAL,CAAc,4BAAd,EApBiB;;AAuBjB,eAAS,EAAT,CAAY,OAAZ,EAAqB,YAAW;AAC9B,qBAAa,QAAQ,MAAR,GAAiB,MAAjB,CAAb,GAD8B;AAE9B,gBAAQ,CAAC,KAAD,CAFsB;OAAX,CAArB,CAvBiB;;AA6BjB,mBAAa,IAAb,GA7BiB;KAAZ;GADT,EAF2B;CAAb,CAAhB;;;;;ACNA;;;;;;AAEA,iBAAE,OAAF,CAAU,IAAV,EAAgB,UAAS,CAAT,EAAY;AAU3B,GAAE,qCAAF,EAAyC,OAAzC,CAAiD;AAChD,WAAS,mBAAW;AACnB,QAAK,MAAL,GADmB;;AAGnB,OAAI,gBAAgB,KAAK,IAAL,CAAU,cAAV,CAAhB;OAA2C,OAA/C;OAAwD,SAAxD,CAHmB;AAInB,OAAG,cAAc,MAAd,EAAsB;AACxB,SAEE,IAFF,CAEO,OAFP,EAEgB,cAAc,IAAd,EAFhB,EAGE,OAHF,CAGU,EAAC,SAAS,cAAc,IAAd,EAAT,EAHX,EADwB;AAKxB,kBAAc,MAAd,GALwB;IAAzB;GAJQ;EADV,EAV2B;;AAyB3B,GAAE,4CAAF,EAAgD,OAAhD,CAAwD;AACvD,aAAW,mBAAS,CAAT,EAAY;AACtB,QAAK,OAAL,CAAa,QAAb,EAAuB,OAAvB,CAA+B,MAA/B,EADsB;GAAZ;AAGX,cAAY,oBAAS,CAAT,EAAY;AACvB,QAAK,OAAL,CAAa,QAAb,EAAuB,OAAvB,CAA+B,OAA/B,EADuB;GAAZ;EAJb,EAzB2B;CAAZ,CAAhB;;;;;ACEA;;;;;;AAEA,iBAAE,EAAF,CAAK,MAAL,CAAY,QAAZ,CAAqB,MAArB,GAA8B,KAA9B;;AAKA,UAAU,OAAQ,OAAP,KAAmB,WAAnB,GAAkC,EAAnC,GAAwC,OAAxC;;AAwBV,QAAQ,qBAAR,GAAgC,UAAU,IAAV,EAAgB,OAAhB,EAAyB;AAExD,KAAI,OAAO,KAAK,IAAL,KAAY,WAAnB,IACH,OAAO,KAAK,OAAL,KAAe,WAAtB,IACA,OAAO,KAAK,OAAL,KAAe,WAAtB,EAAmC;AACnC,QAAM,2EAAN,CADmC;EAFpC;AAKA,KAAI,OAAO,QAAQ,eAAR,KAA0B,WAAjC,IACH,OAAO,QAAQ,eAAR,KAA0B,WAAjC,IACA,OAAO,QAAQ,IAAR,KAAe,WAAtB,EAAmC;AACnC,QAAM,8EAAN,CADmC;EAFpC;AAKA,KAAI,QAAQ,IAAR,KAAe,OAAf,IAA0B,QAAQ,IAAR,KAAe,SAAf,IAA4B,QAAQ,IAAR,KAAe,SAAf,EAA0B;AACnF,QAAM,0EAAN,CADmF;EAApF;;AAKA,KAAI,MAAM;AACT,WAAS,OAAT;EADG,CAjBoD;;AAsBxD,KAAI,OAAO,iBAAE,WAAF,CAAc,KAAK,IAAL,CAArB;KACH,UAAU,iBAAE,WAAF,CAAc,KAAK,OAAL,CAAxB;KACA,UAAU,iBAAE,WAAF,CAAc,KAAK,OAAL,CAAxB,CAxBuD;;AA8BxD,KAAI,MAAJ,GAAa,UAAU,SAAV,EAAqB;AACjC,MAAI,OAAO,UAAU,MAAV,EAAP;MACH,SAAS,UAAU,MAAV,EAAT;MACA,MAAM,OAAO,GAAP;MACN,SAAS,KAAK,MAAL,GAAc,OAAO,MAAP;MACvB,OAAO,OAAO,IAAP;MACP,QAAQ,KAAK,KAAL,GAAa,OAAO,KAAP,CANW;;AAQjC,MAAI,YAAY,KAAK,IAAL,CAAU,KAAV,EAAZ;MACH,eAAe,CAAf;MACA,eAAe,CAAf,CAVgC;;AAYjC,MAAI,KAAK,OAAL,CAAa,IAAb,KAAoB,SAApB,EAA+B;AAElC,kBAAe,CAAf,CAFkC;AAGlC,kBAAe,QAAQ,IAAR,GAAe,SAAf,CAHmB;GAAnC,MAIO,IAAI,KAAK,OAAL,CAAa,IAAb,KAAoB,SAApB,EAA+B;AAEzC,kBAAe,QAAQ,IAAR,GAAe,SAAf,CAF0B;AAGzC,kBAAe,CAAf,CAHyC;GAAnC,MAIA;AAEN,kBAAe,CAAC,QAAQ,IAAR,GAAe,SAAf,CAAD,GAA6B,CAA7B,CAFT;AAGN,kBAAe,QAAQ,IAAR,IAAgB,YAAY,YAAZ,CAAhB,CAHT;;AAMN,OAAI,eAAe,KAAK,OAAL,CAAa,eAAb,EAA8B;AAChD,mBAAe,KAAK,OAAL,CAAa,eAAb,CADiC;AAEhD,mBAAe,QAAQ,IAAR,IAAgB,YAAY,YAAZ,CAAhB,CAFiC;IAAjD,MAGO,IAAI,eAAe,KAAK,OAAL,CAAa,eAAb,EAA8B;AACvD,mBAAe,KAAK,OAAL,CAAa,eAAb,CADwC;AAEvD,mBAAe,QAAQ,IAAR,IAAgB,YAAY,YAAZ,CAAhB,CAFwC;IAAjD;;AAMP,OAAI,eAAe,KAAK,OAAL,CAAa,eAAb,IAAgC,eAAe,KAAK,OAAL,CAAa,eAAb,EAA8B;AAC/F,mBAAe,QAAQ,IAAR,GAAe,SAAf,CADgF;AAE/F,mBAAe,CAAf,CAF+F;IAAhG;GAnBM;;AA0BP,MAAI,YAAY;AACf,YAAS,KAAK,OAAL,CAAa,QAAb,CAAsB,eAAtB,CAAT;AACA,YAAS,KAAK,OAAL,CAAa,QAAb,CAAsB,eAAtB,CAAT;GAFG,CA1C6B;;AAgDjC,MAAI,aAAa;AAChB,YAAS,iBAAiB,CAAjB;AACT,YAAS,iBAAiB,CAAjB;GAFN,CAhD6B;;AAsDjC,OAAK,OAAL,CAAa,WAAb,CAAyB,eAAzB,EAA0C,WAAW,OAAX,CAA1C,CAtDiC;AAuDjC,OAAK,OAAL,CAAa,WAAb,CAAyB,eAAzB,EAA0C,WAAW,OAAX,CAA1C,CAvDiC;;AA0DjC,OAAK,MAAL,CAAY,EAAC,KAAK,IAAL,EAAW,KAAK,GAAL,EAAU,UAAU,SAAS,GAAT,EAAc,SAAS,SAAT,EAA1D,EA1DiC;AA2DjC,OAAK,QAAL,GA3DiC;;AA6DjC,UAAQ,SAAR,CA7DiC;;AA+DjC,UAAQ,MAAR,CAAe,EAAC,KAAK,IAAL,EAAW,KAAK,GAAL,EAAU,UAAU,SAAS,GAAT,EAAc,SAAS,YAAT,EAA7D,EA/DiC;AAgEjC,MAAI,CAAC,WAAW,OAAX,EAAoB,QAAQ,QAAR,GAAzB;;AAEA,UAAQ,YAAR,CAlEiC;;AAoEjC,UAAQ,MAAR,CAAe,EAAC,KAAK,IAAL,EAAW,KAAK,GAAL,EAAU,UAAU,SAAS,GAAT,EAAc,SAAS,YAAT,EAA7D,EApEiC;AAqEjC,MAAI,CAAC,WAAW,OAAX,EAAoB,QAAQ,QAAR,GAAzB;;AAEA,MAAI,WAAW,OAAX,KAAuB,UAAU,OAAV,EAAmB,KAAK,OAAL,CAAa,OAAb,CAAqB,yBAArB,EAA9C;AACA,MAAI,WAAW,OAAX,KAAuB,UAAU,OAAV,EAAmB,KAAK,OAAL,CAAa,OAAb,CAAqB,yBAArB,EAA9C;;AAGA,MAAI,eAAe,YAAf,GAA8B,QAAQ,eAAR,GAA0B,QAAQ,eAAR,EAAyB;AACpF,QAAK,OAAL,CAAa,OAAb,CAAqB,SAArB,EADoF;GAArF,MAEO;AACN,QAAK,OAAL,CAAa,OAAb,CAAqB,QAArB,EADM;GAFP;;AAMA,SAAO,SAAP,CAjFiC;EAArB,CA9B2C;;AAqHxD,UAAS,UAAT,CAAoB,IAApB,EAA0B;AACzB,MAAI,OAAO,OAAO,MAAP,CADc;;AAGzB,SAAO,UAAU,SAAV,EAAqB;AAC3B,OAAI,WAAW,KAAK,IAAL,GAAX;OACH,cAAc,QAAQ,IAAR,GAAd;OACA,cAAc,QAAQ,IAAR,GAAd;OACA,SAAS,UAAU,MAAV,EAAT,CAJ0B;;AAM3B,WAAQ,SAAS,KAAT,GAAiB,YAAY,KAAZ,GAAoB,YAAY,KAAZ,CANlB;AAO3B,YAAS,KAAK,GAAL,CAAS,SAAS,MAAT,EAAiB,YAAY,MAAZ,EAAoB,YAAY,MAAZ,CAAvD,CAP2B;;AAS3B,UAAO;AACN,aAAS,OAAO,IAAP,GAAc,OAAO,KAAP,GAAe,KAA7B;AACT,cAAU,OAAO,GAAP,GAAa,OAAO,MAAP,GAAgB,MAA7B;IAFX,CAT2B;GAArB,CAHkB;EAA1B;;AAoBA,KAAI,SAAJ,GAAgB,WAAW,WAAX,CAAhB,CAzIwD;AA0IxD,KAAI,OAAJ,GAAc,WAAW,SAAX,CAAd,CA1IwD;AA2IxD,KAAI,OAAJ,GAAc,WAAW,SAAX,CAAd,CA3IwD;;AA6IxD,QAAO,GAAP,CA7IwD;CAAzB;;;;;ACnChC;;;;;;AAEA,iBAAE,OAAF,CAAU,IAAV,EAAgB,UAAS,CAAT,EAAW;AA0B1B,GAAE,qBAAF,EAAyB,OAAzB,CAAiC;AAChC,eAAa,qBAAS,QAAT,EAAmB,MAAnB,EAA2B,WAA3B,EAAwC;AAEpD,KAAE,gBAAF,EAAoB,QAApB,CAA6B,IAA7B,EAAmC,IAAnC,CAAwC,YAAU;AACjD,QAAI,QAAJ,EAAc;AACb,OAAE,IAAF,EAAQ,QAAR,CAAiB,IAAjB,EAAuB,IAAvB,CAA4B,YAAW;AACtC,QAAE,IAAF,EAAQ,WAAR,CAAoB,kBAApB,EADsC;AAEtC,UAAI,EAAE,IAAF,EAAQ,IAAR,CAAa,UAAb,CAAJ,EAA8B;AAC7B,SAAE,IAAF,EAAQ,UAAR,CAAmB,UAAnB,EAD6B;AAE7B,SAAE,IAAF,EAAQ,QAAR,CAAiB,UAAjB,EAF6B;OAA9B;MAF2B,CAA5B,CADa;KAAd,MAQO;AACN,OAAE,IAAF,EAAQ,QAAR,CAAiB,IAAjB,EAAuB,IAAvB,CAA4B,YAAW;AACtC,QAAE,IAAF,EAAQ,QAAR,CAAiB,kBAAjB,EADsC;AAEtC,QAAE,IAAF,EAAQ,QAAR,CAAiB,UAAjB,EAFsC;AAGtC,QAAE,IAAF,EAAQ,WAAR,CAAoB,UAApB,EAHsC;AAItC,QAAE,IAAF,EAAQ,IAAR,CAAa,UAAb,EAAyB,IAAzB,EAJsC;MAAX,CAA5B,CADM;KARP;IADuC,CAAxC,CAFoD;;AAqBpD,QAAK,iBAAL,CAAuB,QAAvB,EArBoD;;AAuBpD,QAAK,MAAL,CAAY,QAAZ,EAAsB,MAAtB,EAA8B,WAA9B,EAvBoD;GAAxC;AAyBb,qBAAmB,2BAAS,IAAT,EAAe;AACjC,OAAI,IAAJ,EAAU;AAET,MAAE,YAAF,EAAgB,IAAhB,CAAqB,IAArB,EAA2B,IAA3B,GAFS;;AAKT,MAAE,gBAAF,EAAoB,IAApB,CAAyB,yBAAzB,EAAoD,IAApD,GALS;IAAV,MAMO;AAEN,MAAE,mBAAF,EAAuB,IAAvB,CAA4B,IAA5B,EAAkC,IAAlC,CAAuC,YAAW;AAEjD,OAAE,IAAF,EAAQ,IAAR,GAFiD;KAAX,CAAvC,CAFM;;AAQN,QAAI,MAAM,EAAE,oCAAF,EAAwC,MAAxC,EAAN,CARE;AASN,QAAI,IAAI,QAAJ,CAAa,yBAAb,EAAwC,MAAxC,KAAmD,CAAnD,EAAsD,IAAI,MAAJ,CAAW,8CAAX,EAA2D,MAA3D,GAA1D;AACA,QAAI,QAAJ,CAAa,yBAAb,EAAwC,MAAxC,GAVM;IANP;GADkB;AAoBnB,mBAAiB,2BAAY;AAC5B,UAAO,EAAE,4BAAF,EAAgC,MAAhC,GAAyC,CAAzC,CADqB;GAAZ;;AASjB,2BAAyB,mCAAY;AACpC,OAAI,cAAJ,EAAoB,WAApB,CADoC;;AAGpC,OAAI,EAAE,MAAF,KAAa,KAAK,CAAL,EAAQ;AACxB,kBAAc,EAAE,MAAF,CAAS,iBAAT,CAAd,CADwB;;AAGxB,QAAI,gBAAgB,KAAK,CAAL,IAAU,gBAAgB,IAAhB,EAAsB;AACnD,sBAAiB,gBAAgB,MAAhB,CADkC;KAApD;IAHD;;AAQA,UAAO,cAAP,CAXoC;GAAZ;;AAmBzB,2BAAyB,iCAAU,QAAV,EAAoB;AAC5C,OAAI,EAAE,MAAF,KAAa,KAAK,CAAL,EAAQ;AACxB,MAAE,MAAF,CAAS,iBAAT,EAA4B,QAA5B,EAAsC,EAAE,MAAM,GAAN,EAAW,SAAS,EAAT,EAAnD,EADwB;IAAzB;GADwB;;AAgBzB,8BAA4B,sCAAY;AACvC,OAAI,cAAJ;OACC,cAAc,KAAK,0BAAL,EAAd;OACA,eAAe,EAAE,WAAF,EAAe,uBAAf,EAAf;OACA,iBAAiB,KAAK,eAAL,EAAjB,CAJsC;;AAMvC,OAAI,gBAAgB,KAAK,CAAL,EAAQ;AAE3B,qBAAiB,cAAjB,CAF2B;IAA5B,MAGO,IAAI,gBAAgB,cAAhB,IAAkC,YAAlC,EAAgD;AAE1D,qBAAiB,WAAjB,CAF0D;IAApD,MAGA;AAEN,qBAAiB,cAAjB,CAFM;IAHA;;AAQP,UAAO,cAAP,CAjBuC;GAAZ;;AAoB5B,SAAO,iBAAY;AAClB,OAAI,OAAO,IAAP,CADc;;AAGlB,cAAW,YAAY;AAKtB,SAAK,WAAL,CAAiB,CAAC,KAAK,0BAAL,EAAD,EAAoC,KAArD,EAA4D,KAA5D,EALsB;IAAZ,EAMR,CANH,EAHkB;;AAYlB,KAAE,MAAF,EAAU,EAAV,CAAa,cAAb,EAA6B,UAAU,CAAV,EAAa;AACzC,eAAW,YAAY;AACtB,UAAK,WAAL,CAAiB,CAAC,KAAK,0BAAL,EAAD,EAAoC,KAArD,EAA4D,KAA5D,EADsB;KAAZ,EAER,CAFH,EADyC;IAAb,CAA7B,CAZkB;;AAkBlB,QAAK,MAAL,GAlBkB;GAAZ;EA9GR,EA1B0B;;AA8J1B,GAAE,gBAAF,EAAoB,OAApB,CAA4B;AAC3B,WAAS,mBAAW;AACnB,OAAI,OAAO,IAAP,CADe;;AAInB,QAAK,IAAL,CAAU,YAAV,EAAwB,MAAxB,GAJmB;;AAMnB,QAAK,WAAL,GANmB;;AAQnB,QAAK,MAAL,GARmB;GAAX;AAUT,aAAW,qBAAW;AACrB,QAAK,MAAL,GADqB;GAAX;;AAIX,0BAAwB,gCAAS,GAAT,EAAc;AACrC,OAAI,aAAa,IAAI,iBAAJ,CAAsB,cAAtB,CAAb,CADiC;AAErC,OAAG,UAAH,EAAe;AACd,QAAI,OAAO,KAAK,IAAL,CAAU,aAAa,WAAW,OAAX,CAAmB,KAAnB,EAA0B,GAA1B,EAA+B,OAA/B,CAAuC,oBAAvC,EAA6D,EAA7D,CAAb,CAAjB,CADU;AAEd,QAAG,CAAC,KAAK,QAAL,CAAc,SAAd,CAAD,EAA2B,KAAK,MAAL,GAA9B;IAFD;AAIA,QAAK,WAAL,GANqC;GAAd;;AASxB,yBAAuB;AACtB,uBAAoB,4BAAS,CAAT,EAAY,IAAZ,EAAiB;AACpC,SAAK,sBAAL,CAA4B,KAAK,GAAL,CAA5B,CADoC;IAAjB;AAGpB,sBAAmB,2BAAS,CAAT,EAAY,IAAZ,EAAiB;AACnC,SAAK,sBAAL,CAA4B,KAAK,GAAL,CAA5B,CADmC;IAAjB;GAJpB;;AASA,yBAAuB;AACtB,oBAAiB,yBAAS,CAAT,EAAY,IAAZ,EAAiB;AACjC,SAAK,sBAAL,CAA4B,KAAK,OAAL,CAA5B,CADiC;IAAjB;GADlB;;AAMA,sBAAoB,8BAAU;AAC7B,UAAO,KAAK,OAAL,CAAa,YAAb,CAAP,CAD6B;GAAV;;AAIpB,uBAAqB;AACpB,aAAU,kBAAS,CAAT,EAAW;AACpB,SAAK,WAAL,CAAiB,WAAjB,EAA8B,EAAE,EAAE,MAAF,CAAF,CAAY,QAAZ,CAAqB,WAArB,CAA9B,EADoB;;AAKpB,MAAE,gBAAF,EAAoB,OAApB,CAA4B,cAA5B,EALoB;;AAQpB,QAAI,KAAK,QAAL,CAAc,WAAd,CAAJ,EAAgC,KAAK,IAAL,CAAU,oBAAV,EAAgC,WAAhC,CAA4C,QAA5C,EAAhC;;AAGA,QAAG,CAAC,KAAK,QAAL,CAAc,WAAd,CAAD,EAA6B;AAC/B,OAAE,yBAAF,EAA6B,OAA7B,CAAqC,IAArC,EAA2C,QAA3C,CAAoD,QAApD,EAD+B;KAAhC;IAXS;GADX;;AAkBA,eAAa,uBAAW;AAEvB,OAAI,eAAe,KAAK,IAAL,CAAU,eAAV,CAAf,CAFmB;;AAIvB,gBAAa,aAAa,EAAb,CAAgB,UAAhB,IAA8B,MAA9B,GAAuC,MAAvC,CAAb,GAJuB;;AAOvB,OAAI,YAAY,EAAE,6BAAF,EAAiC,GAAjC,EAAZ,CAPmB;AAQvB,OAAG,SAAH,EAAc;AACb,SAAK,IAAL,CAAU,IAAV,EAAgB,IAAhB,CAAqB,YAAW;AAC/B,SAAG,EAAE,UAAF,CAAa,EAAE,IAAF,EAAQ,WAAR,CAAhB,EAAsC,EAAE,IAAF,EAAQ,WAAR,CAAoB,SAApB,EAAtC;KADoB,CAArB,CADa;IAAd;GARY;EA7Dd,EA9J0B;;AA4O1B,GAAE,mBAAF,EAAuB,OAAvB,CAA+B;AAC9B,gBAAc,sBAAS,IAAT,EAAe;AAC5B,OAAI,MAAM,EAAE,IAAF,CAAN,CADwB;;AAG5B,OAAI,IAAI,QAAJ,CAAa,IAAb,EAAmB,KAAnB,GAA2B,QAA3B,CAAoC,kBAApC,CAAJ,EAA6D;AAC5D,QAAI,IAAJ,EAAU;AAGT,SACC,CAAC,IAAI,QAAJ,CAAa,IAAb,EACC,KADD,GAEC,QAFD,CAEU,IAFV,EAGC,KAHD,GAIC,QAJD,CAIU,OAJV,CAAD,EAKC;;AAED,UAAI,KAAK,IAAI,KAAJ,EAAL,CAFH;AAGD,SAAG,QAAH,CAAY,OAAZ,EAAqB,GAArB,CAAyB,EAAzB,EAHC;;AAOD,SAAG,QAAH,CAAY,IAAZ,EAAkB,KAAlB,GAA0B,MAA1B,GAPC;;AASD,SAAG,IAAH,CAAQ,MAAR,EAAgB,GAAhB,CAAoB,OAApB,EAA6B,MAA7B,GATC;;AAWD,SAAG,IAAH,CAAQ,GAAR,EAAa,KAAb,GAAqB,MAArB,CAA4B,OAA5B,EAXC;;AAaD,UAAI,QAAJ,CAAa,IAAb,EAAmB,OAAnB,CAA2B,EAA3B,EAbC;MANF;;AAsBA,OAAE,mBAAF,EAAuB,IAAvB,GAzBS;AA0BT,SAAI,QAAJ,CAAa,QAAb,EA1BS;AA2BT,SAAI,QAAJ,CAAa,IAAb,EAAmB,IAAnB,CAAwB,IAAxB,EAA8B,MAA9B,CAAqC,MAArC,EA3BS;KAAV,MA4BO;AACN,SAAG,EAAH,EAAO;AACN,SAAG,MAAH,GADM;MAAP;AAGA,OAAE,mBAAF,EAAuB,IAAvB,GAJM;AAKN,SAAI,WAAJ,CAAgB,QAAhB,EALM;AAMN,SAAI,IAAJ,CAAS,iBAAT,EAA4B,WAA5B,CAAwC,QAAxC,EANM;AAON,SAAI,QAAJ,CAAa,IAAb,EAAmB,IAAnB,CAAwB,IAAxB,EAA8B,IAA9B,GAPM;KA5BP;IADD;GAHa;EADf,EA5O0B;;AA0R1B,GAAE,mBAAF,EAAuB,WAAvB,CAAmC,YAAU;AAAC,IAAE,IAAF,EAAQ,YAAR,CAAqB,IAArB,EAAD;EAAV,EAAwC,YAAU;AAAC,IAAE,IAAF,EAAQ,YAAR,CAAqB,KAArB,EAAD;EAAV,CAA3E,CA1R0B;;AA4R1B,GAAE,wBAAF,EAA4B,OAA5B,CAAoC;AACnC,WAAS,iBAAS,CAAT,EAAY;AACpB,KAAE,cAAF,GADoB;AAEpB,KAAE,IAAF,EAAQ,YAAR,CAAqB,IAArB,EAFoB;GAAZ;EADV,EA5R0B;;AAmS1B,GAAE,mBAAF,EAAuB,OAAvB,CAA+B;AAC9B,WAAS,mBAAW;AACnB,OAAG,KAAK,IAAL,CAAU,IAAV,EAAgB,MAAhB,EAAwB;AAC1B,SAAK,IAAL,CAAU,SAAV,EAAqB,MAArB,CAA4B,iFAA5B,EAD0B;IAA3B;AAGA,QAAK,MAAL,GAJmB;GAAX;AAMT,aAAW,qBAAW;AACrB,QAAK,MAAL,GADqB;GAAX;AAGX,UAAQ,kBAAW;AAClB,QAAK,KAAK,QAAL,CAAc,QAAd,IAA0B,OAA1B,GAAoC,MAApC,CAAL,GADkB;GAAX;;AAOR,QAAM,gBAAW;AAChB,OAAI,SAAS,KAAK,WAAL,EAAT,CADY;AAEhB,OAAG,MAAH,EAAW,OAAO,IAAP,GAAX;AACA,OAAI,KAAK,IAAL,CAAU,UAAV,CAAJ,EAA4B;AAC3B,SAAK,IAAL,CAAU,UAAV,EAAsB,MAAtB,GAD2B;IAA5B;AAGA,QAAK,QAAL,CAAc,QAAd,EAAwB,IAAxB,CAA6B,IAA7B,EAAmC,IAAnC,GANgB;AAOhB,QAAK,IAAL,CAAU,kBAAV,EAA8B,QAA9B,CAAuC,QAAvC,EAPgB;GAAX;AASN,SAAO,iBAAW;AACjB,QAAK,WAAL,CAAiB,QAAjB,EAA2B,IAA3B,CAAgC,IAAhC,EAAsC,IAAtC,GADiB;AAEjB,QAAK,IAAL,CAAU,kBAAV,EAA8B,WAA9B,CAA0C,QAA1C,EAFiB;GAAX;AAIP,UAAQ,kBAAW;AAClB,OAAI,SAAS,KAAK,WAAL,EAAT,CADc;AAElB,QAAK,QAAL,CAAc,SAAd,EAAyB,IAAzB,GAFkB;;AAKlB,QAAK,QAAL,GAAgB,WAAhB,CAA4B,SAA5B,EAAuC,KAAvC,GALkB;AAMlB,QAAK,QAAL,GAAgB,IAAhB,CAAqB,IAArB,EAA2B,WAA3B,CAAuC,SAAvC,EANkB;AAOlB,OAAG,MAAH,EAAW;AACV,QAAI,iBAAiB,OAAO,QAAP,EAAjB,CADM;AAEV,WAAO,QAAP,CAAgB,SAAhB,EAFU;AAGV,mBAAe,WAAf,CAA2B,SAA3B,EAAsC,KAAtC,GAHU;AAIV,mBAAe,IAAf,CAAoB,IAApB,EAA0B,WAA1B,CAAsC,SAAtC,EAAiD,KAAjD,GAJU;IAAX;;AAOA,QAAK,OAAL,GAAe,WAAf,GAdkB;;AAgBlB,QAAK,OAAL,CAAa,QAAb,EAhBkB;GAAX;EA9BT,EAnS0B;;AAqV1B,GAAE,kBAAF,EAAsB,OAAtB,CAA8B;AAC7B,WAAS,mBAAW;AACnB,UAAO,KAAK,OAAL,CAAa,sBAAb,CAAP,CADmB;GAAX;EADV,EArV0B;;AA2V1B,GAAE,qBAAF,EAAyB,OAAzB,CAAiC;AAChC,eAAa,uBAAW;AACvB,UAAO,KAAK,OAAL,CAAa,UAAb,CAAP,CADuB;GAAX;EADd,EA3V0B;;AAoW1B,GAAE,qBAAF,EAAyB,OAAzB,CAAiC;AAChC,WAAS,iBAAS,CAAT,EAAY;AAGpB,OAAI,aAAa,EAAE,IAAF,CAAO,UAAP,CAAkB,KAAK,IAAL,CAAU,MAAV,CAAlB,CAAb,CAHgB;AAIpB,OAAG,EAAE,KAAF,GAAU,CAAV,IAAe,UAAf,EAA2B,OAA9B;;AAIA,OAAG,KAAK,IAAL,CAAU,QAAV,KAAuB,QAAvB,EAAiC;AACnC,WADmC;IAApC;;AAIA,KAAE,cAAF,GAZoB;;AAcpB,OAAI,OAAO,KAAK,WAAL,EAAP,CAdgB;;AAgBpB,OAAI,MAAM,KAAK,IAAL,CAAU,MAAV,CAAN,CAhBgB;AAiBpB,OAAG,CAAC,UAAD,EAAa,MAAM,EAAE,MAAF,EAAU,IAAV,CAAe,MAAf,IAAyB,GAAzB,CAAtB;;AAEA,OAAI,WAAW,KAAK,IAAL,CAAU,IAAV,CAAX,CAnBgB;AAoBpB,OAAG,SAAS,MAAT,EAAiB;AACnB,aAAS,KAAT,GAAiB,IAAjB,CAAsB,GAAtB,EAA2B,KAA3B,GADmB;IAApB,MAEO;AAGN,QAAG,CAAC,EAAE,gBAAF,EAAoB,SAApB,CAA8B,GAA9B,CAAD,EAAqC,OAAO,KAAP,CAAxC;IALD;;AAQA,QAAK,MAAL,GA5BoB;GAAZ;EADV,EApW0B;;AAqY1B,GAAE,oCAAF,EAAwC,OAAxC,CAAgD;AAC/C,WAAS,iBAAS,CAAT,EAAY;AACpB,OAAI,KAAK,KAAK,OAAL,CAAa,IAAb,CAAL,CADgB;AAEpB,MAAG,MAAH,GAFoB;AAGpB,UAAO,KAAP,CAHoB;GAAZ;EADV,EArY0B;;AA6Y1B,GAAE,oBAAF,EAAwB,OAAxB,CAAgC;AAC/B,WAAS,mBAAW;AACnB,KAAE,gBAAF,EAAoB,SAApB,CAA8B,KAAK,IAAL,CAAU,MAAV,CAA9B,EADmB;AAEnB,KAAE,mBAAF,EAAuB,WAAvB,CAAmC,SAAnC,EAA8C,KAA9C,GAFmB;AAGnB,UAAO,KAAP,CAHmB;GAAX;EADV,EA7Y0B;;AAwZ1B,GAAE,0BAAF,EAA8B,OAA9B,CAAsC;;AAErC,SAAO,iBAAY;AAClB,OAAI,WAAW,EAAE,WAAF,EAAe,uBAAf,KAA2C,IAA3C,GAAkD,KAAlD,CADG;;AAGlB,QAAK,SAAL,CAAe,QAAf,EAHkB;AAIlB,QAAK,eAAL,CAAqB,QAArB,EAJkB;;AAMlB,QAAK,MAAL,GANkB;GAAZ;;AAcP,aAAW,mBAAU,QAAV,EAAoB;AAC9B,QAAK,WAAW,UAAX,GAAwB,aAAxB,CAAL,CAA4C,QAA5C,EAD8B;GAApB;;AASX,mBAAiB,yBAAU,QAAV,EAAoB;AACpC,QAAK,IAAL,CAAU,0BAAV,EAAsC,IAAtC,CAA2C,WAAW,OAAX,GAAqB,MAArB,CAA3C,CADoC;GAApB;;AAIjB,WAAS,mBAAY;AACpB,OAAI,QAAQ,KAAK,OAAL,CAAa,WAAb,CAAR;OACH,0BAA0B,MAAM,0BAAN,EAA1B;OACA,uBAAuB,MAAM,uBAAN,EAAvB;OACA,iBAAiB,yBAAyB,KAAK,CAAL,GAAS,CAAC,KAAK,QAAL,CAAc,QAAd,CAAD,GAA2B,CAAC,oBAAD,CAJ3D;;AAOpB,OAAI,4BAA4B,KAAK,CAAL,EAAQ;AAIvC,UAAM,0BAAN,CAAiC,MAAM,QAAN,CAAe,WAAf,CAAjC,EAJuC;IAAxC,MAKO,IAAI,4BAA4B,KAAK,CAAL,IAAU,mBAAmB,KAAnB,EAA0B;AAE1E,UAAM,4BAAN,GAF0E;IAApE;;AAMP,SAAM,uBAAN,CAA8B,cAA9B,EAlBoB;;AAoBpB,QAAK,SAAL,CAAe,cAAf,EApBoB;AAqBpB,QAAK,eAAL,CAAqB,cAArB,EArBoB;;AAuBpB,QAAK,MAAL,GAvBoB;GAAZ;EA7BV,EAxZ0B;CAAX,CAAhB;;;;;ACFA;;;;;;AAEA,iBAAE,OAAF,CAAU,IAAV,EAAgB,UAAS,CAAT,EAAY;AAG3B,GAAE,OAAF,CAAU,YAAV,GAAyB,EAAE,OAAF,CAAU,uBAAV,CAHE;;AAwB3B,GAAE,YAAF,EAAgB,OAAhB,CAAwB;;AAEvB,iBAAe,IAAf;;AAEA,kBAAgB,IAAhB;;AAOA,gBAAc,wBAAY;AACzB,UAAO,EAAE,MAAF,KAAa,KAAK,CAAL,IAAU,KAAK,IAAL,CAAU,IAAV,MAAoB,KAAK,CAAL,CADzB;GAAZ;;AASd,8BAA4B,sCAAY;AACvC,OAAI,WAAJ,EAAiB,WAAjB,CADuC;;AAGvC,OAAI,KAAK,YAAL,EAAJ,EAAyB;AACxB,kBAAc,EAAE,MAAF,CAAS,yBAAyB,KAAK,IAAL,CAAU,IAAV,CAAzB,CAAvB,CADwB;;AAGxB,QAAI,gBAAgB,KAAK,CAAL,IAAU,gBAAgB,IAAhB,EAAsB;AACnD,mBAAc,gBAAgB,MAAhB,CADqC;KAApD;IAHD;;AAQA,UAAO,WAAP,CAXuC;GAAZ;;AAmB5B,8BAA4B,oCAAU,QAAV,EAAoB;AAC/C,OAAI,KAAK,YAAL,EAAJ,EAAyB;AACxB,MAAE,MAAF,CAAS,yBAAyB,KAAK,IAAL,CAAU,IAAV,CAAzB,EAA0C,QAAnD,EAA6D,EAAE,MAAM,GAAN,EAAW,SAAS,EAAT,EAA1E,EADwB;IAAzB;GAD2B;;AAU5B,gCAA8B,wCAAY;AACzC,OAAI,KAAK,YAAL,EAAJ,EAAyB;AACxB,MAAE,MAAF,CAAS,yBAAyB,KAAK,IAAL,CAAU,IAAV,CAAzB,EAA0C,EAAnD,EAAuD,EAAE,MAAM,GAAN,EAAW,SAAS,CAAC,CAAD,EAA7E,EADwB;IAAzB;GAD6B;;AAW9B,4BAA0B,oCAAY;AACrC,OAAI,cAAc,KAAK,0BAAL,EAAd,CADiC;;AAIrC,OAAI,gBAAgB,KAAK,CAAL,EAAQ;AAC3B,kBAAc,KAAK,QAAL,CAAc,WAAd,CAAd,CAD2B;IAA5B;;AAIA,UAAO,WAAP,CARqC;GAAZ;;AAW1B,SAAO,iBAAW;AACjB,OAAI,gBAAJ,EAAsB,SAAtB,CADiB;;AAGjB,OAAG,CAAC,KAAK,IAAL,CAAU,oBAAV,EAAgC,MAAhC,EAAwC,MAAM,IAAI,SAAJ,CAAc,0CAAd,CAAN,CAA5C;;AAGA,OAAG,CAAC,KAAK,IAAL,CAAU,mBAAV,EAA+B,MAA/B,EAAuC;AAC1C,gBAAY,EAAE,4CAAF,EACV,MADU,CACH,4DADG,EAEV,MAFU,CAEH,8DAFG,CAAZ,CAD0C;;AAK1C,SAAK,MAAL,CAAY,SAAZ,EAL0C;IAA3C;;AASA,QAAK,gBAAL,CAAsB,KAAK,IAAL,CAAU,oBAAV,EAAgC,UAAhC,EAAtB,EAfiB;;AAkBjB,sBAAmB,KAAK,IAAL,CAAU,8BAAV,CAAnB,CAlBiB;AAmBjB,QAAK,iBAAL,CAAuB,iBAAiB,MAAjB,GAA0B,iBAAiB,UAAjB,EAA1B,GAA0D,KAAK,IAAL,CAAU,gBAAV,EAA4B,UAA5B,EAA1D,CAAvB,CAnBiB;;AAsBjB,QAAK,WAAL,CAAiB,CAAC,KAAK,wBAAL,EAAD,EAAkC,IAAnD,EAAyD,KAAzD,EAtBiB;;AAwBjB,QAAK,MAAL,GAxBiB;GAAX;;AAkCP,eAAa,qBAAS,QAAT,EAAmB,MAAnB,EAA2B,WAA3B,EAAwC;AACpD,OAAI,QAAJ,EAAc,gBAAd,CADoD;;AAGpD,OAAG,CAAC,MAAD,EAAS;AACX,SAAK,OAAL,CAAa,sBAAb,EAAqC,QAArC,EADW;AAEX,SAAK,OAAL,CAAa,WAAW,cAAX,GAA4B,gBAA5B,CAAb,CAFW;IAAZ;;AAKA,QAAK,WAAL,CAAiB,WAAjB,EAA8B,CAAC,QAAD,CAA9B,CARoD;AASpD,cAAW,WAAW,KAAK,gBAAL,EAAX,GAAqC,KAAK,iBAAL,EAArC,CATyC;;AAWpD,QAAK,KAAL,CAAW,QAAX,EAXoD;AAcpD,sBAAmB,KAAK,IAAL,CAAU,8BAAV,CAAnB,CAdoD;AAepD,OAAG,iBAAiB,MAAjB,EAAyB;AAC3B,SAAK,IAAL,CAAU,oBAAV,EAAgC,WAAW,MAAX,GAAoB,MAApB,CAAhC,GAD2B;AAE3B,SAAK,IAAL,CAAU,8BAAV,EAA0C,WAAW,MAAX,GAAoB,MAApB,CAA1C,GAF2B;IAA5B;;AAKA,OAAI,gBAAgB,KAAhB,EAAuB;AAC1B,SAAK,0BAAL,CAAgC,CAAC,QAAD,CAAhC,CAD0B;IAA3B;;AAOC,QAAK,OAAL,CAAa,QAAb,EAAuB,QAAvB,EA3BmD;AA4BnD,QAAK,OAAL,CAAa,WAAW,QAAX,GAAsB,UAAtB,CAAb,CA5BmD;GAAxC;;AAgCb,eAAa,qBAAS,KAAT,EAAgB;AAC5B,OAAG,CAAC,KAAD,IAAU,CAAC,KAAK,QAAL,CAAc,WAAd,CAAD,EAA6B,OAA1C;;AAEA,QAAK,WAAL,CAAiB,IAAjB,EAH4B;GAAhB;;AAMb,iBAAe,uBAAS,KAAT,EAAgB;AAC9B,OAAG,CAAC,KAAD,IAAU,KAAK,QAAL,CAAc,WAAd,CAAV,EAAsC,OAAzC;;AAEA,QAAK,WAAL,CAAiB,KAAjB,EAH8B;GAAhB;EA/IhB,EAxB2B;;AA8K3B,GAAE,wCAAF,EAA4C,OAA5C,CAAoD;AACnD,WAAS,iBAAS,CAAT,EAAY;AACpB,QAAK,WAAL,GADoB;AAEpB,KAAE,cAAF,GAFoB;GAAZ;EADV,EA9K2B;;AAqL3B,GAAE,cAAF,EAAkB,OAAlB,CAA0B;AACzB,YAAU,oBAAW;AACpB,UAAO,KAAK,OAAL,CAAa,kBAAb,CAAP,CADoB;GAAX;EADX,EArL2B;;AA2L3B,GAAE,2BAAF,EAA+B,OAA/B,CAAuC;AACtC,WAAS,iBAAS,CAAT,EAAY;AACpB,KAAE,cAAF,GADoB;AAEpB,KAAE,eAAF,GAFoB;;AAIpB,QAAK,QAAL,GAAgB,WAAhB,GAJoB;;AAMpB,QAAK,MAAL,CAAY,CAAZ,EANoB;GAAZ;EADV,EA3L2B;;AAsM3B,GAAE,6BAAF,EAAiC,OAAjC,CAAyC;AACxC,WAAS,iBAAS,CAAT,EAAY;AACpB,KAAE,cAAF,GADoB;AAEpB,KAAE,eAAF,GAFoB;;AAIpB,QAAK,QAAL,GAAgB,aAAhB,GAJoB;;AAMpB,QAAK,MAAL,CAAY,CAAZ,EANoB;GAAZ;EADV,EAtM2B;;AAiN3B,GAAE,8BAAF,EAAkC,OAAlC,CAA0C;AAEzC,WAAS,iBAAS,CAAT,EAAY;AACpB,QAAK,WAAL,GADoB;AAEpB,QAAK,MAAL,CAAY,CAAZ,EAFoB;GAAZ;EAFV,EAjN2B;CAAZ,CAAhB;;;;;ACFA;;;;AACA;;;;;;AAEA,iBAAE,OAAF,CAAU,YAAV,EAAwB,UAAS,CAAT,EAAW;AAWlC,GAAE,cAAF,EAAkB,OAAlB,CAA0B;AAOzB,iBAAe,CAAC,WAAD,EAAc,UAAd,EAAyB,aAAzB,CAAf;;AAMA,oBAAkB,IAAlB;;AAMA,mBAAiB,MAAjB;;AAKA,oBAAkB,KAAlB;;AAKA,eAAa,OAAb;;AAEA,SAAO;AACN,SAAM;AACL,WAAO,MAAP;AACA,YAAQ,MAAR;IAFD;AAIA,WAAQ;AACP,WAAO,OAAP;AACA,YAAQ,OAAR;IAFD;AAIA,oBAAiB;AAChB,WAAO,OAAP;AACA,YAAQ,OAAR;IAFD;AAIA,WAAQ;AACP,WAAO,OAAP;AACA,YAAQ,QAAR;IAFD;AAIA,oBAAiB;AAChB,WAAO,QAAP;AACA,YAAQ,OAAR;IAFD;AAIA,YAAS;AACR,WAAO,QAAP;AACA,YAAQ,OAAR;IAFD;GArBD;;AAmCA,eAAa,qBAAS,SAAT,EAAoB,IAApB,EAA0B;AACtC,OAAI,OAAO,IAAP;OAAa,SAAS,KAAK,mBAAL,EAAT,CADqB;AAEtC,OAAG,SAAS,KAAT,EAAgB;AAClB,MAAE,IAAF,CAAO,MAAP,EAAe,UAAS,KAAT,EAAgB,KAAhB,EAAuB;AACrC,UAAK,SAAL,CAAe,OAAf,EAAwB,SAAxB,EADqC;KAAvB,CAAf,CADkB;IAAnB;;AAMA,QAAK,mBAAL,CAAyB,SAAzB,EARsC;AAStC,QAAK,iBAAL,GATsC;AAUtC,QAAK,MAAL,GAVsC;;AAYtC,UAAO,IAAP,CAZsC;GAA1B;;AAoBb,cAAY,oBAAS,QAAT,EAAmB,IAAnB,EAAyB;AACpC,OAAI,YAAY,EAAE,gBAAF,CAAZ,CADgC;;AAGpC,OAAI,YAAY,OAAZ,EAAqB;AACxB,cAAU,OAAV,CAAkB,KAAlB,EAAyB,aAAzB,GADwB;AAExB,SAAK,mBAAL,CAAyB,IAAzB,EAFwB;AAGxB,SAAK,iBAAL,GAHwB;IAAzB,MAIO,IAAI,YAAY,SAAZ,EAAuB;AACjC,cAAU,OAAV,CAAkB,KAAlB,EAAyB,eAAzB,GADiC;AAEjC,SAAK,mBAAL,CAAyB,KAAzB,EAFiC;IAA3B,MAIA,IAAI,YAAY,SAAZ,EAAuB;AACjC,eAAU,OAAV,CAAkB,KAAlB,EAAyB,WAAzB,GADiC;AAEjC,UAAK,mBAAL,CAAyB,IAAzB,EAFiC;AAGjC,UAAK,iBAAL,GAHiC;KAA3B,MAIA;AACN,WAAM,mBAAmB,QAAnB,CADA;KAJA;;AAQP,OAAG,SAAS,KAAT,EAAgB,KAAK,SAAL,CAAe,MAAf,EAAuB,QAAvB,EAAnB;;AAEA,QAAK,MAAL,GArBoC;;AAuBpC,UAAO,IAAP,CAvBoC;GAAzB;;AA+BZ,cAAY,oBAAS,QAAT,EAAmB;AAC9B,OAAI,QAAQ,KAAK,QAAL,EAAR,CAD0B;;AAG9B,QAAK,kBAAL,CAAwB,QAAxB,EAH8B;AAI9B,QAAK,WAAL,CAAiB,4BAAjB,EAA+C,QAA/C,CAAwD,QAAxD,EAJ8B;AAK9B,QAAK,IAAL,CAAU,uBAAV,EACE,KADF,CACQ,MAAM,QAAN,EAAgB,KAAhB,CADR,CAEE,MAFF,CAES,MAAM,QAAN,EAAgB,MAAhB,CAFT,CAL8B;AAQ9B,QAAK,IAAL,CAAU,uBAAV,EACE,KADF,CACQ,MAAM,QAAN,EAAgB,KAAhB,CADR,CAR8B;;AAW9B,QAAK,SAAL,CAAe,MAAf,EAAuB,QAAvB,EAX8B;;AAa9B,QAAK,MAAL,GAb8B;;AAe9B,UAAO,IAAP,CAf8B;GAAnB;;AAsBZ,UAAQ,kBAAW;;AAElB,OAAG,OAAO,KAAP,EAAc,QAAQ,GAAR,CAAY,QAAZ,EAAsB,KAAK,IAAL,CAAU,OAAV,CAAtB,EAA0C,KAAK,GAAL,CAAS,CAAT,CAA1C,EAAjB;;AAGA,OAAI,mBAAmB,KAAK,mBAAL,EAAnB,CALc;AAMlB,OAAI,gBAAJ,EAAsB;AACrB,SAAK,IAAL,CAAU,qBAAV,EAAiC,kBAAjC,CAAoD,gBAApD,EADqB;IAAtB;;AAKA,OAAI,gBAAgB,EAAE,gBAAF,EAAoB,OAApB,CAA4B,KAA5B,EAAmC,gBAAnC,EAAhB,CAXc;AAYlB,OAAI,aAAJ,EAAmB;AAElB,MAAE,wBAAF,EAA4B,iBAA5B,CAA8C,cAAc,IAAd,CAA9C,CAFkB;IAAnB;;AAMA,OAAI,kBAAkB,KAAK,kBAAL,EAAlB,CAlBc;AAmBlB,OAAI,eAAJ,EAAqB;AACpB,SAAK,IAAL,CAAU,wBAAV,EAAoC,iBAApC,CAAsD,KAAK,kBAAL,EAAtD,EADoB;IAArB;;AAIA,UAAO,IAAP,CAvBkB;GAAX;;AA6BR,aAAY,mBAAS,IAAT,EAAe,KAAf,EAAsB;AACjC,OAAG,KAAK,qBAAL,EAAH,EAAiC,OAAO,YAAP,CAAoB,OAApB,CAA4B,uBAAuB,IAAvB,EAA6B,KAAzD,EAAjC;GADW;;AAOZ,aAAY,mBAAS,IAAT,EAAe;AAC1B,OAAG,KAAK,qBAAL,EAAH,EAAiC,OAAO,OAAO,YAAP,CAAoB,OAApB,CAA4B,uBAAuB,IAAvB,CAAnC,CAAjC;GADW;;AAQZ,kBAAgB,0BAAW;AAC1B,QAAK,aAAL,CAAmB,IAAnB,EAD0B;AAE1B,QAAK,QAAL,CAAc,aAAd,EAF0B;AAG1B,QAAK,MAAL,GAH0B;AAI1B,QAAK,UAAL,CAAgB,SAAhB,EAA2B,KAA3B,EAJ0B;AAK1B,QAAK,mBAAL,CAAyB,KAAzB,EAL0B;AAM1B,UAAO,IAAP,CAN0B;GAAX;;AAYhB,iBAAe,yBAAW;AACzB,OAAI,CAAC,KAAK,mBAAL,EAAD,EAA6B;AAChC,SAAK,mBAAL,CAAyB,IAAzB,EADgC;;AAIhC,QAAI,EAAE,OAAF,CAAU,IAAV,IAAkB,EAAE,OAAF,CAAU,OAAV,CAAkB,KAAlB,CAAwB,CAAxB,EAA0B,CAA1B,KAA8B,CAA9B,EAAiC;AAEtD,UAAK,UAAL,CAAgB,SAAhB,EAFsD;KAAvD,MAGO;AACN,UAAK,UAAL,CAAgB,KAAK,cAAL,EAAhB,EAAuC,KAAvC,EADM;KAHP;IAJD;AAWA,UAAO,IAAP,CAZyB;GAAX;;AAkBf,kCAAgC,0CAAW;AAC1C,OAAI,QAAQ,EAAE,sBAAF,CAAR,CADsC;AAE1C,OAAI,CAAC,MAAM,MAAN,EAAc;AAClB,YAAQ,EACP,yEACC,yCADD,GAEA,UAFA,CADO,CAIN,QAJM,CAIG,MAJH,CAAR,CADkB;IAAnB;;AAQA,UAAO,KAAP,CAV0C;GAAX;;AAgBhC,SAAO,iBAAW;AACjB,OAAI,OAAO,IAAP;OAAa,kBAAkB,KAAK,MAAL,EAAlB;OAAiC,SAAS,KAAK,IAAL,CAAU,QAAV,CAAT,CADjC;;AAIjB,UAAO,QAAP,CAAgB,QAAhB,EAJiB;AAKjB,UAAO,IAAP,CAAY,MAAZ,EAAoB,YAAW;AAC9B,SAAK,uBAAL,GAD8B;;AAK9B,SAAK,gBAAL,GAL8B;;AAO9B,MAAE,IAAF,EAAQ,WAAR,CAAoB,SAApB,EAP8B;IAAX,CAApB,CALiB;;AAgBjB,OAAI,EAAE,OAAF,CAAU,IAAV,IAAkB,MAAM,SAAS,EAAE,OAAF,CAAU,OAAV,EAAmB,EAA5B,CAAN,EAAuC;AAC5D,WAAO,IAAP,CAAY,kBAAZ,EAAgC,UAAS,CAAT,EAAY;AAC3C,SAAG,OAAO,CAAP,EAAU,UAAV,IAAwB,aAAxB,EAAuC;AACzC,WAAK,8BAAL,GAAsC,UAAtC,CAAiD,UAAjD,EADyC;AAEzC,iBAAW,YAAU;AAAE,YAAK,8BAAL,GAAsC,IAAtC,CAA2C,UAA3C,EAAuD,UAAvD,EAAF;OAAV,EAAmF,CAA9F,EAFyC;MAA1C;KAD+B,CAAhC,CAD4D;IAA7D;;AAUA,QAAK,MAAL,CAAY,iEAAZ,EA1BiB;AA2BjB,QAAK,IAAL,CAAU,sBAAV,EAAkC,IAAlC,GA3BiB;;AA6BjB,QAAK,cAAL,GA7BiB;;AA+BjB,QAAK,MAAL,GA/BiB;GAAX;;AAqCP,yBAAuB,iCAAW;AACjC,OAAI,MAAM,IAAI,IAAJ,EAAN,CAD6B;AAEjC,OAAI,OAAJ,CAFiC;AAGjC,OAAI,MAAJ,CAHiC;AAIjC,OAAI;AACH,KAAC,UAAU,OAAO,YAAP,CAAX,CAAgC,OAAhC,CAAwC,GAAxC,EAA6C,GAA7C,EADG;AAEH,aAAS,QAAQ,OAAR,CAAgB,GAAhB,KAAwB,GAAxB,CAFN;AAGH,YAAQ,UAAR,CAAmB,GAAnB,EAHG;AAIH,WAAO,UAAU,OAAV,CAJJ;IAAJ,CAKE,OAAO,SAAP,EAAkB;AACnB,YAAQ,IAAR,CAAa,wEAAb,EADmB;IAAlB;GAToB;;AAcvB,YAAU,oBAAY;AACrB,OAAI,oBAAoB,EAAE,wBAAF,CAApB,CADiB;;AAGrB,qBAAkB,WAAlB,CAA8B,gBAA9B,EAHqB;AAIrB,qBAAkB,IAAlB,CAAuB,mBAAvB,EAA4C,IAA5C,GAJqB;GAAZ;;AAOV,aAAW,qBAAY;AACtB,OAAI,oBAAoB,EAAE,wBAAF,CAApB,CADkB;;AAGtB,qBAAkB,QAAlB,CAA2B,gBAA3B,EAHsB;AAItB,qBAAkB,IAAlB,CAAuB,mBAAvB,EAA4C,IAA5C,GAJsB;GAAZ;;AAUX,UAAQ,kBAAW;AAClB,QAAK,QAAL,CAAc,SAAd,EADkB;AAElB,QAAK,IAAL,CAAU,sBAAV,EAAkC,IAAlC,GAFkB;AAGlB,UAAO,IAAP,CAHkB;GAAX;;AASR,YAAU,oBAAW;AACpB,QAAK,WAAL,CAAiB,SAAjB,EADoB;AAEpB,QAAK,IAAL,CAAU,sBAAV,EAAkC,IAAlC,GAFoB;AAGpB,UAAO,IAAP,CAHoB;GAAX;;AASV,0BAAwB,kCAAW;AAClC,OAAI,IAAJ,EAAU,IAAV,CADkC;;AAGlC,OAAI,CAAC,EAAE,kBAAF,EAAsB,MAAtB,EAA8B;AAClC,SAAK,cAAL,GADkC;IAAnC,MAEO;AACN,WAAO,KAAK,SAAL,CAAe,MAAf,CAAP,CADM;AAEN,WAAO,KAAK,SAAL,CAAe,MAAf,CAAP,CAFM;;AAIN,SAAK,cAAL,GAJM;AAKN,QAAG,CAAC,IAAD,IAAS,QAAQ,SAAR,EAAmB;AAC9B,UAAK,aAAL,GAD8B;AAE9B,UAAK,iBAAL,GAF8B;KAA/B;AAIA,SAAK,MAAL,GATM;;AAaN,QAAG,IAAH,EAAS,KAAK,UAAL,CAAgB,IAAhB,EAAT;AACA,QAAG,IAAH,EAAS,KAAK,UAAL,CAAgB,IAAhB,EAAT;IAhBD;AAkBA,UAAO,IAAP,CArBkC;GAAX;;AA2BxB,yBAAuB;AACtB,uBAAoB,4BAAS,CAAT,EAAY,IAAZ,EAAkB;AAErC,QAAG,KAAK,GAAL,CAAS,iBAAT,CAA2B,iBAA3B,CAAH,EAAkD,OAAlD;;AAEA,SAAK,sBAAL,GAJqC;IAAlB;GADrB;;AAUA,cAAY,IAAZ;;AAEA,6BAA2B,qCAAW;AACrC,OAAI,MAAM,KAAK,aAAL,EAAN,CADiC;AAErC,OAAI,OAAO,CAAC,KAAK,EAAL,CAAQ,gBAAR,CAAD,EAA4B;AACtC,SAAK,aAAL,CAAmB,IAAnB,EADsC;AAEtC,SAAK,QAAL,CAAc,GAAd,EAFsC;AAGtC,SAAK,QAAL,GAHsC;IAAvC;GAF0B;;AAc3B,wCAAsC;AACrC,sBAAmB,6BAAU;AAC5B,SAAK,sBAAL,GAD4B;IAAV;GADpB;;AASA,YAAU,kBAAS,GAAT,EAAc;AACvB,QAAK,IAAL,CAAU,QAAV,EAAoB,QAApB,CAA6B,SAA7B,EAAwC,IAAxC,CAA6C,KAA7C,EAAoD,GAApD,EADuB;AAEvB,UAAO,IAAP,CAFuB;GAAd;;AASV,uBAAqB,+BAAW;AAE/B,OAAI,SAAS,EAAE,GAAF,CAAM,KAAK,gBAAL,EAAN,EAA+B,UAAS,IAAT,EAAe;AAC1D,QAAI,YAAY,EAAE,+CAA+C,IAA/C,GAAsD,GAAtD,CAAd,CADsD;AAE1D,QAAG,UAAU,MAAV,EAAkB;AACpB,YAAO;AACN,YAAM,IAAN;AACA,WAAK,UAAU,IAAV,CAAe,WAAf,CAAL;AACA,cAAQ,UAAU,EAAV,CAAa,QAAb,IAAyB,UAAU,EAAV,CAAa,UAAb,CAAzB,GAAoD,UAAU,EAAV,CAAa,WAAb,CAApD;MAHT,CADoB;KAArB,MAMO;AACN,YAAO,IAAP,CADM;KANP;IAF2C,CAAxC,CAF2B;;AAe/B,UAAO,MAAP,CAf+B;GAAX;;AAyBrB,qBAAmB,6BAAW;AAC7B,OAAI,CAAC,KAAK,mBAAL,EAAD,EAA6B,OAAO,IAAP,CAAjC;;AAEA,OAAI,SAAS,KAAK,mBAAL,EAAT,CAHyB;AAI7B,OAAI,mBAAmB,KAAK,mBAAL,EAAnB,CAJyB;AAK7B,OAAI,eAAe,IAAf,CALyB;;AAQ7B,OAAI,MAAJ,EAAY;AACX,mBAAe,EAAE,IAAF,CAAO,MAAP,EAAe,UAAS,KAAT,EAAgB,KAAhB,EAAuB;AACpD,YACC,qBAAqB,MAAM,IAAN,IACpB,CAAC,gBAAD,IAAqB,MAAM,MAAN,CAH6B;KAAvB,CAA9B,CADW;IAAZ;;AASA,OAAI,MAAM,IAAN,CAjByB;;AAmB7B,OAAI,aAAa,CAAb,CAAJ,EAAqB;AAEpB,UAAM,aAAa,CAAb,EAAgB,GAAhB,CAFc;IAArB,MAGO,IAAI,OAAO,MAAP,EAAe;AAEzB,SAAK,mBAAL,CAAyB,OAAO,CAAP,EAAU,IAAV,CAAzB,CAFyB;AAGzB,UAAM,OAAO,CAAP,EAAU,GAAV,CAHmB;IAAnB,MAIA;AAEN,SAAK,mBAAL,CAAyB,IAAzB,EAFM;IAJA;;AAUN,UAAO,CAAC,GAAC,CAAI,OAAJ,CAAY,GAAZ,MAAqB,CAAC,CAAD,GAAM,GAA5B,GAAkC,GAAlC,CAAD,GAA0C,cAA1C,CAhCqB;;AAmC7B,OAAI,KAAK,EAAL,CAAQ,gBAAR,CAAJ,EAA+B;AAC9B,SAAK,aAAL,CAAmB,GAAnB,EAD8B;AAE9B,SAAK,QAAL,CAAc,aAAd,EAF8B;AAG9B,SAAK,MAAL,GAH8B;IAA/B,MAKK;AACJ,SAAK,aAAL,CAAmB,IAAnB,EADI;;AAGJ,QAAI,GAAJ,EAAS;AACR,UAAK,QAAL,CAAc,GAAd,EADQ;AAER,UAAK,QAAL,GAFQ;KAAT,MAIK;AACJ,UAAK,MAAL,GADI;KAJL;IARD;;AAiBA,UAAO,IAAP,CApD6B;GAAX;;AA0DnB,kBAAgB,0BAAW;AAC1B,OAAI,YAAY,EAAE,oCAAF,CAAZ,CADsB;AAE1B,OAAI,cAAc,EAAE,+BAAF,CAAd,CAFsB;;AAI1B,OAAI,YAAY,MAAZ,IAAsB,UAAU,MAAV,EAAkB;AAE3C,cAAU,IAAV,CAAe,EAAE,+BAAF,EAAmC,MAAnC,EAAf,EAF2C;IAA5C,MAGO;AAEN,SAAK,MAAL,GAFM;IAHP;GAJe;;AAiBhB,oBAAkB,4BAAW;AAC5B,OAAI,CAAC,KAAK,mBAAL,EAAD,EAA6B,OAAjC;;AAEG,OAAI,GAAJ;OACE,cAAc,EAAE,gBAAF,CAAd,CAJuB;AAKzB,OAAI;AACF,UAAM,KAAK,IAAL,CAAU,QAAV,EAAoB,CAApB,EAAuB,eAAvB,CADJ;IAAJ,CAEE,OAAO,CAAP,EAAU;AAEV,YAAQ,IAAR,CAAa,mDAAb,EAFU;IAAV;AAIF,OAAI,CAAC,GAAD,EAAM;AACR,WADQ;IAAV;;AAKH,OAAI,KAAK,EAAE,GAAF,EAAO,IAAP,CAAY,sBAAZ,EAAoC,IAApC,CAAyC,SAAzC,CAAL,CAhBwB;AAiB5B,OAAI,WAAW,EAAE,GAAF,EAAO,IAAP,CAAY,4BAAZ,EAA0C,IAA1C,CAA+C,SAA/C,CAAX,CAjBwB;AAkB5B,OAAI,eAAe,EAAE,cAAF,CAAf,CAlBwB;;AAoB5B,OAAG,MAAM,aAAa,IAAb,CAAkB,iBAAlB,EAAqC,GAArC,MAA8C,EAA9C,EAAkD;AAG1D,MAAE,gBAAF,EAAoB,OAApB,CAA4B,KAA5B,EAAmC,SAAnC,CAA6C,QAA7C,EAH0D;IAA3D;GApBiB;;AA8BlB,2BAAyB,mCAAW;AAChC,OAAI,SAAS,KAAK,IAAL,CAAU,QAAV,EAAoB,CAApB,CAAT;OACF,GADF,CADgC;AAGhC,OAAG,CAAC,MAAD,EAAQ;AACT,WADS;IAAX;;AAIA,OAAI;AACF,UAAM,OAAO,eAAP,CADJ;IAAJ,CAEE,OAAO,CAAP,EAAU;AAEV,YAAQ,IAAR,CAAa,mDAAb,EAFU;IAAV;AAIF,OAAG,CAAC,GAAD,EAAM;AACP,WADO;IAAT;;AAMH,OAAI,QAAQ,IAAI,oBAAJ,CAAyB,GAAzB,CAAR,CAnB+B;AAoBnC,QAAK,IAAI,IAAI,CAAJ,EAAO,IAAI,MAAM,MAAN,EAAc,GAAlC,EAAuC;AACtC,QAAI,OAAO,MAAM,CAAN,EAAS,YAAT,CAAsB,MAAtB,CAAP,CADkC;AAEtC,QAAG,CAAC,IAAD,EAAO,SAAV;;AAEA,QAAI,KAAK,KAAL,CAAW,YAAX,CAAJ,EAA8B,MAAM,CAAN,EAAS,YAAT,CAAsB,QAAtB,EAAgC,QAAhC,EAA9B;IAJD;;AAQA,OAAI,OAAO,IAAI,cAAJ,CAAmB,uBAAnB,CAAP,CA5B+B;AA6BnC,OAAG,IAAH,EAAS,KAAK,KAAL,CAAW,OAAX,GAAqB,MAArB,CAAT;AACA,OAAI,UAAU,IAAI,cAAJ,CAAmB,8BAAnB,CAAV,CA9B+B;AA+BnC,OAAG,OAAH,EAAY,QAAQ,KAAR,CAAc,OAAd,GAAwB,MAAxB,CAAZ;;AAGA,QAAK,OAAL,CAAa,+BAAb,EAA8C,CAAE,GAAF,CAA9C,EAlCmC;GAAX;EApgB1B,EAXkC;;AAqjBlC,GAAE,gBAAF,EAAoB,OAApB,CAA4B;AAC3B,SAAO,iBAAW;AACjB,QAAK,MAAL,GADiB;AAEjB,KAAE,cAAF,EAAkB,sBAAlB,GAFiB;GAAX;EADR,EArjBkC;;AAgkBlC,GAAE,qBAAF,EAAyB,OAAzB,CAAiC;AAIhC,sBAAoB,4BAAS,KAAT,EAAgB;AACnC,QAAK,IAAL,CAAU,sBAAoB,KAApB,GAA0B,IAA1B,CAAV,CAA0C,IAA1C,CAA+C,SAA/C,EAA0D,IAA1D,EADmC;GAAhB;EAJrB,EAhkBkC;;AAykBlC,GAAE,iCAAF,EAAqC,OAArC,CAA6C;AAI5C,WAAS,iBAAS,CAAT,EAAY;AAEpB,QAAK,MAAL,GAAc,IAAd,CAAmB,SAAnB,EAA8B,WAA9B,CAA0C,QAA1C,EAFoB;AAGpB,QAAK,IAAL,CAAU,OAAV,EAAmB,QAAnB,CAA4B,QAA5B,EAHoB;;AAKpB,OAAI,kBAAkB,EAAE,IAAF,EAAQ,IAAR,CAAa,WAAb,CAAlB,CALgB;;AAOpB,KAAE,cAAF,EAAkB,WAAlB,CAA8B,eAA9B,EAPoB;GAAZ;EAJV,EAzkBkC;;AA4lBlC,GAAE,wBAAF,EAA4B,OAA5B,CAAoC;AAInC,qBAAmB,2BAAS,IAAT,EAAe;AACjC,QAAK,IAAL,CAAU,QAAV,EACE,GADF,CACM,IADN,EAEE,OAFF,CAEU,eAFV,EAGE,QAHF,GADiC;GAAf;EAJpB,EA5lBkC;;AAwmBlC,GAAE,+BAAF,EAAmC,OAAnC,CAA2C;AAI1C,YAAU,kBAAS,CAAT,EAAY;AACrB,QAAK,MAAL,CAAY,CAAZ,EADqB;AAErB,KAAE,cAAF,GAFqB;;AAIrB,OAAI,kBAAkB,EAAE,IAAF,EAAQ,GAAR,EAAlB,CAJiB;AAKrB,KAAE,cAAF,EAAkB,UAAlB,CAA6B,eAA7B,EALqB;GAAZ;EAJX,EAxmBkC;;AAsnBlC,GAAE,yCAAF,EAA6C,OAA7C,CAAqD;AAKpD,WAAQ,iBAAS,CAAT,EAAW;AAClB,OAAI,EAAE,OAAF,CAAU,IAAV,EAAgB;AACnB,MAAE,cAAF,GADmB;AAEnB,QAAI,QAAQ,KAAK,KAAL,EAAR,CAFe;AAGnB,QAAI,kBAAkB,KAAK,OAAL,CAAa,wBAAb,EAAuC,IAAvC,CAA4C,sBAAoB,KAApB,GAA0B,GAA1B,CAA5C,CAA2E,GAA3E,EAAlB,CAHe;;AAMnB,MAAE,cAAF,EAAkB,UAAlB,CAA6B,eAA7B,EANmB;IAApB;GADO;EALT,EAtnBkC;;AA0oBlC,GAAE,4BAAF,EAAgC,OAAhC,CAAwC;AACvC,WAAS,mBAAW;AACnB,KAAE,mCAAF,EAAuC,IAAvC,GADmB;;AAGnB,OAAI,EAAE,+BAAF,EAAmC,QAAnC,CAA4C,mBAA5C,CAAJ,EAAsE;AACrE,kBAAc,eAAK,EAAL,CACb,8BADa,EAEb,qDAFa,CAAd,EAGA,OAHA,EADqE;IAAtE;AAMA,QAAK,MAAL,GATmB;GAAX;;AAYT,aAAW,qBAAW;AACrB,KAAE,mCAAF,EAAuC,IAAvC,GADqB;AAErB,QAAK,MAAL,GAFqB;GAAX;EAbZ,EA1oBkC;;AAgqBlC,GAAE,mCAAF,EAAuC,OAAvC,CAA+C;AAC9C,WAAS,mBAAW;AACnB,OAAI,EAAE,cAAF,EAAkB,EAAlB,CAAqB,gBAArB,CAAJ,EAA4C;AAC3C,SAAK,IAAL,GAD2C;IAA5C,MAGK;AACJ,SAAK,IAAL,GADI;IAHL;AAMA,QAAK,MAAL,GAPmB;GAAX;AAST,aAAW,qBAAW;AACrB,QAAK,MAAL,GADqB;GAAX;EAVZ,EAhqBkC;;AAmrBlC,GAAE,wBAAF,EAA4B,OAA5B,CAAoC;AAInC,qBAAmB,2BAAS,IAAT,EAAe;AACjC,QAAK,IAAL,CAAU,QAAV,EACE,GADF,CACM,IADN,EAEE,OAFF,CAEU,eAFV,EAGE,QAHF,GADiC;GAAf;EAJpB,EAnrBkC;;AA+rBlC,GAAE,+BAAF,EAAmC,OAAnC,CAA2C;AAI1C,YAAU,kBAAS,CAAT,EAAY;AACrB,KAAE,cAAF,GADqB;;AAGrB,OAAI,iBAAiB,EAAE,IAAF,EAAQ,GAAR,EAAjB,CAHiB;AAIrB,KAAE,cAAF,EAAkB,UAAlB,CAA6B,cAA7B,EAJqB;GAAZ;EAJX,EA/rBkC;;AAqtBlC,GAAE,2CAAF,EAA+C,OAA/C,CAAuD;AACtD,8BAA4B,mCAAW;AACtC,QAAK,QAAL,GAAgB,IAAhB,CAAqB,YAArB,EAAmC,QAAnC,CAA4C,MAA5C,EAAoD,WAApD,GADsC;GAAX;;AAI5B,6BAA2B,kCAAW;AACrC,QAAK,QAAL,GAAgB,IAAhB,CAAqB,YAArB,EAAmC,WAAnC,CAA+C,MAA/C,EAAuD,iBAAvD,GADqC;GAAX;;AAQ3B,mBAAiB,wBAAW;AAC3B,QAAK,MAAL,GAD2B;AAE3B,QAAK,QAAL,GAF2B;GAAX;;AAKjB,YAAU,oBAAU;AACnB,OAAI,WAAW,KAAK,IAAL,CAAU,WAAV,CAAX,CADe;AAEnB,OAAI,YAAY,SAAS,IAAT,CAAc,WAAd,CAAZ,CAFe;;AAInB,OAAI,SAAS,KAAK,MAAL,GAAc,IAAd,CAAmB,+BAAnB,CAAT,CAJe;AAKnB,OAAI,UAAU,OAAO,IAAP,CAAY,WAAZ,CAAV,CALe;AAMnB,OAAG,OAAO,OAAP,KAAmB,WAAnB,EAA+B;AACjC,WAAO,WAAP,CAAmB,OAAnB,EADiC;IAAlC;AAGA,UAAO,QAAP,CAAgB,SAAhB,EATmB;AAUnB,UAAO,IAAP,CAAY,WAAZ,EAAyB,SAAzB,EAVmB;;AAYnB,UAAO,IAAP,CAZmB;GAAV;EAlBX,EArtBkC;;AAuvBlC,GAAE,8BAAF,EAAkC,OAAlC,CAA0C;AACzC,eAAa,uBAAU;AACtB,OAAI,OAAO,IAAP,CADkB;AAEtB,KAAE,IAAF,EAAQ,IAAR,GAFsB;;AAMtB,cAAW,YAAU;AACpB,MAAE,IAAF,EAAQ,GAAR,CAAY,EAAC,MAAK,MAAL,EAAa,OAAM,CAAN,EAA1B,EADoB;AAEpB,MAAE,IAAF,EAAQ,IAAR,GAFoB;IAAV,EAGR,GAHH,EANsB;GAAV;AAWb,qBAAkB,6BAAU;AAC3B,KAAE,IAAF,EAAQ,GAAR,CAAY,EAAC,OAAM,MAAN,EAAb,EAD2B;GAAV;;EAZnB,EAvvBkC;;AA4yBlC,GAAE,iDAAF,EAAqD,OAArD,CAA6D;AAC5D,WAAS,mBAAY;AACpB,OAAI,EAAE,wBAAF,EAA4B,QAA5B,CAAqC,gBAArC,CAAJ,EAA4D;AAC3D,SAAK,MAAL,GAAc,MAAd,CAAqB,sCAArB,EAD2D;IAA5D,MAEO;AACN,SAAK,MAAL,GAAc,MAAd,CAAqB,6DAArB,EADM;IAFP;GADQ;EADV,EA5yBkC;;AAyzBlC,GAAE,iBAAF,EAAqB,OAArB,CAA6B;AAI5B,eAAa,EAAb;;AAEA,WAAS,mBAAW;AACnB,OAAI,cAAc,KAAK,cAAL,EAAd,CADe;;AAGnB,OAAG,OAAO,KAAP,EAAc,QAAQ,GAAR,CAAY,QAAZ,EAAsB,KAAK,IAAL,CAAU,OAAV,CAAtB,EAA0C,KAAK,GAAL,CAAS,CAAT,CAA1C,EAAjB;AACA,OAAI,gBAAiB,KAAK,MAAL,KAAgB,WAAhB,CAJF;AAKnB,QAAK,MAAL,CAAY,aAAZ,EALmB;GAAX;;AAQT,WAAS,mBAAW;AACnB,QAAK,OAAL,GADmB;AAEnB,QAAK,MAAL,GAFmB;GAAX;;AAKT,aAAW,qBAAW;AACrB,QAAK,MAAL,GADqB;GAAX;EAnBZ,EAzzBkC;;AAs1BlC,GAAE,uBAAF,EAA2B,OAA3B,CAAmC;AAClC,WAAS,mBAAY;AACpB,QAAK,WAAL,CAAiB,QAAjB,EADoB;GAAZ;EADV,EAt1BkC;CAAX,CAAxB;;;;;ACCA;;;;;;AAEA,iBAAE,OAAF,CAAU,SAAV,EAAqB,UAAS,CAAT,EAAW;;AAE/B,GAAE,WAAF,EAAe,OAAf,CAAuB;;AAEtB,SAAO,IAAP;;AAEA,kBAAgB,KAAhB;;AAEA,YAAU,KAAV;;AAEA,SAAO,iBAAU;AAChB,QAAK,MAAL,GADgB;;AAIhB,OAAG,EAAE,SAAF,CAAY,KAAK,IAAL,CAAU,oBAAV,CAAZ,CAAH,EAAiD,OAAjD;;AAEA,OAAI,QAAQ,KAAK,IAAL,CAAU,YAAV,CAAR,CANY;AAOhB,OAAG,KAAH,EAAU,KAAK,QAAL,CAAc,EAAE,SAAF,CAAY,KAAZ,CAAd,EAAV;;AAoBA,OAAI,OAAO,IAAP,CA3BY;AA4Bf,QACE,MADF,CACS,KAAK,aAAL,EADT,EAEE,IAFF,CAEO,eAFP,EAEwB,UAAS,CAAT,EAAY,IAAZ,EAAkB;AACxC,SAAK,WAAL,CAAiB,IAAjB,EADwC;;AAKxC,SAAK,IAAL,CAAU,aAAV,CAAwB,EAAC,aAAa,EAAC,QAAQ;AAC9C,cAAO,KAAK,IAAL,CAAU,SAAV,CAAP;AACA,eAAQ,cAAS,IAAT,EAAe;AACtB,YAAI,SAAS,KAAK,IAAL,CAAU,cAAV,KAA6B,EAA7B,CADS;;AAGtB,iBAAS,EAAE,IAAF,CAAO,MAAP,EAAe,UAAS,CAAT,EAAY,CAAZ,EAAe;AAAC,gBAAQ,EAAE,IAAF,IAAU,IAAV,IAAkB,EAAE,IAAF,IAAU,OAAV,CAA3B;SAAf,CAAxB,CAHsB;AAItB,eAAO,IAAP,CAAY,EAAC,MAAM,IAAN,EAAY,OAAO,EAAE,IAAF,EAAQ,IAAR,CAAa,IAAb,IAAqB,EAAE,IAAF,EAAQ,IAAR,CAAa,IAAb,CAArB,GAA0C,CAA1C,EAAhC,EAJsB;AAKtB,eAAO,IAAP,CAAY,EAAC,MAAM,MAAN,EAAc,OAAO,CAAP,EAA3B,EALsB;AAMtB,eAAO,MAAP,CANsB;QAAf;OAF8B,EAAd,EAAzB,EALwC;;AAiBxC,SAAK,kBAAL,GAjBwC;AAkBxC,SAAK,GAAL,CAAS,YAAT,EAAuB,SAAvB,EAlBwC;;AAqBxC,SAAK,IAAL,CAAU,eAAV,GArBwC;IAAlB,CAFxB,CAyBE,IAzBF,CAyBO,eAzBP,EAyBwB,UAAS,CAAT,EAAY,IAAZ,EAAkB;AACxC,QAAG,KAAK,IAAL,IAAa,YAAb,EAA2B;AAE7B,SAAG,CAAC,KAAK,QAAL,CAAc,WAAd,CAAD,IAA+B,KAAK,QAAL,CAAc,aAAd,CAA/B,EAA6D;AAC/D,QAAE,wBAAF,GAD+D;AAE/D,aAAO,KAAP,CAF+D;MAAhE;KAFD;;AAQA,QAAG,EAAE,OAAF,CAAU,KAAK,IAAL,EAAW,CAAC,YAAD,EAAe,cAAf,CAArB,CAAH,EAAyD;AAExD,SAAI,OAAO,EAAE,KAAK,IAAL,CAAU,CAAV,CAAF,EAAgB,OAAhB,CAAwB,UAAxB,CAAP,CAFoD;AAGxD,SAAI,kBAAkB,KAAK,IAAL,CAAU,mBAAV,CAAlB,CAHoD;;AAMxD,SAAG,KAAK,QAAL,CAAc,UAAd,KAA6B,mBAAmB,CAAnB,EAAsB;AACrD,QAAE,wBAAF,GADqD;AAErD,aAAO,KAAP,CAFqD;MAAtD;KAND;IATsB,CAzBxB,CA8CE,IA9CF,CA8CO,kBA9CP,EA8C2B,UAAS,CAAT,EAAY,IAAZ,EAAkB;AAC3C,QAAG,KAAK,iBAAL,EAAH,EAA6B,OAA7B;;AAEA,QAAI,YAAY,KAAK,IAAL,CAAU,CAAV;QAAa,gBAAgB,KAAK,IAAL,CAAU,EAAV;QAAc,gBAAgB,KAAK,IAAL,CAAU,WAAV,CAAsB,SAAtB,CAAhB;QAAkD,cAAc,EAAE,aAAF,EAAiB,IAAjB,CAAsB,IAAtB,KAA+B,CAA/B;QAAkC,SAAS,EAAE,SAAF,EAAa,IAAb,CAAkB,IAAlB,CAAT,CAHlH;AAI3C,QAAI,aAAa,EAAE,GAAF,CAAM,EAAE,SAAF,EAAa,QAAb,GAAwB,OAAxB,EAAN,EAAyC,UAAS,EAAT,EAAa;AACtE,YAAO,EAAE,EAAF,EAAM,IAAN,CAAW,IAAX,CAAP,CADsE;KAAb,CAAtD,CAJuC;;AAQ3C,MAAE,IAAF,CAAO;AACN,YAAO,KAAK,IAAL,CAAU,iBAAV,CAAP;AACA,aAAQ,MAAR;AACA,aAAQ;AACP,UAAI,MAAJ;AACA,gBAAU,WAAV;AACA,kBAAY,UAAZ;MAHD;AAKA,cAAS,mBAAW;AAEnB,UAAI,EAAE,gCAAF,EAAoC,GAApC,MAA6C,MAA7C,EAAqD;AACxD,SAAE,sCAAF,EAA0C,GAA1C,CAA8C,WAA9C,EADwD;OAAzD;AAGA,WAAK,qBAAL,CAA2B,CAAC,MAAD,CAA3B,EALmB;MAAX;AAOT,iBAAY;AACX,WAAK,aAAW;AACf,SAAE,MAAF,CAAS,QAAT,CAAkB,KAAK,IAAL,CAAlB,CADe;OAAX;MADN;KAfD,EAR2C;IAAlB,CA9C3B,CA6EE,IA7EF,CA6EO,0DA7EP,EA6EmE,UAAS,CAAT,EAAY,IAAZ,EAAkB;AACnF,MAAE,QAAF,EAAY,cAAZ,CAA2B,CAA3B,EAA8B,IAA9B,EADmF;IAAlB,CA7EnE,CA5Be;GAAV;AA6GP,YAAU,oBAAU;AACnB,QAAK,MAAL,CAAY,SAAZ,EADmB;AAEnB,QAAK,MAAL,GAFmB;GAAV;;AAKV,yBAAuB;AACtB,uBAAoB,4BAAS,CAAT,EAAW;AAC9B,SAAK,kBAAL,GAD8B;IAAX;GADrB;;AAOA,8BAA4B;AAC3B,sBAAmB,2BAAS,CAAT,EAAW;AAC7B,QAAI,KAAK,EAAE,gCAAF,EAAoC,GAApC,EAAL,CADyB;;AAI7B,SAAK,qBAAL,CAA2B,CAAC,EAAD,CAA3B,EAJ6B;IAAX;GADpB;;AASA,iBAAe,yBAAW;AACzB,OAAI,OAAO,IAAP,CADqB;AAEzB,UAAO;AACN,YAAQ;AACP,uBAAkB,CAAC,UAAD,CAAlB;AACA,kBAAa,CAAb;AACA,oBAAe,IAAf;KAHD;AAKA,iBAAa,EAAb;AAGA,UAAM;AACL,qBAAiB,CAAjB;AACA,yBAAoB,CAAC,KAAK,IAAL,CAAU,UAAV,EAAsB,IAAtB,CAA2B,IAA3B,CAAD,CAApB;KAFD;AAIA,YAAQ;AACP,aAAQ;AAGP,oBAAc,oBAAS,IAAT,EAAe;AAC5B,WAAI,YAAY,EAAE,KAAK,CAAL,CAAd;WAAuB,YAAY,EAAE,KAAK,EAAL,CAAd;WAC1B,uBAAuB,KAAK,EAAL,CAAQ,aAAR,GAAwB,CAAxB,KAA8B,KAAK,EAAL,CAAQ,CAAR,CAA9B;WACvB,iBAAiB,UAAU,YAAV,EAAjB;WACA,iBAAiB,UAAU,YAAV,EAAjB;WAEA,QAAQ,KAAK,QAAL,EAAR;WACA,qBAAqB,EAArB;WACA,UAAU,iBAAiB,cAAjB,GAAkC,MAAlC;WACV,OAAO,KAAC,IAAS,OAAO,MAAM,OAAN,CAAP,IAAyB,WAAzB,GAAwC,MAAM,OAAN,CAAlD,GAAmE,IAAnE,CAToB;;AAY5B,WAAG,QAAQ,UAAU,IAAV,CAAe,OAAf,EAAwB,KAAxB,CAA8B,sBAA9B,CAAR,EAA+D,iBAAiB,OAAO,EAAP,CAAnF;;AAEA,WAAG,IAAH,EAAS,qBAAqB,OAAQ,KAAK,kBAAL,IAA2B,WAAlC,GAAiD,KAAK,kBAAL,GAA0B,EAA5E,CAA9B;AACA,WAAI,YAEH,UAAU,IAAV,CAAe,IAAf,MAAyB,CAAzB,IAEG,CAAC,UAAU,QAAV,CAAmB,iBAAnB,CAAD,KAEC,CAAC,oBAAD,IAAyB,KAAK,CAAL,IAAU,QAAV,CAJ7B,IAMG,CAAC,UAAU,QAAV,CAAmB,YAAnB,CAAD,KAEC,CAAC,mBAAmB,MAAnB,IAA6B,EAAE,OAAF,CAAU,cAAV,EAA0B,kBAA1B,KAAiD,CAAC,CAAD,CARnF,CAjB2B;;AA4B5B,cAAO,SAAP,CA5B4B;OAAf;MAHf;KADD;AAoCA,WAAO;AACN,oBAAgB,KAAhB;AACA,oBAAgB,KAAhB;KAFD;AAIA,gBAAY;AACX,kBAAa,IAAb;KADD;AAGA,cAAU;AACT,cAAS,OAAT;AACA,YAAO,EAAE,MAAF,EAAU,IAAV,CAAe,eAAf,IAAkC,2CAAlC;KAFR;;AAMA,eAAW,CACV,WADU,EACG,IADH,EACS,KADT,EACgB,MADhB,EACwB,QADxB,EAEV,UAFU,CAAX;IA9DD,CAFyB;GAAX;;AA+Ef,UAAQ,gBAAS,MAAT,EAAiB,QAAjB,EAA2B;AAClC,OAAG,MAAH,EAAW,KAAK,IAAL,CAAU,cAAV,EAA0B,MAA1B,EAAX,KACK,KAAK,UAAL,CAAgB,cAAhB,EADL;AAEA,QAAK,MAAL,CAAY,SAAZ,EAAuB,CAAC,CAAD,EAAI,QAA3B,EAHkC;GAA3B;;AAeR,eAAa,qBAAS,EAAT,EAAa;AACzB,UAAO,KAAK,IAAL,CAAU,eAAa,EAAb,GAAgB,GAAhB,CAAjB,CADyB;GAAb;;AAeb,cAAY,oBAAS,IAAT,EAAe,IAAf,EAAqB,QAArB,EAA+B;AAC1C,OAAI,OAAO,IAAP;OACH,aAAa,KAAK,QAAL,KAAkB,KAAK,CAAL,GAAS,KAAK,WAAL,CAAiB,KAAK,QAAL,CAA5C,GAA6D,KAA7D;OACb,UAAU,EAAE,IAAF,CAAV,CAHyC;;AAO1C,OAAI,aAAa,EAAC,MAAM,EAAN,EAAd,CAPsC;AAQ1C,OAAG,QAAQ,QAAR,CAAiB,aAAjB,CAAH,EAAoC;AACnC,eAAW,KAAX,GAAmB,MAAnB,CADmC;IAApC,MAEO,IAAG,QAAQ,QAAR,CAAiB,eAAjB,CAAH,EAAsC;AAC5C,eAAW,KAAX,GAAmB,QAAnB,CAD4C;IAAtC;AAGP,QAAK,MAAL,CACC,aADD,EAEC,WAAW,MAAX,GAAoB,UAApB,GAAiC,CAAC,CAAD,EACjC,MAHD,EAIC,UAJD,EAKC,UAAS,IAAT,EAAe;AACd,QAAI,cAAc,KAAK,IAAL,CAAU,OAAV,CAAd,CADU;;AAGd,SAAI,IAAI,IAAE,CAAF,EAAK,IAAE,QAAQ,CAAR,EAAW,UAAX,CAAsB,MAAtB,EAA8B,GAA7C,EAAiD;AAChD,SAAI,OAAO,QAAQ,CAAR,EAAW,UAAX,CAAsB,CAAtB,CAAP,CAD4C;AAEhD,UAAK,IAAL,CAAU,KAAK,IAAL,EAAW,KAAK,KAAL,CAArB,CAFgD;KAAjD;;AAKA,SAAK,QAAL,CAAc,WAAd,EAA2B,IAA3B,CAAgC,QAAQ,IAAR,EAAhC,EARc;AASd,aAAS,IAAT,EATc;IAAf,CALD,CAb0C;GAA/B;;AAyCZ,cAAY,oBAAS,IAAT,EAAe,IAAf,EAAqB,IAArB,EAA2B;AACtC,OAAI,OAAO,IAAP;OAAa,UAAU,EAAE,IAAF,CAAV;OAAmB,cAAc,KAAK,IAAL,CAAU,OAAV,CAAd,CADE;;AAGtC,OAAI,WAAW,KAAK,MAAL,GAAc,KAAK,WAAL,CAAiB,KAAK,MAAL,CAA/B,GAA8C,KAA9C,CAHuB;AAItC,OAAI,WAAW,KAAK,MAAL,GAAc,KAAK,WAAL,CAAiB,KAAK,MAAL,CAA/B,GAA8C,KAA9C,CAJuB;AAKtC,OAAI,aAAa,KAAK,QAAL,GAAgB,KAAK,WAAL,CAAiB,KAAK,QAAL,CAAjC,GAAkD,KAAlD,CALqB;;AAStC,KAAE,IAAF,CAAO,CAAC,IAAD,EAAO,OAAP,EAAgB,OAAhB,EAAyB,eAAzB,CAAP,EAAkD,UAAS,CAAT,EAAY,QAAZ,EAAsB;AACvE,SAAK,IAAL,CAAU,QAAV,EAAoB,QAAQ,IAAR,CAAa,QAAb,CAApB,EADuE;IAAtB,CAAlD,CATsC;;AAetC,iBAAc,YAAY,OAAZ,CAAoB,eAApB,EAAqC,EAArC,CAAd,CAfsC;;AAkBtC,OAAI,eAAe,KAAK,QAAL,CAAc,IAAd,EAAoB,MAApB,EAAf,CAlBkC;AAmBtC,QAAK,QAAL,CAAc,WAAd,EAA2B,IAA3B,CAAgC,QAAQ,IAAR,EAAhC,EAAgD,MAAhD,CAAuD,YAAvD,EAnBsC;;AAqBtC,OAAI,YAAY,SAAS,MAAT,EAAiB;AAChC,SAAK,MAAL,CAAY,WAAZ,EAAyB,IAAzB,EAA+B,QAA/B,EAAyC,QAAzC,EADgC;IAAjC,MAGK,IAAI,YAAY,SAAS,MAAT,EAAiB;AACrC,SAAK,MAAL,CAAY,WAAZ,EAAyB,IAAzB,EAA+B,QAA/B,EAAyC,OAAzC,EADqC;IAAjC,MAGA;AACJ,SAAK,MAAL,CAAY,WAAZ,EAAyB,IAAzB,EAA+B,WAAW,MAAX,GAAoB,UAApB,GAAiC,CAAC,CAAD,CAAhE,CADI;IAHA;GAxBM;;AAmCZ,sBAAoB,8BAAW;AAC9B,OAAI,IAAJ;OAAU,KAAK,EAAE,gCAAF,EAAoC,GAApC,EAAL,CADoB;AAE9B,OAAG,EAAH,EAAO;AACN,WAAO,KAAK,WAAL,CAAiB,EAAjB,CAAP,CADM;AAEN,QAAG,KAAK,MAAL,EAAa;AACf,UAAK,MAAL,CAAY,cAAZ,EADe;AAEf,UAAK,MAAL,CAAY,aAAZ,EAA2B,IAA3B,EAFe;KAAhB,MAGO;AAGN,UAAK,qBAAL,CAA2B,CAAC,EAAD,CAA3B,EAHM;KAHP;IAFD,MAUO;AAGN,SAAK,MAAL,CAAY,cAAZ,EAHM;IAVP;GAFmB;;AA8BpB,yBAAuB,+BAAS,GAAT,EAAc;AACpC,OAAG,KAAK,iBAAL,MAA4B,CAAC,KAAK,WAAL,EAAD,EAAqB,OAApD;;AAEA,OAAI,OAAO,IAAP;OAAa,CAAjB;OAAoB,kBAAkB,KAAlB,CAHgB;AAIpC,QAAK,iBAAL,CAAuB,IAAvB,EAJoC;AAKpC,QAAK,MAAL,CAAY,eAAZ,EALoC;;AAOpC,OAAI,iBAAiB,SAAjB,cAAiB,CAAS,IAAT,EAAe;AAGnC,SAAK,WAAL,CAAiB,KAAK,IAAL,CAAU,IAAV,CAAjB,EAAkC,GAAlC,CAAsC,IAAtC,EAA4C,MAA5C,GAHmC;;AAMnC,SAAK,MAAL,CAAY,cAAZ,EANmC;AAOnC,SAAK,MAAL,CAAY,aAAZ,EAA2B,IAA3B,EAPmC;IAAf,CAPe;;AAkBpC,QAAK,MAAL,CAAY,WAAZ,EAAyB,KAAK,WAAL,CAAiB,CAAjB,CAAzB,EAlBoC;AAmBpC,QAAK,MAAL,CAAY,aAAZ,EAnBoC;AAoBpC,QAAK,MAAL,CAAY,eAAZ,EApBoC;;AAsBpC,KAAE,IAAF,CAAO;AACN,SAAK,EAAE,IAAF,CAAO,eAAP,CAAuB,KAAK,IAAL,CAAU,oBAAV,CAAvB,EAAwD,SAAS,IAAI,IAAJ,CAAS,GAAT,CAAT,CAA7D;AACA,cAAU,MAAV;AACA,aAAS,iBAAS,IAAT,EAAe,GAAf,EAAoB;AAC5B,OAAE,IAAF,CAAO,IAAP,EAAa,UAAS,MAAT,EAAiB,QAAjB,EAA2B;AACvC,UAAI,OAAO,KAAK,WAAL,CAAiB,MAAjB,CAAP,CADmC;;AAIvC,UAAG,CAAC,QAAD,EAAW;AACb,YAAK,MAAL,CAAY,aAAZ,EAA2B,IAA3B,EADa;AAEb,cAFa;OAAd;;AAMA,UAAG,KAAK,MAAL,EAAa;AACf,YAAK,UAAL,CAAgB,IAAhB,EAAsB,SAAS,IAAT,EAAe,QAArC,EADe;AAEf,kBAAW,YAAW;AACrB,uBAAe,IAAf,EADqB;QAAX,EAER,GAFH,EAFe;OAAhB,MAKO;AACN,yBAAkB,IAAlB,CADM;;AAMN,WAAG,SAAS,QAAT,IAAqB,CAAC,KAAK,IAAL,CAAU,gBAAc,SAAS,QAAT,GAAkB,GAAhC,CAAV,CAA+C,MAA/C,EAAuD;AAC/E,aAAK,MAAL,CAAY,WAAZ,EAAyB,CAAC,CAAD,EAAI,YAAW;AACvC,mBAAU,KAAK,IAAL,CAAU,gBAAc,MAAd,GAAqB,GAArB,CAApB,CADuC;AAEvC,wBAAe,OAAf,EAFuC;SAAX,CAA7B,CAD+E;QAAhF,MAKO;AACN,aAAK,UAAL,CAAgB,SAAS,IAAT,EAAe,QAA/B,EAAyC,UAAS,OAAT,EAAkB;AAC1D,wBAAe,OAAf,EAD0D;SAAlB,CAAzC,CADM;QALP;OAXD;MAVY,CAAb,CAD4B;;AAmC5B,SAAG,CAAC,eAAD,EAAkB;AACpB,WAAK,MAAL,CAAY,cAAZ,EADoB;AAEpB,WAAK,MAAL,CAAY,UAAZ,EAFoB;AAGpB,WAAK,MAAL,CAAY,QAAZ,EAHoB;MAArB;KAnCQ;AAyCT,cAAU,oBAAW;AACpB,UAAK,iBAAL,CAAuB,KAAvB,EADoB;KAAX;IA5CX,EAtBoC;GAAd;;EAjWxB,EAF+B;;AA6a/B,GAAE,oBAAF,EAAwB,OAAxB,CAAgC;AAC/B,WAAS,mBAAW;AACnB,QAAK,MAAL,GADmB;AAEnB,QAAK,MAAL,CAAY,iBAAZ,EAFmB;GAAX;AAIT,aAAW,qBAAW;AACrB,QAAK,MAAL,GADqB;AAErB,QAAK,MAAL,CAAY,aAAZ,EAFqB;AAGrB,QAAK,MAAL,CAAY,iBAAZ,EAHqB;GAAX;;AAWX,kBAAgB,0BAAW;AAC1B,UAAO,EAAE,IAAF,EACL,MADK,CACE,aADF,EAEL,GAFK,CAED,WAFC,EAGL,GAHK,CAGD,YAAW;AACf,WAAO,EAAE,IAAF,EAAQ,IAAR,CAAa,IAAb,CAAP,CADe;IAAX,CAHC,CAML,GANK,EAAP,CAD0B;GAAX;EAhBjB,EA7a+B;;AAwc/B,GAAE,cAAF,EAAkB,OAAlB,CAA0B;AAQzB,cAAY,oBAAS,IAAT,EAAe;AAC1B,QAAK,WAAL,CAAiB,UAAjB,EAA6B,CAAE,IAAF,CAA7B,CAD0B;GAAf;;AASZ,gBAAc,wBAAW;AACxB,OAAI,UAAU,KAAK,IAAL,CAAU,OAAV,EAAmB,KAAnB,CAAyB,iBAAzB,CAAV,CADoB;AAExB,UAAO,UAAU,QAAQ,CAAR,CAAV,GAAuB,EAAvB,CAFiB;GAAX;;AAWd,SAAO,iBAAW;AACjB,UAAO,KAAK,IAAL,CAAU,IAAV,CAAP,CADiB;GAAX;EA5BR,EAxc+B;CAAX,CAArB;;;;;ACNA;;;;;;AAEA,iBAAE,OAAF,CAAU,IAAV,EAAgB,UAAS,CAAT,EAAW;AAI1B,GAAE,oBAAF,EAAwB,OAAxB,CAAgC;AAC/B,8BAA4B;AAC3B,sBAAmB,2BAAS,CAAT,EAAW;AAC7B,SAAK,IAAL,CAAU,cAAV,EAA0B,KAA1B,GAD6B;AAE7B,SAAK,MAAL,GAF6B;IAAX;GADpB;EADD,EAJ0B;CAAX,CAAhB;;;;;;;ACCA;;;;AACA;;;;;;AAEA,iBAAE,UAAF;;AAEA,OAAO,EAAP,GAAY,OAAO,EAAP,IAAa,EAAb;AACZ,OAAO,EAAP,CAAU,MAAV;;AAEA,IAAI,WAAJ,EAAiB,YAAjB;;AAQA,SAAS,UAAT,CAAoB,GAApB,EAAyB;AACxB,KAAI,SAAS,SAAS,aAAT,CAAuB,GAAvB,CAAT,CADoB;AAExB,QAAO,IAAP,GAAc,GAAd,CAFwB;;AAIxB,QAAO,OAAO,QAAP,CAJiB;CAAzB;;AAeA,OAAO,EAAP,CAAU,QAAV,GAAqB,UAAU,IAAV,EAAgB,IAAhB,EAAsB,SAAtB,EAAiC;AACrD,KAAI,OAAJ,EAAa,OAAb,EAAsB,IAAtB,CADqD;;AAGrD,KAAI,QAAQ,SAAR,KAAQ,GAAW;AACtB,YAAU,IAAV,CADsB;AAEtB,MAAI,CAAC,SAAD,EAAY,KAAK,KAAL,CAAW,OAAX,EAAoB,IAApB,EAAhB;EAFW,CAHyC;;AAQrD,QAAO,YAAW;AACjB,MAAI,UAAU,aAAa,CAAC,OAAD,CADV;;AAGjB,YAAU,IAAV,CAHiB;AAIjB,SAAO,SAAP,CAJiB;;AAMjB,eAAa,OAAb,EANiB;AAOjB,YAAU,WAAW,KAAX,EAAkB,IAAlB,CAAV,CAPiB;;AASjB,MAAI,OAAJ,EAAa;AACZ,QAAK,KAAL,CAAW,OAAX,EAAoB,IAApB,EADY;GAAb;EATM,CAR8C;CAAjC;;AAuBrB,sBAAE,MAAF,EAAU,IAAV,CAAe,oBAAf,EAAqC,UAAS,CAAT,EAAY;AAEhD,KAAI,KAAK,SAAL,EAAK,GAAW;AAAC,wBAAE,gBAAF,EAAoB,OAApB,CAA4B,cAA5B,EAAD;EAAX,CAFuC;;AAKhD,KAAG,iBAAE,OAAF,CAAU,IAAV,IAAkB,SAAS,iBAAE,OAAF,CAAU,OAAV,EAAmB,EAA5B,IAAkC,CAAlC,EAAqC;AACzD,MAAI,iBAAiB,sBAAE,MAAF,EAAU,KAAV,EAAjB;MAAoC,kBAAkB,sBAAE,MAAF,EAAU,MAAV,EAAlB,CADiB;AAEzD,MAAG,kBAAkB,WAAlB,IAAiC,mBAAmB,YAAnB,EAAiC;AACpE,iBAAc,cAAd,CADoE;AAEpE,kBAAe,eAAf,CAFoE;AAGpE,QAHoE;GAArE;EAFD,MAOO;AACN,OADM;EAPP;CALoC,CAArC;;AAkBA,iBAAE,OAAF,CAAU,YAAV,GAAyB,iBAAE,OAAF,CAAU,uBAAV;;AAEzB,iBAAE,OAAF,CAAU,IAAV,EAAgB,UAAS,CAAT,EAAY;AAK3B,UAAS,eAAT,CAAyB,GAAzB,EAA8B,IAA9B,EAAoC;AAGnC,MAAI,SAAS,UAAT,KAAwB,UAAxB,IAAsC,OAAO,IAAI,KAAJ,CAAU,cAAV,KAA6B,WAApC,EAAiD;AAC1F,UAAO,MAAP,CAD0F;GAA3F;;AAOA,IAAE,gBAAF,EACE,iBADF,CACoB,IADpB,EAC0B,IAAI,KAAJ,CAD1B,CAEE,IAFF,CAEO,YAAM;AACX,UADW;GAAN,CAFP,CAVmC;EAApC;;AAiBA,KAAI,WAAW,WAAW,EAAE,MAAF,EAAU,CAAV,EAAa,IAAb,CAAtB,CAtBuB;;AAyB3B,KAAI,SAAS,SAAS,MAAT,GAAkB,CAAlB,CAAT,KAAkC,GAAlC,EAAuC;AAC1C,cAAY,OAAZ,CAD0C;EAA3C,MAEO;AACN,aAAW,QAAX,CADM;EAFP;;AAMA,kBAAO,IAAP,CAAY,QAAZ,EA/B2B;;AAiC3B,uBAAO,GAAP,EAAY,UAAC,GAAD,EAAM,IAAN,EAAe;AAE1B,MAAM,cAAc,IAAI,iBAAO,KAAP,CAAa,WAAjB,CAAd,CAFoB;;AAI1B,MAAI,YAAY,KAAZ,CAAkB,iBAAO,OAAP,EAAgB,EAAlC,KAAyC,OAAO,IAAI,KAAJ,CAAU,cAAV,KAA6B,WAApC,EAAiD;AAC7F,UAAO,QAAP,CAAgB,IAAhB,GAAuB,IAAI,QAAJ,CADsE;AAE7F,UAF6F;GAA9F;;AAKA,SAT0B;EAAf,CAAZ,CAjC2B;;AA+C3B,uBAAO,UAAP,EAAmB,eAAnB,EA/C2B;AAgD3B,uBAAO,YAAP,EAAqB,eAArB,EAhD2B;AAiD3B,uBAAO,aAAP,EAAsB,eAAtB,EAjD2B;AAkD3B,uBAAO,aAAP,EAAsB,eAAtB,EAlD2B;;AAoD3B,kBAAO,KAAP,GApD2B;;AA+D3B,GAAE,MAAF,EAAU,EAAV,CAAa,SAAb,EAAwB,UAAS,CAAT,EAAY;AACnC,MAAI,MAAJ;MACC,QAAQ,EAAE,aAAF;MACR,OAAO,QAAO,MAAM,IAAN,CAAP,KAAsB,QAAtB,GAAiC,MAAM,IAAN,GAAa,KAAK,KAAL,CAAW,MAAM,IAAN,CAAzD,CAH2B;;AAMnC,MAAG,EAAE,IAAF,CAAO,QAAP,CAAgB,OAAO,QAAP,CAAgB,IAAhB,CAAhB,CAAsC,MAAtC,KAAiD,EAAE,IAAF,CAAO,QAAP,CAAgB,MAAM,MAAN,CAAhB,CAA8B,MAA9B,EAAsC,OAA1F;;AAGA,WAAS,OAAO,KAAK,MAAL,KAAiB,WAAxB,GACN,EAAE,MAAF,CADM,GAEN,EAAE,KAAK,MAAL,CAFI,CAT0B;;AAcnC,UAAO,KAAK,IAAL;AACN,QAAK,OAAL;AACC,WAAO,OAAP,CAAe,KAAK,KAAL,EAAY,KAAK,IAAL,CAA3B,CADD;AAEC,UAFD;AADD,QAIM,UAAL;AACC,WAAO,KAAK,QAAL,CAAP,CAAsB,IAAtB,CAA2B,MAA3B,EAAmC,KAAK,IAAL,CAAnC,CADD;AAEC,UAFD;AAJD,GAdmC;EAAZ,CAAxB,CA/D2B;;AA0F3B,KAAI,yBAAyB,SAAzB,sBAAyB,GAAW;AACvC,MAAI,SAAS,GAAT,CADmC;AAEvC,MAAI,UAAU,EAAE,uCAAF,CAAV,CAFmC;AAGvC,MAAI,MAAM,CAAC,EAAE,MAAF,EAAU,MAAV,KAAqB,QAAQ,MAAR,EAArB,CAAD,GAA0C,CAA1C,CAH6B;AAIvC,UAAQ,GAAR,CAAY,KAAZ,EAAmB,MAAM,MAAN,CAAnB,CAJuC;AAKvC,UAAQ,IAAR,GALuC;EAAX,CA1FF;;AAoG3B,KAAI,cAAc,SAAd,WAAc,CAAS,EAAT,EAAa;AAC9B,MAAG,GAAG,EAAH,CAAM,UAAN,CAAH,EAAsB;AACrB,MAAG,QAAH,CAAY,UAAZ,EAAwB,MAAxB,CAA+B;AAC9B,2BAAuB,IAAvB;AACA,8BAA0B,EAA1B;IAFD,EADqB;;AAMrB,OAAI,QAAQ,GAAG,IAAH,CAAQ,OAAR,CAAR,CANiB;;AAQrB,OAAG,KAAH,EAAU;AACT,OAAG,QAAH,CAAY,iBAAZ,EAA+B,IAA/B,CAAoC,OAApC,EAA6C,KAA7C,EADS;IAAV;GARD,MAWO;AACN,cAAW,YAAW;AAErB,OAAG,IAAH,GAFqB;AAGrB,gBAAY,EAAZ,EAHqB;IAAX,EAIX,GAJA,EADM;GAXP;EADiB,CApGS;;AA8H3B,KAAI,YAAY,SAAZ,SAAY,CAAS,IAAT,EAAe,IAAf,EAAqB;AACpC,MAAI,UAAU,EAAE,MAAF,EAAU,IAAV,CAAe,MAAf,CAAV,CADgC;AAEpC,SAAO,EAAE,IAAF,CAAO,aAAP,CAAqB,IAArB,IAA6B,IAA7B,GAAoC,EAAE,IAAF,CAAO,eAAP,CAAuB,IAAvB,EAA6B,OAA7B,CAApC,EACP,OAAO,EAAE,IAAF,CAAO,aAAP,CAAqB,IAArB,IAA6B,IAA7B,GAAoC,EAAE,IAAF,CAAO,eAAP,CAAuB,IAAvB,EAA6B,OAA7B,CAApC,CAH6B;AAIpC,MAAI,YAAY,EAAE,IAAF,CAAO,QAAP,CAAgB,IAAhB,CAAZ;MAAmC,YAAY,EAAE,IAAF,CAAO,QAAP,CAAgB,IAAhB,CAAZ,CAJH;AAKpC,SACC,UAAU,QAAV,CAAmB,OAAnB,CAA2B,MAA3B,EAAmC,EAAnC,KAA0C,UAAU,QAAV,CAAmB,OAAnB,CAA2B,MAA3B,EAAmC,EAAnC,CAA1C,IACA,UAAU,MAAV,IAAoB,UAAU,MAAV,CAPe;EAArB,CA9HW;;AAyI3B,KAAI,oBAAoB,OAAO,EAAP,CAAU,QAAV,CAAmB,YAAY;AACtD,IAAE,MAAF,EAAU,OAAV,CAAkB,cAAlB,EADsD;EAAZ,EAExC,IAFqB,EAEf,IAFe,CAApB,CAzIuB;;AA6I3B,GAAE,MAAF,EAAU,IAAV,CAAe,QAAf,EAAyB,sBAAzB,EAAiD,OAAjD,CAAyD,QAAzD,EA7I2B;;AAgJ3B,GAAE,QAAF,EAAY,YAAZ,CAAyB,UAAS,CAAT,EAAY,GAAZ,EAAiB,QAAjB,EAA2B;AAEnD,MAAI,MAAM,IAAI,iBAAJ,CAAsB,iBAAtB,CAAN;MACH,UAAU,OAAO,OAAP,CAAe,KAAf,CAAqB,IAArB,CAA0B,OAA1B,CAAkC,KAAlC,EAAyC,EAAzC,CAAV;MACA,UAAU,SAAS,GAAT;MACV,MAAM,IAAI,iBAAJ,CAAsB,UAAtB,MAAsC,IAAtC,GAA6C,IAAI,iBAAJ,CAAsB,UAAtB,CAA7C,GAAiF,IAAI,UAAJ;MACvF,UAAU,GAAC,CAAI,MAAJ,GAAa,GAAb,IAAoB,IAAI,MAAJ,GAAa,GAAb,GAAoB,KAAzC,GAAiD,MAAjD;MACV,kBAAkB,CAAC,IAAD,CAAlB,CAPkD;;AAUnD,MAAI,QAAQ,IAAR,KAAiB,CAAC,UAAU,OAAV,EAAmB,GAAnB,CAAD,IAA4B,CAAC,UAAU,OAAV,EAAmB,GAAnB,CAAD,CAA7C,EAAwE;AAC3E,oBAAO,IAAP,CAAY,GAAZ,EAAiB;AAChB,QAAI,IAAK,IAAJ,EAAD,CAAa,OAAb,KAAyB,OAAO,KAAK,MAAL,EAAP,EAAsB,OAAtB,CAA8B,KAA9B,EAAoC,EAApC,CAAzB;AACJ,UAAM,IAAI,iBAAJ,CAAsB,QAAtB,IAAkC,IAAI,iBAAJ,CAAsB,QAAtB,CAAlC,GAAoE,SAAS,OAAT,CAAiB,QAAjB,CAApE;IAFP,EAD2E;GAA5E;;AAQA,MAAI,IAAI,iBAAJ,CAAsB,kBAAtB,CAAJ,EAA+C;AAC9C,KAAE,gBAAF,EAAoB,eAApB,GAD8C;AAE9C,UAF8C;GAA/C;;AAMA,MAAI,IAAI,MAAJ,KAAe,CAAf,IAAoB,GAApB,IAA2B,EAAE,OAAF,CAAU,GAAV,EAAe,eAAf,CAA3B,EAA4D;AAE/D,iBAAc,mBAAmB,GAAnB,CAAd,EAAuC,OAAvC,EAF+D;GAAhE;;AAKA,oBAAkB,IAAlB,EA7BmD;EAA3B,CAAzB,CAhJ2B;;AAwL3B,GAAE,gBAAF,EAAoB,OAApB,CAA4B;AAK3B,kBAAgB,IAAhB;;AAKA,eAAa,EAAb;;AAEA,oBAAkB,CAAlB;;AAOA,iBAAe;AACd,oBAAiB,GAAjB;AACA,oBAAiB,GAAjB;AACA,SAAM,SAAN;GAHD;;AASA,SAAO,iBAAW;AACjB,OAAI,OAAO,IAAP,CADa;;AAIjB,OAAG,EAAE,OAAF,CAAU,IAAV,IAAkB,SAAS,EAAE,OAAF,CAAU,OAAV,EAAmB,EAA5B,IAAkC,CAAlC,EAAqC;AACzD,MAAE,oBAAF,EAAwB,MAAxB,CACC,iEACA,2HADA,GAEA,aAFA,CADD,CAIE,GAJF,CAIM,SAJN,EAIiB,EAAE,oBAAF,EAAwB,GAAxB,CAA4B,SAA5B,IAAuC,CAAvC,CAJjB,CADyD;AAMzD,MAAE,oBAAF,EAAwB,MAAxB,GANyD;;AAQzD,SAAK,MAAL,GARyD;AASzD,WATyD;IAA1D;;AAaA,QAAK,MAAL,GAjBiB;;AAoBjB,KAAE,oBAAF,EAAwB,IAAxB,GApBiB;AAqBjB,KAAE,MAAF,EAAU,WAAV,CAAsB,SAAtB,EArBiB;AAsBjB,KAAE,MAAF,EAAU,MAAV,CAAiB,QAAjB,EAA2B,sBAA3B,EAtBiB;AAuBjB,QAAK,eAAL,GAvBiB;AAwBjB,QAAK,MAAL,GAxBiB;GAAX;;AA2BP,cAAY;AACX,kBAAe,uBAAS,KAAT,EAAgB,YAAhB,EAA6B;AAC3C,SAAK,iBAAL,CAAuB,KAAvB,EAA8B,YAA9B,EAD2C;IAA7B;GADhB;;AAMA,oBAAkB,0BAAW;AAC5B,QAAK,MAAL,GAD4B;GAAX;;AAIlB,qBAAmB;AAClB,aAAU,oBAAU;AAAE,SAAK,MAAL,GAAF;IAAV;GADX;;AAIA,yBAAuB;AACtB,sBAAmB,6BAAU;AAAE,SAAK,MAAL,GAAF;IAAV;GADpB;;AAOA,8BAA4B;AAC3B,YAAS,iBAAS,CAAT,EAAY;AACpB,QAAI,OAAO,EAAE,EAAE,MAAF,CAAF,CAAY,IAAZ,CAAiB,MAAjB,CAAP,CADgB;AAEpB,QAAG,EAAE,KAAF,GAAU,CAAV,IAAe,QAAQ,KAAK,YAAL,EAAR,EAA6B,OAA/C;AACA,SAAK,aAAL,GAHoB;IAAZ;GADV;;AAYA,uBAAqB,6BAAS,OAAT,EAAkB;AACtC,OAAI,OAAO,KAAK,gBAAL,EAAP,CADkC;;AAGtC,OAAI,QAAQ,KAAR,CAHkC;;AAKtC,QAAK,IAAI,CAAJ,IAAS,OAAd,EAAuB;AACtB,QAAI,KAAK,CAAL,MAAY,QAAQ,CAAR,CAAZ,EAAwB;AAC3B,UAAK,CAAL,IAAU,QAAQ,CAAR,CAAV,CAD2B;AAE3B,aAAQ,IAAR,CAF2B;KAA5B;IADD;;AAOA,OAAI,KAAJ,EAAW,KAAK,MAAL,GAAX;GAZoB;;AAkBrB,iBAAe,yBAAW;AACzB,QAAK,mBAAL,CAAyB;AACxB,UAAM,OAAN;IADD,EADyB;GAAX;;AASf,mBAAiB,2BAAW;AAC3B,QAAK,mBAAL,CAAyB;AACxB,UAAM,SAAN;IADD,EAD2B;GAAX;;AASjB,eAAa,uBAAW;AACvB,QAAK,mBAAL,CAAyB;AACxB,UAAM,SAAN;IADD,EADuB;GAAX;;AAMb,qBAAmB,KAAnB;;AAEA,UAAQ,kBAAW;AAClB,OAAI,KAAK,oBAAL,EAAJ,EAAiC,OAAjC;;AAEA,OAAG,OAAO,KAAP,EAAc,QAAQ,GAAR,CAAY,QAAZ,EAAsB,KAAK,IAAL,CAAU,OAAV,CAAtB,EAA0C,KAAK,GAAL,CAAS,CAAT,CAA1C,EAAjB;;AAGA,QAAK,IAAL,CAAU,SAAV,EAAqB,QAAQ,qBAAR,CACpB;AACC,UAAM,KAAK,QAAL,CAAc,WAAd,CAAN;AACA,aAAS,KAAK,QAAL,CAAc,cAAd,CAAT;AACA,aAAS,KAAK,QAAL,CAAc,cAAd,CAAT;IAJmB,EAMpB,KAAK,gBAAL,EANoB,CAArB,EANkB;;AAiBlB,QAAK,MAAL,GAjBkB;;AAoBlB,QAAK,IAAL,CAAU,mBAAV,EAA+B,MAA/B,GApBkB;AAqBlB,QAAK,IAAL,CAAU,uCAAV,EAAmD,MAAnD,GArBkB;AAsBlB,QAAK,IAAL,CAAU,kCAAV,EAA8C,MAA9C,GAtBkB;AAuBlB,QAAK,IAAL,CAAU,cAAV,EAA0B,MAA1B,GAvBkB;AAwBlB,QAAK,IAAL,CAAU,cAAV,EAA0B,MAA1B,GAxBkB;GAAX;;AAiCR,oBAAkB,0BAAS,SAAT,EAAoB;AAErC,OAAI,aAAa,KAAK,cAAL,CAAoB,aAAa,CAAC,SAAD,CAAb,CAAjC;OACH,aAAa,WACX,IADW,CACN,sBADM,EAEX,GAFW,CAEP,WAAW,MAAX,CAAkB,sBAAlB,CAFO,CAAb;OAGA,OAAO,IAAP,CANoC;;AAQrC,OAAG,CAAC,WAAW,MAAX,EAAmB;AACtB,WAAO,IAAP,CADsB;IAAvB;;AAIA,cAAW,IAAX,CAAgB,YAAW;AAE1B,QAAG,CAAC,EAAE,IAAF,EAAQ,qBAAR,EAAD,EAAkC;AACpC,YAAO,KAAP,CADoC;KAArC;IAFe,CAAhB,CAZqC;;AAmBrC,UAAO,IAAP,CAnBqC;GAApB;;AA4BlB,aAAW,mBAAU,GAAV,EAA6F;OAA9E,8DAAQ,kBAAsE;OAAlE,6DAAO,kBAA2D;OAAvD,2BAAuD;OAA1C,qEAAe,OAAO,OAAP,CAAe,KAAf,CAAqB,IAArB,gBAA2B;;AAEvG,OAAI,CAAC,KAAK,gBAAL,CAAsB,KAAK,IAAL,GAAY,KAAK,IAAL,CAAU,KAAV,CAAgB,GAAhB,CAAZ,GAAmC,CAAC,SAAD,CAAnC,CAAvB,EAAwE;AAC3E,WAD2E;IAA5E;;AAIA,QAAK,YAAL,GANuG;;AAQvG,QAAK,cAAL,GAAsB,YAAtB,CARuG;;AAUvG,OAAI,WAAJ,EAAiB;AAChB,SAAK,aAAL,GAAqB,KAAK,MAAL,EAArB,CADgB;IAAjB;;AAIA,oBAAO,IAAP,CAAY,GAAZ,EAAiB,IAAjB,EAduG;GAA7F;;AAoBX,sBAAoB,8BAAW;AAC9B,QAAK,SAAL,CAAe,OAAO,OAAP,CAAe,KAAf,CAAqB,IAArB,EAA2B,IAA1C,EAAgD,IAAhD,EAAsD,IAAtD,EAD8B;GAAX;;AAiBpB,cAAY,oBAAS,IAAT,EAAe,MAAf,EAAuB,QAAvB,EAAiC,WAAjC,EAA8C;AACzD,OAAI,OAAO,IAAP,CADqD;;AAIzD,OAAG,CAAC,MAAD,EAAS,SAAS,KAAK,IAAL,CAAU,oCAAV,CAAT,CAAZ;;AAEA,OAAG,CAAC,MAAD,EAAS,SAAS,KAAK,IAAL,CAAU,wBAAV,CAAT,CAAZ;;AAEA,QAAK,OAAL,CAAa,kBAAb,EARyD;AASzD,QAAK,OAAL,CAAa,YAAb,EAA2B,EAAC,MAAM,IAAN,EAAY,QAAQ,MAAR,EAAxC,EATyD;;AAYzD,KAAE,MAAF,EAAU,QAAV,CAAmB,SAAnB,EAZyD;;AAezD,OAAI,mBAAmB,KAAK,QAAL,EAAnB,CAfqD;AAgBzD,OAAG,OAAO,gBAAP,KAA0B,WAA1B,IAAyC,CAAC,gBAAD,EAAmB;AAE9D,kBAAc,oBAAd,EAAoC,KAApC,EAF8D;;AAI9D,MAAE,MAAF,EAAU,WAAV,CAAsB,SAAtB,EAJ8D;;AAM9D,WAAO,KAAP,CAN8D;IAA/D;;AAUA,OAAI,WAAW,KAAK,cAAL,EAAX,CA1BqD;;AA4BzD,YAAS,IAAT,CAAc,EAAC,MAAM,EAAE,MAAF,EAAU,IAAV,CAAe,MAAf,CAAN,EAA8B,OAAM,GAAN,EAA7C,EA5ByD;;AAiCzD,YAAS,IAAT,CAAc,EAAE,MAAM,SAAN,EAAiB,OAAO,OAAO,OAAP,CAAe,KAAf,CAAqB,IAArB,CAA0B,OAA1B,CAAkC,KAAlC,EAAyC,EAAzC,CAAP,EAAjC,EAjCyD;;AAoCzD,QAAK,YAAL,GApCyD;;AA0CzD,UAAO,IAAP,CAAY,OAAO,MAAP,CAAc;AACzB,aAAS,EAAC,UAAW,yBAAX,EAAV;AACA,SAAK,KAAK,IAAL,CAAU,QAAV,CAAL;AACA,UAAM,QAAN;AACA,UAAM,MAAN;AACA,cAAU,oBAAW;AACpB,OAAE,MAAF,EAAU,WAAV,CAAsB,SAAtB,EADoB;KAAX;AAGV,aAAS,iBAAS,IAAT,EAAe,MAAf,EAAuB,GAAvB,EAA4B;AACpC,UAAK,WAAL,CAAiB,SAAjB,EADoC;AAEpC,SAAG,QAAH,EAAa,SAAS,IAAT,EAAe,MAAf,EAAuB,GAAvB,EAAb;;AAEA,SAAI,gBAAgB,KAAK,kBAAL,CAAwB,IAAxB,EAA8B,MAA9B,EAAsC,GAAtC,CAAhB,CAJgC;AAKpC,SAAG,CAAC,aAAD,EAAgB,OAAnB;;AAEA,mBAAc,MAAd,CAAqB,MAArB,EAA6B,OAA7B,CAAqC,iBAArC,EAAwD,EAAC,QAAQ,MAAR,EAAgB,KAAK,GAAL,EAAU,UAAU,QAAV,EAAnF,EAPoC;KAA5B;IARE,EAiBT,WAjBS,CAAZ,EA1CyD;;AA6DzD,UAAO,KAAP,CA7DyD;GAA9C;;AAmEZ,aAAW,IAAX;;AAKA,cAAY,KAAZ;;AAwBA,qBAAmB,2BAAU,KAAV,EAAsD;OAArC,qEAAe,OAAO,OAAP,CAAe,KAAf,gBAAsB;;AACxE,OAAI,KAAK,aAAL,EAAJ,EAA0B;AACzB,WADyB;IAA1B;;AAKA,OAAI,KAAK,iBAAL,EAAJ,EAA8B;AAC7B,SAAK,iBAAL,GAAyB,KAAzB,GAD6B;IAA9B;;AAIA,OAAI,OAAO,IAAP;OACH,YAAY,aAAa,IAAb,IAAqB,SAArB;OACZ,UAAU,EAAV;OACA,eAAe,UAAU,KAAV,CAAgB,GAAhB,CAAf;OACA,aAAa,KAAK,cAAL,CAAoB,YAApB,CAAb,CAduE;;AAgBxE,QAAK,mBAAL,CAAyB,KAAK,mBAAL,KAA6B,CAA7B,CAAzB,CAhBwE;;AAkBxE,OAAI,CAAC,KAAK,gBAAL,EAAD,EAA0B;AAC7B,QAAI,YAAY,KAAK,YAAL,EAAZ,CADyB;;AAI7B,SAAK,aAAL,CAAmB,IAAnB,EAJ6B;;AAO7B,QAAI,cAAc,IAAd,EAAoB;AACvB,sBAAO,IAAP,CAAY,UAAU,GAAV,CAAZ,CADuB;KAAxB,MAEO;AACN,sBAAO,IAAP,GADM;KAFP;;AAMA,SAAK,aAAL,CAAmB,KAAnB,EAb6B;;AAgB7B,WAhB6B;IAA9B;;AAmBA,QAAK,YAAL,CAAkB,YAAlB,EArCwE;;AA0CxE,OAAI,WAAW,MAAX,GAAoB,aAAa,MAAb,EAAqB;AAC5C,gBAAY,SAAZ,EAAuB,eAAe,CAAC,SAAD,CAAf,CADqB;AAE5C,iBAAa,KAAK,cAAL,CAAoB,YAApB,CAAb,CAF4C;IAA7C;;AAKA,QAAK,OAAL,CAAa,mBAAb,EAAkC,EAAE,OAAO,YAAP,EAAqB,SAAS,UAAT,EAAzD,EA/CwE;;AAoDxE,WAAQ,QAAR,IAAoB,SAApB,CApDwE;;AAsDxE,OAAI,OAAO,aAAa,cAAb,KAAgC,WAAvC,EAAoD;AAEvD,QAAI,MAAM,aAAa,cAAb,CAF6C;;AAIvD,QAAI;AAEH,WAAM,UAAU,GAAV,CAAN,CAFG;KAAJ,CAGE,OAAM,CAAN,EAAS,EAAT,SAEQ;AAET,aAAQ,WAAR,IAAuB,UAAU,GAAV,CAAvB,CAFS;KALV;IAJD;;AAeA,cAAW,QAAX,CAAoB,SAApB,EArEwE;;AAuExE,OAAI,UAAU,EAAE,IAAF,CAAO;AACpB,aAAS,OAAT;AACA,SAAK,aAAa,IAAb;IAFQ,EAIb,IAJa,CAIR,UAAC,IAAD,EAAO,MAAP,EAAe,GAAf,EAAuB;AAC5B,QAAI,MAAM,KAAK,kBAAL,CAAwB,IAAxB,EAA8B,MAA9B,EAAsC,GAAtC,EAA2C,YAA3C,CAAN,CADwB;AAE5B,SAAK,OAAL,CAAa,kBAAb,EAAiC,EAAC,MAAM,IAAN,EAAY,QAAQ,MAAR,EAAgB,KAAK,GAAL,EAAU,SAAS,GAAT,EAAc,OAAO,YAAP,EAAtF,EAF4B;IAAvB,CAJQ,CAQb,MARa,CAQN,YAAM;AACb,SAAK,iBAAL,CAAuB,IAAvB,EADa;;AAGb,eAAW,WAAX,CAAuB,SAAvB,EAHa;IAAN,CARJ,CAvEoE;;AAqFxE,QAAK,iBAAL,CAAuB,OAAvB,EArFwE;;AAuFxE,UAAO,OAAP,CAvFwE;GAAtD;;AA8GnB,gBAAc,sBAAS,GAAT,EAAc,aAAd,EAA6B;;AAE1C,OAAI,OAAO,IAAP;OACH,GADD;OAEC,UAAU,EAAV;OACA,UAAU,EAAE,MAAF,EAAU,IAAV,CAAe,MAAf,CAAV;OACA,cAAc,KAAK,cAAL,EAAd,CANyC;;AAS1C,OACC,OAAO,YAAY,aAAZ,CAAP,KAAoC,WAApC,IACA,YAAY,aAAZ,MAA6B,IAA7B,EACC;AACD,gBAAY,aAAZ,EAA2B,KAA3B,GADC;AAED,gBAAY,aAAZ,IAA6B,IAA7B,CAFC;IAHF;;AAQA,SAAM,EAAE,IAAF,CAAO,aAAP,CAAqB,GAArB,IAA4B,GAA5B,GAAkC,EAAE,IAAF,CAAO,eAAP,CAAuB,GAAvB,EAA4B,OAA5B,CAAlC,CAjBoC;AAkB1C,WAAQ,QAAR,IAAoB,aAApB,CAlB0C;;AAoB1C,SAAM,EAAE,IAAF,CAAO;AACZ,aAAS,OAAT;AACA,SAAK,GAAL;AACA,aAAS,iBAAS,IAAT,EAAe,MAAf,EAAuB,GAAvB,EAA4B;AACpC,SAAI,WAAW,KAAK,kBAAL,CAAwB,IAAxB,EAA8B,MAA9B,EAAsC,GAAtC,EAA2C,IAA3C,CAAX,CADgC;;AAIpC,UAAK,OAAL,CAAa,mBAAb,EAAkC,EAAE,MAAM,IAAN,EAAY,QAAQ,MAAR,EAAgB,KAAK,GAAL,EAAU,UAAU,QAAV,EAA1E,EAJoC;KAA5B;AAMT,WAAO,eAAS,GAAT,EAAc,MAAd,EAAsB,MAAtB,EAA6B;AACnC,UAAK,OAAL,CAAa,mBAAb,EAAkC,EAAE,KAAK,GAAL,EAAU,QAAQ,MAAR,EAAgB,OAAO,MAAP,EAA9D,EADmC;KAA7B;AAGP,cAAU,oBAAW;AAEpB,SAAI,cAAc,KAAK,cAAL,EAAd,CAFgB;AAGpB,SACC,OAAO,YAAY,aAAZ,CAAP,KAAoC,WAApC,IACA,YAAY,aAAZ,MAA6B,IAA7B,EACC;AACD,kBAAY,aAAZ,IAA6B,IAA7B,CADC;MAHF;KAHS;IAZL,CAAN,CApB0C;;AA6C1C,eAAY,aAAZ,IAA6B,GAA7B,CA7C0C;;AA+C1C,UAAO,GAAP,CA/C0C;GAA7B;;AA6Dd,sBAAoB,4BAAS,IAAT,EAAe,MAAf,EAAuB,GAAvB,EAA4B,KAA5B,EAAmC;AACtD,OAAI,OAAO,IAAP;OAAa,GAAjB;OAAsB,YAAtB;OAAoC,aAApC;OAAmD,QAAnD;OAA6D,KAA7D,CADsD;;AAItD,OAAG,IAAI,iBAAJ,CAAsB,UAAtB,KAAqC,IAAI,iBAAJ,CAAsB,iBAAtB,CAArC,EAA+E;AACjF,QAAI,UAAU,EAAE,MAAF,EAAU,IAAV,CAAe,MAAf,CAAV;QACH,SAAS,IAAI,iBAAJ,CAAsB,iBAAtB,CAAT;QACA,MAAM,EAAE,IAAF,CAAO,aAAP,CAAqB,MAArB,IAA+B,MAA/B,GAAwC,EAAE,IAAF,CAAO,eAAP,CAAuB,MAAvB,EAA+B,OAA/B,CAAxC,CAH0E;;AAKjF,aAAS,QAAT,CAAkB,IAAlB,GAAyB,GAAzB,CALiF;AAMjF,WANiF;IAAlF;;AAWA,OAAG,CAAC,IAAD,EAAO,OAAV;;AAGA,OAAI,QAAQ,IAAI,iBAAJ,CAAsB,SAAtB,CAAR,CAlBkD;AAmBtD,OAAG,KAAH,EAAU,SAAS,KAAT,GAAiB,mBAAmB,MAAM,OAAN,CAAc,KAAd,EAAqB,GAArB,CAAnB,CAAjB,CAAV;;AAEA,OAAI,eAAe,EAAf;OAAmB,aAAvB,CArBsD;;AAuBtD,OAAG,IAAI,iBAAJ,CAAsB,cAAtB,EAAsC,KAAtC,CAA4C,wCAA5C,CAAH,EAA0F;AACzF,mBAAe,IAAf,CADyF;IAA1F,MAEO;AAGN,eAAW,SAAS,sBAAT,EAAX,CAHM;;AAKN,WAAO,KAAP,CAAc,CAAE,IAAF,CAAd,EAAwB,QAAxB,EAAkC,QAAlC,EAA4C,EAA5C,EALM;AAMN,YAAQ,EAAE,OAAO,KAAP,CAAc,EAAd,EAAkB,SAAS,UAAT,CAApB,CAAR,CANM;;AAUN,oBAAgB,SAAhB,CAVM;AAWN,QAAI,MAAM,EAAN,CAAS,MAAT,KAAoB,CAAC,MAAM,EAAN,CAAS,+BAAT,CAAD,EAA4C,gBAAgB,aAAhB,CAApE;;AAEA,iBAAa,aAAb,IAA8B,KAA9B,CAbM;IAFP;;AAkBA,QAAK,oBAAL,CAA0B,IAA1B,EAzCsD;AA0CtD,OAAI;AAEH,MAAE,IAAF,CAAO,YAAP,EAAqB,UAAS,WAAT,EAAsB,IAAtB,EAA4B;AAChD,SAAI,YAAY,EAAE,sBAAF,EAA0B,MAA1B,CAAiC,YAAW;AAC3D,aAAO,EAAE,OAAF,CAAU,WAAV,EAAuB,EAAE,IAAF,EAAQ,IAAR,CAAa,cAAb,EAA6B,KAA7B,CAAmC,GAAnC,CAAvB,KAAmE,CAAC,CAAD,CADf;MAAX,CAA7C;SAEA,eAAe,EAAE,IAAF,CAAf,CAH4C;;AAMhD,SAAG,aAAH,EAAkB,cAAc,GAAd,CAAkB,YAAlB,EAAlB,KACK,gBAAgB,YAAhB,CADL;;AAIA,SAAG,aAAa,IAAb,CAAkB,gBAAlB,EAAoC,MAApC,EAA4C;AAC9C,YAAM,uHAAN,CAD8C;MAA/C;;AAKA,SAAI,YAAY,UAAU,IAAV,CAAe,OAAf,CAAZ,CAf4C;AAgBhD,SAAI,aAAa,UAAU,MAAV,EAAb,CAhB4C;AAiBhD,SAAI,0BAA2B,OAAO,WAAW,IAAX,CAAgB,SAAhB,CAAP,KAAoC,WAApC,CAjBiB;AAkBhD,SAAI,gBAAgB,CAAC,MAAD,EAAS,MAAT,EAAiB,QAAjB,EAA2B,OAA3B,EAAoC,OAApC,EAA6C,eAA7C,CAAhB,CAlB4C;AAmBhD,SAAI,cAAc,UAAU,IAAV,CAAe,OAAf,CAAd,CAnB4C;AAoBhD,SAAI,oBAAoB,EAApB,CApB4C;AAqBhD,SAAG,WAAH,EAAgB;AACf,0BAAoB,EAAE,IAAF,CACnB,YAAY,KAAZ,CAAkB,GAAlB,CADmB,EAEnB,UAAS,GAAT,EAAc;AAAE,cAAQ,EAAE,OAAF,CAAU,GAAV,EAAe,aAAf,KAAiC,CAAjC,CAAV;OAAd,CAFD,CADe;MAAhB;;AAOA,kBACE,WADF,CACc,cAAc,IAAd,CAAmB,GAAnB,CADd,EAEE,QAFF,CAEW,kBAAkB,IAAlB,CAAuB,GAAvB,CAFX,EA5BgD;AA+BhD,SAAG,SAAH,EAAc,aAAa,IAAb,CAAkB,OAAlB,EAA2B,SAA3B,EAAd;;AAIA,SAAI,SAAS,aAAa,IAAb,CAAkB,OAAlB,EAA2B,MAA3B,EAAT,CAnC4C;AAoChD,SAAG,OAAO,MAAP,EAAe,EAAE,QAAF,EAAY,IAAZ,CAAiB,MAAjB,EAAyB,MAAzB,CAAgC,MAAhC,EAAlB;;AAGA,eAAU,WAAV,CAAsB,YAAtB,EAvCgD;;AA4ChD,SAAI,CAAC,WAAW,EAAX,CAAc,gBAAd,CAAD,IAAoC,uBAApC,EAA6D;AAChE,iBAAW,MAAX,GADgE;MAAjE;KA5CoB,CAArB,CAFG;;AAoDH,QAAI,UAAU,cAAc,MAAd,CAAqB,MAArB,CAAV,CApDD;AAqDH,QAAG,QAAQ,QAAR,CAAiB,YAAjB,CAAH,EAAmC,QAAQ,WAAR,CAAoB,YAApB,EAAkC,QAAlC,CAA2C,YAA3C,EAAnC;IArDD,SAuDQ;AACP,SAAK,oBAAL,CAA0B,KAA1B,EADO;IAvDR;;AA2DA,QAAK,MAAL,GArGsD;AAsGtD,QAAK,eAAL,CAAqB,KAAC,IAAS,OAAO,MAAM,QAAN,KAAmB,WAA1B,GAAyC,MAAM,QAAN,GAAiB,IAApE,CAArB,CAtGsD;;AAwGtD,UAAO,aAAP,CAxGsD;GAAnC;;AAkHpB,kBAAgB,wBAAS,SAAT,EAAoB;AACnC,UAAO,EAAE,sBAAF,EAA0B,MAA1B,CAAiC,YAAW;AAElD,QAAI,CAAJ;QAAO,gBAAgB,EAAE,IAAF,EAAQ,IAAR,CAAa,cAAb,EAA6B,KAA7B,CAAmC,GAAnC,CAAhB,CAF2C;AAGlD,SAAI,CAAJ,IAAS,SAAT,EAAoB;AACnB,SAAG,EAAE,OAAF,CAAU,UAAU,CAAV,CAAV,EAAwB,aAAxB,KAA0C,CAAC,CAAD,EAAI,OAAO,IAAP,CAAjD;KADD;AAGA,WAAO,KAAP,CANkD;IAAX,CAAxC,CADmC;GAApB;;AAkBhB,WAAS,mBAAW;AACnB,KAAE,MAAF,EAAU,OAAV,CAAkB,aAAlB,EADmB;;AAGnB,KAAE,IAAF,EAAQ,MAAR,GAHmB;GAAX;;AAUT,gBAAc,wBAAW;AACxB,OAAG,OAAO,OAAO,cAAP,IAAwB,WAA/B,IAA8C,OAAO,cAAP,KAA0B,IAA1B,EAAgC,OAAjF;;AAEA,OAAI,eAAe,EAAf;OAAmB,MAAM,KAAK,YAAL,EAAN,CAHC;AAIxB,QAAK,IAAL,CAAU,wBAAV,EAAoC,IAApC,CAAyC,UAAS,CAAT,EAAY,EAAZ,EAAgB;AACxD,QAAI,KAAK,EAAE,EAAF,EAAM,IAAN,CAAW,IAAX,CAAL,CADoD;AAExD,QAAG,CAAC,EAAD,EAAK,OAAR;AACA,QAAG,CAAC,EAAE,EAAF,EAAM,IAAN,CAAW,MAAX,CAAD,EAAqB,OAAxB;AAGA,QAAG,EAAE,EAAF,EAAM,IAAN,CAAW,gBAAX,KAAgC,EAAE,EAAF,EAAM,iBAAN,EAAhC,EAA2D,OAA9D;;AAEA,iBAAa,IAAb,CAAkB,EAAC,IAAG,EAAH,EAAO,UAAS,EAAE,EAAF,EAAM,IAAN,CAAW,QAAX,EAAqB,UAArB,CAAT,EAA1B,EARwD;IAAhB,CAAzC,CAJwB;;AAexB,OAAG,YAAH,EAAiB;AAChB,QAAI,UAAU,UAAU,GAAV,CADE;AAEhB,QAAI;AACH,YAAO,cAAP,CAAsB,OAAtB,CAA8B,OAA9B,EAAuC,KAAK,SAAL,CAAe,YAAf,CAAvC,EADG;KAAJ,CAEE,OAAM,GAAN,EAAW;AACZ,SAAI,IAAI,IAAJ,KAAa,aAAa,kBAAb,IAAmC,OAAO,cAAP,CAAsB,MAAtB,KAAiC,CAAjC,EAAoC;AAIvF,aAJuF;MAAxF,MAKO;AACN,YAAM,GAAN,CADM;MALP;KADC;IAJH;GAfa;;AAwCd,mBAAiB,yBAAS,cAAT,EAAyB;AACzC,OAAI,OAAO,IAAP;OAAa,MAAM,KAAK,YAAL,EAAN;OAChB,oBAAqB,OAAO,OAAO,cAAP,KAAyB,WAAhC,IAA+C,OAAO,cAAP;OACpE,cAAc,oBAAoB,OAAO,cAAP,CAAsB,OAAtB,CAA8B,UAAU,GAAV,CAAlD,GAAmE,IAAnE;OACd,gBAAgB,cAAc,KAAK,KAAL,CAAW,WAAX,CAAd,GAAwC,KAAxC,CAJwB;;AAMzC,QAAK,IAAL,CAAU,yBAAV,EAAqC,IAArC,CAA0C,YAAW;AACpD,QAAI,KAAJ;QAAW,SAAS,EAAE,IAAF,CAAT;QAAkB,WAAW,OAAO,IAAP,CAAY,IAAZ,CAAX;QAA8B,GAA3D;QACC,YAAY,OAAO,IAAP,CAAY,uBAAZ,CAAZ,CAFmD;;AAIpD,QAAG,CAAC,OAAO,IAAP,CAAY,MAAZ,CAAD,EAAqB;AACvB,YADuB;KAAxB;;AAKA,WAAO,IAAP,CAAY,SAAZ,EAToD;;AAYpD,QAAG,UAAU,MAAV,EAAkB;AACpB,aAAQ,UAAU,KAAV,EAAR,CADoB;KAArB,MAEO,IAAG,kBAAkB,eAAe,QAAf,CAAlB,EAA4C;AACrD,WAAM,OAAO,IAAP,CAAY,eAAe,QAAf,EAAyB,WAAzB,CAAlB,CADqD;AAErD,SAAG,IAAI,MAAJ,EAAW;AACb,cAAQ,IAAI,KAAJ,EAAR,CADa;MAAd;KAFM,MAKA,IAAG,aAAH,EAAkB;AACxB,OAAE,IAAF,CAAO,aAAP,EAAsB,UAAS,CAAT,EAAY,YAAZ,EAA0B;AAC/C,UAAG,OAAO,EAAP,CAAU,MAAM,aAAa,EAAb,CAAnB,EAAoC;AACnC,eAAQ,aAAa,QAAb,CAD2B;OAApC;MADqB,CAAtB,CADwB;KAAlB;AAOP,QAAG,UAAU,IAAV,EAAe;AACjB,YAAO,IAAP,CAAY,QAAZ,EAAsB,QAAtB,EAAgC,KAAhC,EADiB;AAEjB,UAAK,OAAL,CAAa,kBAAb,EAFiB;KAAlB;IA1ByC,CAA1C,CANyC;GAAzB;;AA6CjB,iBAAe,uBAAS,GAAT,EAAc;AAC5B,OAAG,OAAO,OAAO,cAAP,IAAwB,WAA/B,EAA4C,OAA/C;;AAEA,OAAI,IAAI,OAAO,cAAP,CAHoB;AAI5B,OAAG,GAAH,EAAQ;AACP,MAAE,UAAF,CAAa,UAAU,GAAV,CAAb,CADO;IAAR,MAEO;AACN,SAAI,IAAI,IAAE,CAAF,EAAI,IAAE,EAAE,MAAF,EAAS,GAAvB,EAA4B;AAC3B,SAAG,EAAE,GAAF,CAAM,CAAN,EAAS,KAAT,CAAe,QAAf,CAAH,EAA6B,EAAE,UAAF,CAAa,EAAE,GAAF,CAAM,CAAN,CAAb,EAA7B;KADD;IAHD;GAJc;;AAgBf,wBAAsB,gCAAW;AAChC,QAAK,aAAL,CAAmB,KAAK,YAAL,EAAnB,EADgC;GAAX;;AAItB,gBAAc,wBAAW;AACxB,UAAO,OAAO,OAAP,CAAe,KAAf,CAAqB,IAArB,CACL,OADK,CACG,MADH,EACW,EADX,EAEL,OAFK,CAEG,KAFH,EAEU,EAFV,EAGL,OAHK,CAGG,EAAE,MAAF,EAAU,IAAV,CAAe,MAAf,CAHH,EAG2B,EAH3B,CAAP,CADwB;GAAX;;AAOd,mBAAiB,2BAAW;AAC3B,OAAI,SAAS,EAAE,MAAF,EAAU,IAAV,CAAe,eAAf,CAAT;OACH,SAAS,EAAE,0BAAF,CAAT;OACA,MAAM,mBAAN,CAH0B;;AAM3B,OAAG,OAAO,MAAP,EAAe,OAAO,MAAP,GAAlB;;AAGA,SAAM,EAAE,IAAF,CAAO,eAAP,CAAuB,GAAvB,EAA4B;AACjC,cAAU,MAAV;AACA,eAAW,OAAO,QAAP,CAAgB,IAAhB;IAFN,CAAN,CAT2B;;AAgB3B,YAAS,EAAE,6CAAF,CAAT,CAhB2B;AAiB3B,UAAO,IAAP,CAAY,IAAZ,EAAkB,IAAI,IAAJ,GAAW,OAAX,EAAlB,EAjB2B;AAkB3B,UAAO,IAAP,CAAY,KAAZ,EAAmB,GAAnB,EAlB2B;AAmB3B,KAAE,MAAF,EAAU,MAAV,CAAiB,MAAjB,EAnB2B;GAAX;EA/uBlB,EAxL2B;;AA+7B3B,GAAE,0BAAF,EAA8B,OAA9B,CAAsC;AACrC,WAAS,mBAAW;AACnB,QAAK,MAAL,GADmB;;AAInB,QAAK,QAAL,CAAc;AACb,eAAW,KAAK,IAAL,CAAU,KAAV,CAAX;AACA,iBAAa,gCAAb;AACA,cAAU,IAAV;AACA,cAAU,GAAV;AACA,cAAU,GAAV;AACA,eAAW,GAAX;AACA,eAAW,GAAX;AACA,mBAAe,KAAf;AACA,UAAM,gBAAW;AAChB,OAAE,oBAAF,EAAwB,QAAxB,CAAiC,iCAAjC,EADgB;KAAX;AAGN,WAAO,iBAAW;AACjB,OAAE,oBAAF,EAAwB,WAAxB,CAAoC,iCAApC,EADiB;KAAX;IAZR,EAJmB;GAAX;AAqBT,aAAW,qBAAW;AACrB,QAAK,MAAL,GADqB;GAAX;AAGX,QAAM,gBAAW;AAChB,QAAK,QAAL,CAAc,MAAd,EADgB;GAAX;AAGN,SAAO,iBAAW;AACjB,QAAK,QAAL,CAAc,OAAd,EADiB;GAAX;AAGP,UAAQ,gBAAS,IAAT,EAAe;AACtB,OAAG,KAAK,EAAL,CAAQ,UAAR,CAAH,EAAwB,KAAK,KAAL,GAAxB,KACK,KAAK,IAAL,GADL;GADO;;AAOR,kBAAgB,wBAAS,IAAT,EAAe;AAE9B,OAAG,OAAO,KAAK,UAAL,KAAqB,WAA5B,EAAyC;AAC3C,MAAE,yBAAF,EAA6B,GAA7B,CAAiC,KAAK,UAAL,CAAjC,CAD2C;IAA5C;;AAIA,OAAG,OAAO,KAAK,MAAL,KAAiB,WAAxB,EAAqC;AACvC,MAAE,MAAF,EAAU,IAAV,CAAe,eAAf,EAAgC,KAAK,MAAL,CAAhC,CADuC;IAAxC;AAGA,QAAK,KAAL,GAT8B;GAAf;EAtCjB,EA/7B2B;;AAu/B3B,GAAE,yFAAF,EAA6F,OAA7F,CAAqG;AACpG,WAAS,mBAAW;AACnB,QAAK,MAAL,CAAY,wHAAZ,EADmB;AAEnB,QAAK,MAAL,GAFmB;GAAX;AAIT,aAAW,qBAAW;AACrB,QAAK,IAAL,CAAU,2DAAV,EAAuE,MAAvE,GADqB;AAErB,QAAK,MAAL,GAFqB;GAAX;EALZ,EAv/B2B;;AAmgC3B,GAAE,sFAAF,EAA0F,OAA1F,CAAkG;AACjG,SAAO,iBAAW;AACjB,QAAK,QAAL,CAAc,cAAd,EADiB;AAEjB,OAAG,CAAC,KAAK,IAAL,CAAU,QAAV,CAAD,EAAsB,KAAK,MAAL,GAAzB;AACA,QAAK,MAAL,GAHiB;GAAX;AAKP,YAAU,oBAAW;AACpB,OAAG,KAAK,IAAL,CAAU,QAAV,CAAH,EAAwB,KAAK,MAAL,CAAY,SAAZ,EAAxB;AACA,QAAK,MAAL,GAFoB;GAAX;EANX,EAngC2B;;AAshC3B,GAAE,sBAAF,EAA0B,OAA1B,CAAkC;AACjC,WAAS,iBAAS,CAAT,EAAY;AACpB,OAAG,EAAE,IAAF,EAAQ,QAAR,CAAiB,eAAjB,CAAH,EAAsC;AACrC,MAAE,eAAF,GADqC;;AAGrC,WAHqC;IAAtC;;AAMA,OAAI,OAAO,KAAK,IAAL,CAAU,MAAV,CAAP;OACH,MAAM,IAAC,IAAQ,CAAC,KAAK,KAAL,CAAW,IAAX,CAAD,GAAqB,IAA9B,GAAqC,KAAK,IAAL,CAAU,MAAV,CAArC;OACN,OAAO,EAAC,MAAM,KAAK,IAAL,CAAU,YAAV,CAAN,EAAR,CATmB;;AAWpB,KAAE,gBAAF,EAAoB,SAApB,CAA8B,GAA9B,EAAmC,IAAnC,EAAyC,IAAzC,EAXoB;AAYpB,KAAE,cAAF,GAZoB;GAAZ;EADV,EAthC2B;;AA4iC3B,GAAE,yBAAF,EAA6B,OAA7B,CAAqC;AACpC,WAAS,iBAAS,CAAT,EAAY;AACpB,KAAE,IAAF,EAAQ,WAAR,CAAoB,qBAApB,EADoB;AAEpB,KAAE,IAAF,EAAQ,QAAR,CAAiB,2CAAjB,EAFoB;;AAIpB,OAAI,UAAU,EAAE,IAAF,EAAQ,IAAR,CAAa,qBAAb,CAAV,CAJgB;;AAMpB,OAAG,QAAQ,MAAR,GAAiB,CAAjB,EAAoB;AACtB,cAAU,EAAE,eAAF,EAAmB,QAAnB,CAA4B,mDAA5B,CAAV,CADsB;;AAGtB,MAAE,IAAF,EAAQ,OAAR,CAAgB,OAAhB,EAHsB;IAAvB;;AAMA,WAAQ,IAAR,GAZoB;;AAcpB,OAAI,OAAO,KAAK,IAAL,CAAU,MAAV,CAAP;OAA0B,MAAM,OAAO,IAAP,GAAc,KAAK,IAAL,CAAU,MAAV,CAAd,CAdhB;;AAgBpB,UAAO,IAAP,CAAY;AACX,SAAK,GAAL;;AAEA,cAAU,kBAAS,OAAT,EAAkB,MAAlB,EAA0B;AACnC,SAAI,MAAM,OAAC,CAAQ,iBAAR,CAA0B,UAA1B,CAAD,GAA0C,QAAQ,iBAAR,CAA0B,UAA1B,CAA1C,GAAkF,QAAQ,YAAR,CADzD;;AAGnC,SAAI;AACH,UAAI,OAAO,GAAP,IAAc,WAAd,IAA6B,QAAQ,IAAR,EAAc,KAAK,GAAL,EAA/C;MADD,CAGA,OAAM,CAAN,EAAS,EAAT;;AAEA,aAAQ,IAAR,GARmC;;AAUnC,OAAE,gBAAF,EAAoB,OAApB,GAVmC;;AAYnC,OAAE,IAAF,EAAQ,WAAR,CAAoB,2CAApB,EAZmC;AAanC,OAAE,IAAF,EAAQ,QAAR,CAAiB,qBAAjB,EAbmC;KAA1B;AAeV,cAAU,MAAV;IAlBD,EAhBoB;AAoCpB,KAAE,cAAF,GApCoB;GAAZ;EADV,EA5iC2B;;AAwlC3B,GAAE,yBAAF,EAA6B,OAA7B,CAAqC;AACpC,QAAM,IAAN;AACA,WAAS,mBAAW;AACnB,QAAK,MAAL,GADmB;AAEnB,QAAK,OAAL,CAAa,IAAI,IAAJ,GAAW,OAAX,EAAb,EAFmB;GAAX;AAIT,aAAW,qBAAW;AACrB,QAAK,MAAL,GADqB;GAAX;AAGX,WAAS,mBAAW;AACnB,QAAK,MAAL,GADmB;;AAGnB,OAAI,OAAO,IAAP;OAAa,KAAK,kBAAkB,KAAK,OAAL,EAAlB,CAHH;AAInB,OAAI,SAAS,EAAE,MAAM,EAAN,CAAX,CAJe;AAKnB,OAAG,CAAC,OAAO,MAAP,EAAe;AAClB,aAAS,EAAE,mCAAmC,EAAnC,GAAwC,MAAxC,CAAX,CADkB;AAElB,MAAE,MAAF,EAAU,MAAV,CAAiB,MAAjB,EAFkB;IAAnB;;AAKA,OAAI,aAAa,KAAK,IAAL,CAAU,YAAV,IAAwB,KAAK,IAAL,CAAU,YAAV,CAAxB,GAAgD,EAAhD,CAVE;;AAYnB,UAAO,QAAP,CAAgB,EAAC,WAAW,KAAK,IAAL,CAAU,MAAV,CAAX,EAA8B,UAAU,IAAV,EAAgB,kBAAkB,UAAlB,EAA/D,EAZmB;AAanB,UAAO,KAAP,CAbmB;GAAX;EATV,EAxlC2B;;AAqnC3B,GAAE,uBAAF,EAA2B,OAA3B,CAAmC;AAClC,WAAS,mBAAW;AACnB,QAAK,IAAL,CAAU,eAAV,EAA2B,KAA3B,CAAiC,YAAW;AAC1C,QAAI,OAAO,KAAK,IAAL,CAD+B;;AAI1C,QAAG,IAAH,EAAS;AACR,UAAK,aAAL,GAAqB,IAArB,CADQ;;AAIT,gBAAW,YAAW;AACrB,WAAK,aAAL,GAAqB,IAArB,CADqB;MAAX,EAER,EAFH,EAJS;KAAT;IAJ+B,CAAjC,CADmB;;AAenB,QAAK,MAAL,GAfmB;AAgBnB,QAAK,MAAL,GAhBmB;GAAX;AAkBT,aAAW,qBAAW;AACrB,QAAK,MAAL,GADqB;GAAX;AAGX,UAAQ,kBAAW;AAClB,OAAG,OAAO,KAAP,EAAc,QAAQ,GAAR,CAAY,QAAZ,EAAsB,KAAK,IAAL,CAAU,OAAV,CAAtB,EAA0C,KAAK,GAAL,CAAS,CAAT,CAA1C,EAAjB;;AAGA,QAAK,QAAL,GAAgB,MAAhB,CAAuB,YAAW;AACjC,WAAQ,KAAK,QAAL,IAAiB,CAAjB,IAAsB,CAAC,KAAK,IAAL,CAAU,KAAK,SAAL,CAAX,CADG;IAAX,CAAvB,CAEG,MAFH,GAJkB;;AASlB,QAAK,IAAL,CAAU,eAAV,EAA2B,IAA3B,CAAgC,YAAW;AAC1C,QAAG,CAAC,EAAE,IAAF,EAAQ,IAAR,CAAa,QAAb,CAAD,EAAyB,EAAE,IAAF,EAAQ,MAAR,GAA5B;IAD+B,CAAhC,CATkB;;AAclB,QAAK,IAAL,CAAU,kBAAV,EAA8B,SAA9B,GAdkB;GAAX;EAtBT,EArnC2B;;AAkqC3B,GAAE,6BAAF,EAAiC,OAAjC,CAAyC;AACxC,WAAS,mBAAW;AACnB,OAAI,SAAS,EAAE,IAAF,EAAQ,OAAR,CAAgB,mBAAhB,CAAT;OAA+C,SAAS,OAAO,IAAP,EAAT,CADhC;AAEnB,OAAG,CAAC,OAAO,YAAP,EAAqB;AACxB,SAAK,MAAL,GADwB;AAExB,WAFwB;IAAzB;;AAKA,UAAO,MAAP,GAAgB,QAAhB,CAPmB;AAQnB,OAAG,OAAO,MAAP,IAAiB,EAAE,UAAF,CAAa,QAAb,CAAsB,OAAO,MAAP,CAAvC,EAAuD;AACzD,aAAS,EAAE,MAAF,CAAS,MAAT,EAAiB,EAAE,UAAF,CAAa,QAAb,CAAsB,OAAO,MAAP,CAAvC,EAAuD,EAAvD,CAAT,CADyD;IAA1D;;AAIA,KAAE,IAAF,EAAQ,UAAR,CAAmB,MAAnB,EAZmB;;;AAgBnB,QAAK,MAAL,GAhBmB;GAAX;AAkBT,aAAW,qBAAW;AACrB,QAAK,MAAL,GADqB;GAAX;EAnBZ,EAlqC2B;;AAmsC3B,GAAE,+FAAF,EAAmG,OAAnG,CAA2G;AAC1G,WAAS,mBAAW;AACnB,OAAG,KAAK,EAAL,CAAQ,UAAR,CAAH,EAAwB;AACvB,SAAK,MAAL,GADuB;AAEvB,WAFuB;IAAxB;;AAMA,OAAG,CAAC,KAAK,IAAL,CAAU,aAAV,CAAD,EAA2B,KAAK,IAAL,CAAU,aAAV,EAAyB,GAAzB,EAA9B;;AAGA,QAAK,WAAL,CAAiB,oBAAjB,EAVmB;AAWnB,QAAK,QAAL,CAAc,iBAAd,EAAiC,MAAjC,GAXmB;;AAcnB,eAAY,IAAZ,EAdmB;;AAgBnB,QAAK,MAAL,GAhBmB;GAAX;AAkBT,aAAW,qBAAW;AACrB,QAAK,MAAL,GADqB;GAAX;EAnBZ,EAnsC2B;;AA2tC3B,GAAE,mBAAF,EAAuB,OAAvB,CAA+B;AAC9B,UAAQ,kBAAW;AAClB,OAAG,OAAO,KAAP,EAAc,QAAQ,GAAR,CAAY,QAAZ,EAAsB,KAAK,IAAL,CAAU,OAAV,CAAtB,EAA0C,KAAK,GAAL,CAAS,CAAT,CAA1C,EAAjB;GADO;EADT,EA3tC2B;;AAquC3B,GAAE,oBAAF,EAAwB,OAAxB,CAAgC;AAC/B,kBAAgB,wBAAS,GAAT,EAAc;AAG7B,OAAI,SAAS,OAAO,QAAP,CAAgB,MAAhB,CAAuB,OAAvB,CAA+B,KAA/B,EAAsC,EAAtC,CAAT,CAHyB;AAI7B,OAAG,MAAH,EAAW,MAAM,EAAE,IAAF,CAAO,eAAP,CAAuB,GAAvB,EAA4B,MAA5B,CAAN,CAAX;AACA,KAAE,gBAAF,EAAoB,SAApB,CAA8B,GAA9B,EAL6B;GAAd;EADjB,EAruC2B;;AAmvC3B,GAAE,kBAAF,EAAsB,OAAtB,CAA8B;AAC7B,YAAU,kBAAS,CAAT,EAAY;AAErB,OAAI,cAAJ,EACC,GADD,CAFqB;;AAKrB,oBAAiB,KAAK,IAAL,CAAU,qBAAV,EAAiC,MAAjC,CAAwC,YAAW;AAGnE,QAAI,OAAO,EAAE,IAAF,CAAO,EAAE,IAAF,EAAQ,UAAR,EAAP,EAA6B,UAAS,GAAT,EAAc;AAAE,YAAQ,GAAR,CAAF;KAAd,CAApC,CAH+D;AAInE,WAAQ,KAAK,MAAL,CAJ2D;IAAX,CAAzD,CALqB;;AAYrB,SAAM,KAAK,IAAL,CAAU,QAAV,CAAN,CAZqB;;AAcrB,OAAG,eAAe,MAAf,EAAuB;AACzB,UAAM,EAAE,IAAF,CAAO,eAAP,CAAuB,GAAvB,EAA4B,eAAe,SAAf,EAA5B,CAAN,CADyB;IAA1B;;AAIA,OAAI,YAAY,KAAK,OAAL,CAAa,gBAAb,CAAZ,CAlBiB;AAmBrB,aAAU,IAAV,CAAe,gBAAf,EAAiC,IAAjC,CAAsC,QAAtC,EAA+C,CAA/C,EAnBqB;AAoBrB,aAAU,SAAV,CAAoB,GAApB,EAAyB,EAAzB,EAA6B,EAA7B,EAAiC,IAAjC,EApBqB;;AAsBrB,UAAO,KAAP,CAtBqB;GAAZ;EADX,EAnvC2B;;AAixC3B,GAAE,yEAAF,EAA6E,OAA7E,CAAqF;AACpF,WAAS,iBAAS,CAAT,EAAY;AACpB,KAAE,cAAF,GADoB;;AAGpB,OAAI,OAAO,EAAE,IAAF,EAAQ,OAAR,CAAgB,MAAhB,CAAP,CAHgB;;AAKpB,QAAK,SAAL,GALoB;AAMpB,QAAK,IAAL,CAAU,kBAAV,EAA8B,IAA9B,CAAmC,eAAnC,EAAoD,CAApD,EAAuD,OAAvD,CAA+D,eAA/D,EANoB;AAOpB,QAAK,MAAL,GAPoB;GAAZ;EADV,EAjxC2B;;AAoyC3B,QAAO,mBAAP,GAA6B,EAA7B,CApyC2B;AAqyC3B,GAAE,qBAAF,EAAyB,OAAzB,CAAiC;AAChC,SAAO,iBAAW;AACjB,QAAK,MAAL,GADiB;AAEjB,QAAK,MAAL,GAFiB;GAAX;AAIP,YAAU,oBAAW;AACpB,OAAG,OAAO,KAAP,EAAc,QAAQ,GAAR,CAAY,QAAZ,EAAsB,KAAK,IAAL,CAAU,KAAV,CAAtB,EAAwC,IAAxC,EAAjB;;AAIA,OAAG,CAAC,KAAK,IAAL,CAAU,iBAAV,CAAD,EAA+B,OAAO,mBAAP,CAA2B,KAAK,IAAL,CAAU,KAAV,CAA3B,IAA+C,KAAK,IAAL,EAA/C,CAAlC;AACA,QAAK,MAAL,GANoB;GAAX;AAQV,UAAQ,kBAAW;AAClB,OAAG,OAAO,KAAP,EAAc,QAAQ,GAAR,CAAY,QAAZ,EAAsB,KAAK,IAAL,CAAU,OAAV,CAAtB,EAA0C,KAAK,GAAL,CAAS,CAAT,CAA1C,EAAjB;;AAEA,OAAI,OAAO,IAAP;OAAa,MAAM,KAAK,IAAL,CAAU,KAAV,CAAN,CAHC;AAIlB,OAAG,CAAC,GAAD,EAAM,MAAM,mEAAN,CAAT;;AAEA,QAAK,MAAL,GANkB;;AASlB,OAAG,CAAC,KAAK,QAAL,GAAgB,MAAhB,EAAwB;AAC3B,QAAG,CAAC,KAAK,IAAL,CAAU,iBAAV,CAAD,IAAiC,OAAO,OAAO,mBAAP,CAA2B,GAA3B,CAAP,KAA2C,WAA3C,EAAwD;AAC3F,UAAK,IAAL,CAAU,OAAO,mBAAP,CAA2B,GAA3B,CAAV,EAD2F;KAA5F,MAEO;AACN,UAAK,QAAL,CAAc,SAAd,EADM;AAEN,OAAE,IAAF,CAAO;AACN,WAAK,GAAL;AACA,gBAAU,oBAAW;AACpB,YAAK,WAAL,CAAiB,SAAjB,EADoB;OAAX;AAGV,eAAS,iBAAS,IAAT,EAAe,MAAf,EAAuB,GAAvB,EAA4B;AACpC,YAAK,IAAL,CAAU,IAAV,EADoC;OAA5B;MALV,EAFM;KAFP;IADD;GATO;EAbT,EAryC2B;;AAq1C3B,GAAE,aAAF,EAAiB,OAAjB,CAAyB;AACxB,SAAO,iBAAW;AAEjB,QAAK,UAAL,GAFiB;AAGjB,QAAK,MAAL,GAHiB;GAAX;AAKP,YAAU,oBAAW;AACpB,OAAI,KAAK,IAAL,CAAU,MAAV,CAAJ,EAAuB,KAAK,IAAL,CAAU,SAAV,EAAvB;AACA,QAAK,MAAL,GAFoB;GAAX;AAIV,cAAY,sBAAW;AACtB,QAAK,gBAAL,GADsB;;AAGtB,OAAI,KAAK,KAAK,IAAL,CAAU,IAAV,CAAL;OAAsB,YAAY,KAAK,IAAL,CAAU,0BAAV,CAAZ,CAHJ;;AAKtB,OAAG,CAAC,KAAK,IAAL,CAAU,QAAV,CAAD,EAAsB,KAAK,IAAL,CAAU;AAClC,YAAQ,SAAC,CAAU,KAAV,MAAqB,CAAC,CAAD,GAAM,UAAU,KAAV,EAA5B,GAAgD,CAAhD;AACR,gBAAY,oBAAS,CAAT,EAAY,EAAZ,EAAgB;AAG3B,YAAO,KAAP,CAH2B;KAAhB;AAKZ,cAAU,kBAAS,CAAT,EAAY,EAAZ,EAAgB;AAEzB,SAAI,UAAU,EAAE,IAAF,EAAQ,OAAR,CAAgB,MAAhB,EAAwB,IAAxB,CAA6B,UAA7B,CAAV,CAFqB;AAGzB,SAAG,EAAE,GAAG,MAAH,CAAF,CAAa,OAAb,CAAqB,IAArB,EAA2B,QAA3B,CAAoC,UAApC,CAAH,EAAoD;AACnD,cAAQ,OAAR,GADmD;MAApD,MAEO;AACN,cAAQ,IAAR,GADM;MAFP;KAHS;IAPc,EAAzB;GALW;;AA4BZ,oBAAkB,4BAAW;AAC5B,KAAE,IAAF,EAAQ,IAAR,CAAa,MAAb,EAAqB,IAArB,CAA0B,YAAW;AACpC,QAAI,CAAC,EAAE,IAAF,EAAQ,IAAR,CAAa,MAAb,CAAD,EAAuB,OAA3B;AACA,QAAI,UAAU,EAAE,IAAF,EAAQ,IAAR,CAAa,MAAb,EAAqB,KAArB,CAA2B,KAA3B,CAAV,CAFgC;AAGpC,QAAG,CAAC,OAAD,EAAU,OAAb;AACA,MAAE,IAAF,EAAQ,IAAR,CAAa,MAAb,EAAqB,SAAS,QAAT,CAAkB,IAAlB,CAAuB,OAAvB,CAA+B,KAA/B,EAAsC,EAAtC,IAA4C,QAAQ,CAAR,CAA5C,CAArB,CAJoC;IAAX,CAA1B,CAD4B;GAAX;EAtCnB,EAr1C2B;;AAw4C3B,GAAE,iBAAF,EAAqB,OAArB,CAA6B;AAC5B,WAAS,mBAAY;AACpB,QAAK,MAAL,GADoB;;AAGpB,QAAK,IAAL,CAAU,WAAV,EAAuB,IAAvB,EAHoB;AAIpB,QAAK,IAAL,CAAU,WAAV,EAAuB,KAAvB,EAJoB;GAAZ;AAMT,aAAW,qBAAY;AACtB,QAAK,MAAL,GADsB;GAAZ;AAGX,YAAU,oBAAY;AACrB,OAAI,OAAO,IAAP;OACH,WAAW,EAAE,sBAAF,EAA0B,KAA1B,EAAX;OACA,YAAY,KAAK,IAAL,CAAU,WAAV,CAAZ,CAHoB;;AAMrB,OAAI,KAAK,IAAL,CAAU,WAAV,CAAJ,EAA4B;AAC3B,WAD2B;IAA5B;;AAIA,QAAK,WAAL,CAAiB,QAAjB,EAVqB;AAWrB,QAAK,IAAL,CAAU,WAAV,EAAuB,IAAvB,EAXqB;;AAcrB,YAAS,YAAY,WAAZ,GAA0B,SAA1B,CAAT,CAA8C;AAC7C,cAAU,oBAAY;AAErB,UAAK,IAAL,CAAU,WAAV,EAAuB,CAAC,SAAD,CAAvB,CAFqB;AAGrB,UAAK,IAAL,CAAU,WAAV,EAAuB,KAAvB,EAHqB;KAAZ;IADX,EAdqB;GAAZ;AAsBV,WAAS,mBAAY;AACpB,QAAK,QAAL,GADoB;GAAZ;EAhCV,EAx4C2B;CAAZ,CAAhB;;AA86CA,IAAI,gBAAgB,SAAhB,aAAgB,CAAS,IAAT,EAAe,IAAf,EAAqB;AACxC,QAAO,OAAO,QAAP,EAAiB,IAAjB,CAAsB,IAAtB,EAA4B,IAA5B,EAAP,CADwC;AAExC,QAAO,SAAP,CAAiB,EAAC,MAAM,IAAN,EAAY,MAAM,IAAN,EAAY,UAAU,IAAV,EAAgB,UAAU,EAAC,MAAM,GAAN,EAAW,SAAS,MAAT,EAAtB,EAA1D,EAFwC;CAArB;;AAKpB,IAAI,eAAe,SAAf,YAAe,CAAS,IAAT,EAAe;AACjC,QAAO,SAAP,CAAiB,EAAC,MAAM,IAAN,EAAY,MAAM,OAAN,EAAe,UAAU,IAAV,EAAgB,UAAU,EAAC,MAAM,GAAN,EAAW,SAAS,MAAT,EAAtB,EAA7D,EADiC;CAAf;;;;;AChgDnB,QAAQ,iCAAR;AACA,QAAQ,0BAAR;AACA,QAAQ,uCAAR;AACA,QAAQ,gCAAR;AACA,QAAQ,+BAAR;AACA,QAAQ,kCAAR;AACA,QAAQ,mCAAR;AACA,QAAQ,+BAAR;AACA,QAAQ,kCAAR;AACA,QAAQ,uCAAR;AACA,QAAQ,oCAAR;AACA,QAAQ,iDAAR;AACA,QAAQ,4CAAR","file":"bundle-legacy.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\n * File: LeftAndMain.ActionTabset.js\n *\n * Contains rules for .ss-ui-action-tabset, used for:\n * * Site tree action tabs (to perform actions on the site tree)\n * * Actions menu (Edit page actions)\n *\n */\nimport $ from 'jQuery';\n\n$.entwine('ss', function($) {\n\t/**\n\t * Generic rules for all ss-ui-action-tabsets\n\t * * ActionMenus\n\t * * SiteTree ActionTabs\n\t */\n\t$('.ss-tabset.ss-ui-action-tabset').entwine({\n\t\t// Ignore tab state so it will not be reopened on form submission.\n\t\tIgnoreTabState: true,\n\n\t\tonadd: function() {\n\t\t\t// Make sure the .ss-tabset is already initialised to apply our modifications on top.\n\t\t\tthis._super();\n\t\t\t//Set actionTabs to allow closing and be closed by default\n\t\t\tthis.tabs({'collapsible': true, 'active': false});\n\t\t},\n\n\t\tonremove: function() {\n\t\t\t// Remove all bound events.\n\t\t\t// This guards against an edge case where the click handlers are not unbound\n\t\t\t// because the panel is still open when the ajax edit form reloads.\n\t\t\tvar frame = $('.cms-container').find('iframe');\n\t\t\tframe.each(function(index, iframe){\n\t\t\t\ttry {\n\t\t\t\t\t$(iframe).contents().off('click.ss-ui-action-tabset');\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Unable to access iframe, possible https mis-match');\n\t\t\t\t}\n\t\t\t});\n\t\t\t$(document).off('click.ss-ui-action-tabset');\n\n\t\t\tthis._super();\n\t\t},\n\n\t\t/**\n\t\t * Deal with available vertical space\n\t\t */\n\t\t'ontabsbeforeactivate': function(event, ui) {\n\t\t\tthis.riseUp(event, ui);\n\t\t},\n\n\t\t/**\n\t\t * Handle opening and closing tabs\n\t\t */\n\t\tonclick: function(event, ui) {\n\t\t\tthis.attachCloseHandler(event, ui);\n\t\t},\n\n\t\t/**\n\t\t * Generic function to close open tabs. Stores event in a handler,\n\t\t * and removes the bound event once activated.\n\t\t *\n\t\t * Note: Should be called by a click event attached to 'this'\n\t\t */\n\t\tattachCloseHandler: function(event, ui) {\n\t\t\tvar that = this, frame = $('.cms-container').find('iframe'), closeHandler;\n\n\t\t\t// Create a handler for the click event so we can close tabs\n\t\t\t// and easily remove the event once done\n\t\t\tcloseHandler = function(event) {\n\t\t\t\tvar panel, frame;\n\t\t\t\tpanel = $(event.target).closest('.ss-ui-action-tabset .ui-tabs-panel');\n\n\t\t\t\t// If anything except the ui-nav button or panel is clicked,\n\t\t\t\t// close panel and remove handler. We can't close if click was\n\t\t\t\t// within panel, as it might've caused a button action,\n\t\t\t\t// and we need to show its loading indicator.\n\t\t\t\tif (!$(event.target).closest(that).length && !panel.length) {\n\t\t\t\t\tthat.tabs('option', 'active', false); // close tabs\n\n\t\t\t\t\t// remove click event from objects it is bound to (iframe's and document)\n\t\t\t\t\tframe = $('.cms-container').find('iframe');\n\t\t\t\t\tframe.each(function(index, iframe){\n\t\t\t\t\t\t$(iframe).contents().off('click.ss-ui-action-tabset', closeHandler);\n\t\t\t\t\t});\n\t\t\t\t\t$(document).off('click.ss-ui-action-tabset', closeHandler);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Bind click event to document, and use closeHandler to handle the event\n\t\t\t$(document).on('click.ss-ui-action-tabset', closeHandler);\n\t\t\t// Make sure iframe click also closes tab\n\t\t\t// iframe needs a special case, else the click event will not register here\n\t\t\tif(frame.length > 0){\n\t\t\t\tframe.each(function(index, iframe) {\n\t\t\t\t\t$(iframe).contents().on('click.ss-ui-action-tabset', closeHandler);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Function riseUp checks to see if a tab should be opened upwards\n\t\t * (based on space concerns). If true, the rise-up class is applied\n\t\t * and a new position is calculated and applied to the element.\n\t\t *\n\t\t * Note: Should be called by a tabsbeforeactivate event\n\t\t */\n\t\triseUp: function(event, ui) {\n\t\t\tvar elHeight, trigger, endOfWindow, elPos, activePanel, activeTab, topPosition, containerSouth, padding;\n\n\t\t\t// Get the numbers needed to calculate positions\n\t\t\telHeight = $(this).find('.ui-tabs-panel').outerHeight();\n\t\t\ttrigger = $(this).find('.ui-tabs-nav').outerHeight();\n\t\t\tendOfWindow = ($(window).height() + $(document).scrollTop()) - trigger;\n\t\t\telPos = $(this).find('.ui-tabs-nav').offset().top;\n\n\t\t\tactivePanel = ui.newPanel;\n\t\t\tactiveTab = ui.newTab;\n\n\t\t\tif (elPos + elHeight >= endOfWindow && elPos - elHeight > 0){\n\t\t\t\tthis.addClass('rise-up');\n\n\t\t\t\tif (activeTab.position() !== null){\n\t\t\t\t\ttopPosition = -activePanel.outerHeight();\n\t\t\t\t\tcontainerSouth = activePanel.parents('.south');\n\t\t\t\t\tif (containerSouth){\n\t\t\t\t\t\t// If container is the southern panel, make tab appear from the top of the container\n\t\t\t\t\t\tpadding = activeTab.offset().top - containerSouth.offset().top;\n\t\t\t\t\t\ttopPosition = topPosition-padding;\n\t\t\t\t\t}\n\t\t\t\t\t$(activePanel).css('top',topPosition+\"px\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// else remove the rise-up class and set top to 0\n\t\t\t\tthis.removeClass('rise-up');\n\t\t\t\tif (activeTab.position() !== null){\n\t\t\t\t\t$(activePanel).css('top','0px');\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t});\n\n\n\t/**\n\t * ActionMenus\n\t * * Specific rules for ActionMenus, used for edit page actions\n\t */\n\t$('.cms-content-actions .ss-tabset.ss-ui-action-tabset').entwine({\n\t\t/**\n\t\t * Make necessary adjustments before tab is activated\n\t\t */\n\t\t'ontabsbeforeactivate': function(event, ui) {\n\t\t\tthis._super(event, ui);\n\t\t\t//Set the position of the opening tab (if it exists)\n\t\t\tif($(ui.newPanel).length > 0){\n\t\t\t\t$(ui.newPanel).css('left', ui.newTab.position().left+\"px\");\n\t\t\t}\n\t\t}\n\t});\n\n\t/**\n\t * SiteTree ActionTabs\n\t * Specific rules for site tree action tabs. Applies to tabs\n\t * within the expanded content area, and within the sidebar\n\t */\n\t$('.cms-actions-row.ss-tabset.ss-ui-action-tabset').entwine({\n\t\t/**\n\t\t * Make necessary adjustments before tab is activated\n\t\t */\n\t\t'ontabsbeforeactivate': function(event, ui) {\n\t\t\tthis._super(event, ui);\n\t\t\t// Remove tabset open classes (Last gets a unique class\n\t\t\t// in the bigger sitetree. Remove this if we have it)\n\t\t\t$(this).closest('.ss-ui-action-tabset')\n\t\t\t\t\t.removeClass('tabset-open tabset-open-last');\n\t\t}\n\t});\n\n\t/**\n\t * SiteTree ActionTabs: expanded\n\t * * Specific rules for siteTree actions within the expanded content area.\n\t */\n\t$('.cms-content-fields .ss-tabset.ss-ui-action-tabset').entwine({\n\t\t/**\n\t\t * Make necessary adjustments before tab is activated\n\t\t */\n\t\t'ontabsbeforeactivate': function(event, ui) {\n\t\t\tthis._super(event, ui);\n\t\t\tif($( ui.newPanel).length > 0){\n\t\t\t\tif($(ui.newTab).hasClass(\"last\")){\n\t\t\t\t\t// Align open tab to the right (because opened tab is last)\n\t\t\t\t\t$(ui.newPanel).css({'left': 'auto', 'right': '0px'});\n\n\t\t\t\t\t// Last needs to be styled differently when open, so apply a unique class\n\t\t\t\t\t$(ui.newPanel).parent().addClass('tabset-open-last');\n\t\t\t\t}else{\n\t\t\t\t\t// Assign position to tabpanel based on position of relivent active tab item\n\t\t\t\t\t$(ui.newPanel).css('left', ui.newTab.position().left+\"px\");\n\n\t\t\t\t\t// If this is the first tab, make sure the position doesn't include border\n\t\t\t\t\t// (hard set position to 0 ), and add the tab-set open class\n\t\t\t\t\tif($(ui.newTab).hasClass(\"first\")){\n\t\t\t\t\t\t$(ui.newPanel).css('left',\"0px\");\n\t\t\t\t\t\t$(ui.newPanel).parent().addClass('tabset-open');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\t/**\n\t * SiteTree ActionTabs: sidebar\n\t * * Specific rules for when the site tree actions panel appears in\n\t * * the side-bar\n\t */\n\t$('.cms-tree-view-sidebar .cms-actions-row.ss-tabset.ss-ui-action-tabset').entwine({\n\n\t\t// If actions panel is within the sidebar, apply active class\n\t\t// to help animate open/close on hover\n\t\t'from .ui-tabs-nav li': {\n\t\t\tonhover: function(e) {\n\t\t\t\t$(e.target).parent().find('li .active').removeClass('active');\n\t\t\t\t$(e.target).find('a').addClass('active');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Make necessary adjustments before tab is activated\n\t\t */\n\t\t'ontabsbeforeactivate': function(event, ui) {\n\t\t\tthis._super(event, ui);\n\t\t\t// Reset position of tabs, else anyone going between the large\n\t\t\t// and the small sitetree will see broken tabs\n\t\t\t// Apply styles with .css, to avoid overriding currently applied styles\n\t\t\t$(ui.newPanel).css({'left': 'auto', 'right': 'auto'});\n\n\t\t\tif($(ui.newPanel).length > 0){\n\t\t\t\t$(ui.newPanel).parent().addClass('tabset-open');\n\t\t\t}\n\t\t}\n\t});\n\n});\n","/**\n * File: LeftAndMain.BatchActions.js\n */\nimport $ from 'jQuery';\nimport i18n from 'i18n';\n\n$.entwine('ss.tree', function($){\n\n\t/**\n\t * Class: #Form_BatchActionsForm\n\t * \n\t * Batch actions which take a bunch of selected pages,\n\t * usually from the CMS tree implementation, and perform serverside\n\t * callbacks on the whole set. We make the tree selectable when the jQuery.UI tab\n\t * enclosing this form is opened.\n\t * \n\t * Events:\n\t *  register - Called before an action is added.\n\t *  unregister - Called before an action is removed.\n\t */\n\t$('#Form_BatchActionsForm').entwine({\n\n\t\t/**\n\t\t * Variable: Actions\n\t\t * (Array) Stores all actions that can be performed on the collected IDs as\n\t\t * function closures. This might trigger filtering of the selected IDs,\n\t\t * a confirmation message, etc.\n\t\t */\n\t\tActions: [],\n\n\t\tgetTree: function() {\n\t\t\treturn $('.cms-tree');\n\t\t},\n\n\t\tfromTree: {\n\t\t\toncheck_node: function(e, data){\n\t\t\t\tthis.serializeFromTree();\n\t\t\t},\n\t\t\tonuncheck_node: function(e, data){\n\t\t\t\tthis.serializeFromTree();\n\t\t\t}\n\t\t},\n\t\t\n\t\t/**\n\t\t * @func registerDefault\n\t\t * @desc Register default bulk confirmation dialogs\n\t\t */\n\t\tregisterDefault: function() {\n\t\t\t// Publish selected pages action\n\t\t\tthis.register('admin/pages/batchactions/publish', function(ids) {\n\t\t\t\tvar confirmed = confirm(\n\t\t\t\t\ti18n.inject(\n\t\t\t\t\t\ti18n._t(\n\t\t\t\t\t\t\t\"CMSMAIN.BATCH_PUBLISH_PROMPT\",\n\t\t\t\t\t\t\t\"You have {num} page(s) selected.\\n\\nDo you really want to publish?\"\n\t\t\t\t\t\t),\n\t\t\t\t\t\t{'num': ids.length}\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn (confirmed) ? ids : false;\n\t\t\t});\n\n\t\t\t// Unpublish selected pages action\n\t\t\tthis.register('admin/pages/batchactions/unpublish', function(ids) {\n\t\t\t\tvar confirmed = confirm(\n\t\t\t\t\ti18n.inject(\n\t\t\t\t\t\ti18n._t(\n\t\t\t\t\t\t\t\"CMSMAIN.BATCH_UNPUBLISH_PROMPT\",\n\t\t\t\t\t\t\t\"You have {num} page(s) selected.\\n\\nDo you really want to unpublish\"\n\t\t\t\t\t\t),\n\t\t\t\t\t\t{'num': ids.length}\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn (confirmed) ? ids : false;\n\t\t\t});\n\n\t\t\t// Delete selected pages action\n\t\t\t// @deprecated since 4.0 Use archive instead\n\t\t\tthis.register('admin/pages/batchactions/delete', function(ids) {\n\t\t\t\tvar confirmed = confirm(\n\t\t\t\t\ti18n.inject(\n\t\t\t\t\t\ti18n._t(\n\t\t\t\t\t\t\t\"CMSMAIN.BATCH_DELETE_PROMPT\",\n\t\t\t\t\t\t\t\"You have {num} page(s) selected.\\n\\nDo you really want to delete?\"\n\t\t\t\t\t\t),\n\t\t\t\t\t\t{'num': ids.length}\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn (confirmed) ? ids : false;\n\t\t\t});\n\n\t\t\t// Delete selected pages action\n\t\t\tthis.register('admin/pages/batchactions/archive', function(ids) {\n\t\t\t\tvar confirmed = confirm(\n\t\t\t\t\ti18n.inject(\n\t\t\t\t\t\ti18n._t(\n\t\t\t\t\t\t\t\"CMSMAIN.BATCH_ARCHIVE_PROMPT\",\n\t\t\t\t\t\t\t\"You have {num} page(s) selected.\\n\\nAre you sure you want to archive these pages?\\n\\nThese pages and all of their children pages will be unpublished and sent to the archive.\"\n\t\t\t\t\t\t),\n\t\t\t\t\t\t{'num': ids.length}\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn (confirmed) ? ids : false;\n\t\t\t});\n\n\t\t\t// Restore selected archived pages\n\t\t\tthis.register('admin/pages/batchactions/restore', function(ids) {\n\t\t\t\tvar confirmed = confirm(\n\t\t\t\t\ti18n.inject(\n\t\t\t\t\t\ti18n._t(\n\t\t\t\t\t\t\t\"CMSMAIN.BATCH_RESTORE_PROMPT\",\n\t\t\t\t\t\t\t\"You have {num} page(s) selected.\\n\\nDo you really want to restore to stage?\\n\\nChildren of archived pages will be restored to the root level, unless those pages are also being restored.\"\n\t\t\t\t\t\t),\n\t\t\t\t\t\t{'num': ids.length}\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn (confirmed) ? ids : false;\n\t\t\t});\n\n\t\t\t// Delete selected pages from live action\n\t\t\tthis.register('admin/pages/batchactions/deletefromlive', function(ids) {\n\t\t\t\tvar confirmed = confirm(\n\t\t\t\t\ti18n.inject(\n\t\t\t\t\t\ti18n._t(\n\t\t\t\t\t\t\t\"CMSMAIN.BATCH_DELETELIVE_PROMPT\",\n\t\t\t\t\t\t\t\"You have {num} page(s) selected.\\n\\nDo you really want to delete these pages from live?\"\n\t\t\t\t\t\t),\n\t\t\t\t\t\t{'num': ids.length}\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn (confirmed) ? ids : false;\n\t\t\t});\n\t\t},\n\n\t\tonadd: function() {\n\t\t\tthis.registerDefault();\n\t\t\tthis._super();\n\t\t},\n\n\t\t/**\n\t\t * @func register\n\t\t * @param {string} type\n\t\t * @param {function} callback\n\t\t */\n\t\tregister: function(type, callback) {\n\t\t\tthis.trigger('register', {type: type, callback: callback});\n\t\t\tvar actions = this.getActions();\n\t\t\tactions[type] = callback;\n\t\t\tthis.setActions(actions);\n\t\t},\n\n\t\t/**\n\t\t * @func unregister\n\t\t * @param {string} type\n\t\t * @desc Remove an existing action.\n\t\t */\n\t\tunregister: function(type) {\n\t\t\tthis.trigger('unregister', {type: type});\n\n\t\t\tvar actions = this.getActions();\n\t\t\tif(actions[type]) delete actions[type];\n\t\t\tthis.setActions(actions);\n\t\t},\n\n\t\t/**\n\t\t * @func refreshSelected\n\t\t * @param {object} rootNode\n\t\t * @desc Ajax callbacks determine which pages is selectable in a certain batch action.\n\t\t */\n\t\trefreshSelected : function(rootNode) {\n\t\t\tvar self = this,\n\t\t\t\tst = this.getTree(),\n\t\t\t\tids = this.getIDs(),\n\t\t\t\tallIds = [],\n\t\t\t\tviewMode = $('.cms-content-batchactions-button'),\n\t\t\t\tactionUrl = this.find(':input[name=Action]').val();\n\t\t\n\t\t\t// Default to refreshing the entire tree\n\t\t\tif(rootNode == null) rootNode = st;\n\n\t\t\tfor(var idx in ids) {\n\t\t\t\t$($(st).getNodeByID(idx)).addClass('selected').attr('selected', 'selected');\n\t\t\t}\n\n\t\t\t// If no action is selected, enable all nodes\n\t\t\tif(!actionUrl || actionUrl == -1 || !viewMode.hasClass('active')) {\n\t\t\t\t$(rootNode).find('li').each(function() {\n\t\t\t\t\t$(this).setEnabled(true);\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Disable the nodes while the ajax request is being processed\n\t\t\t$(rootNode).find('li').each(function() {\n\t\t\t\tallIds.push($(this).data('id'));\n\t\t\t\t$(this).addClass('treeloading').setEnabled(false);\n\t\t\t});\n\t\t\t\n\t\t\t// Post to the server to ask which pages can have this batch action applied\n\t\t\t// Retain existing query parameters in URL before appending path\n\t\t\tvar actionUrlParts = $.path.parseUrl(actionUrl);\n\t\t\tvar applicablePagesUrl = actionUrlParts.hrefNoSearch + '/applicablepages/';\n\t\t\tapplicablePagesUrl = $.path.addSearchParams(applicablePagesUrl, actionUrlParts.search);\n\t\t\tapplicablePagesUrl = $.path.addSearchParams(applicablePagesUrl, {csvIDs: allIds.join(',')});\n\t\t\tjQuery.getJSON(applicablePagesUrl, function(applicableIDs) {\n\t\t\t\t// Set a CSS class on each tree node indicating which can be batch-actioned and which can't\n\t\t\t\tjQuery(rootNode).find('li').each(function() {\n\t\t\t\t\t$(this).removeClass('treeloading');\n\n\t\t\t\t\tvar id = $(this).data('id');\n\t\t\t\t\tif(id == 0 || $.inArray(id, applicableIDs) >= 0) {\n\t\t\t\t\t\t$(this).setEnabled(true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// De-select the node if it's non-applicable\n\t\t\t\t\t\t$(this).removeClass('selected').setEnabled(false);\n\t\t\t\t\t\t$(this).prop('selected', false);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tself.serializeFromTree();\n\t\t\t});\n\t\t},\n\t\t\n\t\t/**\n\t\t * @func serializeFromTree\n\t\t * @return {boolean}\n\t\t */\n\t\tserializeFromTree: function() {\n\t\t\tvar tree = this.getTree(), ids = tree.getSelectedIDs();\n\t\t\t\n\t\t\t// write IDs to the hidden field\n\t\t\tthis.setIDs(ids);\n\t\t\t\n\t\t\treturn true;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @func setIDS\n\t\t * @param {array} ids\n\t\t */\n\t\tsetIDs: function(ids) {\n\t\t\tthis.find(':input[name=csvIDs]').val(ids ? ids.join(',') : null);\n\t\t},\n\t\t\n\t\t/**\n\t\t * @func getIDS\n\t\t * @return {array}\n\t\t */\n\t\tgetIDs: function() {\n\t\t\t// Map empty value to empty array\n\t\t\tvar value = this.find(':input[name=csvIDs]').val();\n\t\t\treturn value\n\t\t\t\t? value.split(',')\n\t\t\t\t: [];\n\t\t},\n\n\t\tonsubmit: function(e) {\n\t\t\tvar self = this, ids = this.getIDs(), tree = this.getTree(), actions = this.getActions();\n\t\t\t\n\t\t\t// if no nodes are selected, return with an error\n\t\t\tif(!ids || !ids.length) {\n\t\t\t\talert(i18n._t('CMSMAIN.SELECTONEPAGE', 'Please select at least one page'));\n\t\t\t\te.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t// apply callback, which might modify the IDs\n\t\t\tvar type = this.find(':input[name=Action]').val();\n\t\t\tif(actions[type]) {\n\t\t\t\tids = this.getActions()[type].apply(this, [ids]);\n\t\t\t}\n\t\t\t\n\t\t\t// Discontinue processing if there are no further items\n\t\t\tif(!ids || !ids.length) {\n\t\t\t\te.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\n\t\t\t// write (possibly modified) IDs back into to the hidden field\n\t\t\tthis.setIDs(ids);\n\t\t\t\n\t\t\t// Reset failure states\n\t\t\ttree.find('li').removeClass('failed');\n\t\t\n\t\t\tvar button = this.find(':submit:first');\n\t\t\tbutton.addClass('loading');\n\t\t\n\t\t\tjQuery.ajax({\n\t\t\t\t// don't use original form url\n\t\t\t\turl: type,\n\t\t\t\ttype: 'POST',\n\t\t\t\tdata: this.serializeArray(),\n\t\t\t\tcomplete: function(xmlhttp, status) {\n\t\t\t\t\tbutton.removeClass('loading');\n\n\t\t\t\t\t// Refresh the tree.\n\t\t\t\t\t// Makes sure all nodes have the correct CSS classes applied.\n\t\t\t\t\ttree.jstree('refresh', -1);\n\t\t\t\t\tself.setIDs([]);\n\n\t\t\t\t\t// Reset action\n\t\t\t\t\tself.find(':input[name=Action]').val('').change();\n\t\t\t\t\n\t\t\t\t\t// status message (decode into UTF-8, HTTP headers don't allow multibyte)\n\t\t\t\t\tvar msg = xmlhttp.getResponseHeader('X-Status');\n\t\t\t\t\tif(msg) statusMessage(decodeURIComponent(msg), (status == 'success') ? 'good' : 'bad');\n\t\t\t\t},\n\t\t\t\tsuccess: function(data, status) {\n\t\t\t\t\tvar id, node;\n\t\t\t\t\t\n\t\t\t\t\tif(data.modified) {\n\t\t\t\t\t\tvar modifiedNodes = [];\n\t\t\t\t\t\tfor(id in data.modified) {\n\t\t\t\t\t\t\tnode = tree.getNodeByID(id);\n\t\t\t\t\t\t\ttree.jstree('set_text', node, data.modified[id]['TreeTitle']);\n\t\t\t\t\t\t\tmodifiedNodes.push(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$(modifiedNodes).effect('highlight');\n\t\t\t\t\t}\n\t\t\t\t\tif(data.deleted) {\n\t\t\t\t\t\tfor(id in data.deleted) {\n\t\t\t\t\t\t\tnode = tree.getNodeByID(id);\n\t\t\t\t\t\t\tif(node.length)\ttree.jstree('delete_node', node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(data.error) {\n\t\t\t\t\t\tfor(id in data.error) {\n\t\t\t\t\t\t\tnode = tree.getNodeByID(id);\n\t\t\t\t\t\t\t$(node).addClass('failed');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdataType: 'json'\n\t\t\t});\n\t\t\n\t\t\t// Never process this action; Only invoke via ajax\n\t\t\te.preventDefault();\n\t\t\treturn false;\n\t\t}\n\t\n\t});\n\n\t$('.cms-content-batchactions-button').entwine({\n\t\tonmatch: function () {\n\t\t\tthis._super();\n\t\t\tthis.updateTree();\n\t\t},\n\t\tonunmatch: function () {\n\t\t\tthis._super();\n\t\t},\n\t\tonclick: function (e) {\n\t\t\tthis.updateTree();\n\t\t},\n\t\tupdateTree: function () {\n\t\t\tvar tree = $('.cms-tree'),\n\t\t\t\tform = $('#Form_BatchActionsForm');\n\n\t\t\tthis._super();\n\n\t\t\tif(this.data('active')) {\n\t\t\t\ttree.addClass('multiple');\n\t\t\t\ttree.removeClass('draggable');\n\t\t\t\tform.serializeFromTree();\n\t\t\t} else {\n\t\t\t\ttree.removeClass('multiple');\n\t\t\t\ttree.addClass('draggable');\n\t\t\t}\n\t\t\t\n\t\t\t$('#Form_BatchActionsForm').refreshSelected();\n\t\t}\n\t});\n\n\t/**\n\t * Class: #Form_BatchActionsForm :select[name=Action]\n\t */\n\t$('#Form_BatchActionsForm select[name=Action]').entwine({\n\t\tonchange: function(e) {\n\t\t\tvar form = $(e.target.form),\n\t\t\t\tbtn = form.find(':submit'),\n\t\t\t\tselected = $(e.target).val();\n\t\t\tif(!selected || selected == -1) {\n\t\t\t\tbtn.attr('disabled', 'disabled').button('refresh');\n\t\t\t} else {\n\t\t\t\tbtn.removeAttr('disabled').button('refresh');\n\t\t\t}\n\t\t\t\n\t\t\t// Refresh selected / enabled nodes\n\t\t\t$('#Form_BatchActionsForm').refreshSelected();\n\n\t\t\t// TODO Should work by triggering change() along, but doesn't - entwine event bubbling?\n\t\t\tthis.trigger(\"liszt:updated\");\n\n\t\t\tthis._super(e);\n\t\t}\n\t});\n});\n","import $ from 'jQuery';\n\n$.entwine('ss', function($){\n\t\n\t/**\n\t * The \"content\" area contains all of the section specific UI (excluding the menu).\n\t * This area can be a form itself, as well as contain one or more forms.\n\t * For example, a page edit form might fill the whole area, \n\t * while a ModelAdmin layout shows a search form on the left, and edit form on the right.\n\t */\n\t$('.cms-content').entwine({\n\t\t\n\t\tonadd: function() {\n\t\t\tvar self = this;\n\t\t\t\n\t\t\t// Force initialization of certain UI elements to avoid layout glitches\n\t\t\tthis.find('.cms-tabset').redrawTabs();\n\t\t\tthis._super();\n\n\t\t},\n\n\t\tredraw: function() {\n\t\t\tif(window.debug) console.log('redraw', this.attr('class'), this.get(0));\n\t\t\t\n\t\t\t// Force initialization of certain UI elements to avoid layout glitches\n\t\t\tthis.add(this.find('.cms-tabset')).redrawTabs();\n\t\t\tthis.find('.cms-content-header').redraw();\n\t\t\tthis.find('.cms-content-actions').redraw();\n\t\t}\n\t});\n\n\t/**\n\t * Load edit form for the selected node when its clicked.\n\t */\n\t$('.cms-content .cms-tree').entwine({\n\t\tonadd: function() {\n\t\t\tvar self = this;\n\n\t\t\tthis._super();\n\n\t\t\tthis.bind('select_node.jstree', function(e, data) {\n\t\t\t\tvar node = data.rslt.obj, loadedNodeID = self.find(':input[name=ID]').val(), origEvent = data.args[2], container = $('.cms-container');\n\t\t\t\t\n\t\t\t\t// Don't trigger unless coming from a click event.\n\t\t\t\t// Avoids problems with automated section switches from tree to detail view\n\t\t\t\t// when JSTree auto-selects elements on first load.\n\t\t\t\tif(!origEvent) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Don't allow checking disabled nodes\n\t\t\t\tif($(node).hasClass('disabled')) return false;\n\n\t\t\t\t// Don't allow reloading of currently selected node,\n\t\t\t\t// mainly to avoid doing an ajax request on initial page load\n\t\t\t\tif($(node).data('id') == loadedNodeID) return;\n\n\t\t\t\tvar url = $(node).find('a:first').attr('href');\n\t\t\t\tif(url && url != '#') {\n\t\t\t\t\t// strip possible querystrings from the url to avoid duplicateing document.location.search\n\t\t\t\t\turl = url.split('?')[0];\n\t\t\t\t\t\n\t\t\t\t\t// Deselect all nodes (will be reselected after load according to form state)\n\t\t\t\t\tself.jstree('deselect_all');\n\t\t\t\t\tself.jstree('uncheck_all');\n\n\t\t\t\t\t// Ensure URL is absolute (important for IE)\n\t\t\t\t\tif($.path.isExternal($(node).find('a:first'))) url = url = $.path.makeUrlAbsolute(url, $('base').attr('href'));\n\t\t\t\t\t// Retain search parameters\n\t\t\t\t\tif(document.location.search) url = $.path.addSearchParams(url, document.location.search.replace(/^\\?/, ''));\n\t\t\t\t\t// Load new page\n\t\t\t\t\tcontainer.loadPanel(url);\t\n\t\t\t\t} else {\n\t\t\t\t\tself.removeForm();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\t$('.cms-content .cms-content-fields').entwine({\n\t\tredraw: function() {\n\t\t\tif(window.debug) console.log('redraw', this.attr('class'), this.get(0));\n\t\t}\n\t});\n\n\t$('.cms-content .cms-content-header, .cms-content .cms-content-actions').entwine({\n\t\tredraw: function() {\n\t\t\tif(window.debug) console.log('redraw', this.attr('class'), this.get(0));\n\n\t\t\t// Fix dimensions to actual extents, in preparation for a relayout via jslayout.\n\t\t\tthis.height('auto');\n\t\t\tthis.height(this.innerHeight()-this.css('padding-top')-this.css('padding-bottom'));\n\t\t}\n\t});\n\n\t\n});\n","/**\n * File: LeftAndMain.EditForm.js\n */\nimport $ from 'jQuery';\nimport i18n from 'i18n';\n\n// Can't bind this through jQuery\nwindow.onbeforeunload = function(e) {\n\tvar form = $('.cms-edit-form');\n\tform.trigger('beforesubmitform');\n\tif(form.is('.changed') && ! form.is('.discardchanges')) {\n\t\treturn i18n._t('LeftAndMain.CONFIRMUNSAVEDSHORT');\n\t}\n};\n\n$.entwine('ss', function($){\n\n\t/**\n\t * Class: .cms-edit-form\n\t *\n\t * Base edit form, provides ajaxified saving\n\t * and reloading itself through the ajax return values.\n\t * Takes care of resizing tabsets within the layout container.\n\t *\n\t * Change tracking is enabled on all fields within the form. If you want\n\t * to disable change tracking for a specific field, add a \"no-change-track\"\n\t * class to it.\n\t *\n\t * @name ss.Form_EditForm\n\t * @require jquery.changetracker\n\t *\n\t * Events:\n\t *  ajaxsubmit - Form is about to be submitted through ajax\n\t *  validate - Contains validation result\n\t *  load - Form is about to be loaded through ajax\n\t */\n\t$('.cms-edit-form').entwine(/** @lends ss.Form_EditForm */{\n\t\t/**\n\t\t * Variable: PlaceholderHtml\n\t\t * (String_ HTML text to show when no form content is chosen.\n\t\t * Will show inside the <form> tag.\n\t\t */\n\t\tPlaceholderHtml: '',\n\n\t\t/**\n\t\t * Variable: ChangeTrackerOptions\n\t\t * (Object)\n\t\t */\n\t\tChangeTrackerOptions: {\n\t\t\tignoreFieldSelector: '.no-change-track, .ss-upload :input, .cms-navigator :input'\n\t\t},\n\n\t\t/**\n\t\t * Constructor: onmatch\n\t\t */\n\t\tonadd: function() {\n\t\t\tvar self = this;\n\n\t\t\t// Turn off autocomplete to fix the access tab randomly switching radio buttons in Firefox\n\t\t\t// when refresh the page with an anchor tag in the URL. E.g: /admin#Root_Access.\n\t\t\t// Autocomplete in the CMS also causes strangeness in other browsers,\n\t\t\t// filling out sections of the form that the user does not want to be filled out,\n\t\t\t// so this turns it off for all browsers.\n\t\t\t// See the following page for demo and explanation of the Firefox bug:\n\t\t\t//  http://www.ryancramer.com/journal/entries/radio_buttons_firefox/\n\t\t\tthis.attr(\"autocomplete\", \"off\");\n\n\t\t\tthis._setupChangeTracker();\n\n\t\t\t// Catch navigation events before they reach handleStateChange(),\n\t\t\t// in order to avoid changing the menu state if the action is cancelled by the user\n\t\t\t// $('.cms-menu')\n\n\t\t\t// Optionally get the form attributes from embedded fields, see Form->formHtmlContent()\n\t\t\tfor(var overrideAttr in {'action':true,'method':true,'enctype':true,'name':true}) {\n\t\t\t\tvar el = this.find(':input[name='+ '_form_' + overrideAttr + ']');\n\t\t\t\tif(el) {\n\t\t\t\t\tthis.attr(overrideAttr, el.val());\n\t\t\t\t\tel.remove();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// TODO\n\t\t\t// // Rewrite # links\n\t\t\t// html = html.replace(/(<a[^>]+href *= *\")#/g, '$1' + window.location.href.replace(/#.*$/,'') + '#');\n\t\t\t//\n\t\t\t// // Rewrite iframe links (for IE)\n\t\t\t// html = html.replace(/(<iframe[^>]*src=\")([^\"]+)(\"[^>]*>)/g, '$1' + $('base').attr('href') + '$2$3');\n\n\t\t\t// Show validation errors if necessary\n\t\t\tif(this.hasClass('validationerror')) {\n\t\t\t\t// Ensure the first validation error is visible\n\t\t\t\tvar tabError = this.find('.message.validation, .message.required').first().closest('.tab');\n\t\t\t\t$('.cms-container').clearCurrentTabState(); // clear state to avoid override later on\n\t\t\t\ttabError.closest('.ss-tabset').tabs('option', 'active', tabError.index('.tab'));\n\t\t\t}\n\n\t\t\tthis._super();\n\t\t},\n\t\tonremove: function() {\n\t\t\tthis.changetracker('destroy');\n\t\t\tthis._super();\n\t\t},\n\t\tonmatch: function() {\n\t\t\tthis._super();\n\t\t},\n\t\tonunmatch: function() {\n\t\t\tthis._super();\n\t\t},\n\t\tredraw: function() {\n\t\t\tif(window.debug) console.log('redraw', this.attr('class'), this.get(0));\n\n\t\t\t// Force initialization of tabsets to avoid layout glitches\n\t\t\tthis.add(this.find('.cms-tabset')).redrawTabs();\n\t\t\tthis.find('.cms-content-header').redraw();\n\t\t},\n\n\t\t/**\n\t\t * Function: _setupChangeTracker\n\t\t */\n\t\t_setupChangeTracker: function() {\n\t\t\t// Don't bind any events here, as we dont replace the\n\t\t\t// full <form> tag by any ajax updates they won't automatically reapply\n\t\t\tthis.changetracker(this.getChangeTrackerOptions());\n\t\t},\n\n\t\t/**\n\t\t * Function: confirmUnsavedChanges\n\t\t *\n\t\t * Checks the jquery.changetracker plugin status for this form,\n\t\t * and asks the user for confirmation via a browser dialog if changes are detected.\n\t\t * Doesn't cancel any unload or form removal events, you'll need to implement this based on the return\n\t\t * value of this message.\n\t\t *\n\t\t * If changes are confirmed for discard, the 'changed' flag is reset.\n\t\t *\n\t\t * Returns:\n\t\t *  (Boolean) FALSE if the user wants to abort with changes present, TRUE if no changes are detected\n\t\t *  or the user wants to discard them.\n\t\t */\n\t\tconfirmUnsavedChanges: function() {\n\t\t\tthis.trigger('beforesubmitform');\n\t\t\tif(!this.is('.changed') || this.is('.discardchanges')) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tvar confirmed = confirm(i18n._t('LeftAndMain.CONFIRMUNSAVED'));\n\t\t\tif(confirmed) {\n\t\t\t\t// Ensures that once a form is confirmed, subsequent\n\t\t\t\t// changes to the underlying form don't trigger\n\t\t\t\t// additional change confirmation requests\n\t\t\t\tthis.addClass('discardchanges');\n\t\t\t}\n\t\t\treturn confirmed;\n\t\t},\n\n\t\t/**\n\t\t * Function: onsubmit\n\t\t *\n\t\t * Suppress submission unless it is handled through ajaxSubmit().\n\t\t */\n\t\tonsubmit: function(e, button) {\n\t\t\t// Only submit if a button is present.\n\t\t\t// This supressed submits from ENTER keys in input fields,\n\t\t\t// which means the browser auto-selects the first available form button.\n\t\t\t// This might be an unrelated button of the form field,\n\t\t\t// or a destructive action (if \"save\" is not available, or not on first position).\n\t\t\tif(this.prop(\"target\") != \"_blank\") {\n\t\t\t\tif(button) this.closest('.cms-container').submitForm(this, button);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Function: validate\n\t\t *\n\t\t * Hook in (optional) validation routines.\n\t\t * Currently clientside validation is not supported out of the box in the CMS.\n\t\t *\n\t\t * Todo:\n\t\t *  Placeholder implementation\n\t\t *\n\t\t * Returns:\n\t\t *  {boolean}\n\t\t */\n\t\tvalidate: function() {\n\t\t\tvar isValid = true;\n\t\t\tthis.trigger('validate', {isValid: isValid});\n\n\t\t\treturn isValid;\n\t\t},\n\t\t/*\n\t\t * Track focus on htmleditor fields\n\t\t */\n\t\t'from .htmleditor': {\n\t\t\toneditorinit: function(e){\n\t\t\t\tvar self = this,\n\t\t\t\t\tfield = $(e.target).closest('.field.htmleditor'),\n\t\t\t\t\teditor = field.find('textarea.htmleditor').getEditor().getInstance();\n\n\t\t\t\t// TinyMCE 4 will add a focus event, but for now, use click\n\t\t\t\teditor.onClick.add(function(e){\n\t\t\t\t\tself.saveFieldFocus(field.attr('id'));\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/*\n\t\t * Track focus on inputs\n\t\t */\n\t\t'from .cms-edit-form :input:not(:submit)': {\n\t\t\tonclick: function(e){\n\t\t\t\tthis.saveFieldFocus($(e.target).attr('id'));\n\t\t\t},\n\t\t\tonfocus: function(e){\n\t\t\t\tthis.saveFieldFocus($(e.target).attr('id'));\n\t\t\t}\n\t\t},\n\t\t/*\n\t\t * Track focus on treedropdownfields.\n\t\t */\n\t\t'from .cms-edit-form .treedropdown *': {\n\t\t\tonfocusin: function(e){\n\t\t\t\tvar field = $(e.target).closest('.field.treedropdown');\n\t\t\t\tthis.saveFieldFocus(field.attr('id'));\n\t\t\t}\n\t\t},\n\t\t/*\n\t\t * Track focus on chosen selects\n\t\t */\n\t\t'from .cms-edit-form .dropdown .chzn-container a': {\n\t\t\tonfocusin: function(e){\n\t\t\t\tvar field = $(e.target).closest('.field.dropdown');\n\t\t\t\tthis.saveFieldFocus(field.attr('id'));\n\t\t\t}\n\t\t},\n\t\t/*\n\t\t * Restore fields after tabs are restored\n\t\t */\n\t\t'from .cms-container': {\n\t\t\tontabstaterestored: function(e){\n\t\t\t\tthis.restoreFieldFocus();\n\t\t\t}\n\t\t},\n\t\t/*\n\t\t * Saves focus in Window session storage so it that can be restored on page load\n\t\t */\n\t\tsaveFieldFocus: function(selected){\n\t\t\tif(typeof(window.sessionStorage)==\"undefined\" || window.sessionStorage === null) return;\n\n\t\t\tvar id = $(this).attr('id'),\n\t\t\t\tfocusElements = [];\n\n\t\t\tfocusElements.push({\n\t\t\t\tid:id,\n\t\t\t\tselected:selected\n\t\t\t});\n\n\t\t\tif(focusElements) {\n\t\t\t\ttry {\n\t\t\t\t\twindow.sessionStorage.setItem(id, JSON.stringify(focusElements));\n\t\t\t\t} catch(err) {\n\t\t\t\t\tif (err.code === DOMException.QUOTA_EXCEEDED_ERR && window.sessionStorage.length === 0) {\n\t\t\t\t\t\t// If this fails we ignore the error as the only issue is that it\n\t\t\t\t\t\t// does not remember the focus state.\n\t\t\t\t\t\t// This is a Safari bug which happens when private browsing is enabled.\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow err;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Set focus or window to previously saved fields.\n\t\t * Requires HTML5 sessionStorage support.\n\t\t *\n\t\t * Must follow tab restoration, as reliant on active tab\n\t\t */\n\t\trestoreFieldFocus: function(){\n\t\t\tif(typeof(window.sessionStorage)==\"undefined\" || window.sessionStorage === null) return;\n\n\t\t\tvar self = this,\n\t\t\t\thasSessionStorage = (typeof(window.sessionStorage)!==\"undefined\" && window.sessionStorage),\n\t\t\t\tsessionData = hasSessionStorage ? window.sessionStorage.getItem(this.attr('id')) : null,\n\t\t\t\tsessionStates = sessionData ? JSON.parse(sessionData) : false,\n\t\t\t\telementID,\n\t\t\t\ttabbed = (this.find('.ss-tabset').length !== 0),\n\t\t\t\tactiveTab,\n\t\t\t\telementTab,\n\t\t\t\ttoggleComposite,\n\t\t\t\tscrollY;\n\n\t\t\tif(hasSessionStorage && sessionStates.length > 0){\n\t\t\t\t$.each(sessionStates, function(i, sessionState) {\n\t\t\t\t\tif(self.is('#' + sessionState.id)){\n\t\t\t\t\t\telementID = $('#' + sessionState.selected);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// If the element IDs saved in session states don't match up to anything in this particular form\n\t\t\t\t// that probably means we haven't encountered this form yet, so focus on the first input\n\t\t\t\tif($(elementID).length < 1){\n\t\t\t\t\tthis.focusFirstInput();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tactiveTab = $(elementID).closest('.ss-tabset').find('.ui-tabs-nav .ui-tabs-active .ui-tabs-anchor').attr('id');\n\t\t\t\telementTab  = 'tab-' + $(elementID).closest('.ss-tabset .ui-tabs-panel').attr('id');\n\n\t\t\t\t// Last focussed element differs to last selected tab, do nothing\n\t\t\t\tif(tabbed && elementTab !== activeTab){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\ttoggleComposite = $(elementID).closest('.togglecomposite');\n\n\t\t\t\t//Reopen toggle fields\n\t\t\t\tif(toggleComposite.length > 0){\n\t\t\t\t\ttoggleComposite.accordion('activate', toggleComposite.find('.ui-accordion-header'));\n\t\t\t\t}\n\n\t\t\t\t//Calculate position for scroll\n\t\t\t\tscrollY = $(elementID).position().top;\n\n\t\t\t\t//Fall back to nearest visible element if hidden (for select type fields)\n\t\t\t\tif(!$(elementID).is(':visible')){\n\t\t\t\t\telementID = '#' + $(elementID).closest('.field').attr('id');\n\t\t\t\t\tscrollY = $(elementID).position().top;\n\t\t\t\t}\n\n\t\t\t\t//set focus to focus variable if element focusable\n\t\t\t\t$(elementID).focus();\n\n\t\t\t\t// Scroll fallback when element is not focusable\n\t\t\t\t// Only scroll if element at least half way down window\n\t\t\t\tif(scrollY > $(window).height() / 2){\n\t\t\t\t\tself.find('.cms-content-fields').scrollTop(scrollY);\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\t// If session storage is not supported or there is nothing stored yet, focus on the first input\n\t\t\t\tthis.focusFirstInput();\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Skip if an element in the form is already focused. Exclude elements which specifically\n\t\t * opt-out of this behaviour via \"data-skip-autofocus\". This opt-out is useful if the\n\t\t * first visible field is shown far down a scrollable area, for example for the pagination\n\t\t * input field after a long GridField listing.\n\t\t */\n\t\tfocusFirstInput: function() {\n\t\t\tthis.find(':input:not(:submit)[data-skip-autofocus!=\"true\"]').filter(':visible:first').focus();\n\t\t}\n\t});\n\n\t/**\n\t * Class: .cms-edit-form .Actions :submit\n\t *\n\t * All buttons in the right CMS form go through here by default.\n\t * We need this onclick overloading because we can't get to the\n\t * clicked button from a form.onsubmit event.\n\t */\n\t$('.cms-edit-form .Actions input.action[type=submit], .cms-edit-form .Actions button.action').entwine({\n\t\t/**\n\t\t * Function: onclick\n\t\t */\n\t\tonclick: function(e) {\n\t\t\t// Confirmation on delete.\n\t\t\tif(\n\t\t\t\tthis.hasClass('gridfield-button-delete')\n\t\t\t\t&& !confirm(i18n._t('TABLEFIELD.DELETECONFIRMMESSAGE'))\n\t\t\t) {\n\t\t\t\te.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif(!this.is(':disabled')) {\n\t\t\t\tthis.parents('form').trigger('submit', [this]);\n\t\t\t}\n\t\t\te.preventDefault();\n\t\t\treturn false;\n\t\t}\n\t});\n\n\t/**\n\t * If we've a history state to go back to, go back, otherwise fall back to\n\t * submitting the form with the 'doCancel' action.\n\t */\n\t$('.cms-edit-form .Actions input.action[type=submit].ss-ui-action-cancel, .cms-edit-form .Actions button.action.ss-ui-action-cancel').entwine({\n\t\tonclick: function(e) {\n\t\t\tif (window.history.length > 1) {\n\t\t\t\twindow.history.back();\n\t\t\t} else {\n\t\t\t\tthis.parents('form').trigger('submit', [this]);\n\t\t\t}\n\t\t\te.preventDefault();\n\t\t}\n\t});\n\n\t/**\n\t * Hide tabs when only one is available.\n\t * Special case is actiontabs - tabs between buttons, where we want to have\n\t * extra options hidden within a tab (even if only one) by default.\n\t */\n\t$('.cms-edit-form .ss-tabset').entwine({\n\t\tonmatch: function() {\n\t\t\tif (!this.hasClass('ss-ui-action-tabset')) {\n\t\t\t\tvar tabs = this.find(\"> ul:first\");\n\n\t\t\t\tif(tabs.children(\"li\").length == 1) {\n\t\t\t\t\ttabs.hide().parent().addClass(\"ss-tabset-tabshidden\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._super();\n\t\t},\n\t\tonunmatch: function() {\n\t\t\tthis._super();\n\t\t}\n\t});\n\n});\n","/**\n * Enable toggling (show/hide) of the field's description.\n */\n\nimport $ from 'jQuery';\n\n$.entwine('ss', function ($) {\n\n  $('.cms-description-toggle').entwine({\n    onadd: function () {\n      var shown = false, // Current state of the description.\n        fieldId = this.prop('id').substr(0, this.prop('id').indexOf('_Holder')),\n        $trigger = this.find('.cms-description-trigger'), // Click target for toggling the description.\n        $description = this.find('.description');\n\n      // Prevent multiple events being added.\n      if (this.hasClass('description-toggle-enabled')) {\n        return;\n      }\n\n      // If a custom trigger han't been supplied use a sensible default.\n      if ($trigger.length === 0) {\n        $trigger = this\n          .find('.middleColumn')\n          .first() // Get the first middleColumn so we don't add multiple triggers on composite field types.\n          .after('<label class=\"right\" for=\"' + fieldId + '\"><a class=\"cms-description-trigger\" href=\"javascript:void(0)\"><span class=\"btn-icon-information\"></span></a></label>')\n          .next();\n      }\n\n      this.addClass('description-toggle-enabled');\n\n      // Toggle next description when button is clicked.\n      $trigger.on('click', function() {\n        $description[shown ? 'hide' : 'show']();\n        shown = !shown;\n      });\n\n      // Hide next description by default.\n      $description.hide();\n    }\n  });\n\n});\n","import $ from 'jQuery';\n\n$.entwine('ss', function($) {\n\t/**\n\t * Converts an inline field description into a tooltip\n\t * which is shown on hover over any part of the field container,\n\t * as well as when focusing into an input element within the field container.\n\t *\n\t * Note that some fields don't have distinct focusable\n\t * input fields (e.g. GridField), and aren't compatible\n\t * with showing tooltips.\n\t */\n\t$(\".cms .field.cms-description-tooltip\").entwine({\n\t\tonmatch: function() {\n\t\t\tthis._super();\n\n\t\t\tvar descriptionEl = this.find('.description'), inputEl, tooltipEl;\n\t\t\tif(descriptionEl.length) {\n\t\t\t\tthis\n\t\t\t\t\t// TODO Remove title setting, shouldn't be necessary\n\t\t\t\t\t.attr('title', descriptionEl.text())\n\t\t\t\t\t.tooltip({content: descriptionEl.html()});\n\t\t\t\tdescriptionEl.remove();\n\t\t\t}\n\t\t},\n\t});\n\n\t$(\".cms .field.cms-description-tooltip :input\").entwine({\n\t\tonfocusin: function(e) {\n\t\t\tthis.closest('.field').tooltip('open');\n\t\t},\n\t\tonfocusout: function(e) {\n\t\t\tthis.closest('.field').tooltip('close');\n\t\t\t}\n\t});\n\n});\n","/**\n * File: LeftAndMain.Layout.js\n */\n\nimport $ from 'jQuery';\n\n$.fn.layout.defaults.resize = false;\n\n/**\n * Acccess the global variable in the same way the plugin does it.\n */\njLayout = (typeof jLayout === 'undefined') ? {} : jLayout;\n\n/**\n * Factory function for generating new type of algorithm for our CMS.\n *\n * Spec requires a definition of three column elements:\n * - `menu` on the left\n * - `content` area in the middle (includes the EditForm, side tool panel, actions, breadcrumbs and tabs)\n * - `preview` on the right (will be shown if there is enough space)\n *\n * Required options:\n * - `minContentWidth`: minimum size for the content display as long as the preview is visible\n * - `minPreviewWidth`: preview will not be displayed below this size\n * - `mode`: one of \"split\", \"content\" or \"preview\"\n *\n * The algorithm first checks which columns are to be visible and which hidden.\n *\n * In the case where both preview and content should be shown it first tries to assign half of non-menu space to\n * preview and the other half to content. Then if there is not enough space for either content or preview, it tries\n * to allocate the minimum acceptable space to that column, and the rest to the other one. If the minimum\n * requirements are still not met, it falls back to showing content only.\n *\n * @param spec A structure defining columns and parameters as per above.\n */\njLayout.threeColumnCompressor = function (spec, options) {\n\t// Spec sanity checks.\n\tif (typeof spec.menu==='undefined' ||\n\t\ttypeof spec.content==='undefined' ||\n\t\ttypeof spec.preview==='undefined') {\n\t\tthrow 'Spec is invalid. Please provide \"menu\", \"content\" and \"preview\" elements.';\n\t}\n\tif (typeof options.minContentWidth==='undefined' ||\n\t\ttypeof options.minPreviewWidth==='undefined' ||\n\t\ttypeof options.mode==='undefined') {\n\t\tthrow 'Spec is invalid. Please provide \"minContentWidth\", \"minPreviewWidth\", \"mode\"';\n\t}\n\tif (options.mode!=='split' && options.mode!=='content' && options.mode!=='preview') {\n\t\tthrow 'Spec is invalid. \"mode\" should be either \"split\", \"content\" or \"preview\"';\n\t}\n\n\t// Instance of the algorithm being produced.\n\tvar obj = {\n\t\toptions: options\n\t};\n\n\t// Internal column handles, also implementing layout.\n\tvar menu = $.jLayoutWrap(spec.menu),\n\t\tcontent = $.jLayoutWrap(spec.content),\n\t\tpreview = $.jLayoutWrap(spec.preview);\n\n\t/**\n\t * Required interface implementations follow.\n\t * Refer to https://github.com/bramstein/jlayout#layout-algorithms for the interface spec.\n\t */\n\tobj.layout = function (container) {\n\t\tvar size = container.bounds(),\n\t\t\tinsets = container.insets(),\n\t\t\ttop = insets.top,\n\t\t\tbottom = size.height - insets.bottom,\n\t\t\tleft = insets.left,\n\t\t\tright = size.width - insets.right;\n\n\t\tvar menuWidth = spec.menu.width(), \n\t\t\tcontentWidth = 0,\n\t\t\tpreviewWidth = 0;\n\n\t\tif (this.options.mode==='preview') {\n\t\t\t// All non-menu space allocated to preview.\n\t\t\tcontentWidth = 0;\n\t\t\tpreviewWidth = right - left - menuWidth;\n\t\t} else if (this.options.mode==='content') {\n\t\t\t// All non-menu space allocated to content.\n\t\t\tcontentWidth = right - left - menuWidth;\n\t\t\tpreviewWidth = 0;\n\t\t} else { // ==='split'\n\t\t\t// Split view - first try 50-50 distribution.\n\t\t\tcontentWidth = (right - left - menuWidth) / 2;\n\t\t\tpreviewWidth = right - left - (menuWidth + contentWidth);\n\n\t\t\t// If violating one of the minima, try to readjust towards satisfying it.\n\t\t\tif (contentWidth < this.options.minContentWidth) {\n\t\t\t\tcontentWidth = this.options.minContentWidth;\n\t\t\t\tpreviewWidth = right - left - (menuWidth + contentWidth);\n\t\t\t} else if (previewWidth < this.options.minPreviewWidth) {\n\t\t\t\tpreviewWidth = this.options.minPreviewWidth;\n\t\t\t\tcontentWidth = right - left - (menuWidth + previewWidth);\n\t\t\t}\n\n\t\t\t// If still violating one of the (other) minima, remove the preview and allocate everything to content.\n\t\t\tif (contentWidth < this.options.minContentWidth || previewWidth < this.options.minPreviewWidth) {\n\t\t\t\tcontentWidth = right - left - menuWidth;\n\t\t\t\tpreviewWidth = 0;\n\t\t\t}\n\t\t}\n\n\t\t// Calculate what columns are already hidden pre-layout\n\t\tvar prehidden = {\n\t\t\tcontent: spec.content.hasClass('column-hidden'),\n\t\t\tpreview: spec.preview.hasClass('column-hidden')\n\t\t};\n\n\t\t// Calculate what columns will be hidden (zero width) post-layout\n\t\tvar posthidden = {\n\t\t\tcontent: contentWidth === 0,\n\t\t\tpreview: previewWidth === 0\n\t\t};\n\n\t\t// Apply classes for elements that might not be visible at all.\n\t\tspec.content.toggleClass('column-hidden', posthidden.content);\n\t\tspec.preview.toggleClass('column-hidden', posthidden.preview);\n\n\t\t// Apply the widths to columns, and call subordinate layouts to arrange the children.\n\t\tmenu.bounds({'x': left, 'y': top, 'height': bottom - top, 'width': menuWidth});\n\t\tmenu.doLayout();\n\n\t\tleft += menuWidth;\n\n\t\tcontent.bounds({'x': left, 'y': top, 'height': bottom - top, 'width': contentWidth});\n\t\tif (!posthidden.content) content.doLayout();\n\n\t\tleft += contentWidth;\n\n\t\tpreview.bounds({'x': left, 'y': top, 'height': bottom - top, 'width': previewWidth});\n\t\tif (!posthidden.preview) preview.doLayout();\n\n\t\tif (posthidden.content !== prehidden.content) spec.content.trigger('columnvisibilitychanged');\n\t\tif (posthidden.preview !== prehidden.preview) spec.preview.trigger('columnvisibilitychanged');\n\n\t\t// Calculate whether preview is possible in split mode\n\t\tif (contentWidth + previewWidth < options.minContentWidth + options.minPreviewWidth) {\n\t\t\tspec.preview.trigger('disable');\n\t\t} else {\n\t\t\tspec.preview.trigger('enable');\n\t\t}\n\n\t\treturn container;\n\t};\n\n\t/**\n\t * Helper to generate the required `preferred`, `minimum` and `maximum` interface functions.\n\t */\n\tfunction typeLayout(type) {\n\t\tvar func = type + 'Size';\n\n\t\treturn function (container) {\n\t\t\tvar menuSize = menu[func](),\n\t\t\t\tcontentSize = content[func](),\n\t\t\t\tpreviewSize = preview[func](),\n\t\t\t\tinsets = container.insets();\n\n\t\t\twidth = menuSize.width + contentSize.width + previewSize.width;\n\t\t\theight = Math.max(menuSize.height, contentSize.height, previewSize.height);\n\n\t\t\treturn {\n\t\t\t\t'width': insets.left + insets.right + width,\n\t\t\t\t'height': insets.top + insets.bottom + height\n\t\t\t};\n\t\t};\n\t}\n\n\t// Generate interface functions.\n\tobj.preferred = typeLayout('preferred');\n\tobj.minimum = typeLayout('minimum');\n\tobj.maximum = typeLayout('maximum');\n\n\treturn obj;\n};\n","import $ from 'jQuery';\n\n$.entwine('ss', function($){\n\t\t\n\t/**\n\t * Vertical CMS menu with two levels, built from a nested unordered list. \n\t * The (optional) second level is collapsible, hiding its children.\n\t * The whole menu (including second levels) is collapsible as well,\n\t * exposing only a preview for every menu item in order to save space.\n\t * In this \"preview/collapsed\" mode, the secondary menu hovers over the menu item,\n\t * rather than expanding it.\n\t * \n\t * Example:\n\t * \n\t * <ul class=\"cms-menu-list\">\n\t *  <li><a href=\"#\">Item 1</a></li>\n\t *  <li class=\"current opened\">\n\t *  <a href=\"#\">Item 2</a>\n\t *  <ul>\n\t *    <li class=\"current opened\"><a href=\"#\">Item 2.1</a></li>\n\t *    <li><a href=\"#\">Item 2.2</a></li>\n\t *  </ul>\n\t *  </li>\n\t * </ul>\n\t * \n\t * Custom Events:\n\t * - 'select': Fires when a menu item is selected (on any level).\n\t */\n\t$('.cms-panel.cms-menu').entwine({\n\t\ttogglePanel: function(doExpand, silent, doSaveState) {\n\t\t\t//apply or unapply the flyout formatting, should only apply to cms-menu-list when the current collapsed panal is the cms menu.\n\t\t\t$('.cms-menu-list').children('li').each(function(){\n\t\t\t\tif (doExpand) { //expand\n\t\t\t\t\t$(this).children('ul').each(function() {\n\t\t\t\t\t\t$(this).removeClass('collapsed-flyout');\n\t\t\t\t\t\tif ($(this).data('collapse')) {\n\t\t\t\t\t\t\t$(this).removeData('collapse');\n\t\t\t\t\t\t\t$(this).addClass('collapse');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {  //collapse\n\t\t\t\t\t$(this).children('ul').each(function() {\n\t\t\t\t\t\t$(this).addClass('collapsed-flyout');\n\t\t\t\t\t\t$(this).hasClass('collapse');\n\t\t\t\t\t\t$(this).removeClass('collapse');\n\t\t\t\t\t\t$(this).data('collapse', true);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.toggleFlyoutState(doExpand);\n\n\t\t\tthis._super(doExpand, silent, doSaveState);\n\t\t},\n\t\ttoggleFlyoutState: function(bool) {\n\t\t\tif (bool) { //expand\n\t\t\t\t//show the flyout\n\t\t\t\t$('.collapsed').find('li').show();\n\n\t\t\t\t//hide all the flyout-indicator\n\t\t\t\t$('.cms-menu-list').find('.child-flyout-indicator').hide();\n\t\t\t} else {  //collapse\n\t\t\t\t//hide the flyout only if it is not the current section\n\t\t\t\t$('.collapsed-flyout').find('li').each(function() {\n\t\t\t\t\t//if (!$(this).hasClass('current'))\n\t\t\t\t\t$(this).hide();\n\t\t\t\t});\n\n\t\t\t\t//show all the flyout-indicators\n\t\t\t\tvar par = $('.cms-menu-list ul.collapsed-flyout').parent();\n\t\t\t\tif (par.children('.child-flyout-indicator').length === 0) par.append('<span class=\"child-flyout-indicator\"></span>').fadeIn();\n\t\t\t\tpar.children('.child-flyout-indicator').fadeIn();\n\t\t\t}\n\t\t},\n\t\tsiteTreePresent: function () {\n\t\t\treturn $('#cms-content-tools-CMSMain').length > 0;\n\t\t},\n\n\t\t/**\n\t\t * @func getPersistedStickyState\n\t\t * @return {boolean|undefined} - Returns true if the menu is sticky, false if unsticky. Returns undefined if there is no cookie set.\n\t\t * @desc Get the sticky state of the menu according to the cookie.\n\t\t */\n\t\tgetPersistedStickyState: function () {\n\t\t\tvar persistedState, cookieValue;\n\n\t\t\tif ($.cookie !== void 0) {\n\t\t\t\tcookieValue = $.cookie('cms-menu-sticky');\n\n\t\t\t\tif (cookieValue !== void 0 && cookieValue !== null) {\n\t\t\t\t\tpersistedState = cookieValue === 'true';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn persistedState;\n\t\t},\n\n\t\t/**\n\t\t * @func setPersistedStickyState\n\t\t * @param {boolean} isSticky - Pass true if you want the panel to be sticky, false for unsticky.\n\t\t * @desc Set the collapsed value of the panel, stored in cookies.\n\t\t */\n\t\tsetPersistedStickyState: function (isSticky) {\n\t\t\tif ($.cookie !== void 0) {\n\t\t\t\t$.cookie('cms-menu-sticky', isSticky, { path: '/', expires: 31 });\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * @func getEvaluatedCollapsedState\n\t\t * @return {boolean} - Returns true if the menu should be collapsed, false if expanded.\n\t\t * @desc Evaluate whether the menu should be collapsed.\n\t\t *     The basic rule is \"If the SiteTree (middle column) is present, collapse the menu, otherwise expand the menu\".\n\t\t *     This reason behind this is to give the content area more real estate when the SiteTree is present.\n\t\t *     The user may wish to override this automatic behaviour and have the menu expanded or collapsed at all times.\n\t\t *     So unlike manually toggling the menu, the automatic behaviour never updates the menu's cookie value.\n\t\t *     Here we use the manually set state and the automatic behaviour to evaluate what the collapsed state should be.\n\t\t */\n\t\tgetEvaluatedCollapsedState: function () {\n\t\t\tvar shouldCollapse,\n\t\t\t\tmanualState = this.getPersistedCollapsedState(),\n\t\t\t\tmenuIsSticky = $('.cms-menu').getPersistedStickyState(),\n\t\t\t\tautomaticState = this.siteTreePresent();\n\n\t\t\tif (manualState === void 0) {\n\t\t\t\t// There is no manual state, use automatic state.\n\t\t\t\tshouldCollapse = automaticState;\n\t\t\t} else if (manualState !== automaticState && menuIsSticky) {\n\t\t\t\t// The manual and automatic statea conflict, use manual state.\n\t\t\t\tshouldCollapse = manualState;\n\t\t\t} else {\n\t\t\t\t// Use automatic state.\n\t\t\t\tshouldCollapse = automaticState;\n\t\t\t}\n\n\t\t\treturn shouldCollapse;\n\t\t},\n\n\t\tonadd: function () {\n\t\t\tvar self = this;\n\n\t\t\tsetTimeout(function () {\n\t\t\t\t// Use a timeout so this happens after the redraw.\n\t\t\t\t// Triggering a toggle before redraw will result in an incorrect\n\t\t\t\t// menu 'expanded width' being calculated when then menu\n\t\t\t\t// is added in a collapsed state.\n\t\t\t\tself.togglePanel(!self.getEvaluatedCollapsedState(), false, false);\n\t\t\t}, 0);\n\n\t\t\t// Setup automatic expand / collapse behaviour.\n\t\t\t$(window).on('ajaxComplete', function (e) {\n\t\t\t\tsetTimeout(function () { // Use a timeout so this happens after the redraw\n\t\t\t\t\tself.togglePanel(!self.getEvaluatedCollapsedState(), false, false);\n\t\t\t\t}, 0);\n\t\t\t});\n\n\t\t\tthis._super();\n\t\t}\n\t});\n\n\t$('.cms-menu-list').entwine({\n\t\tonmatch: function() {\n\t\t\tvar self = this;\n\n\t\t\t// Select default element (which might reveal children in hidden parents)\n\t\t\tthis.find('li.current').select();\n\n\t\t\tthis.updateItems();\n\n\t\t\tthis._super();\n\t\t},\n\t\tonunmatch: function() {\n\t\t\tthis._super();\n\t\t},\n\n\t\tupdateMenuFromResponse: function(xhr) {\n\t\t\tvar controller = xhr.getResponseHeader('X-Controller');\n\t\t\tif(controller) {\n\t\t\t\tvar item = this.find('li#Menu-' + controller.replace(/\\\\/g, '-').replace(/[^a-zA-Z0-9\\-_:.]+/, ''));\n\t\t\t\tif(!item.hasClass('current')) item.select();\n\t\t\t}\n\t\t\tthis.updateItems();\n\t\t},\n\n\t\t'from .cms-container': {\n\t\t\tonafterstatechange: function(e, data){\n\t\t\t\tthis.updateMenuFromResponse(data.xhr);\n\t\t\t},\n\t\t\tonaftersubmitform: function(e, data){\n\t\t\t\tthis.updateMenuFromResponse(data.xhr);\n\t\t\t}\n\t\t},\n\n\t\t'from .cms-edit-form': {\n\t\t\tonrelodeditform: function(e, data){\n\t\t\t\tthis.updateMenuFromResponse(data.xmlhttp);\n\t\t\t}\n\t\t},\n\n\t\tgetContainingPanel: function(){\n\t\t\treturn this.closest('.cms-panel');\n\t\t},\n\n\t\tfromContainingPanel: {\n\t\t\tontoggle: function(e){\n\t\t\t\tthis.toggleClass('collapsed', $(e.target).hasClass('collapsed'));\n\n\t\t\t\t// Trigger synthetic resize event. Avoid native window.resize event\n\t\t\t\t// since it causes other behaviour which should be reserved for actual window dimension changes.\n\t\t\t\t$('.cms-container').trigger('windowresize');\n\n\t\t\t\t//If panel is closing\n\t\t\t\tif (this.hasClass('collapsed')) this.find('li.children.opened').removeClass('opened');\n\n\t\t\t\t//If panel is opening\n\t\t\t\tif(!this.hasClass('collapsed')) {\n\t\t\t\t\t$('.toggle-children.opened').closest('li').addClass('opened');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tupdateItems: function() {\n\t\t\t// Hide \"edit page\" commands unless the section is activated\n\t\t\tvar editPageItem = this.find('#Menu-CMSMain');\n\t\t\t\n\t\t\teditPageItem[editPageItem.is('.current') ? 'show' : 'hide']();\n\t\t\t\n\t\t\t// Update the menu links to reflect the page ID if the page has changed the URL.\n\t\t\tvar currentID = $('.cms-content input[name=ID]').val();\n\t\t\tif(currentID) {\n\t\t\t\tthis.find('li').each(function() {\n\t\t\t\t\tif($.isFunction($(this).setRecordID)) $(this).setRecordID(currentID);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\t/** Toggle the flyout panel to appear/disappear when mouse over */\n\t$('.cms-menu-list li').entwine({\n\t\ttoggleFlyout: function(bool) {\n\t\t\tvar fly = $(this);\n\n\t\t\tif (fly.children('ul').first().hasClass('collapsed-flyout')) {\n\t\t\t\tif (bool) { //expand\n\t\t\t\t\t// create the clone of the list item to be displayed\n\t\t\t\t\t// over the existing one\n\t\t\t\t\tif (\n\t\t\t\t\t\t!fly.children('ul')\n\t\t\t\t\t\t\t.first()\n\t\t\t\t\t\t\t.children('li')\n\t\t\t\t\t\t\t.first()\n\t\t\t\t\t\t\t.hasClass('clone')\n\t\t\t\t\t) {\n\n\t\t\t\t\t\tvar li = fly.clone();\n\t\t\t\t\t\tli.addClass('clone').css({\n\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tli.children('ul').first().remove();\n\n\t\t\t\t\t\tli.find('span').not('.text').remove();\n\n\t\t\t\t\t\tli.find('a').first().unbind('click');\n\n\t\t\t\t\t\tfly.children('ul').prepend(li);\n\t\t\t\t\t}\n\n\t\t\t\t\t$('.collapsed-flyout').show();\n\t\t\t\t\tfly.addClass('opened');\n\t\t\t\t\tfly.children('ul').find('li').fadeIn('fast');\n\t\t\t\t} else {  //collapse\n\t\t\t\t\tif(li) {\n\t\t\t\t\t\tli.remove();\n\t\t\t\t\t}\n\t\t\t\t\t$('.collapsed-flyout').hide();\n\t\t\t\t\tfly.removeClass('opened');\n\t\t\t\t\tfly.find('toggle-children').removeClass('opened');\n\t\t\t\t\tfly.children('ul').find('li').hide();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\t//slight delay to prevent flyout closing from \"sloppy mouse movement\"\n\t$('.cms-menu-list li').hoverIntent(function(){$(this).toggleFlyout(true);},function(){$(this).toggleFlyout(false);});\n\t\n\t$('.cms-menu-list .toggle').entwine({\n\t\tonclick: function(e) {\n\t\t\te.preventDefault();\n\t\t\t$(this).toogleFlyout(true);\n\t\t}\n\t});\n\t\n\t$('.cms-menu-list li').entwine({\n\t\tonmatch: function() {\n\t\t\tif(this.find('ul').length) {\n\t\t\t\tthis.find('a:first').append('<span class=\"toggle-children\"><span class=\"toggle-children-icon\"></span></span>');\n\t\t\t}\n\t\t\tthis._super();\n\t\t},\n\t\tonunmatch: function() {\n\t\t\tthis._super();\n\t\t},\n\t\ttoggle: function() {\n\t\t\tthis[this.hasClass('opened') ? 'close' : 'open']();\n\t\t},\n\t\t/**\n\t\t * \"Open\" is just a visual state, and unrelated to \"current\".\n\t\t * More than one item can be open at the same time.\n\t\t */\n\t\topen: function() {\n\t\t\tvar parent = this.getMenuItem();\n\t\t\tif(parent) parent.open();\n\t\t\tif( this.find('li.clone') ) {\n\t\t\t\tthis.find('li.clone').remove();\n\t\t\t}\n\t\t\tthis.addClass('opened').find('ul').show();\n\t\t\tthis.find('.toggle-children').addClass('opened');\n\t\t},\n\t\tclose: function() {\n\t\t\tthis.removeClass('opened').find('ul').hide();\n\t\t\tthis.find('.toggle-children').removeClass('opened');\n\t\t},\n\t\tselect: function() {\n\t\t\tvar parent = this.getMenuItem();\n\t\t\tthis.addClass('current').open();\n\n\t\t\t// Remove \"current\" class from all siblings and their children\n\t\t\tthis.siblings().removeClass('current').close();\n\t\t\tthis.siblings().find('li').removeClass('current');\n\t\t\tif(parent) {\n\t\t\t\tvar parentSiblings = parent.siblings();\n\t\t\t\tparent.addClass('current');\n\t\t\t\tparentSiblings.removeClass('current').close();\n\t\t\t\tparentSiblings.find('li').removeClass('current').close();\n\t\t\t}\n\t\t\t\n\t\t\tthis.getMenu().updateItems();\n\n\t\t\tthis.trigger('select');\n\t\t}\n\t});\n\t\n\t$('.cms-menu-list *').entwine({\n\t\tgetMenu: function() {\n\t\t\treturn this.parents('.cms-menu-list:first');\n\t\t}\n\t});\n\n\t$('.cms-menu-list li *').entwine({\n\t\tgetMenuItem: function() {\n\t\t\treturn this.parents('li:first');\n\t\t}\n\t});\n\t\n\t/**\n\t * Both primary and secondary nav.\n\t */\n\t$('.cms-menu-list li a').entwine({\n\t\tonclick: function(e) {\n\t\t\t// Only catch left clicks, in order to allow opening in tabs.\n\t\t\t// Ignore external links, fallback to standard link behaviour\n\t\t\tvar isExternal = $.path.isExternal(this.attr('href'));\n\t\t\tif(e.which > 1 || isExternal) return;\n\n\t\t\t// if the developer has this to open in a new window, handle \n\t\t\t// that\n\t\t\tif(this.attr('target') == \"_blank\") {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\te.preventDefault();\n\n\t\t\tvar item = this.getMenuItem();\n\n\t\t\tvar url = this.attr('href');\n\t\t\tif(!isExternal) url = $('base').attr('href') + url;\n\t\t\t\n\t\t\tvar children = item.find('li');\n\t\t\tif(children.length) {\n\t\t\t\tchildren.first().find('a').click();\n\t\t\t} else {\n\t\t\t\t// Load URL, but give the loading logic an opportunity to veto the action\n\t\t\t\t// (e.g. because of unsaved changes)\n\t\t\t\tif(!$('.cms-container').loadPanel(url)) return false;\t\n\t\t\t}\n\n\t\t\titem.select();\n\t\t}\n\t});\n\n\t$('.cms-menu-list li .toggle-children').entwine({\n\t\tonclick: function(e) {\n\t\t\tvar li = this.closest('li');\n\t\t\tli.toggle();\n\t\t\treturn false; // prevent wrapping link event to fire\n\t\t}\n\t});\n\n\t$('.cms .profile-link').entwine({\n\t\tonclick: function() {\n\t\t\t$('.cms-container').loadPanel(this.attr('href'));\n\t\t\t$('.cms-menu-list li').removeClass('current').close(); \n\t\t\treturn false;\n\t\t}\n\t});\n\n\t/**\n\t * Toggles the manual override of the left menu's automatic expand / collapse behaviour.\n\t */\n\t$('.cms-menu .sticky-toggle').entwine({\n\n\t\tonadd: function () {\n\t\t\tvar isSticky = $('.cms-menu').getPersistedStickyState() ? true : false;\n\n\t\t\tthis.toggleCSS(isSticky);\n\t\t\tthis.toggleIndicator(isSticky);\n\n\t\t\tthis._super();\n\t\t},\n\n\t\t/**\n\t\t * @func toggleCSS\n\t\t * @param {boolean} isSticky - The current state of the menu.\n\t\t * @desc Toggles the 'active' CSS class of the element.\n\t\t */\n\t\ttoggleCSS: function (isSticky) {\n\t\t\tthis[isSticky ? 'addClass' : 'removeClass']('active');\n\t\t},\n\n\t\t/**\n\t\t * @func toggleIndicator\n\t\t * @param {boolean} isSticky - The current state of the menu.\n\t\t * @desc Updates the indicator's text based on the sticky state of the menu.\n\t\t */\n\t\ttoggleIndicator: function (isSticky) {\n\t\t\tthis.next('.sticky-status-indicator').text(isSticky ? 'fixed' : 'auto');\n\t\t},\n\n\t\tonclick: function () {\n\t\t\tvar $menu = this.closest('.cms-menu'),\n\t\t\t\tpersistedCollapsedState = $menu.getPersistedCollapsedState(),\n\t\t\t\tpersistedStickyState = $menu.getPersistedStickyState(),\n\t\t\t\tnewStickyState = persistedStickyState === void 0 ? !this.hasClass('active') : !persistedStickyState;\n\n\t\t\t// Update the persisted collapsed state\n\t\t\tif (persistedCollapsedState === void 0) {\n\t\t\t\t// If there is no persisted menu state currently set, then set it to the menu's current state.\n\t\t\t\t// This will be the case if the user has never manually expanded or collapsed the menu,\n\t\t\t\t// or the menu has previously been made unsticky.\n\t\t\t\t$menu.setPersistedCollapsedState($menu.hasClass('collapsed'));\n\t\t\t} else if (persistedCollapsedState !== void 0 && newStickyState === false) {\n\t\t\t\t// If there is a persisted state and the menu has been made unsticky, remove the persisted state.\n\t\t\t\t$menu.clearPersistedCollapsedState();\n\t\t\t}\n\n\t\t\t// Persist the sticky state of the menu\n\t\t\t$menu.setPersistedStickyState(newStickyState);\n\n\t\t\tthis.toggleCSS(newStickyState);\n\t\t\tthis.toggleIndicator(newStickyState);\n\n\t\t\tthis._super();\n\t\t}\n\t});\n});","import $ from 'jQuery';\n\n$.entwine('ss', function($) {\n\n\t// setup jquery.entwine\n\t$.entwine.warningLevel = $.entwine.WARN_LEVEL_BESTPRACTISE;\n\n\t/**\n\t * Horizontal collapsible panel. Generic enough to work with CMS menu as well as various \"filter\" panels.\n\t * \n\t * A panel consists of the following parts:\n\t * - Container div: The outer element, with class \".cms-panel\"\n\t * - Header (optional)\n\t * - Content\n\t * - Expand and collapse toggle anchors (optional)\n\t * \n\t * Sample HTML:\n\t * <div class=\"cms-panel\">\n\t *  <div class=\"cms-panel-header\">your header</div>\n\t * \t<div class=\"cms-panel-content\">your content here</div>\n\t *\t<div class=\"cms-panel-toggle\">\n\t * \t\t<a href=\"#\" class=\"toggle-expande\">your toggle text</a>\n\t * \t\t<a href=\"#\" class=\"toggle-collapse\">your toggle text</a>\n\t *\t</div>\n\t * </div>\n\t */\n\t$('.cms-panel').entwine({\n\t\t\n\t\tWidthExpanded: null,\n\t\t\n\t\tWidthCollapsed: null,\n\n\t\t/**\n\t\t * @func canSetCookie\n\t\t * @return {boolean}\n\t\t * @desc Before trying to set a cookie, make sure $.cookie and the element's id are both defined.\n\t\t */\n\t\tcanSetCookie: function () {\n\t\t\treturn $.cookie !== void 0 && this.attr('id') !== void 0;\n\t\t},\n\n\t\t/**\n\t\t * @func getPersistedCollapsedState\n\t\t * @return {boolean|undefined} - Returns true if the panel is collapsed, false if expanded. Returns undefined if there is no cookie set.\n\t\t * @desc Get the collapsed state of the panel according to the cookie.\n\t\t */\n\t\tgetPersistedCollapsedState: function () {\n\t\t\tvar isCollapsed, cookieValue;\n\n\t\t\tif (this.canSetCookie()) {\n\t\t\t\tcookieValue = $.cookie('cms-panel-collapsed-' + this.attr('id'));\n\n\t\t\t\tif (cookieValue !== void 0 && cookieValue !== null) {\n\t\t\t\t\tisCollapsed = cookieValue === 'true';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn isCollapsed;\n\t\t},\n\n\t\t/**\n\t\t * @func setPersistedCollapsedState\n\t\t * @param {boolean} newState - Pass true if you want the panel to be collapsed, false for expanded.\n\t\t * @desc Set the collapsed value of the panel, stored in cookies.\n\t\t */\n\t\tsetPersistedCollapsedState: function (newState) {\n\t\t\tif (this.canSetCookie()) {\n\t\t\t\t$.cookie('cms-panel-collapsed-' + this.attr('id'), newState, { path: '/', expires: 31 });\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * @func clearPersistedState\n\t\t * @desc Remove the cookie responsible for maintaing the collapsed state.\n\t\t */\n\t\tclearPersistedCollapsedState: function () {\n\t\t\tif (this.canSetCookie()) {\n\t\t\t\t$.cookie('cms-panel-collapsed-' + this.attr('id'), '', { path: '/', expires: -1 });\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * @func getInitialCollapsedState\n\t\t * @return {boolean} - Returns true if the the panel is collapsed, false if expanded.\n\t\t * @desc Get the initial collapsed state of the panel. Check if a cookie value is set then fall back to checking CSS classes.\n\t\t */\n\t\tgetInitialCollapsedState: function () {\n\t\t\tvar isCollapsed = this.getPersistedCollapsedState();\n\n\t\t\t// Fallback to getting the state from the default CSS class\n\t\t\tif (isCollapsed === void 0) {\n\t\t\t\tisCollapsed = this.hasClass('collapsed');\n\t\t\t}\n\n\t\t\treturn isCollapsed;\n\t\t},\n\n\t\tonadd: function() {\n\t\t\tvar collapsedContent, container;\n\n\t\t\tif(!this.find('.cms-panel-content').length) throw new Exception('Content panel for \".cms-panel\" not found');\n\t\t\t\n\t\t\t// Create default controls unless they already exist.\n\t\t\tif(!this.find('.cms-panel-toggle').length) {\n\t\t\t\tcontainer = $(\"<div class='cms-panel-toggle south'></div>\")\n\t\t\t\t\t.append('<a class=\"toggle-expand\" href=\"#\"><span>&raquo;</span></a>')\n\t\t\t\t\t.append('<a class=\"toggle-collapse\" href=\"#\"><span>&laquo;</span></a>');\n\t\t\t\t\t\n\t\t\t\tthis.append(container);\n\t\t\t}\n\t\t\t\n\t\t\t// Set panel width same as the content panel it contains. Assumes the panel has overflow: hidden.\n\t\t\tthis.setWidthExpanded(this.find('.cms-panel-content').innerWidth());\n\t\t\t\n\t\t\t// Assumes the collapsed width is indicated by the toggle, or by an optionally collapsed view\n\t\t\tcollapsedContent = this.find('.cms-panel-content-collapsed');\n\t\t\tthis.setWidthCollapsed(collapsedContent.length ? collapsedContent.innerWidth() : this.find('.toggle-expand').innerWidth());\n\n\t\t\t// Toggle visibility\n\t\t\tthis.togglePanel(!this.getInitialCollapsedState(), true, false);\n\t\t\t\n\t\t\tthis._super();\n\t\t},\n\n\t\t/**\n\t\t * @func togglePanel\n\t\t * @param doExpand {boolean} - true to expand, false to collapse.\n\t\t * @param silent {boolean} - true means that events won't be fired, which is useful for the component initialization phase.\n\t\t * @param doSaveState - if false, the panel's state will not be persisted via cookies.\n\t\t * @desc Toggle the expanded / collapsed state of the panel.\n\t\t */\n\t\ttogglePanel: function(doExpand, silent, doSaveState) {\n\t\t\tvar newWidth, collapsedContent;\n\n\t\t\tif(!silent) {\n\t\t\t\tthis.trigger('beforetoggle.sspanel', doExpand);\n\t\t\t\tthis.trigger(doExpand ? 'beforeexpand' : 'beforecollapse');\n\t\t\t}\n\n\t\t\tthis.toggleClass('collapsed', !doExpand);\n\t\t\tnewWidth = doExpand ? this.getWidthExpanded() : this.getWidthCollapsed();\n\t\t\t\n\t\t\tthis.width(newWidth); // the content panel width always stays in \"expanded state\" to avoid floating elements\n\t\t\t\n\t\t\t// If an alternative collapsed view exists, toggle it as well\n\t\t\tcollapsedContent = this.find('.cms-panel-content-collapsed');\n\t\t\tif(collapsedContent.length) {\n\t\t\t\tthis.find('.cms-panel-content')[doExpand ? 'show' : 'hide']();\n\t\t\t\tthis.find('.cms-panel-content-collapsed')[doExpand ? 'hide' : 'show']();\n\t\t\t}\n\n\t\t\tif (doSaveState !== false) {\n\t\t\t\tthis.setPersistedCollapsedState(!doExpand);\n\t\t\t}\n\n\t\t\t// TODO Fix redraw order (inner to outer), and re-enable silent flag\n\t\t\t// to avoid multiple expensive redraws on a single load.\n\t\t\t// if(!silent) {\n\t\t\t\tthis.trigger('toggle', doExpand);\n\t\t\t\tthis.trigger(doExpand ? 'expand' : 'collapse');\n\t\t\t// }\n\t\t},\n\t\t\n\t\texpandPanel: function(force) {\n\t\t\tif(!force && !this.hasClass('collapsed')) return;\n\n\t\t\tthis.togglePanel(true);\n\t\t},\n\t\t\n\t\tcollapsePanel: function(force) {\n\t\t\tif(!force && this.hasClass('collapsed')) return;\n\n\t\t\tthis.togglePanel(false);\n\t\t}\n\t});\n\n\t$('.cms-panel.collapsed .cms-panel-toggle').entwine({\n\t\tonclick: function(e) {\n\t\t\tthis.expandPanel();\n\t\t\te.preventDefault();\n\t\t}\n\t});\n\t\n\t$('.cms-panel *').entwine({\n\t\tgetPanel: function() {\n\t\t\treturn this.parents('.cms-panel:first');\n\t\t}\n\t});\n\t\t\t\n\t$('.cms-panel .toggle-expand').entwine({\n\t\tonclick: function(e) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\n\t\t\tthis.getPanel().expandPanel();\n\n\t\t\tthis._super(e);\n\t\t}\n\t});\n\t\n\t$('.cms-panel .toggle-collapse').entwine({\n\t\tonclick: function(e) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\n\t\t\tthis.getPanel().collapsePanel();\n\n\t\t\tthis._super(e);\n\t\t}\n\t});\n\n\t$('.cms-content-tools.collapsed').entwine({\n\t\t// Expand CMS' centre pane, when the pane itself is clicked somewhere\n\t\tonclick: function(e) {\n\t\t\tthis.expandPanel();\n\t\t\tthis._super(e);\n\t\t}\n\t});\n});\n","import $ from 'jQuery';\nimport i18n from 'i18n';\n\n$.entwine('ss.preview', function($){\n\n\t/**\n\t * Shows a previewable website state alongside its editable version in backend UI.\n\t *\n\t * Relies on the server responses to indicate if a preview is available for the \n\t * currently loaded admin interface - signified by class \".cms-previewable\" being present.\n\t *\n\t * The preview options at the bottom are constructured by grabbing a SilverStripeNavigator \n\t * structure also provided by the backend.\n\t */\n\t$('.cms-preview').entwine({\n\n\t\t/**\n\t\t * List of SilverStripeNavigator states (SilverStripeNavigatorItem classes) to search for.\n\t\t * The order is significant - if the state is not available, preview will start searching the list\n\t\t * from the beginning.\n\t\t */\n\t\tAllowedStates: ['StageLink', 'LiveLink','ArchiveLink'],\n\n\t\t/**\n\t\t * API\n\t\t * Name of the current preview state - one of the \"AllowedStates\".\n\t\t */\n\t\tCurrentStateName: null,\n\n\t\t/**\n\t\t * API\n\t\t * Current size selection.\n\t\t */\n\t\tCurrentSizeName: 'auto',\n\n\t\t/**\n\t\t * Flags whether the preview is available on this CMS section.\n\t\t */\n\t\tIsPreviewEnabled: false,\n\n\t\t/**\n\t\t * Mode in which the preview will be enabled.\n\t\t */\n\t\tDefaultMode: 'split',\n\n\t\tSizes: {\n\t\t\tauto: {\n\t\t\t\twidth: '100%',\n\t\t\t\theight: '100%'\n\t\t\t},\n\t\t\tmobile: {\n\t\t\t\twidth: '335px', // add 15px for approx desktop scrollbar \n\t\t\t\theight: '568px' \n\t\t\t},\n\t\t\tmobileLandscape: {\n\t\t\t\twidth: '583px', // add 15px for approx desktop scrollbar\n\t\t\t\theight: '320px'\n\t\t\t},\n\t\t\ttablet: {\n\t\t\t\twidth: '783px', // add 15px for approx desktop scrollbar\n\t\t\t\theight: '1024px'\n\t\t\t},\n\t\t\ttabletLandscape: {\n\t\t\t\twidth: '1039px', // add 15px for approx desktop scrollbar\n\t\t\t\theight: '768px'\n\t\t\t},\n\t\t\tdesktop: {\n\t\t\t\twidth: '1024px',\n\t\t\t\theight: '800px'\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * API\n\t\t * Switch the preview to different state.\n\t\t * stateName can be one of the \"AllowedStates\".\n\t\t *\n\t\t * @param {String}\n\t\t * @param {Boolean} Set to FALSE to avoid persisting the state\n\t\t */\n\t\tchangeState: function(stateName, save) {\t\t\t\t\n\t\t\tvar self = this, states = this._getNavigatorStates();\n\t\t\tif(save !== false) {\n\t\t\t\t$.each(states, function(index, state) {\n\t\t\t\t\tself.saveState('state', stateName);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.setCurrentStateName(stateName);\n\t\t\tthis._loadCurrentState();\n\t\t\tthis.redraw();\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * API\n\t\t * Change the preview mode.\n\t\t * modeName can be: split, content, preview.\n\t\t */\n\t\tchangeMode: function(modeName, save) {\t\t\t\t\n\t\t\tvar container = $('.cms-container');\n\n\t\t\tif (modeName == 'split') {\n\t\t\t\tcontainer.entwine('.ss').splitViewMode();\n\t\t\t\tthis.setIsPreviewEnabled(true);\n\t\t\t\tthis._loadCurrentState();\n\t\t\t} else if (modeName == 'content') {\n\t\t\t\tcontainer.entwine('.ss').contentViewMode();\n\t\t\t\tthis.setIsPreviewEnabled(false);\n\t\t\t\t// Do not load content as the preview is not visible.\n\t\t\t} else if (modeName == 'preview') {\n\t\t\t\tcontainer.entwine('.ss').previewMode();\n\t\t\t\tthis.setIsPreviewEnabled(true);\n\t\t\t\tthis._loadCurrentState();\n\t\t\t} else {\n\t\t\t\tthrow 'Invalid mode: ' + modeName;\n\t\t\t}\n\n\t\t\tif(save !== false) this.saveState('mode', modeName);\n\n\t\t\tthis.redraw();\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * API\n\t\t * Change the preview size.\n\t\t * sizeName can be: auto, desktop, tablet, mobile.\n\t\t */\n\t\tchangeSize: function(sizeName) {\n\t\t\tvar sizes = this.getSizes();\n\n\t\t\tthis.setCurrentSizeName(sizeName);\n\t\t\tthis.removeClass('auto desktop tablet mobile').addClass(sizeName);\n\t\t\tthis.find('.preview-device-outer')\n\t\t\t\t.width(sizes[sizeName].width)\n\t\t\t\t.height(sizes[sizeName].height);\n\t\t\tthis.find('.preview-device-inner')\n\t\t\t\t.width(sizes[sizeName].width);\n\n\t\t\tthis.saveState('size', sizeName);\n\n\t\t\tthis.redraw();\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * API\n\t\t * Update the visual appearance to match the internal preview state.\n\t\t */\n\t\tredraw: function() {\t\t\t\n\n\t\t\tif(window.debug) console.log('redraw', this.attr('class'), this.get(0));\n\n\t\t\t// Update preview state selector.\n\t\t\tvar currentStateName = this.getCurrentStateName();\n\t\t\tif (currentStateName) {\n\t\t\t\tthis.find('.cms-preview-states').changeVisibleState(currentStateName);\n\t\t\t}\n\n\t\t\t// Update preview mode selectors.\n\t\t\tvar layoutOptions = $('.cms-container').entwine('.ss').getLayoutOptions();\n\t\t\tif (layoutOptions) {\n\t\t\t\t// There are two mode selectors that we need to keep in sync. Redraw both.\n\t\t\t\t$('.preview-mode-selector').changeVisibleMode(layoutOptions.mode);\n\t\t\t}\n\n\t\t\t// Update preview size selector.\n\t\t\tvar currentSizeName = this.getCurrentSizeName();\n\t\t\tif (currentSizeName) {\n\t\t\t\tthis.find('.preview-size-selector').changeVisibleSize(this.getCurrentSizeName());\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Store the preview options for this page.\n\t\t */\n\t\tsaveState : function(name, value) {\n\t\t\tif(this._supportsLocalStorage()) window.localStorage.setItem('cms-preview-state-' + name, value);\n\t\t},\n\n\t\t/**\n\t\t * Load previously stored preferences\n\t\t */\n\t\tloadState : function(name) {\n\t\t\tif(this._supportsLocalStorage()) return window.localStorage.getItem('cms-preview-state-' + name);\n\t\t}, \n\n\t\t/**\n\t\t * Disable the area - it will not appear in the GUI.\n\t\t * Caveat: the preview will be automatically enabled when \".cms-previewable\" class is detected.\n\t\t */\n\t\tdisablePreview: function() {\n\t\t\tthis.setPendingURL(null);\n\t\t\tthis._loadUrl('about:blank');\n\t\t\tthis._block();\n\t\t\tthis.changeMode('content', false);\n\t\t\tthis.setIsPreviewEnabled(false);\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Enable the area and start updating to reflect the content editing.\n\t\t */\n\t\tenablePreview: function() {\n\t\t\tif (!this.getIsPreviewEnabled()) {\n\t\t\t\tthis.setIsPreviewEnabled(true);\n\n\t\t\t\t// Initialise mode.\n\t\t\t\tif ($.browser.msie && $.browser.version.slice(0,3)<=7) {\n\t\t\t\t\t// We do not support the split mode in IE < 8.\n\t\t\t\t\tthis.changeMode('content');\n\t\t\t\t} else {\n\t\t\t\t\tthis.changeMode(this.getDefaultMode(), false);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Return a style element we can use in IE8 to fix fonts (see readystatechange binding in onadd below)\n\t\t */\n\t\tgetOrAppendFontFixStyleElement: function() {\n\t\t\tvar style = $('#FontFixStyleElement');\n\t\t\tif (!style.length) {\n\t\t\t\tstyle = $(\n\t\t\t\t\t'<style type=\"text/css\" id=\"FontFixStyleElement\" disabled=\"disabled\">'+\n\t\t\t\t\t\t':before,:after{content:none !important}'+\n\t\t\t\t\t'</style>'\n\t\t\t\t).appendTo('head');\n\t\t\t}\n\n\t\t\treturn style;\n\t\t},\n\n\t\t/**\n\t\t * Initialise the preview element.\n\t\t */\n\t\tonadd: function() {\n\t\t\tvar self = this, layoutContainer = this.parent(), iframe = this.find('iframe');\n\n\t\t\t// Create layout and controls\n\t\t\tiframe.addClass('center');\n\t\t\tiframe.bind('load', function() {\n\t\t\t\tself._adjustIframeForPreview();\n\n\t\t\t\t// Load edit view for new page, but only if the preview is activated at the moment.\n\t\t\t\t// This avoids e.g. force-redirections of the edit view on RedirectorPage instances.\n\t\t\t\tself._loadCurrentPage();\n\t\t\t\t\n\t\t\t\t$(this).removeClass('loading');\n\t\t\t});\n\n\t\t\t// If there's any webfonts in the preview, IE8 will start glitching. This fixes that.\n\t\t\tif ($.browser.msie && 8 === parseInt($.browser.version, 10)) {\n\t\t\t\tiframe.bind('readystatechange', function(e) {\n\t\t\t\t\tif(iframe[0].readyState == 'interactive') {\n\t\t\t\t\t\tself.getOrAppendFontFixStyleElement().removeAttr('disabled');\n\t\t\t\t\t\tsetTimeout(function(){ self.getOrAppendFontFixStyleElement().attr('disabled', 'disabled'); }, 0);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Preview might not be available in all admin interfaces - block/disable when necessary\n\t\t\tthis.append('<div class=\"cms-preview-overlay ui-widget-overlay-light\"></div>');\n\t\t\tthis.find('.cms-preview-overlay').hide();\t\t\t\n\n\t\t\tthis.disablePreview();\n\n\t\t\tthis._super();\n\t\t},\n\t\t\n\t\t/**\n\t\t* Detect and use localStorage if available. In IE11 windows 8.1 call to window.localStorage was throwing out an access denied error in some cases which was causing the preview window not to display correctly in the CMS admin area.\n\t\t*/\n\t\t_supportsLocalStorage: function() {\n\t\t\tvar uid = new Date;\n\t\t\tvar storage;\n\t\t\tvar result;\n\t\t\ttry {\n\t\t\t\t(storage = window.localStorage).setItem(uid, uid);\n\t\t\t\tresult = storage.getItem(uid) == uid;\n\t\t\t\tstorage.removeItem(uid);\n\t\t\t\treturn result && storage;\n\t\t\t} catch (exception) {\n\t\t\t\tconsole.warn('localStorge is not available due to current browser / system settings.');\n\t\t\t}\n\t\t},\n\n\t\tonenable: function () {\n\t\t\tvar $viewModeSelector = $('.preview-mode-selector');\n\n\t\t\t$viewModeSelector.removeClass('split-disabled');\n\t\t\t$viewModeSelector.find('.disabled-tooltip').hide();\n\t\t},\n\n\t\tondisable: function () {\n\t\t\tvar $viewModeSelector = $('.preview-mode-selector');\n\n\t\t\t$viewModeSelector.addClass('split-disabled');\n\t\t\t$viewModeSelector.find('.disabled-tooltip').show();\n\t\t},\n\n\t\t/**\n\t\t * Set the preview to unavailable - could be still visible. This is purely visual.\n\t\t */\n\t\t_block: function() {\n\t\t\tthis.addClass('blocked');\n\t\t\tthis.find('.cms-preview-overlay').show();\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Set the preview to available (remove the overlay);\n\t\t */\n\t\t_unblock: function() {\n\t\t\tthis.removeClass('blocked');\n\t\t\tthis.find('.cms-preview-overlay').hide();\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Update the preview according to browser and CMS section capabilities.\n\t\t */\n\t\t_initialiseFromContent: function() {\n\t\t\tvar mode, size;\n\n\t\t\tif (!$('.cms-previewable').length) {\n\t\t\t\tthis.disablePreview();\n\t\t\t} else {\n\t\t\t\tmode = this.loadState('mode');\n\t\t\t\tsize = this.loadState('size');\n\n\t\t\t\tthis._moveNavigator();\n\t\t\t\tif(!mode || mode != 'content') {\n\t\t\t\t\tthis.enablePreview();\n\t\t\t\t\tthis._loadCurrentState();\n\t\t\t\t}\n\t\t\t\tthis.redraw();\n\n\t\t\t\t// now check the cookie to see if we have any preview settings that have been\n\t\t\t\t// retained for this page from the last visit\n\t\t\t\tif(mode) this.changeMode(mode);\n\t\t\t\tif(size) this.changeSize(size);\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Update preview whenever any panels are reloaded.\n\t\t */\n\t\t'from .cms-container': {\n\t\t\tonafterstatechange: function(e, data) {\n\t\t\t\t// Don't update preview if we're dealing with a custom redirect\n\t\t\t\tif(data.xhr.getResponseHeader('X-ControllerURL')) return;\n\n\t\t\t\tthis._initialiseFromContent();\n\t\t\t}\n\t\t},\n\n\t\t/** @var string A URL that should be displayed in this preview panel once it becomes visible */\n\t\tPendingURL: null,\n\n\t\toncolumnvisibilitychanged: function() {\n\t\t\tvar url = this.getPendingURL();\n\t\t\tif (url && !this.is('.column-hidden')) {\n\t\t\t\tthis.setPendingURL(null);\n\t\t\t\tthis._loadUrl(url);\n\t\t\t\tthis._unblock();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Update preview whenever a form is submitted.\n\t\t * This is an alternative to the LeftAndmMain::loadPanel functionality which we already\n\t\t * cover in the onafterstatechange handler.\n\t\t */\n\t\t'from .cms-container .cms-edit-form': {\n\t\t\tonaftersubmitform: function(){\n\t\t\t\tthis._initialiseFromContent();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Change the URL of the preview iframe (if its not already displayed).\n\t\t */\n\t\t_loadUrl: function(url) {\n\t\t\tthis.find('iframe').addClass('loading').attr('src', url);\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Fetch available states from the current SilverStripeNavigator (SilverStripeNavigatorItems).\n\t\t * Navigator is supplied by the backend and contains all state options for the current object.\n\t\t */\n\t\t_getNavigatorStates: function() {\n\t\t\t// Walk through available states and get the URLs.\n\t\t\tvar urlMap = $.map(this.getAllowedStates(), function(name) {\n\t\t\t\tvar stateLink = $('.cms-preview-states .state-name[data-name=' + name + ']');\n\t\t\t\tif(stateLink.length) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: name, \n\t\t\t\t\t\turl: stateLink.attr('data-link'),\n\t\t\t\t\t\tactive: stateLink.is(':radio') ? stateLink.is(':checked') : stateLink.is(':selected')\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn urlMap;\n\t\t},\n\n\t\t/**\n\t\t * Load current state into the preview (e.g. StageLink or LiveLink).\n\t\t * We try to reuse the state we have been previously in. Otherwise we fall back\n\t\t * to the first state available on the \"AllowedStates\" list.\n\t\t *\n\t\t * @returns New state name.\n\t\t */\n\t\t_loadCurrentState: function() {\n\t\t\tif (!this.getIsPreviewEnabled()) return this;\n\n\t\t\tvar states = this._getNavigatorStates();\n\t\t\tvar currentStateName = this.getCurrentStateName();\n\t\t\tvar currentState = null;\n\n\t\t\t// Find current state within currently available states.\n\t\t\tif (states) {\n\t\t\t\tcurrentState = $.grep(states, function(state, index) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tcurrentStateName === state.name ||\n\t\t\t\t\t\t(!currentStateName && state.active)\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar url = null;\n\n\t\t\tif (currentState[0]) {\n\t\t\t\t// State is available on the newly loaded content. Get it.\n\t\t\t\turl = currentState[0].url;\n\t\t\t} else if (states.length) {\n\t\t\t\t// Fall back to the first available content state.\n\t\t\t\tthis.setCurrentStateName(states[0].name);\n\t\t\t\turl = states[0].url;\n\t\t\t} else {\n\t\t\t\t// No state available at all.\n\t\t\t\tthis.setCurrentStateName(null);\n\t\t\t}\n\n\t\t\t// Mark url as a preview url so it can get special treatment\n \t\t\turl += ((url.indexOf('?') === -1) ? '?' : '&') + 'CMSPreview=1';\n\n\t\t\t// If this preview panel isn't visible at the moment, delay loading the URL until it (maybe) is later\n\t\t\tif (this.is('.column-hidden')) {\n\t\t\t\tthis.setPendingURL(url);\n\t\t\t\tthis._loadUrl('about:blank');\n\t\t\t\tthis._block();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.setPendingURL(null);\n\n\t\t\t\tif (url) {\n\t\t\t\t\tthis._loadUrl(url);\n\t\t\t\t\tthis._unblock();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis._block();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Move the navigator from the content to the preview bar.\n\t\t */\n\t\t_moveNavigator: function() {\n\t\t\tvar previewEl = $('.cms-preview .cms-preview-controls');\n\t\t\tvar navigatorEl = $('.cms-edit-form .cms-navigator');\n\n\t\t\tif (navigatorEl.length && previewEl.length) {\n\t\t\t\t// Navigator is available - install the navigator.\n\t\t\t\tpreviewEl.html($('.cms-edit-form .cms-navigator').detach());\n\t\t\t} else {\n\t\t\t\t// Navigator not available.\n\t\t\t\tthis._block();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Loads the matching edit form for a page viewed in the preview iframe,\n\t\t * based on metadata sent along with this document.\n\t\t */\n\t\t_loadCurrentPage: function() {\n\t\t\tif (!this.getIsPreviewEnabled()) return;\n\n      var doc,\n        containerEl = $('.cms-container');\n      try {\n        doc = this.find('iframe')[0].contentDocument;\n      } catch (e) {\n        // iframe can't be accessed - might be secure?\n        console.warn('Unable to access iframe, possible https mis-match');\n      }\n      if (!doc) {\n        return;\n      }\n\n\t\t\t// Load this page in the admin interface if appropriate\n\t\t\tvar id = $(doc).find('meta[name=x-page-id]').attr('content'); \n\t\t\tvar editLink = $(doc).find('meta[name=x-cms-edit-link]').attr('content');\n\t\t\tvar contentPanel = $('.cms-content');\n\t\t\t\n\t\t\tif(id && contentPanel.find(':input[name=ID]').val() != id) {\n\t\t\t\t// Ignore behaviour without history support (as we need ajax loading \n\t\t\t\t// for the new form to load in the background)\n\t\t\t\t$('.cms-container').entwine('.ss').loadPanel(editLink);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Prepare the iframe content for preview.\n\t\t */\n\t\t_adjustIframeForPreview: function() {\n      var iframe = this.find('iframe')[0],\n        doc;\n      if(!iframe){\n        return;\n      }\n\n      try {\n        doc = iframe.contentDocument;\n      } catch (e) {\n        // iframe can't be accessed - might be secure?\n        console.warn('Unable to access iframe, possible https mis-match');\n      }\n      if(!doc) {\n        return;\n      }\n\n\t\t\t// Open external links in new window to avoid \"escaping\" the internal page context in the preview\n\t\t\t// iframe, which is important to stay in for the CMS logic.\n\t\t\tvar links = doc.getElementsByTagName('A');\n\t\t\tfor (var i = 0; i < links.length; i++) {\n\t\t\t\tvar href = links[i].getAttribute('href');\n\t\t\t\tif(!href) continue;\n\t\t\t\t\n\t\t\t\tif (href.match(/^http:\\/\\//)) links[i].setAttribute('target', '_blank');\n\t\t\t}\n\n\t\t\t// Hide the navigator from the preview iframe and use only the CMS one.\n\t\t\tvar navi = doc.getElementById('SilverStripeNavigator');\n\t\t\tif(navi) navi.style.display = 'none';\n\t\t\tvar naviMsg = doc.getElementById('SilverStripeNavigatorMessage');\n\t\t\tif(naviMsg) naviMsg.style.display = 'none';\n\n\t\t\t// Trigger extensions.\n\t\t\tthis.trigger('afterIframeAdjustedForPreview', [ doc ]);\n\t\t}\n\t});\n\n\t$('.cms-edit-form').entwine({\n\t\tonadd: function() {\n\t\t\tthis._super();\n\t\t\t$('.cms-preview')._initialiseFromContent();\n\t\t}\n\t});\n\t\n\t/**\n\t * \"Preview state\" functions.\n\t * -------------------------------------------------------------------\n\t */\n\t$('.cms-preview-states').entwine({\n\t\t/**\n\t\t * Change the appearance of the state selector.\n\t\t */\n\t\tchangeVisibleState: function(state) {\n\t\t\tthis.find('input[data-name=\"'+state+'\"]').prop('checked', true);\n\t\t}\n\t});\n\n\t$('.cms-preview-states .state-name').entwine({\n\t\t/**\n\t\t * Reacts to the user changing the state of the preview.\n\t\t */\n\t\tonclick: function(e) {\t\n\t\t\t//Add and remove classes to make switch work ok in old IE\n\t\t\tthis.parent().find('.active').removeClass('active');\n\t\t\tthis.next('label').addClass('active');\n\n\t\t\tvar targetStateName = $(this).attr('data-name');\n\t\t\t// Reload preview with the selected state.\n\t\t\t$('.cms-preview').changeState(targetStateName);\t\t\t\t\n\t\t}\n\t});\t\n\t\n\t/**\n\t * \"Preview mode\" functions\n\t * -------------------------------------------------------------------\n\t */\n\t$('.preview-mode-selector').entwine({\n\t\t/**\n\t\t * Change the appearance of the mode selector.\n\t\t */\n\t\tchangeVisibleMode: function(mode) {\n\t\t\tthis.find('select')\n\t\t\t\t.val(mode)\n\t\t\t\t.trigger('liszt:updated')\n\t\t\t\t._addIcon();\n\t\t}\n\t});\n\n\t$('.preview-mode-selector select').entwine({\n\t\t/**\n\t\t * Reacts to the user changing the preview mode.\n\t\t */\n\t\tonchange: function(e) {\t\t\t\t\n\t\t\tthis._super(e);\n\t\t\te.preventDefault();\n\n\t\t\tvar targetStateName = $(this).val();\n\t\t\t$('.cms-preview').changeMode(targetStateName);\n\t\t}\n\t});\n\n\t\n\t$('.preview-mode-selector .chzn-results li').entwine({\n\t\t/**\n\t\t *  IE8 doesn't support programatic access to onchange event \n\t\t *\tso react on click\n\t\t */\n\t\tonclick:function(e){\n\t\t\tif ($.browser.msie) {\n\t\t\t\te.preventDefault();\t\t\t\t\t\n\t\t\t\tvar index = this.index();\n\t\t\t\tvar targetStateName = this.closest('.preview-mode-selector').find('select option:eq('+index+')').val();\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t//var targetStateName = $(this).val();\n\t\t\t\t$('.cms-preview').changeMode(targetStateName);\n\t\t\t}\n\t\t}\n\t});\n\t\n\t/**\n\t * Adjust the visibility of the preview-mode selector in the CMS part (hidden if preview is visible).\n\t */\n\t$('.cms-preview.column-hidden').entwine({\n\t\tonmatch: function() {\n\t\t\t$('#preview-mode-dropdown-in-content').show();\n\t\t\t// Alert the user as to why the preview is hidden\n\t\t\tif ($('.cms-preview .result-selected').hasClass('font-icon-columns')) {\n\t\t\t\tstatusMessage(i18n._t(\n\t\t\t\t\t'LeftAndMain.DISABLESPLITVIEW',\n\t\t\t\t\t\"Screen too small to show site preview in split mode\"),\n\t\t\t\t\"error\");\n\t\t\t}\n\t\t\tthis._super();\n\t\t},\n\n\t\tonunmatch: function() {\n\t\t\t$('#preview-mode-dropdown-in-content').hide();\n\t\t\tthis._super();\n\t\t}\n\t});\n\n\t/**\n\t * Initialise the preview-mode selector in the CMS part (could be hidden if preview is visible).\n\t */\n\t$('#preview-mode-dropdown-in-content').entwine({\n\t\tonmatch: function() {\n\t\t\tif ($('.cms-preview').is('.column-hidden')) {\n\t\t\t\tthis.show();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t\tthis._super();\n\t\t},\n\t\tonunmatch: function() {\n\t\t\tthis._super();\n\t\t}\n\t});\n\n\t/**\n\t * \"Preview size\" functions\n\t * -------------------------------------------------------------------\n\t */\n\t$('.preview-size-selector').entwine({\n\t\t/**\n\t\t * Change the appearance of the size selector.\n\t\t */\n\t\tchangeVisibleSize: function(size) {\t\t\t\t\n\t\t\tthis.find('select')\n\t\t\t\t.val(size)\n\t\t\t\t.trigger('liszt:updated')\n\t\t\t\t._addIcon();\n\t\t}\n\t});\n\n\t$('.preview-size-selector select').entwine({\n\t\t/**\n\t\t * Trigger change in the preview size.\n\t\t */\n\t\tonchange: function(e) {\n\t\t\te.preventDefault();\n\n\t\t\tvar targetSizeName = $(this).val();\n\t\t\t$('.cms-preview').changeSize(targetSizeName);\n\t\t}\n\t});\n\n\t\n\t/**\n\t * \"Chosen\" plumbing.\n\t * -------------------------------------------------------------------\n\t */\n\n\t/*\n\t*\tAdd a class to the chzn select trigger based on the currently \n\t*\tselected option. Update as this changes\n\t*/\n\t$('.preview-selector select.preview-dropdown').entwine({\n\t\t'onliszt:showing_dropdown': function() {\n\t\t\tthis.siblings().find('.chzn-drop').addClass('open')._alignRight();\n\t\t},\n\n\t\t'onliszt:hiding_dropdown': function() {\n\t\t\tthis.siblings().find('.chzn-drop').removeClass('open')._removeRightAlign();\n\t\t},\n\n\t\t/**\n\t\t * Trigger additional initial icon update when the control is fully loaded.\n\t\t * Solves an IE8 timing issue.\n\t\t */\n\t\t'onliszt:ready': function() {\n\t\t\tthis._super();\n\t\t\tthis._addIcon();\n\t\t},\n\n\t\t_addIcon: function(){\n\t\t\tvar selected = this.find(':selected');\t\t\t\t\n\t\t\tvar iconClass = selected.attr('data-icon');\t\n\t\t\t\t\t\t\t\n\t\t\tvar target = this.parent().find('.chzn-container a.chzn-single');\n\t\t\tvar oldIcon = target.attr('data-icon');\n\t\t\tif(typeof oldIcon !== 'undefined'){\n\t\t\t\ttarget.removeClass(oldIcon);\n\t\t\t}\n\t\t\ttarget.addClass(iconClass);\n\t\t\ttarget.attr('data-icon', iconClass);\t\t\t\t\n\n\t\t\treturn this;\n\t\t}\n\t});\n\n\t$('.preview-selector .chzn-drop').entwine({\n\t\t_alignRight: function(){\n\t\t\tvar that = this;\n\t\t\t$(this).hide();\n\t\t\t/* Delay so styles applied after chosen applies css\t\n\t\t\t   (the line after we find out the dropdown is open)\n\t\t\t*/\n\t\t\tsetTimeout(function(){ \n\t\t\t\t$(that).css({left:'auto', right:0});\n\t\t\t\t$(that).show();\t\n\t\t\t}, 100);\t\t\t\t\t\t\t\n\t\t},\n\t\t_removeRightAlign:function(){\n\t\t\t$(this).css({right:'auto'});\n\t\t}\n\n\t});\n\n\t/* \n\t* Means of having extra styled data in chzn 'preview-selector' selects \n\t* When chzn ul is ready, grab data-description from original select. \n\t* If it exists, append to option and add description class to list item\n\t*/\n\t/*\n\n\tCurrently buggy (adds dexcription, then re-renders). This may need to \n\tbe done inside chosen. Chosen recommends to do this stuff in the css, \n\tbut that option is inaccessible and untranslatable \n\t(https://github.com/harvesthq/chosen/issues/399)\n\n\t$('.preview-selector .chzn-drop ul').entwine({\n\t\tonmatch: function() {\n\t\t\tthis.extraData();\n\t\t\tthis._super();\n\t\t},\n\t\tonunmatch: function() {\n\t\t\tthis._super();\n\t\t},\n\t\textraData: function(){\n\t\t\tvar that = this;\n\t\t\tvar options = this.closest('.preview-selector').find('select option');\t\n\t\t\t\t\n\t\t\t$.each(options, function(index, option){\n\t\t\t\tvar target = $(that).find(\"li:eq(\" + index + \")\");\n\t\t\t\tvar description = $(option).attr('data-description');\n\t\t\t\tif(description != undefined && !$(target).hasClass('description')){\n\t\t\t\t\t$(target).append('<span>' + description + '</span>');\n\t\t\t\t\t$(target).addClass('description');\t\t\t\t\t\t\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}); */\n\n\t$('.preview-mode-selector .chzn-drop li:last-child').entwine({\n\t\tonmatch: function () {\n\t\t\tif ($('.preview-mode-selector').hasClass('split-disabled')) {\n\t\t\t\tthis.parent().append('<div class=\"disabled-tooltip\"></div>');\n\t\t\t} else {\n\t\t\t\tthis.parent().append('<div class=\"disabled-tooltip\" style=\"display: none;\"></div>');\n\t\t\t}\n\t\t}\n\t});\n\n\t/**\n\t * Recalculate the preview space to allow for horizontal scrollbar and the preview actions panel\n\t */\n\t$('.preview-scroll').entwine({\n\t\t/**\n\t\t * Height of the preview actions panel\n\t\t */\n\t\tToolbarSize: 53,\n\n\t\t_redraw: function() {\n\t\t\tvar toolbarSize = this.getToolbarSize();\n\n\t\t\tif(window.debug) console.log('redraw', this.attr('class'), this.get(0));\n\t\t\tvar previewHeight = (this.height() - toolbarSize);\n\t\t\tthis.height(previewHeight);\n\t\t}, \n\n\t\tonmatch: function() {\n\t\t\tthis._redraw();\n\t\t\tthis._super();\n\t\t},\n\n\t\tonunmatch: function() {\n\t\t\tthis._super();\n\t\t}\n\t\t// TODO: Need to recalculate on resize of browser\n\n\t});\n\n\t/**\n\t * Rotate preview to landscape\n\t */\n\t$('.preview-device-outer').entwine({\n\t\tonclick: function () {\n\t\t\tthis.toggleClass('rotate');\n\t\t}\n\t});\n});\n","/**\n * File: LeftAndMain.Tree.js\n */\n\nimport $ from 'jQuery';\n\n$.entwine('ss.tree', function($){\n\n\t$('.cms-tree').entwine({\n\t\t\n\t\tHints: null,\n\n\t\tIsUpdatingTree: false,\n\n\t\tIsLoaded: false,\n\n\t\tonadd: function(){\n\t\t\tthis._super();\n\n\t\t\t// Don't reapply (expensive) tree behaviour if already present\n\t\t\tif($.isNumeric(this.data('jstree_instance_id'))) return;\n\t\t\t\n\t\t\tvar hints = this.attr('data-hints');\n\t\t\tif(hints) this.setHints($.parseJSON(hints));\n\t\t\t\n\t\t\t/**\n\t\t\t * @todo Icon and page type hover support\n\t\t\t * @todo Sorting of sub nodes (originally placed in context menu)\n\t\t\t * @todo Automatic load of full subtree via ajax on node checkbox selection (minNodeCount = 0)\n\t\t\t *  to avoid doing partial selection with \"hidden nodes\" (unloaded markup)\n\t\t\t * @todo Disallow drag'n'drop when node has \"noChildren\" set (see siteTreeHints)\n\t\t\t * @todo Disallow moving of pages marked as deleted \n\t\t\t *  most likely by server response codes rather than clientside\n\t\t\t * @todo \"defaultChild\" when creating a page (sitetreeHints)\n\t\t\t * @todo Duplicate page (originally located in context menu)\n\t\t\t * @todo Update tree node title information and modified state after reordering (response is a JSON array)\n\t\t\t * \n\t\t\t * Tasks most likely not required after moving to a standalone tree:\n\t\t\t * \n\t\t\t * @todo Context menu - to be replaced by a bezel UI\n\t\t\t * @todo Refresh form for selected tree node if affected by reordering (new parent relationship)\n\t\t\t * @todo Cancel current form load via ajax when new load is requested (synchronous loading)\n\t\t\t */\n\t\t\tvar self = this;\n\t\t\t\tthis\n\t\t\t\t\t.jstree(this.getTreeConfig())\n\t\t\t\t\t.bind('loaded.jstree', function(e, data) {\n\t\t\t\t\t\tself.setIsLoaded(true);\n\n\t\t\t\t\t\t// Add ajax settings after init period to avoid unnecessary initial ajax load\n\t\t\t\t\t\t// of existing tree in DOM - see load_node_html()\n\t\t\t\t\t\tdata.inst._set_settings({'html_data': {'ajax': {\n\t\t\t\t\t\t\t'url': self.data('urlTree'),\n\t\t\t\t\t\t\t'data': function(node) {\n\t\t\t\t\t\t\t\tvar params = self.data('searchparams') || [];\n\t\t\t\t\t\t\t\t// Avoid duplication of parameters\n\t\t\t\t\t\t\t\tparams = $.grep(params, function(n, i) {return (n.name != 'ID' && n.name != 'value');});\n\t\t\t\t\t\t\t\tparams.push({name: 'ID', value: $(node).data(\"id\") ? $(node).data(\"id\") : 0});\n\t\t\t\t\t\t\t\tparams.push({name: 'ajax', value: 1});\n\t\t\t\t\t\t\t\treturn params;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}});\n\n\t\t\t\t\t\tself.updateFromEditForm();\n\t\t\t\t\t\tself.css('visibility', 'visible');\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Only show checkboxes with .multiple class\n\t\t\t\t\t\tdata.inst.hide_checkboxes();\n\t\t\t\t\t})\n\t\t\t\t\t.bind('before.jstree', function(e, data) {\n\t\t\t\t\t\tif(data.func == 'start_drag') {\n\t\t\t\t\t\t\t// Don't allow drag'n'drop if multi-select is enabled'\n\t\t\t\t\t\t\tif(!self.hasClass('draggable') || self.hasClass('multiselect')) {\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif($.inArray(data.func, ['check_node', 'uncheck_node'])) {\n\t\t\t\t\t\t\t// don't allow check and uncheck if parent is disabled\n\t\t\t\t\t\t\tvar node = $(data.args[0]).parents('li:first');\n\t\t\t\t\t\t\tvar allowedChildren = node.find('li:not(.disabled)');\n\n\t\t\t\t\t\t\t// if there are child nodes that aren't disabled, allow expanding the tree\n\t\t\t\t\t\t\tif(node.hasClass('disabled') && allowedChildren == 0) {\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.bind('move_node.jstree', function(e, data) {\n\t\t\t\t\t\tif(self.getIsUpdatingTree()) return;\n\n\t\t\t\t\t\tvar movedNode = data.rslt.o, newParentNode = data.rslt.np, oldParentNode = data.inst._get_parent(movedNode), newParentID = $(newParentNode).data('id') || 0, nodeID = $(movedNode).data('id');\n\t\t\t\t\t\tvar siblingIDs = $.map($(movedNode).siblings().andSelf(), function(el) {\n\t\t\t\t\t\t\treturn $(el).data('id');\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t'url': self.data('urlSavetreenode'),\n\t\t\t\t\t\t\t'type': 'POST',\n\t\t\t\t\t\t\t'data': {\n\t\t\t\t\t\t\t\tID: nodeID, \n\t\t\t\t\t\t\t\tParentID: newParentID,\n\t\t\t\t\t\t\t\tSiblingIDs: siblingIDs\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsuccess: function() {\n\t\t\t\t\t\t\t\t// We only need to update the ParentID if the current page we're on is the page being moved\n\t\t\t\t\t\t\t\tif ($('.cms-edit-form :input[name=ID]').val() == nodeID) {\n\t\t\t\t\t\t\t\t\t$('.cms-edit-form :input[name=ParentID]').val(newParentID);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tself.updateNodesFromServer([nodeID]);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tstatusCode: {\n\t\t\t\t\t\t\t\t403: function() {\n\t\t\t\t\t\t\t\t\t$.jstree.rollback(data.rlbk);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t// Make some jstree events delegatable\n\t\t\t\t\t.bind('select_node.jstree check_node.jstree uncheck_node.jstree', function(e, data) {\n\t\t\t\t\t\t$(document).triggerHandler(e, data);\n\t\t\t\t\t});\n\t\t},\n\t\tonremove: function(){\n\t\t\tthis.jstree('destroy');\n\t\t\tthis._super();\n\t\t},\n\n\t\t'from .cms-container': {\n\t\t\tonafterstatechange: function(e){\n\t\t\t\tthis.updateFromEditForm();\n\t\t\t\t// No need to refresh tree nodes, we assume only form submits cause state changes\n\t\t\t}\n\t\t},\n\n\t\t'from .cms-container form': {\n\t\t\tonaftersubmitform: function(e){\n\t\t\t\tvar id = $('.cms-edit-form :input[name=ID]').val();\n\t\t\t\t// TODO Trigger by implementing and inspecting \"changed records\" metadata \n\t\t\t\t// sent by form submission response (as HTTP response headers)\n\t\t\t\tthis.updateNodesFromServer([id]);\n\t\t\t}\n\t\t},\n\n\t\tgetTreeConfig: function() {\n\t\t\tvar self = this;\n\t\t\treturn {\n\t\t\t\t'core': {\n\t\t\t\t\t'initially_open': ['record-0'],\n\t\t\t\t\t'animation': 0,\n\t\t\t\t\t'html_titles': true\n\t\t\t\t},\n\t\t\t\t'html_data': {\n\t\t\t\t\t// 'ajax' will be set on 'loaded.jstree' event\n\t\t\t\t},\n\t\t\t\t'ui': {\n\t\t\t\t\t\"select_limit\" : 1,\n\t\t\t\t\t'initially_select': [this.find('.current').attr('id')]\n\t\t\t\t},\n\t\t\t\t\"crrm\": {\n\t\t\t\t\t'move': {\n\t\t\t\t\t\t// Check if a node is allowed to be moved.\n\t\t\t\t\t\t// Caution: Runs on every drag over a new node\n\t\t\t\t\t\t'check_move': function(data) {\n\t\t\t\t\t\t\tvar movedNode = $(data.o), newParent = $(data.np), \n\t\t\t\t\t\t\t\tisMovedOntoContainer = data.ot.get_container()[0] == data.np[0],\n\t\t\t\t\t\t\t\tmovedNodeClass = movedNode.getClassname(), \n\t\t\t\t\t\t\t\tnewParentClass = newParent.getClassname(),\n\t\t\t\t\t\t\t\t// Check allowedChildren of newParent or against root node rules\n\t\t\t\t\t\t\t\thints = self.getHints(),\n\t\t\t\t\t\t\t\tdisallowedChildren = [],\n\t\t\t\t\t\t\t\thintKey = newParentClass ? newParentClass : 'Root',\n\t\t\t\t\t\t\t\thint = (hints && typeof hints[hintKey] != 'undefined') ? hints[hintKey] : null;\n\n\t\t\t\t\t\t\t// Special case for VirtualPage: Check that original page type is an allowed child\n\t\t\t\t\t\t\tif(hint && movedNode.attr('class').match(/VirtualPage-([^\\s]*)/)) movedNodeClass = RegExp.$1;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(hint) disallowedChildren = (typeof hint.disallowedChildren != 'undefined') ? hint.disallowedChildren : [];\n\t\t\t\t\t\t\tvar isAllowed = (\n\t\t\t\t\t\t\t\t// Don't allow moving the root node\n\t\t\t\t\t\t\t\tmovedNode.data('id') !== 0 \n\t\t\t\t\t\t\t\t// Archived pages can't be moved\n\t\t\t\t\t\t\t\t&& !movedNode.hasClass('status-archived')\n\t\t\t\t\t\t\t\t// Only allow moving node inside the root container, not before/after it\n\t\t\t\t\t\t\t\t&& (!isMovedOntoContainer || data.p == 'inside')\n\t\t\t\t\t\t\t\t// Children are generally allowed on parent\n\t\t\t\t\t\t\t\t&& !newParent.hasClass('nochildren')\n\t\t\t\t\t\t\t\t// movedNode is allowed as a child\n\t\t\t\t\t\t\t\t&& (!disallowedChildren.length || $.inArray(movedNodeClass, disallowedChildren) == -1)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\treturn isAllowed;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t'dnd': {\n\t\t\t\t\t\"drop_target\" : false,\n\t\t\t\t\t\"drag_target\" : false\n\t\t\t\t},\n\t\t\t\t'checkbox': {\n\t\t\t\t\t'two_state': true\n\t\t\t\t},\n\t\t\t\t'themes': {\n\t\t\t\t\t'theme': 'apple',\n\t\t\t\t\t'url': $('body').data('frameworkpath') + '/thirdparty/jstree/themes/apple/style.css'\n\t\t\t\t},\n\t\t\t\t// Caution: SilverStripe has disabled $.vakata.css.add_sheet() for performance reasons,\n\t\t\t\t// which means you need to add any CSS manually to framework/admin/scss/_tree.css\n\t\t\t\t'plugins': [\n\t\t\t\t\t'html_data', 'ui', 'dnd', 'crrm', 'themes', \n\t\t\t\t\t'checkbox' // checkboxes are hidden unless .multiple is set\n\t\t\t\t]\n\t\t\t};\n\t\t},\n\t\t\n\t\t/**\n\t\t * Function:\n\t\t *  search\n\t\t * \n\t\t * Parameters:\n\t\t *  (Object) data Pass empty data to cancel search\n\t\t *  (Function) callback Success callback\n\t\t */\n\t\tsearch: function(params, callback) {\n\t\t\tif(params) this.data('searchparams', params);\n\t\t\telse this.removeData('searchparams');\n\t\t\tthis.jstree('refresh', -1, callback);\n\t\t},\n\t\t\n\t\t/**\n\t\t * Function: getNodeByID\n\t\t * \n\t\t * Parameters:\n\t\t *  (Int) id \n\t\t * \n\t\t * Returns\n\t\t *  DOMElement\n\t\t */\n\t\tgetNodeByID: function(id) {\n\t\t\treturn this.find('*[data-id='+id+']');\n\t\t},\n\n\t\t/**\n\t\t * Creates a new node from the given HTML.\n\t\t * Wrapping around jstree API because we want the flexibility to define\n\t\t * the node's <li> ourselves. Places the node in the tree\n\t\t * according to data.ParentID.\n\t\t *\n\t\t * Parameters:\n\t\t *  (String) HTML New node content (<li>)\n\t\t *  (Object) Map of additional data, e.g. ParentID\n\t\t *  (Function) Success callback\n\t\t */\n\t\tcreateNode: function(html, data, callback) {\n\t\t\tvar self = this, \n\t\t\t\tparentNode = data.ParentID !== void 0 ? self.getNodeByID(data.ParentID) : false, // Explicitly check for undefined as 0 is a valid ParentID\n\t\t\t\tnewNode = $(html);\n\t\t\t\n\t\t\t// Extract the state for the new node from the properties taken from the provided HTML template.\n\t\t\t// This will correctly initialise the behaviour of the node for ajax loading of children.\n\t\t\tvar properties = {data: ''};\n\t\t\tif(newNode.hasClass('jstree-open')) {\n\t\t\t\tproperties.state = 'open';\n\t\t\t} else if(newNode.hasClass('jstree-closed')) {\n\t\t\t\tproperties.state = 'closed';\n\t\t\t}\n\t\t\tthis.jstree(\n\t\t\t\t'create_node', \n\t\t\t\tparentNode.length ? parentNode : -1, \n\t\t\t\t'last', \n\t\t\t\tproperties,\n\t\t\t\tfunction(node) {\n\t\t\t\t\tvar origClasses = node.attr('class');\n\t\t\t\t\t// Copy attributes\n\t\t\t\t\tfor(var i=0; i<newNode[0].attributes.length; i++){\n\t\t\t\t\t\tvar attr = newNode[0].attributes[i];\n\t\t\t\t\t\tnode.attr(attr.name, attr.value);\n\t\t\t\t\t}\n\t\t\t\t\t// Substitute html from request for that generated by jstree\n\t\t\t\t\tnode.addClass(origClasses).html(newNode.html());\n\t\t\t\t\tcallback(node);\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Updates a node's state in the tree,\n\t\t * including all of its HTML, as well as its position.\n\t\t * \n\t\t * Parameters:\n\t\t *  (DOMElement) Existing node\n\t\t *  (String) HTML New node content (<li>)\n\t\t *  (Object) Map of additional data, e.g. ParentID\n\t\t */\n\t\tupdateNode: function(node, html, data) {\n\t\t\tvar self = this, newNode = $(html), origClasses = node.attr('class');\n\n\t\t\tvar nextNode = data.NextID ? this.getNodeByID(data.NextID) : false;\n\t\t\tvar prevNode = data.PrevID ? this.getNodeByID(data.PrevID) : false;\n\t\t\tvar parentNode = data.ParentID ? this.getNodeByID(data.ParentID) : false;\n\n\t\t\t// Copy attributes. We can't replace the node completely\n\t\t\t// without removing or detaching its children nodes.\n\t\t\t$.each(['id', 'style', 'class', 'data-pagetype'], function(i, attrName) {\n\t\t\t\tnode.attr(attrName, newNode.attr(attrName));\n\t\t\t});\n\n\t\t\t// To avoid conflicting classes when the node gets its content replaced (see below)\n\t\t\t// Filter out all previous status flags if they are not in the class property of the new node\n\t\t\torigClasses = origClasses.replace(/status-[^\\s]*/, '');\n\n\t\t\t// Replace inner content\n\t\t\tvar origChildren = node.children('ul').detach();\n\t\t\tnode.addClass(origClasses).html(newNode.html()).append(origChildren);\n\n\t\t\tif (nextNode && nextNode.length) {\n\t\t\t\tthis.jstree('move_node', node, nextNode, 'before');\n\t\t\t}\n\t\t\telse if (prevNode && prevNode.length) {\n\t\t\t\tthis.jstree('move_node', node, prevNode, 'after');\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.jstree('move_node', node, parentNode.length ? parentNode : -1);\n\t\t\t}\n\t\t},\n\t\t\n\t\t/**\n\t\t * Sets the current state based on the form the tree is managing.\n\t\t */\n\t\tupdateFromEditForm: function() {\n\t\t\tvar node, id = $('.cms-edit-form :input[name=ID]').val();\n\t\t\tif(id) {\n\t\t\t\tnode = this.getNodeByID(id);\n\t\t\t\tif(node.length) {\n\t\t\t\t\tthis.jstree('deselect_all');\n\t\t\t\t\tthis.jstree('select_node', node);\n\t\t\t\t} else {\n\t\t\t\t\t// If form is showing an ID that doesn't exist in the tree,\n\t\t\t\t\t// get it from the server\n\t\t\t\t\tthis.updateNodesFromServer([id]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// If no ID exists in a form view, we're displaying the tree on its own,\n\t\t\t\t// hence to page should show as active\n\t\t\t\tthis.jstree('deselect_all');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Reloads the view of one or more tree nodes\n\t\t * from the server, ensuring that their state is up to date\n\t\t * (icon, title, hierarchy, badges, etc).\n\t\t * This is easier, more consistent and more extensible \n\t\t * than trying to correct all aspects via DOM modifications, \n\t\t * based on the sparse data available in the current edit form.\n\t\t *\n\t\t * Parameters:\n\t\t *  (Array) List of IDs to retrieve\n\t\t */\n\t\tupdateNodesFromServer: function(ids) {\n\t\t\tif(this.getIsUpdatingTree() || !this.getIsLoaded()) return;\n\n\t\t\tvar self = this, i, includesNewNode = false;\n\t\t\tthis.setIsUpdatingTree(true);\n\t\t\tself.jstree('save_selected');\n\n\t\t\tvar correctStateFn = function(node) {\n\t\t\t\t// Duplicates can be caused by the subtree reloading through\n\t\t\t\t// a tree \"open\"/\"select\" event, while at the same time creating a new node\n\t\t\t\tself.getNodeByID(node.data('id')).not(node).remove();\n\t\t\t\t\n\t\t\t\t// Select this node\n\t\t\t\tself.jstree('deselect_all');\n\t\t\t\tself.jstree('select_node', node);\n\t\t\t};\n\n\t\t\t// TODO 'initially_opened' config doesn't apply here\n\t\t\tself.jstree('open_node', this.getNodeByID(0));\n\t\t\tself.jstree('save_opened');\n\t\t\tself.jstree('save_selected');\n\n\t\t\t$.ajax({\n\t\t\t\turl: $.path.addSearchParams(this.data('urlUpdatetreenodes'), 'ids=' + ids.join(',')),\n\t\t\t\tdataType: 'json',\n\t\t\t\tsuccess: function(data, xhr) {\n\t\t\t\t\t$.each(data, function(nodeId, nodeData) {\n\t\t\t\t\t\tvar node = self.getNodeByID(nodeId);\n\n\t\t\t\t\t\t// If no node data is given, assume the node has been removed\n\t\t\t\t\t\tif(!nodeData) {\n\t\t\t\t\t\t\tself.jstree('delete_node', node);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Check if node exists, create if necessary\n\t\t\t\t\t\tif(node.length) {\n\t\t\t\t\t\t\tself.updateNode(node, nodeData.html, nodeData);\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tcorrectStateFn(node);\n\t\t\t\t\t\t\t}, 500);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tincludesNewNode = true;\n\n\t\t\t\t\t\t\t// If the parent node can't be found, it might have not been loaded yet.\n\t\t\t\t\t\t\t// This can happen for deep trees which require ajax loading.\n\t\t\t\t\t\t\t// Assumes that the new node has been submitted to the server already.\n\t\t\t\t\t\t\tif(nodeData.ParentID && !self.find('li[data-id='+nodeData.ParentID+']').length) {\n\t\t\t\t\t\t\t\tself.jstree('load_node', -1, function() {\n\t\t\t\t\t\t\t\t\tnewNode = self.find('li[data-id='+nodeId+']');\n\t\t\t\t\t\t\t\t\tcorrectStateFn(newNode);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tself.createNode(nodeData.html, nodeData, function(newNode) {\n\t\t\t\t\t\t\t\t\tcorrectStateFn(newNode);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif(!includesNewNode) {\n\t\t\t\t\t\tself.jstree('deselect_all');\n\t\t\t\t\t\tself.jstree('reselect');\n\t\t\t\t\t\tself.jstree('reopen');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcomplete: function() {\n\t\t\t\t\tself.setIsUpdatingTree(false);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t});\n\t\n\t$('.cms-tree.multiple').entwine({\n\t\tonmatch: function() {\n\t\t\tthis._super();\n\t\t\tthis.jstree('show_checkboxes');\n\t\t},\n\t\tonunmatch: function() {\n\t\t\tthis._super();\n\t\t\tthis.jstree('uncheck_all');\n\t\t\tthis.jstree('hide_checkboxes');\n\t\t},\n\t\t/**\n\t\t * Function: getSelectedIDs\n\t\t * \n\t\t * Returns:\n\t\t * \t(Array)\n\t\t */\n\t\tgetSelectedIDs: function() {\n\t\t\treturn $(this)\n\t\t\t\t.jstree('get_checked')\n\t\t\t\t.not('.disabled')\n\t\t\t\t.map(function() {\n\t\t\t\t\treturn $(this).data('id');\n\t\t\t\t})\n\t\t\t\t.get();\n\t\t}\n\t});\n\t\n\t$('.cms-tree li').entwine({\n\t\t\n\t\t/**\n\t\t * Function: setEnabled\n\t\t * \n\t\t * Parameters:\n\t\t * \t(bool)\n\t\t */\n\t\tsetEnabled: function(bool) {\n\t\t\tthis.toggleClass('disabled', !(bool));\n\t\t},\n\t\t\n\t\t/**\n\t\t * Function: getClassname\n\t\t * \n\t\t * Returns PHP class for this element. Useful to check business rules like valid drag'n'drop targets.\n\t\t */\n\t\tgetClassname: function() {\n\t\t\tvar matches = this.attr('class').match(/class-([^\\s]*)/i);\n\t\t\treturn matches ? matches[1] : '';\n\t\t},\n\t\t\n\t\t/**\n\t\t * Function: getID\n\t\t * \n\t\t * Returns:\n\t\t * \t(Number)\n\t\t */\n\t\tgetID: function() {\n\t\t\treturn this.data('id');\n\t\t}\n\t});\n});\n","import $ from 'jQuery';\n\n$.entwine('ss', function($){\n\n\t// Any TreeDowndownField needs to refresh it's contents after a form submission,\n\t// because the tree on the backend might have changed\n\t$('.TreeDropdownField').entwine({\n\t\t'from .cms-container form': {\n\t\t\tonaftersubmitform: function(e){\n\t\t\t\tthis.find('.tree-holder').empty();\n\t\t\t\tthis._super();\n\t\t\t}\n\t\t}\n\t});\n\n});\n","/**\n * File: LeftAndMain.js\n */\nimport $ from 'jQuery';\nimport router from 'router';\n\n$.noConflict();\n\nwindow.ss = window.ss || {};\nwindow.ss.router = router;\n\nvar windowWidth, windowHeight;\n\n/**\n * Extracts the pathname from a URL.\n *\n * @param string url\n * @return string\n */\nfunction getUrlPath(url) {\n\tvar anchor = document.createElement('a');\n\tanchor.href = url;\n\n\treturn anchor.pathname\n}\n\n/**\n * @func debounce\n * @param func {function} - The callback to invoke after `wait` milliseconds.\n * @param wait {number} - Milliseconds to wait.\n * @param immediate {boolean} - If true the callback will be invoked at the start rather than the end.\n * @return {function}\n * @desc Returns a function that will not be called until it hasn't been invoked for `wait` seconds.\n */\nwindow.ss.debounce = function (func, wait, immediate) {\n\tvar timeout, context, args;\n\n\tvar later = function() {\n\t\ttimeout = null;\n\t\tif (!immediate) func.apply(context, args);\n\t};\n\n\treturn function() {\n\t\tvar callNow = immediate && !timeout;\n\n\t\tcontext = this;\n\t\targs = arguments;\n\n\t\tclearTimeout(timeout);\n\t\ttimeout = setTimeout(later, wait);\n\n\t\tif (callNow) {\n\t\t\tfunc.apply(context, args);\n\t\t}\n\t};\n};\n\n$(window).bind('resize.leftandmain', function(e) {\n\t// Entwine's 'fromWindow::onresize' does not trigger on IE8. Use synthetic event.\n\tvar cb = function() {$('.cms-container').trigger('windowresize');};\n\n\t// Workaround to avoid IE8 infinite loops when elements are resized as a result of this event\n\tif($.browser.msie && parseInt($.browser.version, 10) < 9) {\n\t\tvar newWindowWidth = $(window).width(), newWindowHeight = $(window).height();\n\t\tif(newWindowWidth != windowWidth || newWindowHeight != windowHeight) {\n\t\t\twindowWidth = newWindowWidth;\n\t\t\twindowHeight = newWindowHeight;\n\t\t\tcb();\n\t\t}\n\t} else {\n\t\tcb();\n\t}\n});\n\n// setup jquery.entwine\n$.entwine.warningLevel = $.entwine.WARN_LEVEL_BESTPRACTISE;\n\n$.entwine('ss', function($) {\n\n\t/**\n\t * Client routing.\n\t */\n\tfunction handleLoadPanel(ctx, next) {\n\t\t// If the page isn't ready or the request hasn't come from 'loadPanel'\n\t\t// then don't PJAX load the panel. Note: __forceReferer is set by 'loadPanel' only.\n\t\tif (document.readyState !== 'complete' || typeof ctx.state.__forceReferer === 'undefined') {\n\t\t\treturn next();\n\t\t}\n\n\t\t// Load the panel and call the next route.\n\t\t// The next route is call after the panel is in the DOM so that\n\t\t// any routes defined in the panel are available.\n\t\t$('.cms-container')\n\t\t\t.handleStateChange(null, ctx.state)\n\t\t\t.done(() => {\n\t\t\t\tnext();\n\t\t\t});\n\t}\n\n\tlet basePath = getUrlPath($('base')[0].href);\n\n\t// Avoid adding a double slash if the base path is '/'\n\tif (basePath[basePath.length - 1] === '/') {\n\t\tbasePath += 'admin';\n\t} else {\n\t\tbasePath = '/admin';\n\t}\n\n\trouter.base(basePath);\n\n\trouter('*', (ctx, next) => {\n\t\t// Break routing and do a full page reload when going to the assets section.\n\t\tconst assetsRoute = new router.Route('/assets/*');\n\n\t\tif (assetsRoute.match(router.current, {}) && typeof ctx.state.__forceReferer !== 'undefined') {\n\t\t\twindow.location.href = ctx.pathname;\n\t\t\treturn;\n\t\t}\n\n\t\tnext();\n\t});\n\n\t// There's currently no way to get a list of routes dynamically.\n\t// We're hardcoding these until a configuration manager is implemented.\n\trouter('/pages/*', handleLoadPanel);\n\trouter('/reports/*', handleLoadPanel);\n\trouter('/security/*', handleLoadPanel);\n\trouter('/settings/*', handleLoadPanel);\n\n\trouter.start();\n\n\t/*\n\t * Handle messages sent via nested iframes\n\t * Messages should be raised via postMessage with an object with the 'type' parameter given.\n\t * An optional 'target' and 'data' parameter can also be specified. If no target is specified\n\t * events will be sent to the window instead.\n\t * type should be one of:\n\t *  - 'event' - Will trigger the given event (specified by 'event') on the target\n\t *  - 'callback' - Will call the given method (specified by 'callback') on the target\n\t */\n\t$(window).on(\"message\", function(e) {\n\t\tvar target,\n\t\t\tevent = e.originalEvent,\n\t\t\tdata = typeof event.data === 'object' ? event.data : JSON.parse(event.data);\n\n\t\t// Reject messages outside of the same origin\n\t\tif($.path.parseUrl(window.location.href).domain !== $.path.parseUrl(event.origin).domain) return;\n\n\t\t// Get target of this action\n\t\ttarget = typeof(data.target) === 'undefined'\n\t\t\t? $(window)\n\t\t\t: $(data.target);\n\n\t\t// Determine action\n\t\tswitch(data.type) {\n\t\t\tcase 'event':\n\t\t\t\ttarget.trigger(data.event, data.data);\n\t\t\t\tbreak;\n\t\t\tcase 'callback':\n\t\t\t\ttarget[data.callback].call(target, data.data);\n\t\t\t\tbreak;\n\t\t}\n\t});\n\n\t/**\n\t * Position the loading spinner animation below the ss logo\n\t */\n\tvar positionLoadingSpinner = function() {\n\t\tvar offset = 120; // offset from the ss logo\n\t\tvar spinner = $('.ss-loading-screen .loading-animation');\n\t\tvar top = ($(window).height() - spinner.height()) / 2;\n\t\tspinner.css('top', top + offset);\n\t\tspinner.show();\n\t};\n\n\t// apply an select element only when it is ready, ie. when it is rendered into a template\n\t// with css applied and got a width value.\n\tvar applyChosen = function(el) {\n\t\tif(el.is(':visible')) {\n\t\t\tel.addClass('has-chzn').chosen({\n\t\t\t\tallow_single_deselect: true,\n\t\t\t\tdisable_search_threshold: 20\n\t\t\t});\n\n\t\t\tvar title = el.prop('title');\n\n\t\t\tif(title) {\n\t\t\t\tel.siblings('.chzn-container').prop('title', title);\n\t\t\t}\n\t\t} else {\n\t\t\tsetTimeout(function() {\n\t\t\t\t// Make sure it's visible before applying the ui\n\t\t\t\tel.show();\n\t\t\t\tapplyChosen(el); },\n\t\t\t500);\n\t\t}\n\t};\n\n\t/**\n\t * Compare URLs, but normalize trailing slashes in\n\t * URL to work around routing weirdnesses in SS_HTTPRequest.\n\t * Also normalizes relative URLs by prefixing them with the <base>.\n\t */\n\tvar isSameUrl = function(url1, url2) {\n\t\tvar baseUrl = $('base').attr('href');\n\t\turl1 = $.path.isAbsoluteUrl(url1) ? url1 : $.path.makeUrlAbsolute(url1, baseUrl),\n\t\turl2 = $.path.isAbsoluteUrl(url2) ? url2 : $.path.makeUrlAbsolute(url2, baseUrl);\n\t\tvar url1parts = $.path.parseUrl(url1), url2parts = $.path.parseUrl(url2);\n\t\treturn (\n\t\t\turl1parts.pathname.replace(/\\/*$/, '') == url2parts.pathname.replace(/\\/*$/, '') &&\n\t\t\turl1parts.search == url2parts.search\n\t\t);\n\t};\n\n\tvar ajaxCompleteEvent = window.ss.debounce(function () {\n\t\t$(window).trigger('ajaxComplete');\n\t}, 1000, true);\n\n\t$(window).bind('resize', positionLoadingSpinner).trigger('resize');\n\n\t// global ajax handlers\n\t$(document).ajaxComplete(function(e, xhr, settings) {\n\t\t// Simulates a redirect on an ajax response.\n\t\tvar url = xhr.getResponseHeader('X-ControllerURL'),\n\t\t\torigUrl = window.history.state.path.replace(/\\/$/, ''), // TODO Replaces trailing slashes added by History after locale (e.g. admin/?locale=en/)\n\t\t\tdestUrl = settings.url,\n\t\t\tmsg = xhr.getResponseHeader('X-Status') !== null ? xhr.getResponseHeader('X-Status') : xhr.statusText, // Handle custom status message headers\n\t\t\tmsgType = (xhr.status < 200 || xhr.status > 399) ? 'bad' : 'good',\n\t\t\tignoredMessages = ['OK'];\n\n\t\t// Only redirect if controller url differs to the requested or current one\n\t\tif (url !== null && (!isSameUrl(origUrl, url) || !isSameUrl(destUrl, url))) {\n\t\t\trouter.show(url, {\n\t\t\t\tid: (new Date()).getTime() + String(Math.random()).replace(/\\D/g,''), // Ensure that redirections are followed through by history API by handing it a unique ID\n\t\t\t\tpjax: xhr.getResponseHeader('X-Pjax') ? xhr.getResponseHeader('X-Pjax') : settings.headers['X-Pjax']\n\t\t\t});\n\t\t}\n\n\t\t// Enable reauthenticate dialog if requested\n\t\tif (xhr.getResponseHeader('X-Reauthenticate')) {\n\t\t\t$('.cms-container').showLoginDialog();\n\t\t\treturn;\n\t\t}\n\n\t\t// Show message (but ignore aborted requests)\n\t\tif (xhr.status !== 0 && msg && $.inArray(msg, ignoredMessages)) {\n\t\t\t// Decode into UTF-8, HTTP headers don't allow multibyte\n\t\t\tstatusMessage(decodeURIComponent(msg), msgType);\n\t\t}\n\n\t\tajaxCompleteEvent(this);\n\t});\n\n\t/**\n\t * Main LeftAndMain interface with some control panel and an edit form.\n\t *\n\t * Events:\n\t *  ajaxsubmit - ...\n\t *  validate - ...\n\t *  aftersubmitform - ...\n\t */\n\t$('.cms-container').entwine({\n\n\t\t/**\n\t\t * Tracks current panel request.\n\t\t */\n\t\tStateChangeXHR: null,\n\n\t\t/**\n\t\t * Tracks current fragment-only parallel PJAX requests.\n\t\t */\n\t\tFragmentXHR: {},\n\n\t\tStateChangeCount: 0,\n\n\t\t/**\n\t\t * Options for the threeColumnCompressor layout algorithm.\n\t\t *\n\t\t * See LeftAndMain.Layout.js for description of these options.\n\t\t */\n\t\tLayoutOptions: {\n\t\t\tminContentWidth: 940,\n\t\t\tminPreviewWidth: 400,\n\t\t\tmode: 'content'\n\t\t},\n\n\t\t/**\n\t\t * Constructor: onmatch\n\t\t */\n\t\tonadd: function() {\n\t\t\tvar self = this;\n\n\t\t\t// Browser detection\n\t\t\tif($.browser.msie && parseInt($.browser.version, 10) < 8) {\n\t\t\t\t$('.ss-loading-screen').append(\n\t\t\t\t\t'<p class=\"ss-loading-incompat-warning\"><span class=\"notice\">' +\n\t\t\t\t\t'Your browser is not compatible with the CMS interface. Please use Internet Explorer 8+, Google Chrome or Mozilla Firefox.' +\n\t\t\t\t\t'</span></p>'\n\t\t\t\t).css('z-index', $('.ss-loading-screen').css('z-index')+1);\n\t\t\t\t$('.loading-animation').remove();\n\n\t\t\t\tthis._super();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Initialize layouts\n\t\t\tthis.redraw();\n\n\t\t\t// Remove loading screen\n\t\t\t$('.ss-loading-screen').hide();\n\t\t\t$('body').removeClass('loading');\n\t\t\t$(window).unbind('resize', positionLoadingSpinner);\n\t\t\tthis.restoreTabState();\n\t\t\tthis._super();\n\t\t},\n\n\t\tfromWindow: {\n\t\t\tonstatechange: function(event, historyState){\n\t\t\t\tthis.handleStateChange(event, historyState); \n\t\t\t}\n\t\t},\n\n\t\t'onwindowresize': function() {\n\t\t\tthis.redraw();\n\t\t},\n\n\t\t'from .cms-panel': {\n\t\t\tontoggle: function(){ this.redraw(); }\n\t\t},\n\n\t\t'from .cms-container': {\n\t\t\tonaftersubmitform: function(){ this.redraw(); }\n\t\t},\n\n\t\t/**\n\t\t * Ensure the user can see the requested section - restore the default view.\n\t\t */\n\t\t'from .cms-menu-list li a': {\n\t\t\tonclick: function(e) {\n\t\t\t\tvar href = $(e.target).attr('href');\n\t\t\t\tif(e.which > 1 || href == this._tabStateUrl()) return;\n\t\t\t\tthis.splitViewMode();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Change the options of the threeColumnCompressor layout, and trigger layouting if needed.\n\t\t * You can provide any or all options. The remaining options will not be changed.\n\t\t */\n\t\tupdateLayoutOptions: function(newSpec) {\n\t\t\tvar spec = this.getLayoutOptions();\n\n\t\t\tvar dirty = false;\n\n\t\t\tfor (var k in newSpec) {\n\t\t\t\tif (spec[k] !== newSpec[k]) {\n\t\t\t\t\tspec[k] = newSpec[k];\n\t\t\t\t\tdirty = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (dirty) this.redraw();\n\t\t},\n\n\t\t/**\n\t\t * Enable the split view - with content on the left and preview on the right.\n\t\t */\n\t\tsplitViewMode: function() {\n\t\t\tthis.updateLayoutOptions({\n\t\t\t\tmode: 'split'\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Content only.\n\t\t */\n\t\tcontentViewMode: function() {\n\t\t\tthis.updateLayoutOptions({\n\t\t\t\tmode: 'content'\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Preview only.\n\t\t */\n\t\tpreviewMode: function() {\n\t\t\tthis.updateLayoutOptions({\n\t\t\t\tmode: 'preview'\n\t\t\t});\n\t\t},\n\n\t\tRedrawSuppression: false,\n\n\t\tredraw: function() {\n\t\t\tif (this.getRedrawSuppression()) return;\n\n\t\t\tif(window.debug) console.log('redraw', this.attr('class'), this.get(0));\n\n\t\t\t// Reset the algorithm.\n\t\t\tthis.data('jlayout', jLayout.threeColumnCompressor(\n\t\t\t\t{\n\t\t\t\t\tmenu: this.children('.cms-menu'),\n\t\t\t\t\tcontent: this.children('.cms-content'),\n\t\t\t\t\tpreview: this.children('.cms-preview')\n\t\t\t\t},\n\t\t\t\tthis.getLayoutOptions()\n\t\t\t));\n\n\t\t\t// Trigger layout algorithm once at the top. This also lays out children - we move from outside to\n\t\t\t// inside, resizing to fit the parent.\n\t\t\tthis.layout();\n\n\t\t\t// Redraw on all the children that need it\n\t\t\tthis.find('.cms-panel-layout').redraw();\n\t\t\tthis.find('.cms-content-fields[data-layout-type]').redraw();\n\t\t\tthis.find('.cms-edit-form[data-layout-type]').redraw();\n\t\t\tthis.find('.cms-preview').redraw();\n\t\t\tthis.find('.cms-content').redraw();\n\t\t},\n\n\t\t/**\n\t\t * Confirm whether the current user can navigate away from this page\n\t\t * \n\t\t * @param {array} selectors Optional list of selectors\n\t\t * @returns {boolean} True if the navigation can proceed\n\t\t */\n\t\tcheckCanNavigate: function(selectors) {\n\t\t\t// Check change tracking (can't use events as we need a way to cancel the current state change)\n\t\t\tvar contentEls = this._findFragments(selectors || ['Content']),\n\t\t\t\ttrackedEls = contentEls\n\t\t\t\t\t.find(':data(changetracker)')\n\t\t\t\t\t.add(contentEls.filter(':data(changetracker)')),\n\t\t\t\tsafe = true;\n\n\t\t\tif(!trackedEls.length) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\ttrackedEls.each(function() {\n\t\t\t\t// See LeftAndMain.EditForm.js\n\t\t\t\tif(!$(this).confirmUnsavedChanges()) {\n\t\t\t\t\tsafe = false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn safe;\n\t\t},\n\n\t\t/**\n\t\t * @param string url\n\t\t * @param string title - New window title.\n\t\t * @param object data - Any additional data passed through to `window.history.state`.\n\t\t * @param boolean forceReload - Forces the replacement of the current history state, even if the URL is the same, i.e. allows reloading.\n\t\t */\n\t\tloadPanel: function (url, title = '', data = {}, forceReload, forceReferer = window.history.state.path) {\n\t\t\t// Check for unsaved changes\n\t\t\tif (!this.checkCanNavigate(data.pjax ? data.pjax.split(',') : ['Content'])) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.saveTabState();\n\n\t\t\tdata.__forceReferer = forceReferer;\n\n\t\t\tif (forceReload) {\n\t\t\t\tdata.__forceReload = Math.random(); // Make sure the page reloads even if the URL is the same.\n\t\t\t}\n\n\t\t\trouter.show(url, data);\n\t\t},\n\n\t\t/**\n\t\t * Nice wrapper for reloading current history state.\n\t\t */\n\t\treloadCurrentPanel: function() {\n\t\t\tthis.loadPanel(window.history.state.path, null, null, true);\n\t\t},\n\n\t\t/**\n\t\t * Function: submitForm\n\t\t *\n\t\t * Parameters:\n\t\t *  {DOMElement} form - The form to be submitted. Needs to be passed\n\t\t *   in to avoid entwine methods/context being removed through replacing the node itself.\n\t\t *  {DOMElement} button - The pressed button (optional)\n\t\t *  {Function} callback - Called in complete() handler of jQuery.ajax()\n\t\t *  {Object} ajaxOptions - Object literal to merge into $.ajax() call\n\t\t *\n\t\t * Returns:\n\t\t *  (boolean)\n\t\t */\n\t\tsubmitForm: function(form, button, callback, ajaxOptions) {\n\t\t\tvar self = this;\n\n\t\t\t// look for save button\n\t\t\tif(!button) button = this.find('.Actions :submit[name=action_save]');\n\t\t\t// default to first button if none given - simulates browser behaviour\n\t\t\tif(!button) button = this.find('.Actions :submit:first');\n\n\t\t\tform.trigger('beforesubmitform');\n\t\t\tthis.trigger('submitform', {form: form, button: button});\n\n\t\t\t// set button to \"submitting\" state\n\t\t\t$(button).addClass('loading');\n\n\t\t\t// validate if required\n\t\t\tvar validationResult = form.validate();\n\t\t\tif(typeof validationResult!=='undefined' && !validationResult) {\n\t\t\t\t// TODO Automatically switch to the tab/position of the first error\n\t\t\t\tstatusMessage(\"Validation failed.\", \"bad\");\n\n\t\t\t\t$(button).removeClass('loading');\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// get all data from the form\n\t\t\tvar formData = form.serializeArray();\n\t\t\t// add button action\n\t\t\tformData.push({name: $(button).attr('name'), value:'1'});\n\t\t\t// Artificial HTTP referer, IE doesn't submit them via ajax.\n\t\t\t// Also rewrites anchors to their page counterparts, which is important\n\t\t\t// as automatic browser ajax response redirects seem to discard the hash/fragment.\n\t\t\t// TODO Replaces trailing slashes added by History after locale (e.g. admin/?locale=en/)\n\t\t\tformData.push({ name: 'BackURL', value: window.history.state.path.replace(/\\/$/, '') });\n\n\t\t\t// Save tab selections so we can restore them later\n\t\t\tthis.saveTabState();\n\n\t\t\t// Standard Pjax behaviour is to replace the submitted form with new content.\n\t\t\t// The returned view isn't always decided upon when the request\n\t\t\t// is fired, so the server might decide to change it based on its own logic,\n\t\t\t// sending back different `X-Pjax` headers and content\n\t\t\tjQuery.ajax(jQuery.extend({\n\t\t\t\theaders: {\"X-Pjax\" : \"CurrentForm,Breadcrumbs\"},\n\t\t\t\turl: form.attr('action'),\n\t\t\t\tdata: formData,\n\t\t\t\ttype: 'POST',\n\t\t\t\tcomplete: function() {\n\t\t\t\t\t$(button).removeClass('loading');\n\t\t\t\t},\n\t\t\t\tsuccess: function(data, status, xhr) {\n\t\t\t\t\tform.removeClass('changed'); // TODO This should be using the plugin API\n\t\t\t\t\tif(callback) callback(data, status, xhr);\n\n\t\t\t\t\tvar newContentEls = self.handleAjaxResponse(data, status, xhr);\n\t\t\t\t\tif(!newContentEls) return;\n\n\t\t\t\t\tnewContentEls.filter('form').trigger('aftersubmitform', {status: status, xhr: xhr, formData: formData});\n\t\t\t\t}\n\t\t\t}, ajaxOptions));\n\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Last html5 history state\n\t\t */\n\t\tLastState: null,\n\t\t\n\t\t/**\n\t\t * Flag to pause handleStateChange\n\t\t */\n\t\tPauseState: false,\n\n\t\t/**\n\t\t * Handles ajax loading of new panels through the window.history object.\n\t\t * To trigger loading, pass a new URL to router.show().\n\t\t * Use loadPanel() as a router.show() wrapper as it provides some additional functionality\n\t\t * like global changetracking and user aborts.\n\t\t *\n\t\t * Due to the nature of history management, no callbacks are allowed.\n\t\t * Use the 'beforestatechange' and 'afterstatechange' events instead,\n\t\t * or overwrite the beforeLoad() and afterLoad() methods on the\n\t\t * DOM element you're loading the new content into.\n\t\t * Although you can pass data into router.show(url, data), it shouldn't contain\n\t\t * DOM elements or callback closures.\n\t\t *\n\t\t * The passed URL should allow reconstructing important interface state\n\t\t * without additional parameters, in the following use cases:\n\t\t * - Explicit loading through router.show()\n\t\t * - Implicit loading through browser navigation event triggered by the user (forward or back)\n\t\t * - Full window refresh without ajax\n\t\t * For example, a ModelAdmin search event should contain the search terms\n\t\t * as URL parameters, and the result display should automatically appear\n\t\t * if the URL is loaded without ajax.\n\t\t */\n\t\thandleStateChange: function (event, historyState = window.history.state) {\n\t\t\tif (this.getPauseState()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Don't allow parallel loading to avoid edge cases\n\t\t\tif (this.getStateChangeXHR()) {\n\t\t\t\tthis.getStateChangeXHR().abort();\n\t\t\t}\n\n\t\t\tvar self = this,\n\t\t\t\tfragments = historyState.pjax || 'Content',\n\t\t\t\theaders = {},\n\t\t\t\tfragmentsArr = fragments.split(','),\n\t\t\t\tcontentEls = this._findFragments(fragmentsArr);\n\n\t\t\tthis.setStateChangeCount(this.getStateChangeCount() + 1);\n\n\t\t\tif (!this.checkCanNavigate()) {\n\t\t\t\tvar lastState = this.getLastState();\n\n\t\t\t\t// Suppress panel loading while resetting state\n\t\t\t\tthis.setPauseState(true);\n\n\t\t\t\t// Restore best last state\n\t\t\t\tif (lastState !== null) {\n\t\t\t\t\trouter.show(lastState.url);\n\t\t\t\t} else {\n\t\t\t\t\trouter.back();\n\t\t\t\t}\n\n\t\t\t\tthis.setPauseState(false);\n\n\t\t\t\t// Abort loading of this panel\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.setLastState(historyState);\n\n\t\t\t// If any of the requested Pjax fragments don't exist in the current view,\n\t\t\t// fetch the \"Content\" view instead, which is the \"outermost\" fragment\n\t\t\t// that can be reloaded without reloading the whole window.\n\t\t\tif (contentEls.length < fragmentsArr.length) {\n\t\t\t\tfragments = 'Content', fragmentsArr = ['Content'];\n\t\t\t\tcontentEls = this._findFragments(fragmentsArr);\n\t\t\t}\n\n\t\t\tthis.trigger('beforestatechange', { state: historyState, element: contentEls });\n\n\t\t\t// Set Pjax headers, which can declare a preference for the returned view.\n\t\t\t// The actually returned view isn't always decided upon when the request\n\t\t\t// is fired, so the server might decide to change it based on its own logic.\n\t\t\theaders['X-Pjax'] = fragments;\n\n\t\t\tif (typeof historyState.__forceReferer !== 'undefined') {\n\t\t\t\t// Ensure query string is properly encoded if present\n\t\t\t\tlet url = historyState.__forceReferer;\n\n\t\t\t\ttry {\n\t\t\t\t\t// Prevent double-encoding by attempting to decode\n\t\t\t\t\turl = decodeURI(url);\n\t\t\t\t} catch(e) {\n\t\t\t\t\t// URL not encoded, or was encoded incorrectly, so do nothing\n\t\t\t\t} finally {\n\t\t\t\t\t// Set our referer header to the encoded URL\n\t\t\t\t\theaders['X-Backurl'] = encodeURI(url);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcontentEls.addClass('loading');\n\n\t\t\tlet promise = $.ajax({\n\t\t\t\theaders: headers,\n\t\t\t\turl: historyState.path\n\t\t\t})\n\t\t\t.done((data, status, xhr) => {\n\t\t\t\tvar els = self.handleAjaxResponse(data, status, xhr, historyState);\n\t\t\t\tself.trigger('afterstatechange', {data: data, status: status, xhr: xhr, element: els, state: historyState});\n\t\t\t})\n\t\t\t.always(() => {\n\t\t\t\tself.setStateChangeXHR(null);\n\t\t\t\t// Remove loading indication from old content els (regardless of which are replaced)\n\t\t\t\tcontentEls.removeClass('loading');\n\t\t\t});\n\n\t\t\tthis.setStateChangeXHR(promise);\n\n\t\t\treturn promise;\n\t\t},\n\n\t\t/**\n\t\t * ALternative to loadPanel/submitForm.\n\t\t *\n\t\t * Triggers a parallel-fetch of a PJAX fragment, which is a separate request to the\n\t\t * state change requests. There could be any amount of these fetches going on in the background,\n\t\t * and they don't register as a HTML5 history states.\n\t\t *\n\t\t * This is meant for updating a PJAX areas that are not complete panel/form reloads. These you'd\n\t\t * normally do via submitForm or loadPanel which have a lot of automation built in.\n\t\t *\n\t\t * On receiving successful response, the framework will update the element tagged with appropriate\n\t\t * data-pjax-fragment attribute (e.g. data-pjax-fragment=\"<pjax-fragment-name>\"). Make sure this element\n\t\t * is available.\n\t\t *\n\t\t * Example usage:\n\t\t * $('.cms-container').loadFragment('admin/foobar/', 'FragmentName');\n\t\t *\n\t\t * @param url string Relative or absolute url of the controller.\n\t\t * @param pjaxFragments string PJAX fragment(s), comma separated.\n\t\t */\n\t\tloadFragment: function(url, pjaxFragments) {\n\n\t\t\tvar self = this,\n\t\t\t\txhr,\n\t\t\t\theaders = {},\n\t\t\t\tbaseUrl = $('base').attr('href'),\n\t\t\t\tfragmentXHR = this.getFragmentXHR();\n\n\t\t\t// Make sure only one XHR for a specific fragment is currently in progress.\n\t\t\tif(\n\t\t\t\ttypeof fragmentXHR[pjaxFragments]!=='undefined' &&\n\t\t\t\tfragmentXHR[pjaxFragments]!==null\n\t\t\t) {\n\t\t\t\tfragmentXHR[pjaxFragments].abort();\n\t\t\t\tfragmentXHR[pjaxFragments] = null;\n\t\t\t}\n\n\t\t\turl = $.path.isAbsoluteUrl(url) ? url : $.path.makeUrlAbsolute(url, baseUrl);\n\t\t\theaders['X-Pjax'] = pjaxFragments;\n\n\t\t\txhr = $.ajax({\n\t\t\t\theaders: headers,\n\t\t\t\turl: url,\n\t\t\t\tsuccess: function(data, status, xhr) {\n\t\t\t\t\tvar elements = self.handleAjaxResponse(data, status, xhr, null);\n\n\t\t\t\t\t// We are fully done now, make it possible for others to hook in here.\n\t\t\t\t\tself.trigger('afterloadfragment', { data: data, status: status, xhr: xhr, elements: elements });\n\t\t\t\t},\n\t\t\t\terror: function(xhr, status, error) {\n\t\t\t\t\tself.trigger('loadfragmenterror', { xhr: xhr, status: status, error: error });\n\t\t\t\t},\n\t\t\t\tcomplete: function() {\n\t\t\t\t\t// Reset the current XHR in tracking object.\n\t\t\t\t\tvar fragmentXHR = self.getFragmentXHR();\n\t\t\t\t\tif(\n\t\t\t\t\t\ttypeof fragmentXHR[pjaxFragments]!=='undefined' &&\n\t\t\t\t\t\tfragmentXHR[pjaxFragments]!==null\n\t\t\t\t\t) {\n\t\t\t\t\t\tfragmentXHR[pjaxFragments] = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Store the fragment request so we can abort later, should we get a duplicate request.\n\t\t\tfragmentXHR[pjaxFragments] = xhr;\n\n\t\t\treturn xhr;\n\t\t},\n\n\t\t/**\n\t\t * Handles ajax responses containing plain HTML, or mulitple\n\t\t * PJAX fragments wrapped in JSON (see PjaxResponseNegotiator PHP class).\n\t\t * Can be hooked into an ajax 'success' callback.\n\t\t *\n\t\t * Parameters:\n\t\t * \t(Object) data\n\t\t * \t(String) status\n\t\t * \t(XMLHTTPRequest) xhr\n\t\t * \t(Object) state The original history state which the request was initiated with\n\t\t */\n\t\thandleAjaxResponse: function(data, status, xhr, state) {\n\t\t\tvar self = this, url, selectedTabs, guessFragment, fragment, $data;\n\n\t\t\t// Support a full reload\n\t\t\tif(xhr.getResponseHeader('X-Reload') && xhr.getResponseHeader('X-ControllerURL')) {\n\t\t\t\tvar baseUrl = $('base').attr('href'),\n\t\t\t\t\trawURL = xhr.getResponseHeader('X-ControllerURL'),\n\t\t\t\t\turl = $.path.isAbsoluteUrl(rawURL) ? rawURL : $.path.makeUrlAbsolute(rawURL, baseUrl);\n\n\t\t\t\tdocument.location.href = url;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Pseudo-redirects via X-ControllerURL might return empty data, in which\n\t\t\t// case we'll ignore the response\n\t\t\tif(!data) return;\n\n\t\t\t// Update title\n\t\t\tvar title = xhr.getResponseHeader('X-Title');\n\t\t\tif(title) document.title = decodeURIComponent(title.replace(/\\+/g, ' '));\n\n\t\t\tvar newFragments = {}, newContentEls;\n\t\t\t// If content type is text/json (ignoring charset and other parameters)\n\t\t\tif(xhr.getResponseHeader('Content-Type').match(/^((text)|(application))\\/json[ \\t]*;?/i)) {\n\t\t\t\tnewFragments = data;\n\t\t\t} else {\n\n\t\t\t\t// Fall back to replacing the content fragment if HTML is returned\n\t\t\t\tfragment = document.createDocumentFragment();\n\n\t\t\t\tjQuery.clean( [ data ], document, fragment, [] );\n\t\t\t\t$data = $(jQuery.merge( [], fragment.childNodes ));\n\n\t\t\t\t// Try and guess the fragment if none is provided\n\t\t\t\t// TODO: data-pjax-fragment might actually give us the fragment. For now we just check most common case\n\t\t\t\tguessFragment = 'Content';\n\t\t\t\tif ($data.is('form') && !$data.is('[data-pjax-fragment~=Content]')) guessFragment = 'CurrentForm';\n\n\t\t\t\tnewFragments[guessFragment] = $data;\n\t\t\t}\n\n\t\t\tthis.setRedrawSuppression(true);\n\t\t\ttry {\n\t\t\t\t// Replace each fragment individually\n\t\t\t\t$.each(newFragments, function(newFragment, html) {\n\t\t\t\t\tvar contentEl = $('[data-pjax-fragment]').filter(function() {\n\t\t\t\t\t\treturn $.inArray(newFragment, $(this).data('pjaxFragment').split(' ')) != -1;\n\t\t\t\t\t}), newContentEl = $(html);\n\n\t\t\t\t\t// Add to result collection\n\t\t\t\t\tif(newContentEls) newContentEls.add(newContentEl);\n\t\t\t\t\telse newContentEls = newContentEl;\n\n\t\t\t\t\t// Update panels\n\t\t\t\t\tif(newContentEl.find('.cms-container').length) {\n\t\t\t\t\t\tthrow 'Content loaded via ajax is not allowed to contain tags matching the \".cms-container\" selector to avoid infinite loops';\n\t\t\t\t\t}\n\n\t\t\t\t\t// Set loading state and store element state\n\t\t\t\t\tvar origStyle = contentEl.attr('style');\n\t\t\t\t\tvar origParent = contentEl.parent();\n\t\t\t\t\tvar origParentLayoutApplied = (typeof origParent.data('jlayout')!=='undefined');\n\t\t\t\t\tvar layoutClasses = ['east', 'west', 'center', 'north', 'south', 'column-hidden'];\n\t\t\t\t\tvar elemClasses = contentEl.attr('class');\n\t\t\t\t\tvar origLayoutClasses = [];\n\t\t\t\t\tif(elemClasses) {\n\t\t\t\t\t\torigLayoutClasses = $.grep(\n\t\t\t\t\t\t\telemClasses.split(' '),\n\t\t\t\t\t\t\tfunction(val) { return ($.inArray(val, layoutClasses) >= 0);}\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tnewContentEl\n\t\t\t\t\t\t.removeClass(layoutClasses.join(' '))\n\t\t\t\t\t\t.addClass(origLayoutClasses.join(' '));\n\t\t\t\t\tif(origStyle) newContentEl.attr('style', origStyle);\n\n\t\t\t\t\t// Allow injection of inline styles, as they're not allowed in the document body.\n\t\t\t\t\t// Not handling this through jQuery.ondemand to avoid parsing the DOM twice.\n\t\t\t\t\tvar styles = newContentEl.find('style').detach();\n\t\t\t\t\tif(styles.length) $(document).find('head').append(styles);\n\n\t\t\t\t\t// Replace panel completely (we need to override the \"layout\" attribute, so can't replace the child instead)\n\t\t\t\t\tcontentEl.replaceWith(newContentEl);\n\n\t\t\t\t\t// Force jlayout to rebuild internal hierarchy to point to the new elements.\n\t\t\t\t\t// This is only necessary for elements that are at least 3 levels deep. 2nd level elements will\n\t\t\t\t\t// be taken care of when we lay out the top level element (.cms-container).\n\t\t\t\t\tif (!origParent.is('.cms-container') && origParentLayoutApplied) {\n\t\t\t\t\t\torigParent.layout();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Re-init tabs (in case the form tag itself is a tabset)\n\t\t\t\tvar newForm = newContentEls.filter('form');\n\t\t\t\tif(newForm.hasClass('cms-tabset')) newForm.removeClass('cms-tabset').addClass('cms-tabset');\n\t\t\t}\n\t\t\tfinally {\n\t\t\t\tthis.setRedrawSuppression(false);\n\t\t\t}\n\n\t\t\tthis.redraw();\n\t\t\tthis.restoreTabState((state && typeof state.tabState !== 'undefined') ? state.tabState : null);\n\n\t\t\treturn newContentEls;\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t *\n\t\t * Parameters:\n\t\t * - fragments {Array}\n\t\t * Returns: jQuery collection\n\t\t */\n\t\t_findFragments: function(fragments) {\n\t\t\treturn $('[data-pjax-fragment]').filter(function() {\n\t\t\t\t// Allows for more than one fragment per node\n\t\t\t\tvar i, nodeFragments = $(this).data('pjaxFragment').split(' ');\n\t\t\t\tfor(i in fragments) {\n\t\t\t\t\tif($.inArray(fragments[i], nodeFragments) != -1) return true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Function: refresh\n\t\t *\n\t\t * Updates the container based on the current url\n\t\t *\n\t\t * Returns: void\n\t\t */\n\t\trefresh: function() {\n\t\t\t$(window).trigger('statechange');\n\n\t\t\t$(this).redraw();\n\t\t},\n\n\t\t/**\n\t\t * Save tab selections in order to reconstruct them later.\n\t\t * Requires HTML5 sessionStorage support.\n\t\t */\n\t\tsaveTabState: function() {\n\t\t\tif(typeof(window.sessionStorage)==\"undefined\" || window.sessionStorage === null) return;\n\n\t\t\tvar selectedTabs = [], url = this._tabStateUrl();\n\t\t\tthis.find('.cms-tabset,.ss-tabset').each(function(i, el) {\n\t\t\t\tvar id = $(el).attr('id');\n\t\t\t\tif(!id) return; // we need a unique reference\n\t\t\t\tif(!$(el).data('tabs')) return; // don't act on uninit'ed controls\n\n\t\t\t\t// Allow opt-out via data element or entwine property.\n\t\t\t\tif($(el).data('ignoreTabState') || $(el).getIgnoreTabState()) return;\n\n\t\t\t\tselectedTabs.push({id:id, selected:$(el).tabs('option', 'selected')});\n\t\t\t});\n\n\t\t\tif(selectedTabs) {\n\t\t\t\tvar tabsUrl = 'tabs-' + url;\n\t\t\t\ttry {\n\t\t\t\t\twindow.sessionStorage.setItem(tabsUrl, JSON.stringify(selectedTabs));\n\t\t\t\t} catch(err) {\n\t\t\t\t\tif (err.code === DOMException.QUOTA_EXCEEDED_ERR && window.sessionStorage.length === 0) {\n\t\t\t\t\t\t// If this fails we ignore the error as the only issue is that it\n\t\t\t\t\t\t// does not remember the tab state.\n\t\t\t\t\t\t// This is a Safari bug which happens when private browsing is enabled.\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow err;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Re-select previously saved tabs.\n\t\t * Requires HTML5 sessionStorage support.\n\t\t *\n\t\t * Parameters:\n\t\t * \t(Object) Map of tab container selectors to tab selectors.\n\t\t * \tUsed to mark a specific tab as active regardless of the previously saved options.\n\t\t */\n\t\trestoreTabState: function(overrideStates) {\n\t\t\tvar self = this, url = this._tabStateUrl(),\n\t\t\t\thasSessionStorage = (typeof(window.sessionStorage)!==\"undefined\" && window.sessionStorage),\n\t\t\t\tsessionData = hasSessionStorage ? window.sessionStorage.getItem('tabs-' + url) : null,\n\t\t\t\tsessionStates = sessionData ? JSON.parse(sessionData) : false;\n\n\t\t\tthis.find('.cms-tabset, .ss-tabset').each(function() {\n\t\t\t\tvar index, tabset = $(this), tabsetId = tabset.attr('id'), tab,\n\t\t\t\t\tforcedTab = tabset.find('.ss-tabs-force-active');\n\n\t\t\t\tif(!tabset.data('tabs')){\n\t\t\t\t\treturn; // don't act on uninit'ed controls\n\t\t\t\t}\n\n\t\t\t\t// The tabs may have changed, notify the widget that it should update its internal state.\n\t\t\t\ttabset.tabs('refresh');\n\n\t\t\t\t// Make sure the intended tab is selected.\n\t\t\t\tif(forcedTab.length) {\n\t\t\t\t\tindex = forcedTab.index();\n\t\t\t\t} else if(overrideStates && overrideStates[tabsetId]) {\n\t\t\t\t\ttab = tabset.find(overrideStates[tabsetId].tabSelector);\n\t\t\t\t\tif(tab.length){\n\t\t\t\t\t\tindex = tab.index();\n\t\t\t\t\t}\n\t\t\t\t} else if(sessionStates) {\n\t\t\t\t\t$.each(sessionStates, function(i, sessionState) {\n\t\t\t\t\t\tif(tabset.is('#' + sessionState.id)){\n\t\t\t\t\t\t\tindex = sessionState.selected;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif(index !== null){\n\t\t\t\t\ttabset.tabs('option', 'active', index);\n\t\t\t\t\tself.trigger('tabstaterestored');\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Remove any previously saved state.\n\t\t *\n\t\t * Parameters:\n\t\t *  (String) url Optional (sanitized) URL to clear a specific state.\n\t\t */\n\t\tclearTabState: function(url) {\n\t\t\tif(typeof(window.sessionStorage)==\"undefined\") return;\n\n\t\t\tvar s = window.sessionStorage;\n\t\t\tif(url) {\n\t\t\t\ts.removeItem('tabs-' + url);\n\t\t\t} else {\n\t\t\t\tfor(var i=0;i<s.length;i++) {\n\t\t\t\t\tif(s.key(i).match(/^tabs-/)) s.removeItem(s.key(i));\n\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Remove tab state for the current URL.\n\t\t */\n\t\tclearCurrentTabState: function() {\n\t\t\tthis.clearTabState(this._tabStateUrl());\n\t\t},\n\n\t\t_tabStateUrl: function() {\n\t\t\treturn window.history.state.path\n\t\t\t\t.replace(/\\?.*/, '')\n\t\t\t\t.replace(/#.*/, '')\n\t\t\t\t.replace($('base').attr('href'), '');\n\t\t},\n\n\t\tshowLoginDialog: function() {\n\t\t\tvar tempid = $('body').data('member-tempid'),\n\t\t\t\tdialog = $('.leftandmain-logindialog'),\n\t\t\t\turl = 'CMSSecurity/login';\n\n\t\t\t// Force regeneration of any existing dialog\n\t\t\tif(dialog.length) dialog.remove();\n\n\t\t\t// Join url params\n\t\t\turl = $.path.addSearchParams(url, {\n\t\t\t\t'tempid': tempid,\n\t\t\t\t'BackURL': window.location.href\n\t\t\t});\n\n\t\t\t// Show a placeholder for instant feedback. Will be replaced with actual\n\t\t\t// form dialog once its loaded.\n\t\t\tdialog = $('<div class=\"leftandmain-logindialog\"></div>');\n\t\t\tdialog.attr('id', new Date().getTime());\n\t\t\tdialog.data('url', url);\n\t\t\t$('body').append(dialog);\n\t\t}\n\t});\n\n\t// Login dialog page\n\t$('.leftandmain-logindialog').entwine({\n\t\tonmatch: function() {\n\t\t\tthis._super();\n\n\t\t\t// Create jQuery dialog\n\t\t\tthis.ssdialog({\n\t\t\t\tiframeUrl: this.data('url'),\n\t\t\t\tdialogClass: \"leftandmain-logindialog-dialog\",\n\t\t\t\tautoOpen: true,\n\t\t\t\tminWidth: 500,\n\t\t\t\tmaxWidth: 500,\n\t\t\t\tminHeight: 370,\n\t\t\t\tmaxHeight: 400,\n\t\t\t\tcloseOnEscape: false,\n\t\t\t\topen: function() {\n\t\t\t\t\t$('.ui-widget-overlay').addClass('leftandmain-logindialog-overlay');\n\t\t\t\t},\n\t\t\t\tclose: function() {\n\t\t\t\t\t$('.ui-widget-overlay').removeClass('leftandmain-logindialog-overlay');\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tonunmatch: function() {\n\t\t\tthis._super();\n\t\t},\n\t\topen: function() {\n\t\t\tthis.ssdialog('open');\n\t\t},\n\t\tclose: function() {\n\t\t\tthis.ssdialog('close');\n\t\t},\n\t\ttoggle: function(bool) {\n\t\t\tif(this.is(':visible')) this.close();\n\t\t\telse this.open();\n\t\t},\n\t\t/**\n\t\t * Callback activated by CMSSecurity_success.ss\n\t\t */\n\t\treauthenticate: function(data) {\n\t\t\t// Replace all SecurityID fields with the given value\n\t\t\tif(typeof(data.SecurityID) !== 'undefined') {\n\t\t\t\t$(':input[name=SecurityID]').val(data.SecurityID);\n\t\t\t}\n\t\t\t// Update TempID for current user\n\t\t\tif(typeof(data.TempID) !== 'undefined') {\n\t\t\t\t$('body').data('member-tempid', data.TempID);\n\t\t\t}\n\t\t\tthis.close();\n\t\t}\n\t});\n\n\t/**\n\t * Add loading overlay to selected regions in the CMS automatically.\n\t * Not applied to all \"*.loading\" elements to avoid secondary regions\n\t * like the breadcrumbs showing unnecessary loading status.\n\t */\n\t$('form.loading,.cms-content.loading,.cms-content-fields.loading,.cms-content-view.loading').entwine({\n\t\tonmatch: function() {\n\t\t\tthis.append('<div class=\"cms-content-loading-overlay ui-widget-overlay-light\"></div><div class=\"cms-content-loading-spinner\"></div>');\n\t\t\tthis._super();\n\t\t},\n\t\tonunmatch: function() {\n\t\t\tthis.find('.cms-content-loading-overlay,.cms-content-loading-spinner').remove();\n\t\t\tthis._super();\n\t\t}\n\t});\n\n\t/** Make all buttons \"hoverable\" with jQuery theming. */\n\t$('.cms input[type=\"submit\"], .cms button, .cms input[type=\"reset\"], .cms .ss-ui-button').entwine({\n\t\tonadd: function() {\n\t\t\tthis.addClass('ss-ui-button');\n\t\t\tif(!this.data('button')) this.button();\n\t\t\tthis._super();\n\t\t},\n\t\tonremove: function() {\n\t\t\tif(this.data('button')) this.button('destroy');\n\t\t\tthis._super();\n\t\t}\n\t});\n\n\t/**\n\t * Loads the link's 'href' attribute into a panel via ajax,\n\t * as opposed to triggering a full page reload.\n\t * Little helper to avoid repetition, and make it easy to\n\t * \"opt in\" to panel loading, while by default links still exhibit their default behaviour.\n\t * The PJAX target can be specified via a 'data-pjax-target' attribute.\n\t */\n\t$('.cms .cms-panel-link').entwine({\n\t\tonclick: function(e) {\n\t\t\tif($(this).hasClass('external-link')) {\n\t\t\t\te.stopPropagation();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar href = this.attr('href'),\n\t\t\t\turl = (href && !href.match(/^#/)) ? href : this.data('href'),\n\t\t\t\tdata = {pjax: this.data('pjaxTarget')};\n\n\t\t\t$('.cms-container').loadPanel(url, null, data);\n\t\t\te.preventDefault();\n\t\t}\n\t});\n\n\t/**\n\t * Does an ajax loads of the link's 'href' attribute via ajax and displays any FormResponse messages from the CMS.\n\t * Little helper to avoid repetition, and make it easy to trigger actions via a link,\n\t * without reloading the page, changing the URL, or loading in any new panel content.\n\t */\n\t$('.cms .ss-ui-button-ajax').entwine({\n\t\tonclick: function(e) {\n\t\t\t$(this).removeClass('ui-button-text-only');\n\t\t\t$(this).addClass('ss-ui-button-loading ui-button-text-icons');\n\n\t\t\tvar loading = $(this).find(\".ss-ui-loading-icon\");\n\n\t\t\tif(loading.length < 1) {\n\t\t\t\tloading = $(\"<span></span>\").addClass('ss-ui-loading-icon ui-button-icon-primary ui-icon');\n\n\t\t\t\t$(this).prepend(loading);\n\t\t\t}\n\n\t\t\tloading.show();\n\n\t\t\tvar href = this.attr('href'), url = href ? href : this.data('href');\n\n\t\t\tjQuery.ajax({\n\t\t\t\turl: url,\n\t\t\t\t// Ensure that form view is loaded (rather than whole \"Content\" template)\n\t\t\t\tcomplete: function(xmlhttp, status) {\n\t\t\t\t\tvar msg = (xmlhttp.getResponseHeader('X-Status')) ? xmlhttp.getResponseHeader('X-Status') : xmlhttp.responseText;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (typeof msg != \"undefined\" && msg !== null) eval(msg);\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e) {}\n\n\t\t\t\t\tloading.hide();\n\n\t\t\t\t\t$(\".cms-container\").refresh();\n\n\t\t\t\t\t$(this).removeClass('ss-ui-button-loading ui-button-text-icons');\n\t\t\t\t\t$(this).addClass('ui-button-text-only');\n\t\t\t\t},\n\t\t\t\tdataType: 'html'\n\t\t\t});\n\t\t\te.preventDefault();\n\t\t}\n\t});\n\n\t/**\n\t * Trigger dialogs with iframe based on the links href attribute (see ssui-core.js).\n\t */\n\t$('.cms .ss-ui-dialog-link').entwine({\n\t\tUUID: null,\n\t\tonmatch: function() {\n\t\t\tthis._super();\n\t\t\tthis.setUUID(new Date().getTime());\n\t\t},\n\t\tonunmatch: function() {\n\t\t\tthis._super();\n\t\t},\n\t\tonclick: function() {\n\t\t\tthis._super();\n\n\t\t\tvar self = this, id = 'ss-ui-dialog-' + this.getUUID();\n\t\t\tvar dialog = $('#' + id);\n\t\t\tif(!dialog.length) {\n\t\t\t\tdialog = $('<div class=\"ss-ui-dialog\" id=\"' + id + '\" />');\n\t\t\t\t$('body').append(dialog);\n\t\t\t}\n\n\t\t\tvar extraClass = this.data('popupclass')?this.data('popupclass'):'';\n\n\t\t\tdialog.ssdialog({iframeUrl: this.attr('href'), autoOpen: true, dialogExtraClass: extraClass});\n\t\t\treturn false;\n\t\t}\n\t});\n\n\t/**\n\t * Add styling to all contained buttons, and create buttonsets if required.\n\t */\n\t$('.cms-content .Actions').entwine({\n\t\tonmatch: function() {\n\t\t\tthis.find('.ss-ui-button').click(function() {\n\t\t\t\t\tvar form = this.form;\n\n\t\t\t\t\t// forms don't natively store the button they've been triggered with\n\t\t\t\t\tif(form) {\n\t\t\t\t\t\tform.clickedButton = this;\n\t\t\t\t\t\t// Reset the clicked button shortly after the onsubmit handlers\n\t\t\t\t\t\t// have fired on the form\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\tform.clickedButton = null;\n\t\t\t\t\t}, 10);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.redraw();\n\t\t\tthis._super();\n\t\t},\n\t\tonunmatch: function() {\n\t\t\tthis._super();\n\t\t},\n\t\tredraw: function() {\n\t\t\tif(window.debug) console.log('redraw', this.attr('class'), this.get(0));\n\n\t\t\t// Remove whitespace to avoid gaps with inline elements\n\t\t\tthis.contents().filter(function() {\n\t\t\t\treturn (this.nodeType == 3 && !/\\S/.test(this.nodeValue));\n\t\t\t}).remove();\n\n\t\t\t// Init buttons if required\n\t\t\tthis.find('.ss-ui-button').each(function() {\n\t\t\t\tif(!$(this).data('button')) $(this).button();\n\t\t\t});\n\n\t\t\t// Mark up buttonsets\n\t\t\tthis.find('.ss-ui-buttonset').buttonset();\n\t\t}\n\t});\n\n\t/**\n\t * Duplicates functionality in DateField.js, but due to using entwine we can match\n\t * the DOM element on creation, rather than onclick - which allows us to decorate\n\t * the field with a calendar icon\n\t */\n\t$('.cms .field.date input.text').entwine({\n\t\tonmatch: function() {\n\t\t\tvar holder = $(this).parents('.field.date:first'), config = holder.data();\n\t\t\tif(!config.showcalendar) {\n\t\t\t\tthis._super();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconfig.showOn = 'button';\n\t\t\tif(config.locale && $.datepicker.regional[config.locale]) {\n\t\t\t\tconfig = $.extend(config, $.datepicker.regional[config.locale], {});\n\t\t\t}\n\n\t\t\t$(this).datepicker(config);\n\t\t\t// // Unfortunately jQuery UI only allows configuration of icon images, not sprites\n\t\t\t// this.next('button').button('option', 'icons', {primary : 'ui-icon-calendar'});\n\n\t\t\tthis._super();\n\t\t},\n\t\tonunmatch: function() {\n\t\t\tthis._super();\n\t\t}\n\t});\n\n\t/**\n\t * Styled dropdown select fields via chosen. Allows things like search and optgroup\n\t * selection support. Rather than manually adding classes to selects we want\n\t * styled, we style everything but the ones we tell it not to.\n\t *\n\t * For the CMS we also need to tell the parent div that it has a select so\n\t * we can fix the height cropping.\n\t */\n\n\t$('.cms .field.dropdown select, .cms .field select[multiple], .fieldholder-small select.dropdown').entwine({\n\t\tonmatch: function() {\n\t\t\tif(this.is('.no-chzn')) {\n\t\t\t\tthis._super();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Explicitly disable default placeholder if no custom one is defined\n\t\t\tif(!this.data('placeholder')) this.data('placeholder', ' ');\n\n\t\t\t// We could've gotten stale classes and DOM elements from deferred cache.\n\t\t\tthis.removeClass('has-chzn chzn-done');\n\t\t\tthis.siblings('.chzn-container').remove();\n\n\t\t\t// Apply Chosen\n\t\t\tapplyChosen(this);\n\n\t\t\tthis._super();\n\t\t},\n\t\tonunmatch: function() {\n\t\t\tthis._super();\n\t\t}\n\t});\n\n\t$(\".cms-panel-layout\").entwine({\n\t\tredraw: function() {\n\t\t\tif(window.debug) console.log('redraw', this.attr('class'), this.get(0));\n\t\t}\n\t});\n\n\t/**\n\t * Overload the default GridField behaviour (open a new URL in the browser)\n\t * with the CMS-specific ajax loading.\n\t */\n\t$('.cms .ss-gridfield').entwine({\n\t\tshowDetailView: function(url) {\n\t\t\t// Include any GET parameters from the current URL, as the view state might depend on it.\n\t\t\t// For example, a list prefiltered through external search criteria might be passed to GridField.\n\t\t\tvar params = window.location.search.replace(/^\\?/, '');\n\t\t\tif(params) url = $.path.addSearchParams(url, params);\n\t\t\t$('.cms-container').loadPanel(url);\n\t\t}\n\t});\n\n\n\t/**\n\t * Generic search form in the CMS, often hooked up to a GridField results display.\n\t */\n\t$('.cms-search-form').entwine({\n\t\tonsubmit: function(e) {\n\t\t\t// Remove empty elements and make the URL prettier\n\t\t\tvar nonEmptyInputs,\n\t\t\t\turl;\n\n\t\t\tnonEmptyInputs = this.find(':input:not(:submit)').filter(function() {\n\t\t\t\t// Use fieldValue() from jQuery.form plugin rather than jQuery.val(),\n\t\t\t\t// as it handles checkbox values more consistently\n\t\t\t\tvar vals = $.grep($(this).fieldValue(), function(val) { return (val);});\n\t\t\t\treturn (vals.length);\n\t\t\t});\n\n\t\t\turl = this.attr('action');\n\n\t\t\tif(nonEmptyInputs.length) {\n\t\t\t\turl = $.path.addSearchParams(url, nonEmptyInputs.serialize());\n\t\t\t}\n\n\t\t\tvar container = this.closest('.cms-container');\n\t\t\tcontainer.find('.cms-edit-form').tabs('select',0);  //always switch to the first tab (list view) when searching\n\t\t\tcontainer.loadPanel(url, \"\", {}, true);\n\n\t\t\treturn false;\n\t\t}\n\t});\n\n\t/**\n\t * Reset button handler. IE8 does not bubble reset events to\n\t */\n\t$(\".cms-search-form button[type=reset], .cms-search-form input[type=reset]\").entwine({\n\t\tonclick: function(e) {\n\t\t\te.preventDefault();\n\n\t\t\tvar form = $(this).parents('form');\n\n\t\t\tform.clearForm();\n\t\t\tform.find(\".dropdown select\").prop('selectedIndex', 0).trigger(\"liszt:updated\"); // Reset chosen.js\n\t\t\tform.submit();\n\t\t\t}\n\t});\n\n\t/**\n\t * Allows to lazy load a panel, by leaving it empty\n\t * and declaring a URL to load its content via a 'url' HTML5 data attribute.\n\t * The loaded HTML is cached, with cache key being the 'url' attribute.\n\t * In order for this to work consistently, we assume that the responses are stateless.\n\t * To avoid caching, add a 'deferred-no-cache' to the node.\n\t */\n\twindow._panelDeferredCache = {};\n\t$('.cms-panel-deferred').entwine({\n\t\tonadd: function() {\n\t\t\tthis._super();\n\t\t\tthis.redraw();\n\t\t},\n\t\tonremove: function() {\n\t\t\tif(window.debug) console.log('saving', this.data('url'), this);\n\n\t\t\t// Save the HTML state at the last possible moment.\n\t\t\t// Don't store the DOM to avoid memory leaks.\n\t\t\tif(!this.data('deferredNoCache')) window._panelDeferredCache[this.data('url')] = this.html();\n\t\t\tthis._super();\n\t\t},\n\t\tredraw: function() {\n\t\t\tif(window.debug) console.log('redraw', this.attr('class'), this.get(0));\n\n\t\t\tvar self = this, url = this.data('url');\n\t\t\tif(!url) throw 'Elements of class .cms-panel-deferred need a \"data-url\" attribute';\n\n\t\t\tthis._super();\n\n\t\t\t// If the node is empty, try to either load it from cache or via ajax.\n\t\t\tif(!this.children().length) {\n\t\t\t\tif(!this.data('deferredNoCache') && typeof window._panelDeferredCache[url] !== 'undefined') {\n\t\t\t\t\tthis.html(window._panelDeferredCache[url]);\n\t\t\t\t} else {\n\t\t\t\t\tthis.addClass('loading');\n\t\t\t\t\t$.ajax({\n\t\t\t\t\t\turl: url,\n\t\t\t\t\t\tcomplete: function() {\n\t\t\t\t\t\t\tself.removeClass('loading');\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsuccess: function(data, status, xhr) {\n\t\t\t\t\t\t\tself.html(data);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\t/**\n\t * Lightweight wrapper around jQuery UI tabs.\n\t * Ensures that anchor links are set properly,\n\t * and any nested tabs are scrolled if they have\n\t * their height explicitly set. This is important\n\t * for forms inside the CMS layout.\n\t */\n\t$('.cms-tabset').entwine({\n\t\tonadd: function() {\n\t\t\t// Can't name redraw() as it clashes with other CMS entwine classes\n\t\t\tthis.redrawTabs();\n\t\t\tthis._super();\n\t\t},\n\t\tonremove: function() {\n\t\t\tif (this.data('tabs')) this.tabs('destroy');\n\t\t\tthis._super();\n\t\t},\n\t\tredrawTabs: function() {\n\t\t\tthis.rewriteHashlinks();\n\n\t\t\tvar id = this.attr('id'), activeTab = this.find('ul:first .ui-tabs-active');\n\n\t\t\tif(!this.data('uiTabs')) this.tabs({\n\t\t\t\tactive: (activeTab.index() != -1) ? activeTab.index() : 0,\n\t\t\t\tbeforeLoad: function(e, ui) {\n\t\t\t\t\t// Disable automatic ajax loading of tabs without matching DOM elements,\n\t\t\t\t\t// determining if the current URL differs from the tab URL is too error prone.\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tactivate: function(e, ui) {\n\t\t\t\t\t// Usability: Hide actions for \"readonly\" tabs (which don't contain any editable fields)\n\t\t\t\t\tvar actions = $(this).closest('form').find('.Actions');\n\t\t\t\t\tif($(ui.newTab).closest('li').hasClass('readonly')) {\n\t\t\t\t\t\tactions.fadeOut();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tactions.show();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Ensure hash links are prefixed with the current page URL,\n\t\t * otherwise jQuery interprets them as being external.\n\t\t */\n\t\trewriteHashlinks: function() {\n\t\t\t$(this).find('ul a').each(function() {\n\t\t\t\tif (!$(this).attr('href')) return;\n\t\t\t\tvar matches = $(this).attr('href').match(/#.*/);\n\t\t\t\tif(!matches) return;\n\t\t\t\t$(this).attr('href', document.location.href.replace(/#.*/, '') + matches[0]);\n\t\t\t});\n\t\t}\n\t});\n\n\t/**\n\t * CMS content filters\n\t */\n\t$('#filters-button').entwine({\n\t\tonmatch: function () {\n\t\t\tthis._super();\n\n\t\t\tthis.data('collapsed', true); // The current collapsed state of the element.\n\t\t\tthis.data('animating', false); // True if the element is currently animating.\n\t\t},\n\t\tonunmatch: function () {\n\t\t\tthis._super();\n\t\t},\n\t\tshowHide: function () {\n\t\t\tvar self = this,\n\t\t\t\t$filters = $('.cms-content-filters').first(),\n\t\t\t\tcollapsed = this.data('collapsed');\n\n\t\t\t// Prevent the user from spamming the UI with animation requests.\n\t\t\tif (this.data('animating')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.toggleClass('active');\n\t\t\tthis.data('animating', true);\n\n\t\t\t// Slide the element down / up based on it's current collapsed state.\n\t\t\t$filters[collapsed ? 'slideDown' : 'slideUp']({\n\t\t\t\tcomplete: function () {\n\t\t\t\t\t// Update the element's state.\n\t\t\t\t\tself.data('collapsed', !collapsed);\n\t\t\t\t\tself.data('animating', false);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tonclick: function () {\n\t\t\tthis.showHide();\n\t\t}\n\t});\n});\n\nvar statusMessage = function(text, type) {\n\ttext = jQuery('<div/>').text(text).html(); // Escape HTML entities in text\n\tjQuery.noticeAdd({text: text, type: type, stayTime: 5000, inEffect: {left: '0', opacity: 'show'}});\n};\n\nvar errorMessage = function(text) {\n\tjQuery.noticeAdd({text: text, type: 'error', stayTime: 5000, inEffect: {left: '0', opacity: 'show'}});\n};\n","require('../../src/LeftAndMain.Layout.js');\nrequire('../../src/LeftAndMain.js');\nrequire('../../src/LeftAndMain.ActionTabSet.js');\nrequire('../../src/LeftAndMain.Panel.js');\nrequire('../../src/LeftAndMain.Tree.js');\nrequire('../../src/LeftAndMain.Content.js');\nrequire('../../src/LeftAndMain.EditForm.js');\nrequire('../../src/LeftAndMain.Menu.js');\nrequire('../../src/LeftAndMain.Preview.js');\nrequire('../../src/LeftAndMain.BatchActions.js');\nrequire('../../src/LeftAndMain.FieldHelp.js');\nrequire('../../src/LeftAndMain.FieldDescriptionToggle.js');\nrequire('../../src/LeftAndMain.TreeDropdownField.js');\n"]}